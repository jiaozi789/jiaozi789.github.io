<!DOCTYPE html>
<html lang="zh" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.150.0">
    <meta name="generator" content="Relearn 8.0.1+b23cf6629eada0c2802f34ae4012e04343497862">
    <meta name="description" content="ä¸€ã€Pod Kubernetesä¸ºæ¯ä¸ªPodéƒ½åˆ†é…äº†å”¯ä¸€çš„IPåœ°å€ï¼Œç§°ä¹‹ä¸ºPod IPï¼Œä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨å…±äº«Pod IPåœ°å€ã€‚Kubernetesè¦æ±‚åº•å±‚ç½‘ç»œæ”¯æŒé›†ç¾¤å†…ä»»æ„ä¸¤ä¸ªPodä¹‹é—´çš„TCP/IPç›´æ¥é€šä¿¡ï¼Œè¿™é€šå¸¸é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œä¾‹å¦‚Flannelã€Open vSwitchç­‰ã€‚å› æ­¤ï¼Œåœ¨Kubernetesé‡Œï¼Œä¸€ä¸ªPodé‡Œçš„å®¹å™¨ä¸å¦å¤–ä¸»æœºä¸Šçš„Podå®¹å™¨èƒ½å¤Ÿç›´æ¥é€šä¿¡ã€‚ Podæœ‰ä¸¤ç§ç±»å‹ï¼šæ™®é€šçš„Podå’Œé™æ€Podï¼ˆStatic Podï¼‰ï¼Œé™æ€Podä¸å­˜æ”¾åœ¨etcdå­˜å‚¨é‡Œï¼Œè€Œæ˜¯å­˜æ”¾åœ¨æŸä¸ªå…·ä½“çš„Nodeä¸Šçš„ä¸€ä¸ªå…·ä½“æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åªåœ¨æ­¤Nodeä¸Šå¯åŠ¨è¿è¡Œã€‚æ™®é€šçš„Podä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¼šè¢«å­˜å‚¨åˆ°etcdä¸­ï¼Œéšåä¼šè¢«Kubernetes Masterè°ƒåº¦åˆ°æŸä¸ªå…·ä½“çš„Nodeä¸Šå¹¶è¿›è¡Œç»‘å®šï¼ˆBindingï¼‰ï¼Œè¯¥Nodeä¸Šçš„kubeletè¿›ç¨‹ä¼šå°†å…¶å®ä¾‹åŒ–æˆä¸€ç»„ç›¸å…³çš„Dockerå®¹å™¨å¹¶å¯åŠ¨èµ·æ¥ã€‚å½“Podé‡Œçš„æŸä¸ªå®¹å™¨åœæ­¢æ—¶ï¼ŒKubernetesä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è¿™ä¸ªé—®é¢˜å¹¶ä¸”é‡æ–°å¯åŠ¨è¿™ä¸ªPodï¼ˆé‡å¯Podé‡Œçš„æ‰€æœ‰å®¹å™¨ï¼‰ï¼›å¦‚æœPodæ‰€åœ¨çš„Nodeå®•æœºï¼Œåˆ™ä¼šå°†è¿™ä¸ªNodeä¸Šçš„æ‰€æœ‰Podé‡æ–°è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ Podã€å®¹å™¨ä¸Nodeçš„å…³ç³»å¦‚ä¸‹å›¾ï¼š Kubernetesé‡Œçš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½å¯ä»¥é‡‡ç”¨yamlæˆ–è€…JSONæ ¼å¼çš„æ–‡ä»¶æ¥å®šä¹‰æˆ–æè¿°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Podèµ„æºå®šä¹‰æ–‡ä»¶ï¼š
apiVersion: v1 kind: Pod metadata: name: myweb labels: name: myweb spec: containers: - name: myweb image: kubeguide/tomcat-app: v1 ports: - containerPort: 8080 env: - name: MYSQL_SERVICE_HOST value: &#39;mysql&#39; - name: MYSQL_SERVICE_PORT value: &#39;3306&#39; kindä¸ºpodè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªPodçš„å®šä¹‰ï¼Œmetadataé‡Œçš„nameå±æ€§ä¸ºPodçš„åå­—ï¼Œmetadataé‡Œè¿˜èƒ½å®šä¹‰èµ„æºå¯¹è±¡çš„æ ‡ç­¾ï¼ˆLabelï¼‰ï¼Œè¿™é‡Œå£°æ˜mywebæ‹¥æœ‰ä¸€ä¸ªname=mywebçš„æ ‡ç­¾ï¼ˆLabelï¼‰ã€‚Podé‡ŒåŒ…å«çš„å®¹å™¨ç»„çš„å®šä¹‰åˆ™åœ¨specä¸€èŠ‚ä¸­å£°æ˜ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåå­—ä¸ºmywebï¼Œå¯¹åº”é•œåƒä¸ºkubeguide/tomcat-app: v1çš„å®¹å™¨ï¼Œè¯¥å®¹å™¨æ³¨å…¥äº†åä¸ºMYSQL_SERVICE_HOST=â€˜mysqlâ€™å’ŒMYSQL_SERVICE_PORT=â€˜3306â€™çš„ç¯å¢ƒå˜é‡ï¼ˆenvå…³é”®å­—ï¼‰ï¼Œå¹¶ä¸”åœ¨8080ç«¯å£ï¼ˆcontainerPortï¼‰ä¸Šå¯åŠ¨å®¹å™¨è¿›ç¨‹ã€‚Podçš„IPåŠ ä¸Šè¿™é‡Œçš„å®¹å™¨ç«¯å£ï¼Œå°±ç»„æˆäº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µâ€”â€”Endpointï¼Œå®ƒä»£è¡¨ç€æ­¤Podé‡Œçš„ä¸€ä¸ªæœåŠ¡è¿›ç¨‹çš„å¯¹å¤–é€šä¿¡åœ°å€ã€‚ä¸€ä¸ªPodä¹Ÿå­˜åœ¨ç€å…·æœ‰å¤šä¸ªEndpointçš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠTomcatå®šä¹‰ä¸ºä¸€ä¸ªPodæ—¶ï¼Œå¯ä»¥å¯¹å¤–æš´éœ²ç®¡ç†ç«¯å£ä¸æœåŠ¡ç«¯å£è¿™ä¸¤ä¸ªEndpointã€‚ Dockeré‡Œçš„Volumeåœ¨Kubernetesé‡Œä¹Ÿæœ‰å¯¹åº”çš„æ¦‚å¿µâ€”â€”Pod Volumeï¼ŒPod Volumeæœ‰ä¸€äº›æ‰©å±•ï¼Œæ¯”å¦‚å¯ä»¥ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸGlusterFSç­‰å®ç°åç«¯å­˜å‚¨åŠŸèƒ½ï¼›Pod Volumeæ˜¯å®šä¹‰åœ¨Podä¹‹ä¸Šï¼Œç„¶åè¢«å„ä¸ªå®¹å™¨æŒ‚è½½åˆ°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ã€‚å¯¹äºPod Volumeçš„å®šä¹‰æˆ‘ä»¬åé¢ä¼šè®²åˆ°ã€‚ è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹Eventæ¦‚å¿µï¼ŒEventæ˜¯ä¸€ä¸ªäº‹ä»¶çš„è®°å½•ï¼Œè®°å½•äº†äº‹ä»¶çš„æœ€æ—©äº§ç”Ÿæ—¶é—´ã€æœ€åé‡ç°æ—¶é—´ã€é‡å¤æ¬¡æ•°ã€å‘èµ·è€…ã€ç±»å‹ï¼Œä»¥åŠå¯¼è‡´æ­¤äº‹ä»¶çš„åŸå› ç­‰ä¼—å¤šä¿¡æ¯ã€‚Eventé€šå¸¸ä¼šå…³è”åˆ°æŸä¸ªå…·ä½“çš„èµ„æºå¯¹è±¡ä¸Šï¼Œæ˜¯æ’æŸ¥æ•…éšœçš„é‡è¦å‚è€ƒä¿¡æ¯ï¼Œå½“æˆ‘ä»¬å‘ç°æŸä¸ªPodè¿Ÿè¿Ÿæ— æ³•åˆ›å»ºæ—¶ï¼Œå¯ä»¥ç”¨kubectl describe pod xxxæ¥æŸ¥çœ‹å®ƒçš„æè¿°ä¿¡æ¯ï¼Œç”¨æ¥å®šä½é—®é¢˜çš„åŸå› ã€‚ æ¯ä¸ªPodéƒ½å¯ä»¥å¯¹å…¶èƒ½ä½¿ç”¨çš„æœåŠ¡å™¨ä¸Šçš„è®¡ç®—èµ„æºè®¾ç½®é™é¢ï¼Œå½“å‰å¯ä»¥è®¾ç½®é™é¢çš„è®¡ç®—èµ„æºæœ‰CPUå’ŒMemoryä¸¤ç§ï¼Œå…¶ä¸­CPUçš„èµ„æºå•ä½ä¸ºCPUï¼ˆCoreï¼‰çš„æ•°é‡ï¼Œæ˜¯ä¸€ä¸ªç»å¯¹å€¼ã€‚ å¯¹äºå®¹å™¨æ¥è¯´ä¸€ä¸ªCPUçš„é…é¢å·²ç»æ˜¯ç›¸å½“å¤§çš„èµ„æºé…é¢äº†ï¼Œæ‰€ä»¥åœ¨Kubernetesé‡Œï¼Œé€šå¸¸ä»¥åƒåˆ†ä¹‹ä¸€çš„CPUé…é¢ä¸ºæœ€å°å•ä½ï¼Œç”¨mæ¥è¡¨ç¤ºã€‚é€šå¸¸ä¸€ä¸ªå®¹å™¨çš„CPUé…é¢è¢«å®šä¹‰ä¸º100-300mï¼Œå³å ç”¨0.1-0.3ä¸ªCPUã€‚ä¸CPUé…é¢ç±»ä¼¼ï¼ŒMemoryé…é¢ä¹Ÿæ˜¯ä¸€ä¸ªç»å¯¹å€¼ï¼Œå®ƒçš„å•ä½æ˜¯å†…å­˜å­—èŠ‚æ•°ã€‚ å¯¹è®¡ç®—èµ„æºè¿›è¡Œé…é¢é™å®šéœ€è¦è®¾å®šä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š
Requestsï¼šè¯¥èµ„æºçš„æœ€å°ç”³è¯·é‡ï¼Œç³»ç»Ÿå¿…é¡»æ»¡è¶³è¦æ±‚ã€‚ Limitsï¼šè¯¥èµ„æºæœ€å¤§å…è®¸ä½¿ç”¨çš„é‡ï¼Œä¸èƒ½è¶…è¿‡è¿™ä¸ªä½¿ç”¨é™åˆ¶ï¼Œå½“å®¹å™¨è¯•å›¾ä½¿ç”¨è¶…è¿‡è¿™ä¸ªé‡çš„èµ„æºæ—¶ï¼Œå¯èƒ½ä¼šè¢«Kubernetes Killå¹¶é‡å¯ã€‚ é€šå¸¸æˆ‘ä»¬åº”è¯¥æŠŠRequestsè®¾ç½®ä¸ºä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°å€¼ï¼Œæ»¡è¶³å®¹å™¨å¹³æ—¶çš„å·¥ä½œè´Ÿè½½æƒ…å†µä¸‹çš„èµ„æºéœ€æ±‚ï¼Œè€ŒæŠŠLimitsè®¾ç½®ä¸ºå³°å€¼è´Ÿè½½æƒ…å†µä¸‹èµ„æºå ç”¨çš„æœ€å¤§é‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªèµ„æºé…é¢çš„ç®€å•å®šä¹‰ï¼š
spec: containers: - name: db image: mysql resources: requests: memory: &#34;64Mi&#34; cpu: &#34;250m&#34; limits: memory: &#34;128Mi&#34; cpu: &#34;500m&#34; æœ€å°0.25ä¸ªCPUåŠ64MBå†…å­˜ï¼Œæœ€å¤§0.5ä¸ªCPUåŠ128MBå†…å­˜ã€‚
äºŒã€Labelï¼ˆæ ‡ç­¾ï¼‰ Labelç›¸å½“äºæˆ‘ä»¬ç†Ÿæ‚‰çš„â€œæ ‡ç­¾â€ï¼Œç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰ä¸€ä¸ªLabelï¼Œå°±ç›¸å½“äºç»™å®ƒæ‰“äº†ä¸€ä¸ªæ ‡ç­¾ï¼Œéšåå¯ä»¥é€šè¿‡Label Selectorï¼ˆæ ‡ç­¾é€‰æ‹©å™¨ï¼‰æŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›Labelçš„èµ„æºå¯¹è±¡ï¼ŒKubernetesé€šè¿‡è¿™ç§æ–¹å¼å®ç°äº†ç±»ä¼¼SQLçš„ç®€å•åˆé€šç”¨çš„å¯¹è±¡æŸ¥è¯¢æœºåˆ¶ã€‚ Label Selectorç›¸å½“äºSQLè¯­å¥ä¸­çš„whereæŸ¥è¯¢æ¡ä»¶ï¼Œä¾‹å¦‚ï¼Œname=redis-slaveè¿™ä¸ªLabel Selectorä½œç”¨äºPodæ—¶ï¼Œç›¸å½“äºselect * from pod where podâ€™s name = â€˜redis-slaveâ€™è¿™æ ·çš„è¯­å¥ã€‚Label Selectorçš„è¡¨è¾¾å¼æœ‰ä¸¤ç§ï¼šåŸºäºç­‰å¼çš„ï¼ˆEquality-basedï¼‰å’ŒåŸºäºé›†åˆçš„ï¼ˆSet-basedï¼‰ã€‚ä¸‹é¢æ˜¯åŸºäºç­‰å¼çš„åŒ¹é…ä¾‹å­ã€‚ name=redis-slaveï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾ä¸ºname=redis-slaveçš„èµ„æºå¯¹è±¡ã€‚ env != productionï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾envä¸ç­‰äºproductionçš„èµ„æºå¯¹è±¡ã€‚ ä¸‹é¢æ˜¯åŸºäºé›†åˆçš„åŒ¹é…ä¾‹å­">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="K8SäºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰ :: liaomin416100569åšå®¢">
    <meta name="twitter:description" content="ä¸€ã€Pod Kubernetesä¸ºæ¯ä¸ªPodéƒ½åˆ†é…äº†å”¯ä¸€çš„IPåœ°å€ï¼Œç§°ä¹‹ä¸ºPod IPï¼Œä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨å…±äº«Pod IPåœ°å€ã€‚Kubernetesè¦æ±‚åº•å±‚ç½‘ç»œæ”¯æŒé›†ç¾¤å†…ä»»æ„ä¸¤ä¸ªPodä¹‹é—´çš„TCP/IPç›´æ¥é€šä¿¡ï¼Œè¿™é€šå¸¸é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œä¾‹å¦‚Flannelã€Open vSwitchç­‰ã€‚å› æ­¤ï¼Œåœ¨Kubernetesé‡Œï¼Œä¸€ä¸ªPodé‡Œçš„å®¹å™¨ä¸å¦å¤–ä¸»æœºä¸Šçš„Podå®¹å™¨èƒ½å¤Ÿç›´æ¥é€šä¿¡ã€‚ Podæœ‰ä¸¤ç§ç±»å‹ï¼šæ™®é€šçš„Podå’Œé™æ€Podï¼ˆStatic Podï¼‰ï¼Œé™æ€Podä¸å­˜æ”¾åœ¨etcdå­˜å‚¨é‡Œï¼Œè€Œæ˜¯å­˜æ”¾åœ¨æŸä¸ªå…·ä½“çš„Nodeä¸Šçš„ä¸€ä¸ªå…·ä½“æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åªåœ¨æ­¤Nodeä¸Šå¯åŠ¨è¿è¡Œã€‚æ™®é€šçš„Podä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¼šè¢«å­˜å‚¨åˆ°etcdä¸­ï¼Œéšåä¼šè¢«Kubernetes Masterè°ƒåº¦åˆ°æŸä¸ªå…·ä½“çš„Nodeä¸Šå¹¶è¿›è¡Œç»‘å®šï¼ˆBindingï¼‰ï¼Œè¯¥Nodeä¸Šçš„kubeletè¿›ç¨‹ä¼šå°†å…¶å®ä¾‹åŒ–æˆä¸€ç»„ç›¸å…³çš„Dockerå®¹å™¨å¹¶å¯åŠ¨èµ·æ¥ã€‚å½“Podé‡Œçš„æŸä¸ªå®¹å™¨åœæ­¢æ—¶ï¼ŒKubernetesä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è¿™ä¸ªé—®é¢˜å¹¶ä¸”é‡æ–°å¯åŠ¨è¿™ä¸ªPodï¼ˆé‡å¯Podé‡Œçš„æ‰€æœ‰å®¹å™¨ï¼‰ï¼›å¦‚æœPodæ‰€åœ¨çš„Nodeå®•æœºï¼Œåˆ™ä¼šå°†è¿™ä¸ªNodeä¸Šçš„æ‰€æœ‰Podé‡æ–°è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ Podã€å®¹å™¨ä¸Nodeçš„å…³ç³»å¦‚ä¸‹å›¾ï¼š Kubernetesé‡Œçš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½å¯ä»¥é‡‡ç”¨yamlæˆ–è€…JSONæ ¼å¼çš„æ–‡ä»¶æ¥å®šä¹‰æˆ–æè¿°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Podèµ„æºå®šä¹‰æ–‡ä»¶ï¼š
apiVersion: v1 kind: Pod metadata: name: myweb labels: name: myweb spec: containers: - name: myweb image: kubeguide/tomcat-app: v1 ports: - containerPort: 8080 env: - name: MYSQL_SERVICE_HOST value: &#39;mysql&#39; - name: MYSQL_SERVICE_PORT value: &#39;3306&#39; kindä¸ºpodè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªPodçš„å®šä¹‰ï¼Œmetadataé‡Œçš„nameå±æ€§ä¸ºPodçš„åå­—ï¼Œmetadataé‡Œè¿˜èƒ½å®šä¹‰èµ„æºå¯¹è±¡çš„æ ‡ç­¾ï¼ˆLabelï¼‰ï¼Œè¿™é‡Œå£°æ˜mywebæ‹¥æœ‰ä¸€ä¸ªname=mywebçš„æ ‡ç­¾ï¼ˆLabelï¼‰ã€‚Podé‡ŒåŒ…å«çš„å®¹å™¨ç»„çš„å®šä¹‰åˆ™åœ¨specä¸€èŠ‚ä¸­å£°æ˜ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåå­—ä¸ºmywebï¼Œå¯¹åº”é•œåƒä¸ºkubeguide/tomcat-app: v1çš„å®¹å™¨ï¼Œè¯¥å®¹å™¨æ³¨å…¥äº†åä¸ºMYSQL_SERVICE_HOST=â€˜mysqlâ€™å’ŒMYSQL_SERVICE_PORT=â€˜3306â€™çš„ç¯å¢ƒå˜é‡ï¼ˆenvå…³é”®å­—ï¼‰ï¼Œå¹¶ä¸”åœ¨8080ç«¯å£ï¼ˆcontainerPortï¼‰ä¸Šå¯åŠ¨å®¹å™¨è¿›ç¨‹ã€‚Podçš„IPåŠ ä¸Šè¿™é‡Œçš„å®¹å™¨ç«¯å£ï¼Œå°±ç»„æˆäº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µâ€”â€”Endpointï¼Œå®ƒä»£è¡¨ç€æ­¤Podé‡Œçš„ä¸€ä¸ªæœåŠ¡è¿›ç¨‹çš„å¯¹å¤–é€šä¿¡åœ°å€ã€‚ä¸€ä¸ªPodä¹Ÿå­˜åœ¨ç€å…·æœ‰å¤šä¸ªEndpointçš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠTomcatå®šä¹‰ä¸ºä¸€ä¸ªPodæ—¶ï¼Œå¯ä»¥å¯¹å¤–æš´éœ²ç®¡ç†ç«¯å£ä¸æœåŠ¡ç«¯å£è¿™ä¸¤ä¸ªEndpointã€‚ Dockeré‡Œçš„Volumeåœ¨Kubernetesé‡Œä¹Ÿæœ‰å¯¹åº”çš„æ¦‚å¿µâ€”â€”Pod Volumeï¼ŒPod Volumeæœ‰ä¸€äº›æ‰©å±•ï¼Œæ¯”å¦‚å¯ä»¥ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸGlusterFSç­‰å®ç°åç«¯å­˜å‚¨åŠŸèƒ½ï¼›Pod Volumeæ˜¯å®šä¹‰åœ¨Podä¹‹ä¸Šï¼Œç„¶åè¢«å„ä¸ªå®¹å™¨æŒ‚è½½åˆ°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ã€‚å¯¹äºPod Volumeçš„å®šä¹‰æˆ‘ä»¬åé¢ä¼šè®²åˆ°ã€‚ è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹Eventæ¦‚å¿µï¼ŒEventæ˜¯ä¸€ä¸ªäº‹ä»¶çš„è®°å½•ï¼Œè®°å½•äº†äº‹ä»¶çš„æœ€æ—©äº§ç”Ÿæ—¶é—´ã€æœ€åé‡ç°æ—¶é—´ã€é‡å¤æ¬¡æ•°ã€å‘èµ·è€…ã€ç±»å‹ï¼Œä»¥åŠå¯¼è‡´æ­¤äº‹ä»¶çš„åŸå› ç­‰ä¼—å¤šä¿¡æ¯ã€‚Eventé€šå¸¸ä¼šå…³è”åˆ°æŸä¸ªå…·ä½“çš„èµ„æºå¯¹è±¡ä¸Šï¼Œæ˜¯æ’æŸ¥æ•…éšœçš„é‡è¦å‚è€ƒä¿¡æ¯ï¼Œå½“æˆ‘ä»¬å‘ç°æŸä¸ªPodè¿Ÿè¿Ÿæ— æ³•åˆ›å»ºæ—¶ï¼Œå¯ä»¥ç”¨kubectl describe pod xxxæ¥æŸ¥çœ‹å®ƒçš„æè¿°ä¿¡æ¯ï¼Œç”¨æ¥å®šä½é—®é¢˜çš„åŸå› ã€‚ æ¯ä¸ªPodéƒ½å¯ä»¥å¯¹å…¶èƒ½ä½¿ç”¨çš„æœåŠ¡å™¨ä¸Šçš„è®¡ç®—èµ„æºè®¾ç½®é™é¢ï¼Œå½“å‰å¯ä»¥è®¾ç½®é™é¢çš„è®¡ç®—èµ„æºæœ‰CPUå’ŒMemoryä¸¤ç§ï¼Œå…¶ä¸­CPUçš„èµ„æºå•ä½ä¸ºCPUï¼ˆCoreï¼‰çš„æ•°é‡ï¼Œæ˜¯ä¸€ä¸ªç»å¯¹å€¼ã€‚ å¯¹äºå®¹å™¨æ¥è¯´ä¸€ä¸ªCPUçš„é…é¢å·²ç»æ˜¯ç›¸å½“å¤§çš„èµ„æºé…é¢äº†ï¼Œæ‰€ä»¥åœ¨Kubernetesé‡Œï¼Œé€šå¸¸ä»¥åƒåˆ†ä¹‹ä¸€çš„CPUé…é¢ä¸ºæœ€å°å•ä½ï¼Œç”¨mæ¥è¡¨ç¤ºã€‚é€šå¸¸ä¸€ä¸ªå®¹å™¨çš„CPUé…é¢è¢«å®šä¹‰ä¸º100-300mï¼Œå³å ç”¨0.1-0.3ä¸ªCPUã€‚ä¸CPUé…é¢ç±»ä¼¼ï¼ŒMemoryé…é¢ä¹Ÿæ˜¯ä¸€ä¸ªç»å¯¹å€¼ï¼Œå®ƒçš„å•ä½æ˜¯å†…å­˜å­—èŠ‚æ•°ã€‚ å¯¹è®¡ç®—èµ„æºè¿›è¡Œé…é¢é™å®šéœ€è¦è®¾å®šä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š
Requestsï¼šè¯¥èµ„æºçš„æœ€å°ç”³è¯·é‡ï¼Œç³»ç»Ÿå¿…é¡»æ»¡è¶³è¦æ±‚ã€‚ Limitsï¼šè¯¥èµ„æºæœ€å¤§å…è®¸ä½¿ç”¨çš„é‡ï¼Œä¸èƒ½è¶…è¿‡è¿™ä¸ªä½¿ç”¨é™åˆ¶ï¼Œå½“å®¹å™¨è¯•å›¾ä½¿ç”¨è¶…è¿‡è¿™ä¸ªé‡çš„èµ„æºæ—¶ï¼Œå¯èƒ½ä¼šè¢«Kubernetes Killå¹¶é‡å¯ã€‚ é€šå¸¸æˆ‘ä»¬åº”è¯¥æŠŠRequestsè®¾ç½®ä¸ºä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°å€¼ï¼Œæ»¡è¶³å®¹å™¨å¹³æ—¶çš„å·¥ä½œè´Ÿè½½æƒ…å†µä¸‹çš„èµ„æºéœ€æ±‚ï¼Œè€ŒæŠŠLimitsè®¾ç½®ä¸ºå³°å€¼è´Ÿè½½æƒ…å†µä¸‹èµ„æºå ç”¨çš„æœ€å¤§é‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªèµ„æºé…é¢çš„ç®€å•å®šä¹‰ï¼š
spec: containers: - name: db image: mysql resources: requests: memory: &#34;64Mi&#34; cpu: &#34;250m&#34; limits: memory: &#34;128Mi&#34; cpu: &#34;500m&#34; æœ€å°0.25ä¸ªCPUåŠ64MBå†…å­˜ï¼Œæœ€å¤§0.5ä¸ªCPUåŠ128MBå†…å­˜ã€‚
äºŒã€Labelï¼ˆæ ‡ç­¾ï¼‰ Labelç›¸å½“äºæˆ‘ä»¬ç†Ÿæ‚‰çš„â€œæ ‡ç­¾â€ï¼Œç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰ä¸€ä¸ªLabelï¼Œå°±ç›¸å½“äºç»™å®ƒæ‰“äº†ä¸€ä¸ªæ ‡ç­¾ï¼Œéšåå¯ä»¥é€šè¿‡Label Selectorï¼ˆæ ‡ç­¾é€‰æ‹©å™¨ï¼‰æŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›Labelçš„èµ„æºå¯¹è±¡ï¼ŒKubernetesé€šè¿‡è¿™ç§æ–¹å¼å®ç°äº†ç±»ä¼¼SQLçš„ç®€å•åˆé€šç”¨çš„å¯¹è±¡æŸ¥è¯¢æœºåˆ¶ã€‚ Label Selectorç›¸å½“äºSQLè¯­å¥ä¸­çš„whereæŸ¥è¯¢æ¡ä»¶ï¼Œä¾‹å¦‚ï¼Œname=redis-slaveè¿™ä¸ªLabel Selectorä½œç”¨äºPodæ—¶ï¼Œç›¸å½“äºselect * from pod where podâ€™s name = â€˜redis-slaveâ€™è¿™æ ·çš„è¯­å¥ã€‚Label Selectorçš„è¡¨è¾¾å¼æœ‰ä¸¤ç§ï¼šåŸºäºç­‰å¼çš„ï¼ˆEquality-basedï¼‰å’ŒåŸºäºé›†åˆçš„ï¼ˆSet-basedï¼‰ã€‚ä¸‹é¢æ˜¯åŸºäºç­‰å¼çš„åŒ¹é…ä¾‹å­ã€‚ name=redis-slaveï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾ä¸ºname=redis-slaveçš„èµ„æºå¯¹è±¡ã€‚ env != productionï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾envä¸ç­‰äºproductionçš„èµ„æºå¯¹è±¡ã€‚ ä¸‹é¢æ˜¯åŸºäºé›†åˆçš„åŒ¹é…ä¾‹å­">
    <meta property="og:url" content="https://jiaozi789.github.io/docs/devops/kubernetes/k8s_dev_01/index.html">
    <meta property="og:site_name" content="liaomin416100569åšå®¢">
    <meta property="og:title" content="K8SäºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰ :: liaomin416100569åšå®¢">
    <meta property="og:description" content="ä¸€ã€Pod Kubernetesä¸ºæ¯ä¸ªPodéƒ½åˆ†é…äº†å”¯ä¸€çš„IPåœ°å€ï¼Œç§°ä¹‹ä¸ºPod IPï¼Œä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨å…±äº«Pod IPåœ°å€ã€‚Kubernetesè¦æ±‚åº•å±‚ç½‘ç»œæ”¯æŒé›†ç¾¤å†…ä»»æ„ä¸¤ä¸ªPodä¹‹é—´çš„TCP/IPç›´æ¥é€šä¿¡ï¼Œè¿™é€šå¸¸é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œä¾‹å¦‚Flannelã€Open vSwitchç­‰ã€‚å› æ­¤ï¼Œåœ¨Kubernetesé‡Œï¼Œä¸€ä¸ªPodé‡Œçš„å®¹å™¨ä¸å¦å¤–ä¸»æœºä¸Šçš„Podå®¹å™¨èƒ½å¤Ÿç›´æ¥é€šä¿¡ã€‚ Podæœ‰ä¸¤ç§ç±»å‹ï¼šæ™®é€šçš„Podå’Œé™æ€Podï¼ˆStatic Podï¼‰ï¼Œé™æ€Podä¸å­˜æ”¾åœ¨etcdå­˜å‚¨é‡Œï¼Œè€Œæ˜¯å­˜æ”¾åœ¨æŸä¸ªå…·ä½“çš„Nodeä¸Šçš„ä¸€ä¸ªå…·ä½“æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åªåœ¨æ­¤Nodeä¸Šå¯åŠ¨è¿è¡Œã€‚æ™®é€šçš„Podä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¼šè¢«å­˜å‚¨åˆ°etcdä¸­ï¼Œéšåä¼šè¢«Kubernetes Masterè°ƒåº¦åˆ°æŸä¸ªå…·ä½“çš„Nodeä¸Šå¹¶è¿›è¡Œç»‘å®šï¼ˆBindingï¼‰ï¼Œè¯¥Nodeä¸Šçš„kubeletè¿›ç¨‹ä¼šå°†å…¶å®ä¾‹åŒ–æˆä¸€ç»„ç›¸å…³çš„Dockerå®¹å™¨å¹¶å¯åŠ¨èµ·æ¥ã€‚å½“Podé‡Œçš„æŸä¸ªå®¹å™¨åœæ­¢æ—¶ï¼ŒKubernetesä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è¿™ä¸ªé—®é¢˜å¹¶ä¸”é‡æ–°å¯åŠ¨è¿™ä¸ªPodï¼ˆé‡å¯Podé‡Œçš„æ‰€æœ‰å®¹å™¨ï¼‰ï¼›å¦‚æœPodæ‰€åœ¨çš„Nodeå®•æœºï¼Œåˆ™ä¼šå°†è¿™ä¸ªNodeä¸Šçš„æ‰€æœ‰Podé‡æ–°è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ Podã€å®¹å™¨ä¸Nodeçš„å…³ç³»å¦‚ä¸‹å›¾ï¼š Kubernetesé‡Œçš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½å¯ä»¥é‡‡ç”¨yamlæˆ–è€…JSONæ ¼å¼çš„æ–‡ä»¶æ¥å®šä¹‰æˆ–æè¿°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Podèµ„æºå®šä¹‰æ–‡ä»¶ï¼š
apiVersion: v1 kind: Pod metadata: name: myweb labels: name: myweb spec: containers: - name: myweb image: kubeguide/tomcat-app: v1 ports: - containerPort: 8080 env: - name: MYSQL_SERVICE_HOST value: &#39;mysql&#39; - name: MYSQL_SERVICE_PORT value: &#39;3306&#39; kindä¸ºpodè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªPodçš„å®šä¹‰ï¼Œmetadataé‡Œçš„nameå±æ€§ä¸ºPodçš„åå­—ï¼Œmetadataé‡Œè¿˜èƒ½å®šä¹‰èµ„æºå¯¹è±¡çš„æ ‡ç­¾ï¼ˆLabelï¼‰ï¼Œè¿™é‡Œå£°æ˜mywebæ‹¥æœ‰ä¸€ä¸ªname=mywebçš„æ ‡ç­¾ï¼ˆLabelï¼‰ã€‚Podé‡ŒåŒ…å«çš„å®¹å™¨ç»„çš„å®šä¹‰åˆ™åœ¨specä¸€èŠ‚ä¸­å£°æ˜ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåå­—ä¸ºmywebï¼Œå¯¹åº”é•œåƒä¸ºkubeguide/tomcat-app: v1çš„å®¹å™¨ï¼Œè¯¥å®¹å™¨æ³¨å…¥äº†åä¸ºMYSQL_SERVICE_HOST=â€˜mysqlâ€™å’ŒMYSQL_SERVICE_PORT=â€˜3306â€™çš„ç¯å¢ƒå˜é‡ï¼ˆenvå…³é”®å­—ï¼‰ï¼Œå¹¶ä¸”åœ¨8080ç«¯å£ï¼ˆcontainerPortï¼‰ä¸Šå¯åŠ¨å®¹å™¨è¿›ç¨‹ã€‚Podçš„IPåŠ ä¸Šè¿™é‡Œçš„å®¹å™¨ç«¯å£ï¼Œå°±ç»„æˆäº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µâ€”â€”Endpointï¼Œå®ƒä»£è¡¨ç€æ­¤Podé‡Œçš„ä¸€ä¸ªæœåŠ¡è¿›ç¨‹çš„å¯¹å¤–é€šä¿¡åœ°å€ã€‚ä¸€ä¸ªPodä¹Ÿå­˜åœ¨ç€å…·æœ‰å¤šä¸ªEndpointçš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠTomcatå®šä¹‰ä¸ºä¸€ä¸ªPodæ—¶ï¼Œå¯ä»¥å¯¹å¤–æš´éœ²ç®¡ç†ç«¯å£ä¸æœåŠ¡ç«¯å£è¿™ä¸¤ä¸ªEndpointã€‚ Dockeré‡Œçš„Volumeåœ¨Kubernetesé‡Œä¹Ÿæœ‰å¯¹åº”çš„æ¦‚å¿µâ€”â€”Pod Volumeï¼ŒPod Volumeæœ‰ä¸€äº›æ‰©å±•ï¼Œæ¯”å¦‚å¯ä»¥ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸGlusterFSç­‰å®ç°åç«¯å­˜å‚¨åŠŸèƒ½ï¼›Pod Volumeæ˜¯å®šä¹‰åœ¨Podä¹‹ä¸Šï¼Œç„¶åè¢«å„ä¸ªå®¹å™¨æŒ‚è½½åˆ°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ã€‚å¯¹äºPod Volumeçš„å®šä¹‰æˆ‘ä»¬åé¢ä¼šè®²åˆ°ã€‚ è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹Eventæ¦‚å¿µï¼ŒEventæ˜¯ä¸€ä¸ªäº‹ä»¶çš„è®°å½•ï¼Œè®°å½•äº†äº‹ä»¶çš„æœ€æ—©äº§ç”Ÿæ—¶é—´ã€æœ€åé‡ç°æ—¶é—´ã€é‡å¤æ¬¡æ•°ã€å‘èµ·è€…ã€ç±»å‹ï¼Œä»¥åŠå¯¼è‡´æ­¤äº‹ä»¶çš„åŸå› ç­‰ä¼—å¤šä¿¡æ¯ã€‚Eventé€šå¸¸ä¼šå…³è”åˆ°æŸä¸ªå…·ä½“çš„èµ„æºå¯¹è±¡ä¸Šï¼Œæ˜¯æ’æŸ¥æ•…éšœçš„é‡è¦å‚è€ƒä¿¡æ¯ï¼Œå½“æˆ‘ä»¬å‘ç°æŸä¸ªPodè¿Ÿè¿Ÿæ— æ³•åˆ›å»ºæ—¶ï¼Œå¯ä»¥ç”¨kubectl describe pod xxxæ¥æŸ¥çœ‹å®ƒçš„æè¿°ä¿¡æ¯ï¼Œç”¨æ¥å®šä½é—®é¢˜çš„åŸå› ã€‚ æ¯ä¸ªPodéƒ½å¯ä»¥å¯¹å…¶èƒ½ä½¿ç”¨çš„æœåŠ¡å™¨ä¸Šçš„è®¡ç®—èµ„æºè®¾ç½®é™é¢ï¼Œå½“å‰å¯ä»¥è®¾ç½®é™é¢çš„è®¡ç®—èµ„æºæœ‰CPUå’ŒMemoryä¸¤ç§ï¼Œå…¶ä¸­CPUçš„èµ„æºå•ä½ä¸ºCPUï¼ˆCoreï¼‰çš„æ•°é‡ï¼Œæ˜¯ä¸€ä¸ªç»å¯¹å€¼ã€‚ å¯¹äºå®¹å™¨æ¥è¯´ä¸€ä¸ªCPUçš„é…é¢å·²ç»æ˜¯ç›¸å½“å¤§çš„èµ„æºé…é¢äº†ï¼Œæ‰€ä»¥åœ¨Kubernetesé‡Œï¼Œé€šå¸¸ä»¥åƒåˆ†ä¹‹ä¸€çš„CPUé…é¢ä¸ºæœ€å°å•ä½ï¼Œç”¨mæ¥è¡¨ç¤ºã€‚é€šå¸¸ä¸€ä¸ªå®¹å™¨çš„CPUé…é¢è¢«å®šä¹‰ä¸º100-300mï¼Œå³å ç”¨0.1-0.3ä¸ªCPUã€‚ä¸CPUé…é¢ç±»ä¼¼ï¼ŒMemoryé…é¢ä¹Ÿæ˜¯ä¸€ä¸ªç»å¯¹å€¼ï¼Œå®ƒçš„å•ä½æ˜¯å†…å­˜å­—èŠ‚æ•°ã€‚ å¯¹è®¡ç®—èµ„æºè¿›è¡Œé…é¢é™å®šéœ€è¦è®¾å®šä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š
Requestsï¼šè¯¥èµ„æºçš„æœ€å°ç”³è¯·é‡ï¼Œç³»ç»Ÿå¿…é¡»æ»¡è¶³è¦æ±‚ã€‚ Limitsï¼šè¯¥èµ„æºæœ€å¤§å…è®¸ä½¿ç”¨çš„é‡ï¼Œä¸èƒ½è¶…è¿‡è¿™ä¸ªä½¿ç”¨é™åˆ¶ï¼Œå½“å®¹å™¨è¯•å›¾ä½¿ç”¨è¶…è¿‡è¿™ä¸ªé‡çš„èµ„æºæ—¶ï¼Œå¯èƒ½ä¼šè¢«Kubernetes Killå¹¶é‡å¯ã€‚ é€šå¸¸æˆ‘ä»¬åº”è¯¥æŠŠRequestsè®¾ç½®ä¸ºä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°å€¼ï¼Œæ»¡è¶³å®¹å™¨å¹³æ—¶çš„å·¥ä½œè´Ÿè½½æƒ…å†µä¸‹çš„èµ„æºéœ€æ±‚ï¼Œè€ŒæŠŠLimitsè®¾ç½®ä¸ºå³°å€¼è´Ÿè½½æƒ…å†µä¸‹èµ„æºå ç”¨çš„æœ€å¤§é‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªèµ„æºé…é¢çš„ç®€å•å®šä¹‰ï¼š
spec: containers: - name: db image: mysql resources: requests: memory: &#34;64Mi&#34; cpu: &#34;250m&#34; limits: memory: &#34;128Mi&#34; cpu: &#34;500m&#34; æœ€å°0.25ä¸ªCPUåŠ64MBå†…å­˜ï¼Œæœ€å¤§0.5ä¸ªCPUåŠ128MBå†…å­˜ã€‚
äºŒã€Labelï¼ˆæ ‡ç­¾ï¼‰ Labelç›¸å½“äºæˆ‘ä»¬ç†Ÿæ‚‰çš„â€œæ ‡ç­¾â€ï¼Œç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰ä¸€ä¸ªLabelï¼Œå°±ç›¸å½“äºç»™å®ƒæ‰“äº†ä¸€ä¸ªæ ‡ç­¾ï¼Œéšåå¯ä»¥é€šè¿‡Label Selectorï¼ˆæ ‡ç­¾é€‰æ‹©å™¨ï¼‰æŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›Labelçš„èµ„æºå¯¹è±¡ï¼ŒKubernetesé€šè¿‡è¿™ç§æ–¹å¼å®ç°äº†ç±»ä¼¼SQLçš„ç®€å•åˆé€šç”¨çš„å¯¹è±¡æŸ¥è¯¢æœºåˆ¶ã€‚ Label Selectorç›¸å½“äºSQLè¯­å¥ä¸­çš„whereæŸ¥è¯¢æ¡ä»¶ï¼Œä¾‹å¦‚ï¼Œname=redis-slaveè¿™ä¸ªLabel Selectorä½œç”¨äºPodæ—¶ï¼Œç›¸å½“äºselect * from pod where podâ€™s name = â€˜redis-slaveâ€™è¿™æ ·çš„è¯­å¥ã€‚Label Selectorçš„è¡¨è¾¾å¼æœ‰ä¸¤ç§ï¼šåŸºäºç­‰å¼çš„ï¼ˆEquality-basedï¼‰å’ŒåŸºäºé›†åˆçš„ï¼ˆSet-basedï¼‰ã€‚ä¸‹é¢æ˜¯åŸºäºç­‰å¼çš„åŒ¹é…ä¾‹å­ã€‚ name=redis-slaveï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾ä¸ºname=redis-slaveçš„èµ„æºå¯¹è±¡ã€‚ env != productionï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾envä¸ç­‰äºproductionçš„èµ„æºå¯¹è±¡ã€‚ ä¸‹é¢æ˜¯åŸºäºé›†åˆçš„åŒ¹é…ä¾‹å­">
    <meta property="og:locale" content="zh">
    <meta property="og:type" content="article">
    <meta property="article:section" content="è¿ç»´ä¸€ä½“åŒ–">
    <meta property="article:published_time" content="2025-09-18T16:55:17+08:00">
    <meta property="article:modified_time" content="2025-09-18T16:55:17+08:00">
    <meta itemprop="name" content="K8SäºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰ :: liaomin416100569åšå®¢">
    <meta itemprop="description" content="ä¸€ã€Pod Kubernetesä¸ºæ¯ä¸ªPodéƒ½åˆ†é…äº†å”¯ä¸€çš„IPåœ°å€ï¼Œç§°ä¹‹ä¸ºPod IPï¼Œä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨å…±äº«Pod IPåœ°å€ã€‚Kubernetesè¦æ±‚åº•å±‚ç½‘ç»œæ”¯æŒé›†ç¾¤å†…ä»»æ„ä¸¤ä¸ªPodä¹‹é—´çš„TCP/IPç›´æ¥é€šä¿¡ï¼Œè¿™é€šå¸¸é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œä¾‹å¦‚Flannelã€Open vSwitchç­‰ã€‚å› æ­¤ï¼Œåœ¨Kubernetesé‡Œï¼Œä¸€ä¸ªPodé‡Œçš„å®¹å™¨ä¸å¦å¤–ä¸»æœºä¸Šçš„Podå®¹å™¨èƒ½å¤Ÿç›´æ¥é€šä¿¡ã€‚ Podæœ‰ä¸¤ç§ç±»å‹ï¼šæ™®é€šçš„Podå’Œé™æ€Podï¼ˆStatic Podï¼‰ï¼Œé™æ€Podä¸å­˜æ”¾åœ¨etcdå­˜å‚¨é‡Œï¼Œè€Œæ˜¯å­˜æ”¾åœ¨æŸä¸ªå…·ä½“çš„Nodeä¸Šçš„ä¸€ä¸ªå…·ä½“æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åªåœ¨æ­¤Nodeä¸Šå¯åŠ¨è¿è¡Œã€‚æ™®é€šçš„Podä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¼šè¢«å­˜å‚¨åˆ°etcdä¸­ï¼Œéšåä¼šè¢«Kubernetes Masterè°ƒåº¦åˆ°æŸä¸ªå…·ä½“çš„Nodeä¸Šå¹¶è¿›è¡Œç»‘å®šï¼ˆBindingï¼‰ï¼Œè¯¥Nodeä¸Šçš„kubeletè¿›ç¨‹ä¼šå°†å…¶å®ä¾‹åŒ–æˆä¸€ç»„ç›¸å…³çš„Dockerå®¹å™¨å¹¶å¯åŠ¨èµ·æ¥ã€‚å½“Podé‡Œçš„æŸä¸ªå®¹å™¨åœæ­¢æ—¶ï¼ŒKubernetesä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è¿™ä¸ªé—®é¢˜å¹¶ä¸”é‡æ–°å¯åŠ¨è¿™ä¸ªPodï¼ˆé‡å¯Podé‡Œçš„æ‰€æœ‰å®¹å™¨ï¼‰ï¼›å¦‚æœPodæ‰€åœ¨çš„Nodeå®•æœºï¼Œåˆ™ä¼šå°†è¿™ä¸ªNodeä¸Šçš„æ‰€æœ‰Podé‡æ–°è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ Podã€å®¹å™¨ä¸Nodeçš„å…³ç³»å¦‚ä¸‹å›¾ï¼š Kubernetesé‡Œçš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½å¯ä»¥é‡‡ç”¨yamlæˆ–è€…JSONæ ¼å¼çš„æ–‡ä»¶æ¥å®šä¹‰æˆ–æè¿°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Podèµ„æºå®šä¹‰æ–‡ä»¶ï¼š
apiVersion: v1 kind: Pod metadata: name: myweb labels: name: myweb spec: containers: - name: myweb image: kubeguide/tomcat-app: v1 ports: - containerPort: 8080 env: - name: MYSQL_SERVICE_HOST value: &#39;mysql&#39; - name: MYSQL_SERVICE_PORT value: &#39;3306&#39; kindä¸ºpodè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªPodçš„å®šä¹‰ï¼Œmetadataé‡Œçš„nameå±æ€§ä¸ºPodçš„åå­—ï¼Œmetadataé‡Œè¿˜èƒ½å®šä¹‰èµ„æºå¯¹è±¡çš„æ ‡ç­¾ï¼ˆLabelï¼‰ï¼Œè¿™é‡Œå£°æ˜mywebæ‹¥æœ‰ä¸€ä¸ªname=mywebçš„æ ‡ç­¾ï¼ˆLabelï¼‰ã€‚Podé‡ŒåŒ…å«çš„å®¹å™¨ç»„çš„å®šä¹‰åˆ™åœ¨specä¸€èŠ‚ä¸­å£°æ˜ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåå­—ä¸ºmywebï¼Œå¯¹åº”é•œåƒä¸ºkubeguide/tomcat-app: v1çš„å®¹å™¨ï¼Œè¯¥å®¹å™¨æ³¨å…¥äº†åä¸ºMYSQL_SERVICE_HOST=â€˜mysqlâ€™å’ŒMYSQL_SERVICE_PORT=â€˜3306â€™çš„ç¯å¢ƒå˜é‡ï¼ˆenvå…³é”®å­—ï¼‰ï¼Œå¹¶ä¸”åœ¨8080ç«¯å£ï¼ˆcontainerPortï¼‰ä¸Šå¯åŠ¨å®¹å™¨è¿›ç¨‹ã€‚Podçš„IPåŠ ä¸Šè¿™é‡Œçš„å®¹å™¨ç«¯å£ï¼Œå°±ç»„æˆäº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µâ€”â€”Endpointï¼Œå®ƒä»£è¡¨ç€æ­¤Podé‡Œçš„ä¸€ä¸ªæœåŠ¡è¿›ç¨‹çš„å¯¹å¤–é€šä¿¡åœ°å€ã€‚ä¸€ä¸ªPodä¹Ÿå­˜åœ¨ç€å…·æœ‰å¤šä¸ªEndpointçš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠTomcatå®šä¹‰ä¸ºä¸€ä¸ªPodæ—¶ï¼Œå¯ä»¥å¯¹å¤–æš´éœ²ç®¡ç†ç«¯å£ä¸æœåŠ¡ç«¯å£è¿™ä¸¤ä¸ªEndpointã€‚ Dockeré‡Œçš„Volumeåœ¨Kubernetesé‡Œä¹Ÿæœ‰å¯¹åº”çš„æ¦‚å¿µâ€”â€”Pod Volumeï¼ŒPod Volumeæœ‰ä¸€äº›æ‰©å±•ï¼Œæ¯”å¦‚å¯ä»¥ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸGlusterFSç­‰å®ç°åç«¯å­˜å‚¨åŠŸèƒ½ï¼›Pod Volumeæ˜¯å®šä¹‰åœ¨Podä¹‹ä¸Šï¼Œç„¶åè¢«å„ä¸ªå®¹å™¨æŒ‚è½½åˆ°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ã€‚å¯¹äºPod Volumeçš„å®šä¹‰æˆ‘ä»¬åé¢ä¼šè®²åˆ°ã€‚ è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹Eventæ¦‚å¿µï¼ŒEventæ˜¯ä¸€ä¸ªäº‹ä»¶çš„è®°å½•ï¼Œè®°å½•äº†äº‹ä»¶çš„æœ€æ—©äº§ç”Ÿæ—¶é—´ã€æœ€åé‡ç°æ—¶é—´ã€é‡å¤æ¬¡æ•°ã€å‘èµ·è€…ã€ç±»å‹ï¼Œä»¥åŠå¯¼è‡´æ­¤äº‹ä»¶çš„åŸå› ç­‰ä¼—å¤šä¿¡æ¯ã€‚Eventé€šå¸¸ä¼šå…³è”åˆ°æŸä¸ªå…·ä½“çš„èµ„æºå¯¹è±¡ä¸Šï¼Œæ˜¯æ’æŸ¥æ•…éšœçš„é‡è¦å‚è€ƒä¿¡æ¯ï¼Œå½“æˆ‘ä»¬å‘ç°æŸä¸ªPodè¿Ÿè¿Ÿæ— æ³•åˆ›å»ºæ—¶ï¼Œå¯ä»¥ç”¨kubectl describe pod xxxæ¥æŸ¥çœ‹å®ƒçš„æè¿°ä¿¡æ¯ï¼Œç”¨æ¥å®šä½é—®é¢˜çš„åŸå› ã€‚ æ¯ä¸ªPodéƒ½å¯ä»¥å¯¹å…¶èƒ½ä½¿ç”¨çš„æœåŠ¡å™¨ä¸Šçš„è®¡ç®—èµ„æºè®¾ç½®é™é¢ï¼Œå½“å‰å¯ä»¥è®¾ç½®é™é¢çš„è®¡ç®—èµ„æºæœ‰CPUå’ŒMemoryä¸¤ç§ï¼Œå…¶ä¸­CPUçš„èµ„æºå•ä½ä¸ºCPUï¼ˆCoreï¼‰çš„æ•°é‡ï¼Œæ˜¯ä¸€ä¸ªç»å¯¹å€¼ã€‚ å¯¹äºå®¹å™¨æ¥è¯´ä¸€ä¸ªCPUçš„é…é¢å·²ç»æ˜¯ç›¸å½“å¤§çš„èµ„æºé…é¢äº†ï¼Œæ‰€ä»¥åœ¨Kubernetesé‡Œï¼Œé€šå¸¸ä»¥åƒåˆ†ä¹‹ä¸€çš„CPUé…é¢ä¸ºæœ€å°å•ä½ï¼Œç”¨mæ¥è¡¨ç¤ºã€‚é€šå¸¸ä¸€ä¸ªå®¹å™¨çš„CPUé…é¢è¢«å®šä¹‰ä¸º100-300mï¼Œå³å ç”¨0.1-0.3ä¸ªCPUã€‚ä¸CPUé…é¢ç±»ä¼¼ï¼ŒMemoryé…é¢ä¹Ÿæ˜¯ä¸€ä¸ªç»å¯¹å€¼ï¼Œå®ƒçš„å•ä½æ˜¯å†…å­˜å­—èŠ‚æ•°ã€‚ å¯¹è®¡ç®—èµ„æºè¿›è¡Œé…é¢é™å®šéœ€è¦è®¾å®šä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š
Requestsï¼šè¯¥èµ„æºçš„æœ€å°ç”³è¯·é‡ï¼Œç³»ç»Ÿå¿…é¡»æ»¡è¶³è¦æ±‚ã€‚ Limitsï¼šè¯¥èµ„æºæœ€å¤§å…è®¸ä½¿ç”¨çš„é‡ï¼Œä¸èƒ½è¶…è¿‡è¿™ä¸ªä½¿ç”¨é™åˆ¶ï¼Œå½“å®¹å™¨è¯•å›¾ä½¿ç”¨è¶…è¿‡è¿™ä¸ªé‡çš„èµ„æºæ—¶ï¼Œå¯èƒ½ä¼šè¢«Kubernetes Killå¹¶é‡å¯ã€‚ é€šå¸¸æˆ‘ä»¬åº”è¯¥æŠŠRequestsè®¾ç½®ä¸ºä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°å€¼ï¼Œæ»¡è¶³å®¹å™¨å¹³æ—¶çš„å·¥ä½œè´Ÿè½½æƒ…å†µä¸‹çš„èµ„æºéœ€æ±‚ï¼Œè€ŒæŠŠLimitsè®¾ç½®ä¸ºå³°å€¼è´Ÿè½½æƒ…å†µä¸‹èµ„æºå ç”¨çš„æœ€å¤§é‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªèµ„æºé…é¢çš„ç®€å•å®šä¹‰ï¼š
spec: containers: - name: db image: mysql resources: requests: memory: &#34;64Mi&#34; cpu: &#34;250m&#34; limits: memory: &#34;128Mi&#34; cpu: &#34;500m&#34; æœ€å°0.25ä¸ªCPUåŠ64MBå†…å­˜ï¼Œæœ€å¤§0.5ä¸ªCPUåŠ128MBå†…å­˜ã€‚
äºŒã€Labelï¼ˆæ ‡ç­¾ï¼‰ Labelç›¸å½“äºæˆ‘ä»¬ç†Ÿæ‚‰çš„â€œæ ‡ç­¾â€ï¼Œç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰ä¸€ä¸ªLabelï¼Œå°±ç›¸å½“äºç»™å®ƒæ‰“äº†ä¸€ä¸ªæ ‡ç­¾ï¼Œéšåå¯ä»¥é€šè¿‡Label Selectorï¼ˆæ ‡ç­¾é€‰æ‹©å™¨ï¼‰æŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›Labelçš„èµ„æºå¯¹è±¡ï¼ŒKubernetesé€šè¿‡è¿™ç§æ–¹å¼å®ç°äº†ç±»ä¼¼SQLçš„ç®€å•åˆé€šç”¨çš„å¯¹è±¡æŸ¥è¯¢æœºåˆ¶ã€‚ Label Selectorç›¸å½“äºSQLè¯­å¥ä¸­çš„whereæŸ¥è¯¢æ¡ä»¶ï¼Œä¾‹å¦‚ï¼Œname=redis-slaveè¿™ä¸ªLabel Selectorä½œç”¨äºPodæ—¶ï¼Œç›¸å½“äºselect * from pod where podâ€™s name = â€˜redis-slaveâ€™è¿™æ ·çš„è¯­å¥ã€‚Label Selectorçš„è¡¨è¾¾å¼æœ‰ä¸¤ç§ï¼šåŸºäºç­‰å¼çš„ï¼ˆEquality-basedï¼‰å’ŒåŸºäºé›†åˆçš„ï¼ˆSet-basedï¼‰ã€‚ä¸‹é¢æ˜¯åŸºäºç­‰å¼çš„åŒ¹é…ä¾‹å­ã€‚ name=redis-slaveï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾ä¸ºname=redis-slaveçš„èµ„æºå¯¹è±¡ã€‚ env != productionï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾envä¸ç­‰äºproductionçš„èµ„æºå¯¹è±¡ã€‚ ä¸‹é¢æ˜¯åŸºäºé›†åˆçš„åŒ¹é…ä¾‹å­">
    <meta itemprop="datePublished" content="2025-09-18T16:55:17+08:00">
    <meta itemprop="dateModified" content="2025-09-18T16:55:17+08:00">
    <meta itemprop="wordCount" content="925">
    <title>K8SäºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰ :: liaomin416100569åšå®¢</title>
    <link href="/docs/css/auto-complete/auto-complete.min.css?1758355652" rel="stylesheet">
    <script src="/docs/js/auto-complete/auto-complete.min.js?1758355652" defer></script>
    <script src="/docs/js/search-lunr.min.js?1758355652" defer></script>
    <script src="/docs/js/search.min.js?1758355652" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/docs/searchindex.en.js?1758355652";
    </script>
    <script src="/docs/js/lunr/lunr.min.js?1758355652" defer></script>
    <script src="/docs/js/lunr/lunr.stemmer.support.min.js?1758355652" defer></script>
    <script src="/docs/js/lunr/lunr.multi.min.js?1758355652" defer></script>
    <script src="/docs/js/lunr/lunr.zh.min.js?1758355652" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['zh'];
    </script>
    <link href="/docs/fonts/fontawesome/css/fontawesome-all.min.css?1758355652" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs/fonts/fontawesome/css/fontawesome-all.min.css?1758355652" rel="stylesheet"></noscript>
    <link href="/docs/css/perfect-scrollbar/perfect-scrollbar.min.css?1758355652" rel="stylesheet">
    <link href="/docs/css/theme.min.css?1758355652" rel="stylesheet">
    <link href="/docs/css/format-html.min.css?1758355652" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/devops\/kubernetes\/k8s_dev_01\/index.html';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/jiaozi789.github.io\/docs';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'auto' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/docs/css/custom.css?1758355652" rel="stylesheet">
  </head>
  <body class="mobile-support html" data-url="/docs/devops/kubernetes/k8s_dev_01/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#ä¸€pod">ä¸€ã€Pod</a></li>
    <li><a href="#äºŒlabelæ ‡ç­¾">äºŒã€Labelï¼ˆæ ‡ç­¾ï¼‰</a></li>
    <li><a href="#ä¸‰replication-controller">ä¸‰ã€Replication Controller</a></li>
    <li><a href="#å››replica-set">å››ã€Replica Set</a></li>
    <li><a href="#äº”deployment">äº”ã€Deployment</a></li>
    <li><a href="#å…­horizontal-pod-autoscaler">å…­ã€Horizontal Pod Autoscaler</a></li>
    <li><a href="#ä¸ƒstatefulset">ä¸ƒã€StatefulSet</a></li>
    <li><a href="#å…«serviceæœåŠ¡">å…«ã€Serviceï¼ˆæœåŠ¡ï¼‰</a>
      <ul>
        <li><a href="#1æ¦‚è¿°">1.æ¦‚è¿°</a></li>
        <li><a href="#2kubernetesçš„æœåŠ¡å‘ç°æœºåˆ¶">2.Kubernetesçš„æœåŠ¡å‘ç°æœºåˆ¶</a></li>
        <li><a href="#3å¤–éƒ¨ç³»ç»Ÿè®¿é—®serviceçš„é—®é¢˜">3.å¤–éƒ¨ç³»ç»Ÿè®¿é—®Serviceçš„é—®é¢˜</a></li>
      </ul>
    </li>
    <li><a href="#ä¹volumeå­˜å‚¨å·">ä¹ã€Volumeï¼ˆå­˜å‚¨å·ï¼‰</a>
      <ul>
        <li><a href="#1emptydir">1.emptyDir</a></li>
        <li><a href="#2hostpath">2.hostPath</a></li>
        <li><a href="#3gcepersistentdisk">3.gcePersistentDisk</a></li>
        <li><a href="#4awselasticblockstore">4.awsElasticBlockStore</a></li>
        <li><a href="#5nfs">5.NFS</a></li>
        <li><a href="#6å…¶ä»–ç±»å‹çš„volume">6.å…¶ä»–ç±»å‹çš„Volume</a></li>
      </ul>
    </li>
    <li><a href="#åpersistent-volume">åã€Persistent Volume</a></li>
    <li><a href="#åä¸€namespaceå‘½åç©ºé—´">åä¸€ã€Namespaceï¼ˆå‘½åç©ºé—´ï¼‰</a>
      <ul>
        <li><a href="#åäºŒannotationæ³¨è§£">åäºŒã€Annotationï¼ˆæ³¨è§£ï¼‰</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/docs/index.html"><span itemprop="name">liaomin416100569åšå®¢</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/docs/devops/index.html"><span itemprop="name">è¿ç»´ä¸€ä½“åŒ–</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/docs/devops/kubernetes/index.html"><span itemprop="name">kubernetes</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">K8SäºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/docs/devops/kubernetes/index.html" title="kubernetes (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/docs/devops/kubernetes/k8s_dev_02/index.html" title="K8SäºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤ (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable devops" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="k8säºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰">K8SäºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰</h1>

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']]
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

<h1 id="ä¸€pod">ä¸€ã€Pod</h1>
<p>Kubernetesä¸ºæ¯ä¸ªPodéƒ½åˆ†é…äº†å”¯ä¸€çš„IPåœ°å€ï¼Œç§°ä¹‹ä¸ºPod IPï¼Œä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨å…±äº«Pod IPåœ°å€ã€‚Kubernetesè¦æ±‚åº•å±‚ç½‘ç»œæ”¯æŒé›†ç¾¤å†…ä»»æ„ä¸¤ä¸ªPodä¹‹é—´çš„TCP/IPç›´æ¥é€šä¿¡ï¼Œè¿™é€šå¸¸é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œä¾‹å¦‚Flannelã€Open vSwitchç­‰ã€‚å› æ­¤ï¼Œåœ¨Kubernetesé‡Œï¼Œä¸€ä¸ªPodé‡Œçš„å®¹å™¨ä¸å¦å¤–ä¸»æœºä¸Šçš„Podå®¹å™¨èƒ½å¤Ÿç›´æ¥é€šä¿¡ã€‚
Podæœ‰ä¸¤ç§ç±»å‹ï¼šæ™®é€šçš„Podå’Œé™æ€Podï¼ˆStatic Podï¼‰ï¼Œé™æ€Podä¸å­˜æ”¾åœ¨etcdå­˜å‚¨é‡Œï¼Œè€Œæ˜¯å­˜æ”¾åœ¨æŸä¸ªå…·ä½“çš„Nodeä¸Šçš„ä¸€ä¸ªå…·ä½“æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åªåœ¨æ­¤Nodeä¸Šå¯åŠ¨è¿è¡Œã€‚æ™®é€šçš„Podä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¼šè¢«å­˜å‚¨åˆ°etcdä¸­ï¼Œéšåä¼šè¢«Kubernetes Masterè°ƒåº¦åˆ°æŸä¸ªå…·ä½“çš„Nodeä¸Šå¹¶è¿›è¡Œç»‘å®šï¼ˆBindingï¼‰ï¼Œè¯¥Nodeä¸Šçš„kubeletè¿›ç¨‹ä¼šå°†å…¶å®ä¾‹åŒ–æˆä¸€ç»„ç›¸å…³çš„Dockerå®¹å™¨å¹¶å¯åŠ¨èµ·æ¥ã€‚å½“Podé‡Œçš„æŸä¸ªå®¹å™¨åœæ­¢æ—¶ï¼ŒKubernetesä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è¿™ä¸ªé—®é¢˜å¹¶ä¸”é‡æ–°å¯åŠ¨è¿™ä¸ªPodï¼ˆé‡å¯Podé‡Œçš„æ‰€æœ‰å®¹å™¨ï¼‰ï¼›å¦‚æœPodæ‰€åœ¨çš„Nodeå®•æœºï¼Œåˆ™ä¼šå°†è¿™ä¸ªNodeä¸Šçš„æ‰€æœ‰Podé‡æ–°è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚
Podã€å®¹å™¨ä¸Nodeçš„å…³ç³»å¦‚ä¸‹å›¾ï¼š
<a href="#R-image-af11d1994a3f946682a70be84065fd24" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/8ba15402284ac47020d0259239a1a56f.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-af11d1994a3f946682a70be84065fd24"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/8ba15402284ac47020d0259239a1a56f.png"></a>
Kubernetesé‡Œçš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½å¯ä»¥é‡‡ç”¨yamlæˆ–è€…JSONæ ¼å¼çš„æ–‡ä»¶æ¥å®šä¹‰æˆ–æè¿°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Podèµ„æºå®šä¹‰æ–‡ä»¶ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">apiVersion:</span> <span style="color:#960050;background-color:#1e0010">v</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">kind:</span> <span style="color:#960050;background-color:#1e0010">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">metadata:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">name:</span> <span style="color:#960050;background-color:#1e0010">myweb</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">labels:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">name:</span> <span style="color:#960050;background-color:#1e0010">myweb</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">spec:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">containers:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">-</span> <span style="color:#960050;background-color:#1e0010">name:</span> <span style="color:#960050;background-color:#1e0010">myweb</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">image:</span> <span style="color:#960050;background-color:#1e0010">kubeguide/tomcat-app:</span> <span style="color:#960050;background-color:#1e0010">v</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">ports:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">-</span> <span style="color:#960050;background-color:#1e0010">containerPort:</span> <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">env:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">-</span> <span style="color:#960050;background-color:#1e0010">name:</span> <span style="color:#960050;background-color:#1e0010">MYSQL_SERVICE_HOST</span>
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">value:</span> <span style="color:#960050;background-color:#1e0010">&#39;mysql&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">-</span> <span style="color:#960050;background-color:#1e0010">name:</span> <span style="color:#960050;background-color:#1e0010">MYSQL_SERVICE_PORT</span>
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">value:</span> <span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">3306</span><span style="color:#960050;background-color:#1e0010">&#39;</span></span></span></code></pre></div>
<p>kindä¸ºpodè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªPodçš„å®šä¹‰ï¼Œmetadataé‡Œçš„nameå±æ€§ä¸ºPodçš„åå­—ï¼Œmetadataé‡Œè¿˜èƒ½å®šä¹‰èµ„æºå¯¹è±¡çš„æ ‡ç­¾ï¼ˆLabelï¼‰ï¼Œè¿™é‡Œå£°æ˜mywebæ‹¥æœ‰ä¸€ä¸ªname=mywebçš„æ ‡ç­¾ï¼ˆLabelï¼‰ã€‚Podé‡ŒåŒ…å«çš„å®¹å™¨ç»„çš„å®šä¹‰åˆ™åœ¨specä¸€èŠ‚ä¸­å£°æ˜ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåå­—ä¸ºmywebï¼Œå¯¹åº”é•œåƒä¸ºkubeguide/tomcat-app: v1çš„å®¹å™¨ï¼Œè¯¥å®¹å™¨æ³¨å…¥äº†åä¸ºMYSQL_SERVICE_HOST=&lsquo;mysql&rsquo;å’ŒMYSQL_SERVICE_PORT=&lsquo;3306&rsquo;çš„ç¯å¢ƒå˜é‡ï¼ˆenvå…³é”®å­—ï¼‰ï¼Œå¹¶ä¸”åœ¨8080ç«¯å£ï¼ˆcontainerPortï¼‰ä¸Šå¯åŠ¨å®¹å™¨è¿›ç¨‹ã€‚Podçš„IPåŠ ä¸Šè¿™é‡Œçš„å®¹å™¨ç«¯å£ï¼Œå°±ç»„æˆäº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µâ€”â€”Endpointï¼Œå®ƒä»£è¡¨ç€æ­¤Podé‡Œçš„ä¸€ä¸ªæœåŠ¡è¿›ç¨‹çš„å¯¹å¤–é€šä¿¡åœ°å€ã€‚ä¸€ä¸ªPodä¹Ÿå­˜åœ¨ç€å…·æœ‰å¤šä¸ªEndpointçš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬æŠŠTomcatå®šä¹‰ä¸ºä¸€ä¸ªPodæ—¶ï¼Œå¯ä»¥å¯¹å¤–æš´éœ²ç®¡ç†ç«¯å£ä¸æœåŠ¡ç«¯å£è¿™ä¸¤ä¸ªEndpointã€‚
Dockeré‡Œçš„Volumeåœ¨Kubernetesé‡Œä¹Ÿæœ‰å¯¹åº”çš„æ¦‚å¿µâ€”â€”Pod Volumeï¼ŒPod Volumeæœ‰ä¸€äº›æ‰©å±•ï¼Œæ¯”å¦‚å¯ä»¥ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸGlusterFSç­‰å®ç°åç«¯å­˜å‚¨åŠŸèƒ½ï¼›Pod Volumeæ˜¯å®šä¹‰åœ¨Podä¹‹ä¸Šï¼Œç„¶åè¢«å„ä¸ªå®¹å™¨æŒ‚è½½åˆ°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„ã€‚å¯¹äºPod Volumeçš„å®šä¹‰æˆ‘ä»¬åé¢ä¼šè®²åˆ°ã€‚
è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹Eventæ¦‚å¿µï¼ŒEventæ˜¯ä¸€ä¸ªäº‹ä»¶çš„è®°å½•ï¼Œè®°å½•äº†äº‹ä»¶çš„æœ€æ—©äº§ç”Ÿæ—¶é—´ã€æœ€åé‡ç°æ—¶é—´ã€é‡å¤æ¬¡æ•°ã€å‘èµ·è€…ã€ç±»å‹ï¼Œä»¥åŠå¯¼è‡´æ­¤äº‹ä»¶çš„åŸå› ç­‰ä¼—å¤šä¿¡æ¯ã€‚Eventé€šå¸¸ä¼šå…³è”åˆ°æŸä¸ªå…·ä½“çš„èµ„æºå¯¹è±¡ä¸Šï¼Œæ˜¯æ’æŸ¥æ•…éšœçš„é‡è¦å‚è€ƒä¿¡æ¯ï¼Œå½“æˆ‘ä»¬å‘ç°æŸä¸ªPodè¿Ÿè¿Ÿæ— æ³•åˆ›å»ºæ—¶ï¼Œå¯ä»¥ç”¨kubectl describe pod xxxæ¥æŸ¥çœ‹å®ƒçš„æè¿°ä¿¡æ¯ï¼Œç”¨æ¥å®šä½é—®é¢˜çš„åŸå› ã€‚
æ¯ä¸ªPodéƒ½å¯ä»¥å¯¹å…¶èƒ½ä½¿ç”¨çš„æœåŠ¡å™¨ä¸Šçš„è®¡ç®—èµ„æºè®¾ç½®é™é¢ï¼Œå½“å‰å¯ä»¥è®¾ç½®é™é¢çš„è®¡ç®—èµ„æºæœ‰CPUå’ŒMemoryä¸¤ç§ï¼Œå…¶ä¸­CPUçš„èµ„æºå•ä½ä¸ºCPUï¼ˆCoreï¼‰çš„æ•°é‡ï¼Œæ˜¯ä¸€ä¸ªç»å¯¹å€¼ã€‚
å¯¹äºå®¹å™¨æ¥è¯´ä¸€ä¸ªCPUçš„é…é¢å·²ç»æ˜¯ç›¸å½“å¤§çš„èµ„æºé…é¢äº†ï¼Œæ‰€ä»¥åœ¨Kubernetesé‡Œï¼Œé€šå¸¸ä»¥åƒåˆ†ä¹‹ä¸€çš„CPUé…é¢ä¸ºæœ€å°å•ä½ï¼Œç”¨mæ¥è¡¨ç¤ºã€‚é€šå¸¸ä¸€ä¸ªå®¹å™¨çš„CPUé…é¢è¢«å®šä¹‰ä¸º100-300mï¼Œå³å ç”¨0.1-0.3ä¸ªCPUã€‚ä¸CPUé…é¢ç±»ä¼¼ï¼ŒMemoryé…é¢ä¹Ÿæ˜¯ä¸€ä¸ªç»å¯¹å€¼ï¼Œå®ƒçš„å•ä½æ˜¯å†…å­˜å­—èŠ‚æ•°ã€‚
å¯¹è®¡ç®—èµ„æºè¿›è¡Œé…é¢é™å®šéœ€è¦è®¾å®šä»¥ä¸‹ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>Requestsï¼šè¯¥èµ„æºçš„æœ€å°ç”³è¯·é‡ï¼Œç³»ç»Ÿå¿…é¡»æ»¡è¶³è¦æ±‚ã€‚</li>
<li>Limitsï¼šè¯¥èµ„æºæœ€å¤§å…è®¸ä½¿ç”¨çš„é‡ï¼Œä¸èƒ½è¶…è¿‡è¿™ä¸ªä½¿ç”¨é™åˆ¶ï¼Œå½“å®¹å™¨è¯•å›¾ä½¿ç”¨è¶…è¿‡è¿™ä¸ªé‡çš„èµ„æºæ—¶ï¼Œå¯èƒ½ä¼šè¢«Kubernetes Killå¹¶é‡å¯ã€‚</li>
</ul>
<p>é€šå¸¸æˆ‘ä»¬åº”è¯¥æŠŠRequestsè®¾ç½®ä¸ºä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°å€¼ï¼Œæ»¡è¶³å®¹å™¨å¹³æ—¶çš„å·¥ä½œè´Ÿè½½æƒ…å†µä¸‹çš„èµ„æºéœ€æ±‚ï¼Œè€ŒæŠŠLimitsè®¾ç½®ä¸ºå³°å€¼è´Ÿè½½æƒ…å†µä¸‹èµ„æºå ç”¨çš„æœ€å¤§é‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªèµ„æºé…é¢çš„ç®€å•å®šä¹‰ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">containers</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">db</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">image</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mysql</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">resources</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">requests</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">memory</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;64Mi&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cpu</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;250m&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">limits</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">memory</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;128Mi&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">cpu</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;500m&#34;</span></span></span></code></pre></div>
<p>æœ€å°0.25ä¸ªCPUåŠ64MBå†…å­˜ï¼Œæœ€å¤§0.5ä¸ªCPUåŠ128MBå†…å­˜ã€‚</p>
<h1 id="äºŒlabelæ ‡ç­¾">äºŒã€Labelï¼ˆæ ‡ç­¾ï¼‰</h1>
<p>Labelç›¸å½“äºæˆ‘ä»¬ç†Ÿæ‚‰çš„â€œæ ‡ç­¾â€ï¼Œç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰ä¸€ä¸ªLabelï¼Œå°±ç›¸å½“äºç»™å®ƒæ‰“äº†ä¸€ä¸ªæ ‡ç­¾ï¼Œéšåå¯ä»¥é€šè¿‡Label Selectorï¼ˆæ ‡ç­¾é€‰æ‹©å™¨ï¼‰æŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›Labelçš„èµ„æºå¯¹è±¡ï¼ŒKubernetesé€šè¿‡è¿™ç§æ–¹å¼å®ç°äº†ç±»ä¼¼SQLçš„ç®€å•åˆé€šç”¨çš„å¯¹è±¡æŸ¥è¯¢æœºåˆ¶ã€‚
Label Selectorç›¸å½“äºSQLè¯­å¥ä¸­çš„whereæŸ¥è¯¢æ¡ä»¶ï¼Œä¾‹å¦‚ï¼Œname=redis-slaveè¿™ä¸ªLabel Selectorä½œç”¨äºPodæ—¶ï¼Œç›¸å½“äºselect * from pod where podâ€™s name = â€˜redis-slaveâ€™è¿™æ ·çš„è¯­å¥ã€‚Label Selectorçš„è¡¨è¾¾å¼æœ‰ä¸¤ç§ï¼šåŸºäºç­‰å¼çš„ï¼ˆEquality-basedï¼‰å’ŒåŸºäºé›†åˆçš„ï¼ˆSet-basedï¼‰ã€‚ä¸‹é¢æ˜¯åŸºäºç­‰å¼çš„åŒ¹é…ä¾‹å­ã€‚
name=redis-slaveï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾ä¸ºname=redis-slaveçš„èµ„æºå¯¹è±¡ã€‚
env != productionï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾envä¸ç­‰äºproductionçš„èµ„æºå¯¹è±¡ã€‚
ä¸‹é¢æ˜¯åŸºäºé›†åˆçš„åŒ¹é…ä¾‹å­</p>
<ul>
<li>name in (redis-master, redis-slave)ï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾ä¸ºname=redis-masteræˆ–è€…name=redis-slaveçš„èµ„æºå¯¹è±¡ã€‚</li>
<li>name not in (php-frontend)ï¼šåŒ¹é…æ‰€æœ‰æ ‡ç­¾nameä¸ç­‰äºphp-frontendçš„èµ„æºå¯¹è±¡ã€‚</li>
</ul>
<p>è¿˜å¯ä»¥é€šè¿‡å¤šä¸ªLabel Selectorè¡¨è¾¾å¼çš„ç»„åˆå®ç°å¤æ‚çš„æ¡ä»¶é€‰æ‹©ï¼Œå¤šä¸ªè¡¨è¾¾å¼ä¹‹é—´ç”¨â€œï¼Œâ€è¿›è¡Œåˆ†éš”å³å¯ï¼Œå‡ ä¸ªæ¡ä»¶ä¹‹é—´æ˜¯â€œANDâ€çš„å…³ç³»ï¼Œå³åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#a6e22e">redis</span><span style="color:#f92672">-</span><span style="color:#a6e22e">slave</span>, <span style="color:#a6e22e">env</span><span style="color:#f92672">!=</span><span style="color:#a6e22e">production</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">name</span> <span style="color:#a6e22e">not</span> <span style="color:#66d9ef">in</span> (<span style="color:#a6e22e">php</span><span style="color:#f92672">-</span><span style="color:#a6e22e">frontend</span>), <span style="color:#a6e22e">env</span><span style="color:#f92672">!=</span><span style="color:#a6e22e">production</span></span></span></code></pre></div>
<p>ä»¥Podä¸ºä¾‹ï¼ŒLabelå®šä¹‰åœ¨metadataä¸­ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">myweb</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labels</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">app</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">myweb</span></span></span></code></pre></div>
<p>RCå’ŒServiceåœ¨specä¸­å®šä¹‰Selectorä¸Podè¿›è¡Œå…³è”ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ReplicationController</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">myweb</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">replicas</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">app</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">myweb</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">template</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">â€¦â€¦â€¦â€¦</span></span></span></code></pre></div>
<p>Deploymentã€ReplicaSetã€DaemonSetå’ŒJobåˆ™å¯ä»¥åœ¨Selectorä¸­ä½¿ç”¨åŸºäºé›†åˆçš„ç­›é€‰æ¡ä»¶ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">matchLabels</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">app</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">myweb</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">matchExpressions</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span> {<span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tier</span>, <span style="color:#a6e22e">operator</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">In</span>, <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">frontend</span>]}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span> {<span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">environment</span>, <span style="color:#a6e22e">operator</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">NotIn</span>, <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">dev</span>]}</span></span></code></pre></div>
<p>matchLabelsç”¨äºå®šä¹‰ä¸€ç»„Labelï¼Œä¸ç›´æ¥å†™åœ¨Selectorä¸­ä½œç”¨ç›¸åŒï¼›matchExpressionsç”¨äºå®šä¹‰ä¸€ç»„åŸºäºé›†åˆçš„ç­›é€‰æ¡ä»¶ï¼Œå¯ç”¨çš„æ¡ä»¶è¿ç®—ç¬¦åŒ…æ‹¬ï¼šInã€NotInã€Existså’ŒDoesNotExistã€‚
å¦‚æœåŒæ—¶è®¾ç½®äº†matchLabelså’ŒmatchExpressionsï¼Œåˆ™ä¸¤ç»„æ¡ä»¶ä¸ºâ€œANDâ€å…³ç³»ï¼Œå³æ‰€æœ‰æ¡ä»¶éœ€è¦åŒæ—¶æ»¡è¶³æ‰èƒ½å®ŒæˆSelectorçš„ç­›é€‰ã€‚
Label Selectoråœ¨Kubernetesä¸­çš„é‡è¦ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>Kube-controllerè¿›ç¨‹é€šè¿‡èµ„æºå¯¹è±¡RCä¸Šå®šä¹‰çš„Label Selectoræ¥ç­›é€‰è¦ç›‘æ§çš„Podå‰¯æœ¬çš„æ•°é‡ï¼Œä»è€Œå®ç°Podå‰¯æœ¬çš„æ•°é‡å§‹ç»ˆç¬¦åˆé¢„æœŸè®¾å®šçš„å…¨è‡ªåŠ¨æ§åˆ¶æµç¨‹ã€‚</li>
<li>Kube-proxyè¿›ç¨‹é€šè¿‡Serviceçš„Label Selectoræ¥é€‰æ‹©å¯¹åº”çš„Podï¼Œè‡ªåŠ¨å»ºç«‹èµ·æ¯ä¸ªServiceåˆ°å¯¹åº”Podçš„è¯·æ±‚è½¬å‘è·¯ç”±è¡¨ï¼Œä»è€Œå®ç°Serviceçš„æ™ºèƒ½è´Ÿè½½å‡è¡¡æœºåˆ¶ã€‚</li>
<li>é€šè¿‡å¯¹æŸäº›Nodeå®šä¹‰ç‰¹å®šçš„Labelï¼Œå¹¶ä¸”åœ¨Podå®šä¹‰æ–‡ä»¶ä¸­ä½¿ç”¨NodeSelectorè¿™ç§æ ‡ç­¾è°ƒåº¦ç­–ç•¥ï¼Œkube-schedulerè¿›ç¨‹å¯ä»¥å®ç°Podâ€œå®šå‘è°ƒåº¦â€çš„ç‰¹æ€§ã€‚</li>
</ul>
<p>ä¸‹é¢ä¸¾ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬ä¸ºPodå®šä¹‰äº†3ä¸ªLabelï¼šreleaseã€envå’Œroleï¼Œä¸åŒçš„Podå®šä¹‰äº†ä¸åŒçš„Labelã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®äº†â€œrole=frontendâ€çš„Label Selectorï¼Œåˆ™ä¼šé€‰å–åˆ°Node 1å’ŒNode 2ä¸Šçš„Podã€‚
<a href="#R-image-9646aa0bfd8af1d91c9f534b4086efb5" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/13ad3e9a372a3dab1ba5ed73546f557d.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9646aa0bfd8af1d91c9f534b4086efb5"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/13ad3e9a372a3dab1ba5ed73546f557d.png"></a>
å¦‚æœæˆ‘ä»¬è®¾ç½®â€œrelease=betaâ€çš„Label Selectorï¼Œåˆ™ä¼šé€‰å–åˆ°Node 2å’ŒNode 3ä¸Šçš„Podï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
<a href="#R-image-739c81dfc9e1c36210adbf3c33f93660" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/90a436b150277357a3de2ca95dc94bde.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-739c81dfc9e1c36210adbf3c33f93660"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/90a436b150277357a3de2ca95dc94bde.png"></a>
æ€»ç»“ï¼šä½¿ç”¨Labelå¯ä»¥ç»™å¯¹è±¡åˆ›å»ºå¤šç»„æ ‡ç­¾ï¼ŒLabelå’ŒLabel Selectorå…±åŒæ„æˆäº†Kubernetesç³»ç»Ÿä¸­æœ€æ ¸å¿ƒçš„åº”ç”¨æ¨¡å‹ï¼Œä½¿å¾—è¢«ç®¡ç†å¯¹è±¡èƒ½å¤Ÿè¢«ç²¾ç»†åœ°åˆ†ç»„ç®¡ç†ï¼ŒåŒæ—¶å®ç°äº†æ•´ä¸ªé›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</p>
<h1 id="ä¸‰replication-controller">ä¸‰ã€Replication Controller</h1>
<p>RCçš„ä½œç”¨æ˜¯å£°æ˜Podçš„å‰¯æœ¬æ•°é‡åœ¨ä»»æ„æ—¶åˆ»éƒ½ç¬¦åˆæŸä¸ªé¢„æœŸå€¼ï¼Œæ‰€ä»¥RCçš„å®šä¹‰åŒ…æ‹¬å¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ã€‚</p>
<ul>
<li>PodæœŸå¾…çš„å‰¯æœ¬æ•°é‡ï¼ˆreplicasï¼‰ã€‚</li>
<li>ç”¨äºç­›é€‰ç›®æ ‡Podçš„Label Selectorã€‚</li>
<li>å½“Podçš„å‰¯æœ¬æ•°é‡å°äºé¢„æœŸæ•°é‡æ—¶ï¼Œç”¨äºåˆ›å»ºæ–°Podçš„Podæ¨¡æ¿ï¼ˆtemplateï¼‰ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„RCå®šä¹‰çš„ä¾‹å­ï¼Œå³ç¡®ä¿æ‹¥æœ‰tier=frontendæ ‡ç­¾çš„è¿™ä¸ªPodï¼ˆè¿è¡ŒTomcatå®¹å™¨ï¼‰åœ¨æ•´ä¸ªKubernetesé›†ç¾¤ä¸­å§‹ç»ˆæœ‰ä¸‰ä¸ªå‰¯æœ¬ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ReplicationController</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">replicas</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tier</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">template</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">labels</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">app</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">app</span><span style="color:#f92672">-</span><span style="color:#a6e22e">demo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">tier</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">containers</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tomcat</span><span style="color:#f92672">-</span><span style="color:#a6e22e">demo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tomcat</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">imagePullPolicy</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">IfNotPresent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">env</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">GET_HOSTS_FROM</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dns</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ports</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span> <span style="color:#a6e22e">containerPort</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">80</span></span></span></code></pre></div>
<p>å½“æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªRCå¹¶æäº¤åˆ°Kubernetesé›†ç¾¤ä¸­åï¼ŒMasterèŠ‚ç‚¹ä¸Šçš„Controller Managerç»„ä»¶å°±å¾—åˆ°é€šçŸ¥ï¼Œå®šæœŸå·¡æ£€ç³»ç»Ÿä¸­å½“å‰å­˜æ´»çš„ç›®æ ‡Podï¼Œå¹¶ç¡®ä¿ç›®æ ‡Podå®ä¾‹çš„æ•°é‡åˆšå¥½ç­‰äºæ­¤RCçš„æœŸæœ›å€¼ã€‚å¦‚æœæœ‰è¿‡å¤šçš„Podå‰¯æœ¬åœ¨è¿è¡Œï¼Œç³»ç»Ÿå°±ä¼šåœæ‰å¤šä½™çš„Podï¼›å¦‚æœè¿è¡Œçš„Podå‰¯æœ¬å°‘äºæœŸæœ›å€¼ï¼Œå³å¦‚æœæŸä¸ªPodæŒ‚æ‰ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„Podä»¥ä¿è¯æ•°é‡ç­‰äºæœŸæœ›å€¼ã€‚
é€šè¿‡RCï¼ŒKuberneteså®ç°äº†ç”¨æˆ·åº”ç”¨é›†ç¾¤çš„é«˜å¯ç”¨æ€§ï¼Œå¹¶ä¸”å¤§å¤§å‡å°‘äº†è¿ç»´äººå‘˜åœ¨ä¼ ç»ŸITç¯å¢ƒä¸­éœ€è¦å®Œæˆçš„è®¸å¤šæ‰‹å·¥è¿ç»´å·¥ä½œï¼ˆå¦‚ä¸»æœºç›‘æ§è„šæœ¬ã€åº”ç”¨ç›‘æ§è„šæœ¬ã€æ•…éšœæ¢å¤è„šæœ¬ç­‰ï¼‰ã€‚
ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹Kuberneteså¦‚ä½•é€šè¿‡RCæ¥å®ç°Podå‰¯æœ¬æ•°é‡è‡ªåŠ¨æ§åˆ¶çš„æœºåˆ¶ï¼Œå‡å¦‚æˆ‘ä»¬æœ‰3ä¸ªNodeèŠ‚ç‚¹ï¼Œåœ¨RCé‡Œå®šä¹‰äº†redis-slaveè¿™ä¸ªPodéœ€è¦ä¿æŒä¸¤ä¸ªå‰¯æœ¬ï¼Œç³»ç»Ÿå°†ä¼šåœ¨å…¶ä¸­çš„ä¸¤ä¸ªNodeä¸Šåˆ›å»ºå‰¯æœ¬ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
<a href="#R-image-3e183b10aa35ab3d1931ebf2152d7bd2" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/8f442923ef4ba86814b3817c556744e5.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-3e183b10aa35ab3d1931ebf2152d7bd2"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/8f442923ef4ba86814b3817c556744e5.png"></a>
å‡å¦‚Node2ä¸Šçš„Pod2æ„å¤–ç»ˆæ­¢ï¼Œæ ¹æ®RCå®šä¹‰çš„replicasæ•°é‡2ï¼ŒKuberneteså°†ä¼šè‡ªåŠ¨åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çš„Podï¼Œä»¥ä¿è¯æ•´ä¸ªé›†ç¾¤ä¸­å§‹ç»ˆæœ‰ä¸¤ä¸ªredis-slave Podåœ¨è¿è¡Œã€‚
ç³»ç»Ÿå¯èƒ½é€‰æ‹©Node1æˆ–è€…Node3æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„Podï¼Œå¦‚ä¸‹å›¾ã€‚
<a href="#R-image-1c186794d1dc49d44578f92e6a17a1be" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/54b8c0336dadce0ba77213a41927a5da.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1c186794d1dc49d44578f92e6a17a1be"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/54b8c0336dadce0ba77213a41927a5da.png"></a>
é€šè¿‡ä¿®æ”¹RCçš„å‰¯æœ¬æ•°é‡ï¼Œå¯ä»¥å®ç°Podçš„åŠ¨æ€ç¼©æ”¾ï¼ˆScalingï¼‰åŠŸèƒ½ã€‚
kubectl scale rc redis-slave &ndash;replicas=3
æ­¤æ—¶Kubernetesä¼šåœ¨3ä¸ªNodeä¸­é€‰å–ä¸€ä¸ªNodeåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªæ–°çš„Pod3ï¼Œä½¿redis-slave Podå‰¯æœ¬æ•°é‡å§‹ç»ˆä¿æŒ3ä¸ªã€‚</p>
<h1 id="å››replica-set">å››ã€Replica Set</h1>
<p>ç”±äºReplication Controllerä¸Kubernetesä»£ç ä¸­çš„æ¨¡å—Replication ControlleråŒåï¼ŒåŒæ—¶è¿™ä¸ªè¯ä¹Ÿæ— æ³•å‡†ç¡®è¡¨è¾¾å®ƒçš„æ„æ€ï¼Œæ‰€ä»¥ä»Kubernetes v1.2å¼€å§‹ï¼Œå®ƒå°±å‡çº§æˆäº†å¦å¤–ä¸€ä¸ªæ–°çš„å¯¹è±¡â€”â€”Replica Setï¼Œå®˜æ–¹è§£é‡Šä¸ºâ€œä¸‹ä¸€ä»£çš„RCâ€ã€‚å®ƒä¸RCå½“å‰å­˜åœ¨çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼šReplica Setæ”¯æŒåŸºäºé›†åˆçš„Label selectorï¼ˆSet-based selectorï¼‰ï¼Œè€ŒRCåªæ”¯æŒåŸºäºç­‰å¼çš„Label selectorï¼ˆequality-based selectorï¼‰ï¼Œæ‰€ä»¥Replica Setçš„åŠŸèƒ½æ›´å¼ºå¤§ã€‚ä¸‹é¢æ˜¯Replica Setçš„å®šä¹‰ä¾‹å­ï¼ˆçœå»äº†Podæ¨¡æ¿éƒ¨åˆ†çš„å†…å®¹ï¼‰ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">extensions</span><span style="color:#f92672">/</span><span style="color:#a6e22e">v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ReplicaSet</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">matchLabels</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">tier</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">matchExpressions</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> {<span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tier</span>, <span style="color:#a6e22e">operator</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">In</span>, <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">frontend</span>]}
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">template</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">â€¦â€¦â€¦â€¦</span></span></span></code></pre></div>
<p>Replica Setå¾ˆå°‘å•ç‹¬ä½¿ç”¨ï¼Œå®ƒä¸»è¦è¢«Deploymentè¿™ä¸ªæ›´é«˜å±‚çš„èµ„æºå¯¹è±¡æ‰€ä½¿ç”¨ï¼Œä»è€Œå½¢æˆä¸€æ•´å¥—Podåˆ›å»ºã€åˆ é™¤ã€æ›´æ–°çš„ç¼–æ’æœºåˆ¶ã€‚
RCå’ŒRSçš„ç‰¹æ€§ä¸ä½œç”¨å¦‚ä¸‹ï¼š</p>
<ul>
<li>åœ¨å¤§å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡å®šä¹‰ä¸€ä¸ªRCå®ç°Podçš„åˆ›å»ºè¿‡ç¨‹åŠå‰¯æœ¬æ•°é‡çš„è‡ªåŠ¨æ§åˆ¶ã€‚</li>
<li>RCé‡ŒåŒ…æ‹¬å®Œæ•´çš„Podå®šä¹‰æ¨¡æ¿ã€‚</li>
<li>RCé€šè¿‡Label Selectoræœºåˆ¶å®ç°å¯¹Podå‰¯æœ¬çš„è‡ªåŠ¨æ§åˆ¶ã€‚</li>
<li>é€šè¿‡æ”¹å˜RCé‡Œçš„Podå‰¯æœ¬æ•°é‡ï¼Œå¯ä»¥å®ç°Podçš„æ‰©å®¹æˆ–ç¼©å®¹åŠŸèƒ½ã€‚</li>
<li>é€šè¿‡æ”¹å˜RCé‡ŒPodæ¨¡æ¿ä¸­çš„é•œåƒç‰ˆæœ¬ï¼Œå¯ä»¥å®ç°Podçš„æ»šåŠ¨å‡çº§åŠŸèƒ½ã€‚</li>
</ul>
<h1 id="äº”deployment">äº”ã€Deployment</h1>
<p>Deploymentç›¸å¯¹äºRCçš„æœ€å¤§åŒºåˆ«æ˜¯æˆ‘ä»¬å¯ä»¥éšæ—¶çŸ¥é“å½“å‰Podâ€œéƒ¨ç½²â€çš„è¿›åº¦ã€‚ä¸€ä¸ªPodçš„åˆ›å»ºã€è°ƒåº¦ã€ç»‘å®šèŠ‚ç‚¹åŠåœ¨ç›®æ ‡Nodeä¸Šå¯åŠ¨å¯¹åº”çš„å®¹å™¨è¿™ä¸€å®Œæ•´è¿‡ç¨‹éœ€è¦ä¸€å®šçš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬æœŸå¾…ç³»ç»Ÿå¯åŠ¨Nä¸ªPodå‰¯æœ¬çš„ç›®æ ‡çŠ¶æ€ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªè¿ç»­å˜åŒ–çš„â€œéƒ¨ç½²è¿‡ç¨‹â€å¯¼è‡´çš„æœ€ç»ˆçŠ¶æ€ã€‚
Deploymentçš„å…¸å‹ä½¿ç”¨åœºæ™¯æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªDeploymentå¯¹è±¡æ¥ç”Ÿæˆå¯¹åº”çš„Replica Setå¹¶å®ŒæˆPodå‰¯æœ¬çš„åˆ›å»ºè¿‡ç¨‹ã€‚</li>
<li>æ£€æŸ¥Deploymentçš„çŠ¶æ€æ¥çœ‹éƒ¨ç½²åŠ¨ä½œæ˜¯å¦å®Œæˆï¼ˆPodå‰¯æœ¬çš„æ•°é‡æ˜¯å¦è¾¾åˆ°é¢„æœŸçš„å€¼ï¼‰ã€‚</li>
<li>æ›´æ–°Deploymentä»¥åˆ›å»ºæ–°çš„Podï¼ˆæ¯”å¦‚é•œåƒå‡çº§ï¼‰ã€‚</li>
<li>å¦‚æœå½“å‰Deploymentä¸ç¨³å®šï¼Œåˆ™å›æ»šåˆ°ä¸€ä¸ªæ—©å…ˆçš„Deploymentç‰ˆæœ¬ã€‚</li>
<li>æš‚åœDeploymentä»¥ä¾¿äºä¸€æ¬¡æ€§ä¿®æ”¹å¤šä¸ªPod Template Specçš„é…ç½®é¡¹ï¼Œä¹‹åå†æ¢å¤Deploymentï¼Œè¿›è¡Œæ–°çš„å‘å¸ƒã€‚</li>
<li>æ‰©å±•Deploymentä»¥åº”å¯¹é«˜è´Ÿè½½ã€‚</li>
<li>æŸ¥çœ‹Deploymentçš„çŠ¶æ€ï¼Œä»¥æ­¤ä½œä¸ºå‘å¸ƒæ˜¯å¦æˆåŠŸçš„æŒ‡æ ‡ã€‚</li>
<li>æ¸…ç†ä¸å†éœ€è¦çš„æ—§ç‰ˆæœ¬ReplicaSetã€‚</li>
</ul>
<p>Deploymentçš„å®šä¹‰ä¸Replica Setçš„å®šä¹‰ç±»ä¼¼ï¼Œåªæ˜¯APIå£°æ˜ä¸Kindç±»å‹ä¸åŒã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">extensions</span><span style="color:#f92672">/</span><span style="color:#a6e22e">v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">nginx</span><span style="color:#f92672">-</span><span style="color:#a6e22e">deployment</span></span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ReplicaSet</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">nginx</span><span style="color:#f92672">-</span><span style="color:#a6e22e">repset</span></span></span></code></pre></div>
<p>ä¸‹é¢æ˜¯Deploymentå®šä¹‰çš„ä¸€ä¸ªå®Œæ•´ä¾‹å­ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">extensions</span><span style="color:#f92672">/</span><span style="color:#a6e22e">v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">replicas</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">matchLabels</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">tier</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">matchExpressions</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> {<span style="color:#a6e22e">key</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tier</span>, <span style="color:#a6e22e">operator</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">In</span>, <span style="color:#a6e22e">values</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">frontend</span>]}
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">template</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">labels</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">app</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">app</span><span style="color:#f92672">-</span><span style="color:#a6e22e">demo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">tier</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">containers</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tomcat</span><span style="color:#f92672">-</span><span style="color:#a6e22e">demo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">image</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tomcat</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">imagePullPolicy</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">IfNotPresent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ports</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span> <span style="color:#a6e22e">containerPort</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">8080</span></span></span></code></pre></div>
<p>å¯ä»¥é€šè¿‡å‘½ä»¤kubectl get deploymentæ¥æŸ¥çœ‹Deploymentçš„ä¿¡æ¯ï¼Œå…¶ä¸­çš„å‡ ä¸ªå‚æ•°è§£é‡Šå¦‚ä¸‹ï¼š</p>
<ul>
<li>DESIRED:ï¼šPodå‰¯æœ¬æ•°é‡çš„æœŸæœ›å€¼ï¼Œå³Deploymenté‡Œå®šä¹‰çš„Replicaã€‚</li>
<li>CURRENTï¼šå½“å‰Replicaçš„å€¼ï¼Œå¦‚æœå°äºDESIREDçš„æœŸæœ›å€¼ï¼Œä¼šåˆ›å»ºæ–°çš„Podï¼Œç›´åˆ°è¾¾æˆDESIREDä¸ºæ­¢ã€‚</li>
<li>UP-TO-DATEï¼šæœ€æ–°ç‰ˆæœ¬çš„Podçš„å‰¯æœ¬æ•°é‡ï¼Œç”¨äºæŒ‡ç¤ºåœ¨æ»šåŠ¨å‡çº§çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¤šå°‘ä¸ªPodå‰¯æœ¬å·²ç»æˆåŠŸå‡çº§ã€‚</li>
<li>AVAILABLEï¼šå½“å‰é›†ç¾¤ä¸­å¯ç”¨çš„Podå‰¯æœ¬æ•°é‡ï¼Œå³é›†ç¾¤ä¸­å½“å‰å­˜æ´»çš„Podæ•°é‡ã€‚</li>
</ul>
<p>Podçš„ç®¡ç†å¯¹è±¡ï¼Œé™¤äº†RCã€ReplicaSetã€Deploymentï¼Œè¿˜æœ‰DaemonSetã€StatefulSetã€Jobç­‰ï¼Œåˆ†åˆ«ç”¨äºä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚</p>
<h1 id="å…­horizontal-pod-autoscaler">å…­ã€Horizontal Pod Autoscaler</h1>
<p>HPAä¸RCã€Deploymentä¸€æ ·ï¼Œä¹Ÿå±äºKubernetesèµ„æºå¯¹è±¡ã€‚é€šè¿‡è¿½è¸ªåˆ†æRCæˆ–RSæ§åˆ¶çš„æ‰€æœ‰ç›®æ ‡Podçš„è´Ÿè½½å˜åŒ–æƒ…å†µï¼Œæ¥ç¡®å®šæ˜¯å¦éœ€è¦é’ˆå¯¹æ€§åœ°è°ƒæ•´ç›®æ ‡Podçš„å‰¯æœ¬æ•°ã€‚
HPAæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä½œä¸ºPodè´Ÿè½½çš„åº¦é‡æŒ‡æ ‡ï¼š</p>
<ul>
<li>CPUUtilizationPercentage</li>
<li>åº”ç”¨ç¨‹åºè‡ªå®šä¹‰çš„åº¦é‡æŒ‡æ ‡ï¼Œæ¯”å¦‚æœåŠ¡åœ¨æ¯ç§’å†…çš„ç›¸åº”çš„è¯·æ±‚æ•°ï¼ˆTPSæˆ–QPSï¼‰ã€‚</li>
</ul>
<p>CPUUtilizationPercentageæ˜¯ä¸€ä¸ªç®—æœ¯å¹³å‡å€¼ï¼Œå³ç›®æ ‡Podæ‰€æœ‰å‰¯æœ¬è‡ªå¸¦çš„CPUåˆ©ç”¨ç‡çš„å¹³å‡å€¼ã€‚ä¸€ä¸ªPodè‡ªèº«çš„CPUåˆ©ç”¨ç‡æ˜¯è¯¥Podå½“å‰CPUçš„ä½¿ç”¨é‡é™¤ä»¥å®ƒçš„Pod Requestçš„å€¼ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªPodçš„Pod Requestä¸º0.4ï¼Œè€Œå½“å‰Podçš„CPUä½¿ç”¨é‡ä¸º0.2ï¼Œåˆ™å®ƒçš„CPUä½¿ç”¨ç‡ä¸º50%ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç®—å‡ºæ¥ä¸€ä¸ªRCæˆ–RSæ§åˆ¶çš„æ‰€æœ‰Podå‰¯æœ¬çš„CPUåˆ©ç”¨ç‡çš„ç®—æœ¯å¹³å‡å€¼äº†ã€‚å¦‚æœæŸä¸€æ—¶åˆ»CPUUtilizationPercentageçš„å€¼è¶…è¿‡80%ï¼Œåˆ™æ„å‘³ç€å½“å‰çš„Podå‰¯æœ¬æ•°å¾ˆå¯èƒ½ä¸è¶³ä»¥æ”¯æ’‘æ¥ä¸‹æ¥æ›´å¤šçš„è¯·æ±‚ï¼Œéœ€è¦è¿›è¡ŒåŠ¨æ€æ‰©å®¹ï¼Œè€Œå½“è¯·æ±‚é«˜å³°æ—¶æ®µè¿‡å»åï¼ŒPodçš„CPUåˆ©ç”¨ç‡åˆä¼šé™ä¸‹æ¥ï¼Œæ­¤æ—¶å¯¹åº”çš„Podå‰¯æœ¬æ•°åº”è¯¥è‡ªåŠ¨å‡å°‘åˆ°ä¸€ä¸ªåˆç†çš„æ°´å¹³ã€‚
ä¸‹é¢æ˜¯HPAå®šä¹‰çš„ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">autoscaling</span><span style="color:#f92672">/</span><span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">HorizontalPodAutoscaler</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">php</span><span style="color:#f92672">-</span><span style="color:#a6e22e">apache</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">namespace</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">default</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">maxReplicas</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">minReplicas</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scaleTargetRef</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Deployment</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">php</span><span style="color:#f92672">-</span><span style="color:#a6e22e">apache</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">targetCPUUtilizationPercentage</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">90</span></span></span></code></pre></div>
<p>é€šè¿‡HPAæ§åˆ¶php-apacheçš„Podå‰¯æœ¬ï¼Œå½“Podå‰¯æœ¬çš„CPUUtilizationPercentageçš„å€¼è¶…è¿‡90%æ—¶ï¼Œä¼šè¿›è¡Œè‡ªåŠ¨æ‰©å®¹å¢åŠ Podå‰¯æœ¬çš„æ•°é‡ï¼Œæ‰©å®¹æˆ–ç¼©å®¹æ—¶Podçš„å‰¯æœ¬æ•°é‡è¦ä»‹äº2-10ä¹‹é—´ã€‚
é™¤äº†é€šè¿‡yamlæ–‡ä»¶æ¥å®šä¹‰HPAå¯¹è±¡ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å‘½ä»¤çš„æ–¹å¼åˆ›å»ºï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">autoscale</span> <span style="color:#a6e22e">deployment</span> <span style="color:#a6e22e">php</span><span style="color:#f92672">-</span><span style="color:#a6e22e">apache</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">cpu</span><span style="color:#f92672">-</span><span style="color:#a6e22e">percent</span><span style="color:#f92672">=</span><span style="color:#ae81ff">90</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">min</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">max</span><span style="color:#f92672">=</span><span style="color:#ae81ff">10</span></span></span></code></pre></div>
<h1 id="ä¸ƒstatefulset">ä¸ƒã€StatefulSet</h1>
<p>Podçš„ç®¡ç†å¯¹è±¡RCã€Deploymentã€DaemonSetå’ŒJobéƒ½æ˜¯é¢å‘æ— çŠ¶æ€çš„æœåŠ¡ï¼Œä½†å®é™…ä¸­æœ‰å¾ˆå¤šæœåŠ¡æ˜¯æœ‰çŠ¶æ€çš„ï¼Œæ¯”å¦‚Mysqlé›†ç¾¤ã€MongoDBé›†ç¾¤ã€ZooKeeperé›†ç¾¤ç­‰ï¼Œå¯ä»¥ä½¿ç”¨StatefulSetæ¥ç®¡ç†æœ‰çŠ¶æ€çš„æœåŠ¡ã€‚
StatefulSetæœ‰å¦‚ä¸‹ä¸€äº›ç‰¹æ€§ï¼š</p>
<ul>
<li>StatefulSeté‡Œçš„æ¯ä¸ªPodéƒ½æœ‰ç¨³å®šã€å”¯ä¸€çš„ç½‘ç»œæ ‡è¯†ï¼Œå¯ä»¥ç”¨æ¥å‘ç°é›†ç¾¤å†…çš„å…¶ä»–æˆå‘˜ã€‚å‡è®¾</li>
<li>StatefulSetçš„åå­—å«kafkaï¼Œé‚£ä¹ˆç¬¬1ä¸ªPodå«kafka-0ï¼Œç¬¬2ä¸ªå«kafka-1ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
<li>StatefulSetæ§åˆ¶çš„Podå‰¯æœ¬çš„å¯åœé¡ºåºæ˜¯å—æ§çš„ï¼Œæ“ä½œç¬¬nä¸ªPodæ—¶ï¼Œå‰n-1ä¸ªPodå·²ç»æ˜¯è¿è¡Œä¸”å‡†å¤‡å¥½çš„çŠ¶æ€ã€‚</li>
</ul>
<p>StatefulSeté‡Œçš„Podé‡‡ç”¨ç¨³å®šçš„æŒä¹…åŒ–å­˜å‚¨å·ï¼Œé€šè¿‡PV/PVCæ¥å®ç°ï¼Œåˆ é™¤Podæ—¶é»˜è®¤ä¸ä¼šåˆ é™¤ä¸StatefulSetç›¸å…³çš„å­˜å‚¨å·ï¼ˆä¸ºäº†ä¿è¯æ•°æ®çš„å®‰å…¨ï¼‰ã€‚
StatefulSeté™¤äº†è¦ä¸PVå·æ†ç»‘ä½¿ç”¨ä»¥å­˜å‚¨Podçš„çŠ¶æ€æ•°æ®ï¼Œè¿˜è¦ä¸Headless Serviceé…åˆä½¿ç”¨ï¼Œå³åœ¨æ¯ä¸ªStatefulSetçš„å®šä¹‰ä¸­è¦å£°æ˜å®ƒå±äºå“ªä¸ªHeadless Serviceã€‚Headless Serviceä¸æ™®é€šServiceçš„åŒºåˆ«åœ¨äºï¼Œå®ƒæ²¡æœ‰Cluster IPï¼Œå¦‚æœè§£æHeadless Serviceçš„DNSåŸŸåï¼Œåˆ™è¿”å›çš„æ˜¯è¯¥Serviceå¯¹åº”çš„å…¨éƒ¨Podçš„Endpointåˆ—è¡¨ã€‚StatefulSetåœ¨Headless Serviceçš„åŸºç¡€ä¸Šåˆä¸ºStatefulSetæ§åˆ¶çš„æ¯ä¸ªPodå®ä¾‹åˆ›å»ºäº†ä¸€ä¸ªDNSåŸŸåï¼Œè¿™ä¸ªåŸŸåçš„æ ¼å¼ä¸ºï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">podname</span>).<span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">headless</span> <span style="color:#a6e22e">service</span> <span style="color:#a6e22e">name</span>)</span></span></code></pre></div>
<p>æ¯”å¦‚ä¸€ä¸ª3èŠ‚ç‚¹çš„kafkaçš„StatefulSeté›†ç¾¤ï¼Œå¯¹åº”çš„Headless Serviceçš„åå­—ä¸ºkafkaï¼ŒStatefulSetçš„åå­—ä¸ºkafkaï¼Œåˆ™StatefulSeté‡Œé¢çš„3ä¸ªPodçš„DNSåç§°åˆ†åˆ«ä¸ºkafka-0.kafkaã€kafka-1.kafkaã€kafka-3.kafkaï¼Œè¿™äº›DNSåç§°å¯ä»¥ç›´æ¥åœ¨é›†ç¾¤çš„é…ç½®æ–‡ä»¶ä¸­å›ºå®šä¸‹æ¥ã€‚</p>
<h1 id="å…«serviceæœåŠ¡">å…«ã€Serviceï¼ˆæœåŠ¡ï¼‰</h1>
<h2 id="1æ¦‚è¿°">1.æ¦‚è¿°</h2>
<p>Serviceå…¶å®å°±æ˜¯æˆ‘ä»¬ç»å¸¸æèµ·çš„å¾®æœåŠ¡æ¶æ„ä¸­çš„ä¸€ä¸ªâ€œå¾®æœåŠ¡â€ï¼ŒPodã€RCç­‰èµ„æºå¯¹è±¡å…¶å®éƒ½æ˜¯ä¸ºå®ƒä½œâ€œå«è¡£â€çš„ã€‚Podã€RCæˆ–RSä¸Serviceçš„é€»è¾‘å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
<a href="#R-image-f162c0da5d62cdc75489107d77e99198" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/92d4ab8c55377382f5870da05793d58b.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f162c0da5d62cdc75489107d77e99198"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/92d4ab8c55377382f5870da05793d58b.png"></a>
é€šè¿‡ä¸Šå›¾æˆ‘ä»¬çœ‹åˆ°ï¼ŒKubernetesçš„Serviceå®šä¹‰äº†ä¸€ä¸ªæœåŠ¡çš„è®¿é—®å…¥å£åœ°å€ï¼Œå‰ç«¯çš„åº”ç”¨ï¼ˆPodï¼‰é€šè¿‡è¿™ä¸ªå…¥å£åœ°å€è®¿é—®å…¶èƒŒåçš„ä¸€ç»„ç”±Podå‰¯æœ¬ç»„æˆçš„é›†ç¾¤å®ä¾‹ï¼ŒServiceä¸å…¶åç«¯Podå‰¯æœ¬é›†ç¾¤ä¹‹é—´åˆ™æ˜¯é€šè¿‡Label Selectoræ¥å®ç°â€œæ— ç¼å¯¹æ¥â€çš„ã€‚è€ŒRCçš„ä½œç”¨å®é™…ä¸Šæ˜¯ä¿è¯Serviceçš„æœåŠ¡èƒ½åŠ›å’ŒæœåŠ¡è´¨é‡å§‹ç»ˆå¤„äºé¢„æœŸçš„æ ‡å‡†ã€‚
é€šè¿‡åˆ†æã€è¯†åˆ«å¹¶å»ºæ¨¡ç³»ç»Ÿä¸­çš„æ‰€æœ‰æœåŠ¡ä¸ºå¾®æœåŠ¡â€”â€”Kubernetes Serviceï¼Œæœ€ç»ˆæˆ‘ä»¬çš„ç³»ç»Ÿç”±å¤šä¸ªæä¾›ä¸åŒä¸šåŠ¡èƒ½åŠ›è€Œåˆå½¼æ­¤ç‹¬ç«‹çš„å¾®æœåŠ¡å•å…ƒæ‰€ç»„æˆï¼ŒæœåŠ¡ä¹‹é—´é€šè¿‡TCP/IPè¿›è¡Œé€šä¿¡ï¼Œä»è€Œå½¢æˆäº†å¼ºå¤§è€Œåˆçµæ´»çš„å¼¹æ€§é›†ç¾¤ï¼Œæ‹¥æœ‰äº†å¼ºå¤§çš„åˆ†å¸ƒå¼èƒ½åŠ›ã€å¼¹æ€§æ‰©å±•èƒ½åŠ›ã€å®¹é”™èƒ½åŠ›ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿæ¶æ„ä¹Ÿå˜å¾—ç®€å•å’Œç›´è§‚è®¸å¤šã€‚
æ—¢ç„¶æ¯ä¸ªPodéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå•ç‹¬çš„IPåœ°å€ï¼Œè€Œä¸”æ¯ä¸ªPodéƒ½æä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„Endpointï¼ˆPod IP+ContainerPortï¼‰ä»¥è¢«å®¢æˆ·ç«¯è®¿é—®ï¼Œå¤šä¸ªPodå‰¯æœ¬ç»„æˆäº†ä¸€ä¸ªé›†ç¾¤æ¥æä¾›æœåŠ¡ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å¦‚ä½•æ¥è®¿é—®å®ƒä»¬å‘¢ï¼Ÿä¸€èˆ¬çš„åšæ³•æ˜¯éƒ¨ç½²ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼ˆè½¯ä»¶æˆ–ç¡¬ä»¶ï¼‰ï¼Œä½†è¿™æ ·æ— ç–‘å¢åŠ äº†è¿ç»´çš„å·¥ä½œé‡ã€‚åœ¨Kubernetesé›†ç¾¤é‡Œä½¿ç”¨äº†Serviceï¼ˆæœåŠ¡ï¼‰ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªè™šæ‹Ÿçš„IPåœ°å€ï¼ˆCluster IPï¼‰å’Œç«¯å£å·ï¼ŒKubernetesé›†ç¾¤é‡Œçš„ä»»ä½•æœåŠ¡éƒ½å¯ä»¥é€šè¿‡Cluster IP+ç«¯å£çš„æ–¹å¼æ¥è®¿é—®æ­¤æœåŠ¡ï¼Œè‡³äºè®¿é—®è¯·æ±‚æœ€åä¼šè¢«è½¬å‘åˆ°å“ªä¸ªPodï¼Œåˆ™ç”±è¿è¡Œåœ¨æ¯ä¸ªNodeä¸Šçš„kube-proxyè´Ÿè´£ã€‚kube-proxyè¿›ç¨‹å…¶å®å°±æ˜¯ä¸€ä¸ªæ™ºèƒ½çš„è½¯ä»¶è´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒè´Ÿè´£æŠŠå¯¹Serviceçš„è¯·æ±‚è½¬å‘åˆ°åç«¯çš„æŸä¸ªPodå®ä¾‹ä¸Šï¼Œå¹¶åœ¨å†…éƒ¨å®ç°æœåŠ¡çš„è´Ÿè½½å‡è¡¡ä¸ä¼šè¯ä¿æŒæœºåˆ¶ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªServiceçš„ç®€å•å®šä¹‰ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tomcat</span><span style="color:#f92672">-</span><span style="color:#a6e22e">service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ports</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tier</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span></span></span></code></pre></div>
<p>ä¸Šè¿°å†…å®¹å®šä¹‰äº†ä¸€ä¸ªåä¸ºâ€œtomcat-serviceâ€çš„Serviceï¼Œå®ƒçš„æœåŠ¡ç«¯å£ä¸º8080ï¼Œæ‹¥æœ‰â€œtier=frontendâ€è¿™ä¸ªLabelçš„æ‰€æœ‰Podå®ä¾‹ã€‚
å¾ˆå¤šæœåŠ¡éƒ½å­˜åœ¨å¤šä¸ªç«¯å£çš„é—®é¢˜ï¼Œé€šå¸¸ä¸€ä¸ªç«¯å£æä¾›ä¸šåŠ¡æœåŠ¡ï¼Œå¦å¤–ä¸€ä¸ªç«¯å£æä¾›ç®¡ç†æœåŠ¡ï¼Œæ¯”å¦‚Mycatã€Codisç­‰å¸¸è§ä¸­é—´ä»¶ã€‚Kubernetes Serviceæ”¯æŒå¤šä¸ªEndpointï¼Œè¦æ±‚æ¯ä¸ªEndpointå®šä¹‰ä¸€ä¸ªåå­—æ¥åŒºåˆ†ï¼Œä¸‹é¢æ˜¯tomcatå¤šç«¯å£çš„Serviceå®šä¹‰æ ·ä¾‹ã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tomcat</span><span style="color:#f92672">-</span><span style="color:#a6e22e">service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ports</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">-</span><span style="color:#a6e22e">port</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">8005</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">shutdown</span><span style="color:#f92672">-</span><span style="color:#a6e22e">port</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tier</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span></span></span></code></pre></div>
<p>å¤šç«¯å£ä¸ºä»€ä¹ˆéœ€è¦ç»™æ¯ä¸ªç«¯å£å‘½åå‘¢ï¼Ÿè¿™å°±æ¶‰åŠKubernetesçš„æœåŠ¡å‘ç°æœºåˆ¶äº†ã€‚
å¯¹äºæœåŠ¡çš„ipå¯ä»¥é€šè¿‡æš´æ¼serviceé€šè¿‡æœåŠ¡å.ç©ºé—´åæ¥è¿›è¡Œè®¿é—® serviceName.namespaceName.svc.cluster.localæ¥è¿›è¡Œè®¿é—®ï¼ˆsvc.cluster.localå¯ä»¥å¿½ç•¥ï¼‰ã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>kubectl create ns test
kubectl run pod-nginx --image=nginx -n test
kubectl expose pod pod-nginx --port=18009 --target-port=80 -n test --name service-nginx
#</code></pre></div>
<p>åœ¨å…¶ä»–å®¹å™¨ä¸­å°±å¯ä»¥é€šè¿‡(podæ˜¯ä¸èƒ½ç›´æ¥è®¿é—®å¿…é¡»é€šè¿‡serviceï¼Œpingå¯èƒ½ä¸é€šï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°ipï¼Œä½†æ˜¯ç«¯å£ä¸€å®šæ˜¯é€šçš„)
ping service-nginx.test
æˆ–è€…
curl service-nginx.test:18009è®¿é—®æœåŠ¡</p>
<p>å¯ä»¥ä½¿ç”¨è¿™ä¸ªbusyboxå®¹å™¨å»æµ‹è¯•</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>kubectl run test-pod --image=busybox --rm -it --restart=Never -- sh</code></pre></div>
<h2 id="2kubernetesçš„æœåŠ¡å‘ç°æœºåˆ¶">2.Kubernetesçš„æœåŠ¡å‘ç°æœºåˆ¶</h2>
<p>æ¯ä¸ªKubernetesä¸­çš„Serviceéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„Cluster IPåŠå”¯ä¸€çš„åå­—ï¼Œè€Œåå­—æ˜¯ç”±æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ï¼Œé‚£æˆ‘ä»¬æ˜¯å¦å¯ä»¥é€šè¿‡Serviceçš„åå­—æ¥è®¿é—®å‘¢ï¼Ÿ
æœ€æ—©æ—¶Kubernetesé‡‡ç”¨äº†Linuxç¯å¢ƒå˜é‡çš„æ–¹å¼æ¥å®ç°ï¼Œå³æ¯ä¸ªServiceç”Ÿæˆä¸€äº›å¯¹åº”çš„Linuxç¯å¢ƒå˜é‡ï¼ˆENVï¼‰ï¼Œå¹¶åœ¨æ¯ä¸ªPodçš„å®¹å™¨å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨æ³¨å…¥è¿™äº›ç¯å¢ƒå˜é‡ï¼Œä»¥å®ç°é€šè¿‡Serviceçš„åå­—æ¥å»ºç«‹è¿æ¥çš„ç›®çš„ã€‚
è€ƒè™‘åˆ°é€šè¿‡ç¯å¢ƒå˜é‡è·å–Serviceçš„IPä¸ç«¯å£çš„æ–¹å¼ä»ç„¶ä¸æ–¹ä¾¿ã€ä¸ç›´è§‚ï¼Œåæ¥Kubernetesé€šè¿‡Add-Onå¢å€¼åŒ…çš„æ–¹å¼å¼•å…¥äº†DNSç³»ç»Ÿï¼ŒæŠŠæœåŠ¡åä½œä¸ºDNSåŸŸåï¼Œè¿™æ ·ç¨‹åºå°±å¯ä»¥ç›´æ¥ä½¿ç”¨æœåŠ¡åæ¥å»ºç«‹è¿æ¥äº†ã€‚</p>
<h2 id="3å¤–éƒ¨ç³»ç»Ÿè®¿é—®serviceçš„é—®é¢˜">3.å¤–éƒ¨ç³»ç»Ÿè®¿é—®Serviceçš„é—®é¢˜</h2>
<p>Kubernetesé›†ç¾¤é‡Œæœ‰ä¸‰ç§IPåœ°å€ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>Node IPï¼šNodeèŠ‚ç‚¹çš„IPåœ°å€ï¼Œå³ç‰©ç†ç½‘å¡çš„IPåœ°å€ã€‚</li>
<li>Pod IPï¼šPodçš„IPåœ°å€ï¼Œå³dockerå®¹å™¨çš„IPåœ°å€ï¼Œæ­¤ä¸ºè™šæ‹ŸIPåœ°å€ã€‚</li>
<li>Cluster IPï¼šServiceçš„IPåœ°å€ï¼Œæ­¤ä¸ºè™šæ‹ŸIPåœ°å€ã€‚</li>
</ul>
<p>å¤–éƒ¨è®¿é—®Kubernetesé›†ç¾¤é‡Œçš„æŸä¸ªèŠ‚ç‚¹æˆ–è€…æœåŠ¡æ—¶ï¼Œå¿…é¡»è¦é€šè¿‡Node IPè¿›è¡Œé€šä¿¡ã€‚
Pod IPæ˜¯Docker Engineæ ¹æ®docker0ç½‘æ¡¥çš„IPåœ°å€æ®µè¿›è¡Œåˆ†é…çš„ä¸€ä¸ªè™šæ‹ŸäºŒå±‚ç½‘ç»œIPåœ°å€ï¼ŒPodä¸Podä¹‹é—´çš„è®¿é—®å°±æ˜¯é€šè¿‡è¿™ä¸ªè™šæ‹ŸäºŒå±‚ç½‘ç»œè¿›è¡Œé€šä¿¡çš„ï¼Œè€ŒçœŸå®çš„TCP/IPæµé‡åˆ™æ˜¯é€šè¿‡Node IPæ‰€åœ¨çš„ç‰©ç†ç½‘å¡æµå‡ºçš„ã€‚
Serviceçš„Cluster IPå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>Cluster IPä»…ä»…ä½œç”¨äºServiceè¿™ä¸ªå¯¹è±¡ï¼Œå¹¶ç”±Kubernetesç®¡ç†å’Œåˆ†é…IPåœ°å€ã€‚</li>
<li>Cluster IPæ˜¯ä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œæ— æ³•è¢«pingã€‚</li>
<li>Cluster IPåªèƒ½ç»“åˆService Portç»„æˆä¸€ä¸ªå…·ä½“çš„é€šä¿¡ç«¯å£ï¼Œä¾›Kubernetesé›†ç¾¤å†…éƒ¨è®¿é—®ï¼Œå•ç‹¬çš„Cluster IPä¸å…·å¤‡TCP/IPé€šä¿¡çš„åŸºç¡€ï¼Œå¹¶ä¸”å¤–éƒ¨å¦‚æœè¦è®¿é—®è¿™ä¸ªé€šä¿¡ç«¯å£ï¼Œéœ€è¦åšä¸€äº›é¢å¤–çš„å·¥ä½œã€‚</li>
<li>Node IPã€Pod IPå’ŒCluster IPä¹‹é—´çš„é€šä¿¡ï¼Œé‡‡ç”¨çš„æ˜¯Kubernetesè‡ªå·±è®¾è®¡çš„ä¸€ç§ç‰¹æ®Šçš„è·¯ç”±è§„åˆ™ï¼Œä¸æˆ‘ä»¬ç†Ÿæ‚‰çš„IPè·¯ç”±æœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚</li>
</ul>
<p>æˆ‘ä»¬çš„åº”ç”¨å¦‚æœæƒ³è®©å¤–éƒ¨è®¿é—®ï¼Œæœ€å¸¸ç”¨çš„ä½œæ³•æ˜¯ä½¿ç”¨NodePortæ–¹å¼ã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tomcat</span><span style="color:#f92672">-</span><span style="color:#a6e22e">service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">NodePort</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ports</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">nodePort</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">31002</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tier</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span></span></span></code></pre></div>
<p>NodePortçš„å®ç°æ–¹å¼æ˜¯åœ¨Kubernetesé›†ç¾¤é‡Œçš„æ¯ä¸ªNodeä¸Šä¸ºéœ€è¦å¤–éƒ¨è®¿é—®çš„Serviceå¼€å¯ä¸€ä¸ªå¯¹åº”çš„TCPç›‘å¬ç«¯å£ï¼Œå¤–éƒ¨ç³»ç»Ÿåªè¦ç”¨ä»»æ„ä¸€ä¸ªNodeçš„IPåœ°å€+å…·ä½“çš„NodePortç«¯å£å·å³å¯è®¿é—®æ­¤æœåŠ¡ã€‚
NodePortè¿˜æ²¡æœ‰å®Œå…¨è§£å†³å¤–éƒ¨è®¿é—®Serviceçš„æ‰€æœ‰é—®é¢˜ï¼Œæ¯”å¦‚è´Ÿè½½å‡è¡¡é—®é¢˜ï¼Œå¸¸ç”¨çš„åšæ³•æ˜¯åœ¨Kubernetesé›†ç¾¤ä¹‹å¤–éƒ¨ç½²ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ã€‚
<a href="#R-image-a394c5bfb7e95868d3403cc0c33300ac" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/b24fa5cb3521a292a29cd41af66b54db.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a394c5bfb7e95868d3403cc0c33300ac"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_01.md.images/b24fa5cb3521a292a29cd41af66b54db.png"></a>
Load balancerç»„ä»¶ç‹¬ç«‹äºKubernetesé›†ç¾¤ä¹‹å¤–ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯è½¯ä»¶æ–¹å¼å®ç°ï¼Œä¾‹å¦‚HAProxyæˆ–è€…Nginxã€‚è¿™ç§æ–¹å¼ï¼Œæ— ç–‘æ˜¯å¢åŠ äº†è¿ç»´çš„å·¥ä½œé‡åŠå‡ºé”™çš„æ¦‚ç‡ã€‚
äºæ˜¯Kubernetesæä¾›äº†è‡ªåŠ¨åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨è°·æ­Œçš„GCEå…¬æœ‰äº‘ï¼Œé‚£ä¹ˆåªéœ€è¦å°†type: NodePortæ”¹æˆtype: LoadBalancerï¼Œæ­¤æ—¶Kubernetesä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Load balancerå®ä¾‹å¹¶è¿”å›å®ƒçš„IPåœ°å€ä¾›å¤–éƒ¨å®¢æˆ·ç«¯ä½¿ç”¨ã€‚å…¶ä»–å…¬æœ‰äº‘æä¾›å•†åªè¦å®ç°äº†æ”¯æŒæ­¤ç‰¹æ€§çš„é©±åŠ¨ï¼Œåˆ™ä¹Ÿå¯ä»¥è¾¾åˆ°ä¸Šè¿°ç›®çš„ã€‚</p>
<h1 id="ä¹volumeå­˜å‚¨å·">ä¹ã€Volumeï¼ˆå­˜å‚¨å·ï¼‰</h1>
<p>Volumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ã€‚Volumeå®šä¹‰åœ¨Podä¸Šï¼Œè¢«ä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯æ—¶ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚Kubernetesæ”¯æŒå¤šç§ç±»å‹çš„Volumeï¼Œä¾‹å¦‚GlusterFSã€Cephç­‰åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚
é™¤äº†å¯ä»¥è®©ä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨å…±äº«æ–‡ä»¶ã€è®©å®¹å™¨çš„æ•°æ®å†™åˆ°å®¿ä¸»æœºçš„ç£ç›˜ä¸Šæˆ–è€…å†™æ–‡ä»¶åˆ°ç½‘ç»œå­˜å‚¨ä¸­ï¼ŒKubernetesè¿˜æä¾›äº†å®¹å™¨é…ç½®æ–‡ä»¶é›†ä¸­åŒ–å®šä¹‰ä¸ç®¡ç†ï¼Œé€šè¿‡ConfigMapå¯¹è±¡æ¥å®ç°ã€‚
Kubernetesæ”¯æŒå¤šç§Volumeç±»å‹ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€ä¸€è¿›è¡Œä»‹ç»ã€‚</p>
<h2 id="1emptydir">1.emptyDir</h2>
<p>emptyDiræ˜¯åœ¨Podåˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå®ƒæ˜¯Kubernetesè‡ªåŠ¨åˆ†é…çš„ä¸€ä¸ªç›®å½•ï¼Œå½“Podä»Nodeä¸Šç§»é™¤æ—¶ï¼ŒemptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚
emptyDirçš„ç”¨é€”å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸´æ—¶ç©ºé—´ï¼Œä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿å­˜ã€‚</li>
<li>é•¿æ—¶é—´ä»»åŠ¡çš„ä¸­é—´è¿‡ç¨‹CheckPointçš„ä¸´æ—¶ä¿å­˜ç›®å½•ã€‚</li>
<li>ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•ï¼ˆå¤šå®¹å™¨å…±äº«ç›®å½•ï¼‰ã€‚
emptyDirçš„å®šä¹‰å¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">template</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labels</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">app</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">app</span><span style="color:#f92672">-</span><span style="color:#a6e22e">demo</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">tier</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">frontend</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">volumes</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">datavol</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">emptyDir</span><span style="color:#f92672">:</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">containers</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tomcat</span><span style="color:#f92672">-</span><span style="color:#a6e22e">demo</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">image</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">tomcat</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">volumeMounts</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span> <span style="color:#a6e22e">mountPath</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">/mydata-data</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">datavol</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">imagePullPolicy</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">IfNotPresent</span></span></span></code></pre></div>
<h2 id="2hostpath">2.hostPath</h2>
<p>ä½¿ç”¨hostPathæŒ‚è½½å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¸»è¦ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>å®¹å™¨åº”ç”¨ç¨‹åºç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶éœ€è¦æ°¸ä¹…ä¿å­˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ã€‚</li>
<li>éœ€è¦è®¿é—®å®¿ä¸»æœºä¸ŠDockerå¼•æ“å†…éƒ¨æ•°æ®æ—¶ï¼Œå¯ä»¥å®šä¹‰hostPathçš„å®¿ä¸»æœºç›®å½•ä¸ºdockerçš„æ•°æ®å­˜å‚¨ç›®å½•ï¼Œä½¿å®¹å™¨å†…éƒ¨åº”ç”¨å¯ä»¥ç›´æ¥è®¿é—®dockerçš„æ•°æ®æ–‡ä»¶ã€‚</li>
</ul>
<p>ä½¿ç”¨hostPathæ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>åœ¨ä¸åŒçš„Nodeä¸Šçš„PodæŒ‚è½½çš„æ˜¯æœ¬åœ°å®¿ä¸»æœºçš„ç›®å½•ï¼Œå¦‚æœè¦æƒ³è®©ä¸åŒçš„NodeæŒ‚è½½ç›¸åŒçš„ç›®å½•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç½‘ç»œå­˜å‚¨æˆ–åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ã€‚</li>
<li>å¦‚æœä½¿ç”¨äº†èµ„æºé…é¢ç®¡ç†ï¼Œåˆ™Kubernetesæ— æ³•å°†å…¶åœ¨å®¿ä¸»æœºä¸Šä½¿ç”¨çš„èµ„æºçº³å…¥ç®¡ç†ã€‚
hostPathçš„å®šä¹‰å¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">volumes</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;persistent-storage&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">hostPath</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/data&#34;</span></span></span></code></pre></div>
<h2 id="3gcepersistentdisk">3.gcePersistentDisk</h2>
<p>ä½¿ç”¨è¿™ç§ç±»å‹çš„Volumeè¡¨ç¤ºä½¿ç”¨è°·æ­Œå…¬æœ‰äº‘æä¾›çš„æ°¸ä¹…ç£ç›˜ï¼ˆPersistent Diskï¼ŒPDï¼‰å­˜æ”¾æ•°æ®ï¼Œä½¿ç”¨gcePersistentDiskæœ‰ä»¥ä¸‹ä¸€äº›é™åˆ¶æ¡ä»¶ï¼š</p>
<ul>
<li>Nodeéœ€è¦æ˜¯è°·æ­ŒGCEäº‘ä¸»æœºã€‚</li>
<li>è¿™äº›äº‘ä¸»æœºéœ€è¦ä¸PDå­˜åœ¨äºç›¸åŒçš„GCEé¡¹ç›®å’ŒZoneä¸­ã€‚
é€šè¿‡gcloudå‘½ä»¤åˆ›å»ºä¸€ä¸ªPDï¼š</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">gcloud</span> <span style="color:#a6e22e">compute</span> <span style="color:#a6e22e">disks</span> <span style="color:#a6e22e">create</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">size</span><span style="color:#f92672">=</span><span style="color:#ae81ff">500</span><span style="color:#a6e22e">GB</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">zone</span><span style="color:#f92672">=</span><span style="color:#a6e22e">us</span><span style="color:#f92672">-</span><span style="color:#a6e22e">centrall</span><span style="color:#f92672">-</span><span style="color:#a6e22e">a</span> <span style="color:#a6e22e">my</span><span style="color:#f92672">-</span><span style="color:#a6e22e">data</span><span style="color:#f92672">-</span><span style="color:#a6e22e">disk</span></span></span></code></pre></div>
<p>å®šä¹‰gcePersistentDiskç±»å‹çš„Volumeçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">volumes</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">-</span><span style="color:#a6e22e">volume</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gcPersistentDisk</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pdName</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">my</span><span style="color:#f92672">-</span><span style="color:#a6e22e">data</span><span style="color:#f92672">-</span><span style="color:#a6e22e">disk</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fsType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ext4</span></span></span></code></pre></div>
<h2 id="4awselasticblockstore">4.awsElasticBlockStore</h2>
<p>ä¸GCEç±»ä¼¼ï¼Œè¯¥ç±»å‹çš„Volumeä½¿ç”¨äºšé©¬é€Šå…¬æœ‰äº‘æä¾›çš„EBS Volumeå­˜å‚¨æ•°æ®ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªEBS Volumeæ‰èƒ½ä½¿ç”¨awsElasticBlockStoreã€‚
ä½¿ç”¨awsElasticBlockStoreçš„ä¸€äº›é™åˆ¶æ¡ä»¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>Nodeéœ€è¦æ˜¯AWS EC2å®ä¾‹ã€‚</li>
<li>è¿™äº›AWS EC2å®ä¾‹éœ€è¦ä¸EBS volumeå­˜åœ¨äºç›¸åŒçš„regionå’Œavailability-zoneä¸­ã€‚</li>
<li>EBSåªæ”¯æŒå•ä¸ªEC2å®ä¾‹mountä¸€ä¸ªvolumeã€‚
é€šè¿‡aws ec2 create-volumeå‘½ä»¤åˆ›å»ºä¸€ä¸ªEBS volumeï¼š</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">aws</span> <span style="color:#a6e22e">ec2</span> <span style="color:#a6e22e">create</span><span style="color:#f92672">-</span><span style="color:#a6e22e">volume</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">availability</span><span style="color:#f92672">-</span><span style="color:#a6e22e">zone</span> <span style="color:#a6e22e">eu</span><span style="color:#f92672">-</span><span style="color:#a6e22e">west</span><span style="color:#f92672">-</span><span style="color:#a6e22e">la</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">size</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">volume</span><span style="color:#f92672">-</span><span style="color:#a6e22e">type</span> <span style="color:#a6e22e">gp2</span></span></span></code></pre></div>
<p>å®šä¹‰awsElasticBlockStoreç±»å‹çš„Volumeçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">volumes</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">-</span><span style="color:#a6e22e">volume</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">awsElasticBlockStore</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">volumeID</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">aws</span><span style="color:#f92672">:</span><span style="color:#75715e">//&lt;availability-zone&gt;/&lt;volume-id&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fsType</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ext4</span></span></span></code></pre></div>
<h2 id="5nfs">5.NFS</h2>
<p>ä½¿ç”¨NFSç½‘ç»œæ–‡ä»¶ç³»ç»Ÿæä¾›çš„å…±äº«ç›®å½•å­˜å‚¨æ•°æ®æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿä¸­éƒ¨ç½²ä¸€ä¸ªNFS Serverã€‚
å®šä¹‰NFSç±»å‹çš„Volumeçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">volumes</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">nfs</span><span style="color:#f92672">-</span><span style="color:#a6e22e">volume</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">nfs</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">server</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">nfs</span><span style="color:#f92672">-</span><span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">localhost</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/&#34;</span></span></span></code></pre></div>
<h2 id="6å…¶ä»–ç±»å‹çš„volume">6.å…¶ä»–ç±»å‹çš„Volume</h2>
<ul>
<li>iscsiï¼šä½¿ç”¨iSCSIå­˜å‚¨è®¾å¤‡ä¸Šçš„ç›®å½•æŒ‚è½½åˆ°Podä¸­ã€‚</li>
<li>flockerï¼šä½¿ç”¨Flockeræ¥ç®¡ç†å­˜å‚¨å·ã€‚</li>
<li>glusterfsï¼šä½¿ç”¨GlusterFSç½‘ç»œæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•æŒ‚è½½åˆ°Podä¸­ã€‚</li>
<li>rbdï¼šä½¿ç”¨Cephå—è®¾å¤‡å…±äº«å­˜å‚¨ï¼ˆRados Block Deviceï¼‰æŒ‚è½½åˆ°Podä¸­ã€‚</li>
<li>gitRepoï¼šé€šè¿‡æŒ‚è½½ä¸€ä¸ªç©ºç›®å½•ï¼Œå¹¶ä»GITåº“cloneä¸€ä¸ªgit repositoryä»¥ä¾›Podä½¿ç”¨ã€‚</li>
<li>secretï¼šä¸€ä¸ªsecret volumeç”¨äºä¸ºPodæä¾›åŠ å¯†çš„ä¿¡æ¯ï¼Œå¯ä»¥å°†å®šä¹‰åœ¨Kubernetesä¸­çš„secretç›´æ¥æŒ‚è½½ä¸ºæ–‡ä»¶è®©Podè®¿é—®ã€‚Secret volumeæ˜¯é€šè¿‡tmfsï¼ˆå†…å­˜æ–‡ä»¶ç³»ç»Ÿï¼‰å®ç°çš„ï¼Œæ‰€ä»¥è¿™ç§ç±»å‹çš„volumeä¸ä¼šæŒä¹…åŒ–ã€‚</li>
</ul>
<h1 id="åpersistent-volume">åã€Persistent Volume</h1>
<p>ä¸Šé¢æåˆ°çš„Volumeæ˜¯å®šä¹‰åœ¨Podä¸Šçš„ï¼Œå±äºâ€œè®¡ç®—èµ„æºâ€çš„ä¸€éƒ¨åˆ†ï¼Œè€Œå®é™…ä¸Šï¼Œâ€œç½‘ç»œå­˜å‚¨â€æ˜¯ç›¸å¯¹ç‹¬ç«‹äºâ€œè®¡ç®—èµ„æºâ€è€Œå­˜åœ¨çš„ä¸€ç§å®ä½“èµ„æºã€‚æ¯”å¦‚åœ¨ä½¿ç”¨äº‘ä¸»æœºçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå…ˆåˆ›å»ºä¸€ä¸ªç½‘ç»œå­˜å‚¨ï¼Œç„¶åä»ä¸­åˆ’å‡ºä¸€ä¸ªâ€œç½‘ç›˜â€å¹¶æŒ‚è½½åˆ°äº‘ä¸»æœºä¸Šã€‚Persistent Volumeï¼ˆç®€ç§°PVï¼‰å’Œä¸ä¹‹ç›¸å…³è”çš„Persistent Volume Claimï¼ˆç®€ç§°PVCï¼‰å®ç°äº†ç±»ä¼¼çš„åŠŸèƒ½ã€‚
PVä¸Volumeçš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>PVåªèƒ½æ˜¯ç½‘ç»œå­˜å‚¨ï¼Œä¸å±äºä»»ä½•Nodeï¼Œä½†å¯ä»¥åœ¨æ¯ä¸ªNodeä¸Šè®¿é—®ã€‚</li>
<li>PVå¹¶ä¸æ˜¯å®šä¹‰åœ¨Podä¸Šçš„ï¼Œè€Œæ˜¯ç‹¬ç«‹äºPodä¹‹å¤–å®šä¹‰ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯NFSç±»å‹PVçš„yamlå®šä¹‰å†…å®¹ï¼Œå£°æ˜äº†éœ€è¦5Gçš„å­˜å‚¨ç©ºé—´ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pv003</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">labels</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pv003</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">capacity</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">storage</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span><span style="color:#a6e22e">Gi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">accessModes</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span> <span style="color:#a6e22e">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">nfs</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">/somepath</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">server</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">172.17</span>.<span style="color:#ae81ff">0.2</span></span></span></code></pre></div>
<p>PVçš„accessModeså±æ€§æœ‰ä»¥ä¸‹ç±»å‹ï¼š</p>
<ul>
<li>ReadWriteOnceï¼šè¯»å†™æƒé™ã€å¹¶ä¸”åªèƒ½è¢«å•ä¸ªNodeæŒ‚è½½ã€‚</li>
<li>ReadOnlyManyï¼šåªè¯»æƒé™ã€å…è®¸è¢«å¤šä¸ªNodeæŒ‚è½½ã€‚</li>
<li>ReadWriteManyï¼šè¯»å†™æƒé™ã€å…è®¸è¢«å¤šä¸ªNodeæŒ‚è½½ã€‚</li>
</ul>
<p>å¦‚æœPodæƒ³ç”³è¯·ä½¿ç”¨PVèµ„æºï¼Œåˆ™é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªPersistentVolumeClaimï¼ˆPVCï¼‰å¯¹è±¡ï¼š
PVCå¯¹è±¡é€šè¿‡labelselectorå…³è”pvå¯¹è±¡</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">myclaim</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">accessModes</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span> <span style="color:#a6e22e">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">resources</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">requests</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">storage</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span><span style="color:#a6e22e">Gi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">selector</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">matchLabels</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pv003</span></span></span></code></pre></div>
<p>ç„¶ååœ¨Podçš„volumeå®šä¹‰ä¸­å¼•ç”¨ä¸Šè¿°PVCå³å¯</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">volumes</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mypd</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">persistentVolumeClaim</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">claimName</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">myclaim</span></span></span></code></pre></div>
<p>PVæ˜¯æœ‰çŠ¶æ€çš„å¯¹è±¡ï¼Œå®ƒæœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š</p>
<ul>
<li>Availableï¼šç©ºé—²çŠ¶æ€ã€‚</li>
<li>Boundï¼šå·²ç»ç»‘å®šåˆ°æŸä¸ªPVCä¸Šã€‚</li>
<li>Releasedï¼šå¯¹åº”çš„PVCå·²ç»åˆ é™¤ï¼Œä½†èµ„æºè¿˜æ²¡æœ‰è¢«é›†ç¾¤æ”¶å›ã€‚</li>
<li>Failedï¼šPVè‡ªåŠ¨å›æ”¶å¤±è´¥ã€‚</li>
</ul>
<p>åœ¨awsä¸Šå¦‚æœéœ€è¦æ”¯æŒå¤šä¸ªpodåŒæ—¶è¯»å†™ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªefsæ–‡ä»¶ç³»ç»Ÿç„¶åè·å–ä»–çš„dnsåœ°å€</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>apiVersion: v1
kind: PersistentVolume
metadata:
  name: kuboard-etcd-pv
  namespace: kuboard
spec:
  capacity:
    storage: 10Gi # Doesn&#39;t really matter, as EFS does not enforce it anyway
  volumeMode: Filesystem
  accessModes:
    - ReadWriteMany
  mountOptions:
    - hard
    - nfsvers=4.1
    - rsize=1048576
    - wsize=1048576
    - timeo=600
    - retrans=2
  nfs:
    path: /
    server: fs-08ef988e733xxx4b7.efs.us-west-2.amazonaws.com
  claimRef:                                        #Here is claim reference
    name: kuboard-etcd-pvc
    namespace: kuboard
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: kuboard-etcd-pvc
  namespace: kuboard
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 10Gi
  volumeName: &#34;kuboard-etcd-pv&#34;
      
---</code></pre></div>
<h1 id="åä¸€namespaceå‘½åç©ºé—´">åä¸€ã€Namespaceï¼ˆå‘½åç©ºé—´ï¼‰</h1>
<p>é€šè¿‡å°†Kubernetesé›†ç¾¤å†…éƒ¨çš„èµ„æºå¯¹è±¡â€œåˆ†é…â€åˆ°ä¸åŒçš„Namespaceä¸­ï¼Œå½¢æˆé€»è¾‘ä¸Šåˆ†ç»„çš„ä¸åŒé¡¹ç›®ã€å°ç»„æˆ–ç”¨æˆ·ç»„ï¼Œä¾¿äºä¸åŒçš„åˆ†ç»„åœ¨å…±äº«ä½¿ç”¨æ•´ä¸ªé›†ç¾¤çš„èµ„æºçš„åŒæ—¶è¿˜èƒ½è¢«åˆ†åˆ«ç®¡ç†ã€‚
Kubernetesé›†ç¾¤åœ¨å¯åŠ¨åï¼Œä¼šåˆ›å»ºä¸€ä¸ªåä¸ºâ€œdefaultâ€çš„Namespaceï¼Œé€šè¿‡kubectlå¯ä»¥æŸ¥çœ‹åˆ°ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">namespaces</span></span></span></code></pre></div>
<p>å¦‚æœä¸ç‰¹åˆ«æŒ‡æ˜Namespaceï¼Œåˆ™ç”¨æˆ·åˆ›å»ºçš„Podã€RCã€RSã€Serviceéƒ½å¥–è¢«ç³»ç»Ÿåˆ›å»ºåˆ°è¿™ä¸ªé»˜è®¤çš„åä¸ºdefaultçš„Namespaceä¸­ã€‚
ä¸‹é¢æ˜¯Namespaceçš„å®šä¹‰ç¤ºä¾‹ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">development</span></span></span></code></pre></div>
<p>å®šä¹‰ä¸€ä¸ªPodï¼Œå¹¶æŒ‡å®šå®ƒå±äºå“ªä¸ªNamespaceï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">busybox</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">namespace</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">development</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">containers</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">image</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">busybox</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">command</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">sleep</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#e6db74">&#34;3600&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">busybox</span></span></span></code></pre></div>
<p>ä½¿ç”¨kubectl getå‘½ä»¤æŸ¥çœ‹PodçŠ¶æ€ä¿¡æ¯æ—¶ï¼Œéœ€è¦åŠ ä¸Š&ndash;namespaceå‚æ•°ï¼ŒæŒ‡å®šæŸ¥çœ‹å“ªä¸ªnamespaceä¸‹çš„èµ„æºå¯¹è±¡ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°åˆ™é»˜è®¤æŸ¥çœ‹ defaultä¸‹çš„èµ„æºå¯¹è±¡ã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">pods</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">namespace</span><span style="color:#f92672">=</span><span style="color:#a6e22e">development</span></span></span></code></pre></div>
<p>å½“æˆ‘ä»¬ç»™æ¯ä¸ªç§Ÿæˆ·åˆ›å»ºä¸€ä¸ªNamespaceæ¥å®ç°å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»æ—¶ï¼Œè¿˜èƒ½ç»“åˆKubernetesçš„èµ„æºé…é¢ç®¡ç†ï¼Œé™å®šä¸åŒç§Ÿæˆ·èƒ½å ç”¨çš„èµ„æºï¼Œä¾‹å¦‚CPUä½¿ç”¨é‡ã€å†…å­˜ä½¿ç”¨é‡ç­‰ã€‚</p>
<h2 id="åäºŒannotationæ³¨è§£">åäºŒã€Annotationï¼ˆæ³¨è§£ï¼‰</h2>
<p>Annotationä¸Labelç±»ä¼¼ï¼Œä¹Ÿä½¿ç”¨key/valueé”®å€¼å¯¹çš„å½¢å¼è¿›è¡Œå®šä¹‰ã€‚ä¸åŒçš„æ˜¯Labelå…·æœ‰ä¸¥æ ¼çš„å‘½åè§„åˆ™ï¼Œå®ƒå®šä¹‰çš„æ˜¯Kuberneteså¯¹è±¡çš„å…ƒæ•°æ®ï¼ˆMetadataï¼‰ï¼Œå¹¶ä¸”ç”¨äºLabel Selectorã€‚è€ŒAnnotationåˆ™æ˜¯ç”¨æˆ·ä»»æ„å®šä¹‰çš„â€œé™„åŠ â€ä¿¡æ¯ï¼Œä»¥ä¾¿äºå¤–éƒ¨å·¥å…·è¿›è¡ŒæŸ¥æ‰¾ã€‚é€šå¸¸Kubernetesçš„æ¨¡å—ä¼šé€šè¿‡Annotationçš„æ–¹å¼æ ‡è®°èµ„æºå¯¹è±¡çš„ä¸€äº›ç‰¹æ®Šä¿¡æ¯ã€‚
ä½¿ç”¨Annotationæ¥è®°å½•çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>buildä¿¡æ¯ã€releaseä¿¡æ¯ã€Dockeré•œåƒä¿¡æ¯ç­‰ï¼Œä¾‹å¦‚æ—¶é—´æˆ³ã€release idå·ã€PRå·ã€é•œåƒbashå€¼ã€docker registryåœ°å€ç­‰ã€‚</li>
<li>æ—¥å¿—åº“ã€ç›‘æ§åº“ã€åˆ†æåº“ç­‰èµ„æºåº“çš„åœ°å€ä¿¡æ¯ã€‚</li>
<li>ç¨‹åºè°ƒè¯•å·¥å…·ä¿¡æ¯ï¼Œä¾‹å¦‚å·¥å…·åç§°ã€ç‰ˆæœ¬å·ç­‰ã€‚</li>
<li>å›¢é˜Ÿçš„è”ç³»ä¿¡æ¯ï¼Œä¾‹å¦‚ç”µè¯å·ç ã€è´Ÿè´£äººåç§°ã€ç½‘å€ç­‰ã€‚
æ³¨ï¼šæœ¬æ–‡å†…å®¹æ‘˜è‡ªã€ŠKubernetesæƒå¨æŒ‡å—ï¼šä»Dockeråˆ°Kuberneteså®è·µå…¨æ¥è§¦ï¼ˆçºªå¿µç‰ˆã€‹ï¼Œå¹¶ç²¾å‡äº†éƒ¨åˆ†å†…éƒ¨ï¼Œè€Œä¸”å¯¹éƒ¨åˆ†å†…å®¹åšäº†ç›¸åº”çš„è°ƒæ•´ï¼Œå¯ä»¥å¸®åŠ©å¤§å®¶åŠ æ·±å¯¹Kubernetesçš„å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰æ–¹æ³•ï¼Œå…³æ³¨æˆ‘çš„åšå®¢ï¼Œè·Ÿæˆ‘ä¸€èµ·å¼€å¯k8sçš„å­¦ä¹ ä¹‹æ—…å§ã€‚</li>
</ul>
<p>è½¬è½½äº:https://blog.51cto.com/andyxu/2329257</p>

  <footer class="footline">
              <i class='fa-fw fas fa-calendar'></i> Sep 18, 2025
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/docs/index.html">
            <div class="logo-title">liaomin416100569åšå®¢</div>
          </a>
        </div>
        <search><form action="/docs/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/docs/index.html"><a class="padding" href="/docs/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/docs/programming/index.html"><a class="padding" href="/docs/programming/index.html">ç¼–ç¨‹å¼€å‘</a><ul id="R-subsections-e3fc01b477dbaf64a8f5013a3dab5c5b" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/docs/devops/index.html"><a class="padding" href="/docs/devops/index.html">è¿ç»´ä¸€ä½“åŒ–</a><ul id="R-subsections-389d4feb4920b919bcbc0b1e9947dace" class="collapsible-menu">
            <li class="parent alwaysopen " data-nav-id="/docs/devops/kubernetes/index.html"><a class="padding" href="/docs/devops/kubernetes/index.html">kubernetes</a><ul id="R-subsections-a6d9d4850f81ae033d42cdaa03dad084" class="collapsible-menu">
            <li class="active " data-nav-id="/docs/devops/kubernetes/k8s_dev_01/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_01/index.html">K8SäºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰</a></li>
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_02/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_02/index.html">K8SäºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤</a></li>
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_03/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_03/index.html">K8SäºŒæ¬¡å¼€å‘03-CRDèµ„æºè¯¦è§£</a></li>
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_04/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_04/index.html">K8SäºŒæ¬¡å¼€å‘04-è‡ªå®šä¹‰operatorï¼ˆoperator-sdkè°ƒè¯•ï¼‰</a></li>
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_05/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_05/index.html">K8SäºŒæ¬¡å¼€å‘05-ä½¿ç”¨clientgoè‡ªå®šä¹‰ingresscontroller</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/docs/devops/networking/index.html"><a class="padding" href="/docs/devops/networking/index.html">ç½‘ç»œæŠ€æœ¯</a><ul id="R-subsections-bd6b3f75e8269a91d29691b78d3bac17" class="collapsible-menu"></ul></li></ul></li>
            <li class="" data-nav-id="/docs/security/index.html"><a class="padding" href="/docs/security/index.html">å®‰å…¨æ”»é˜²</a><ul id="R-subsections-66815ecaaecfc1c209e5637d03b258b2" class="collapsible-menu"></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/docs/js/clipboard/clipboard.min.js?1758355652" defer></script>
    <script src="/docs/js/perfect-scrollbar/perfect-scrollbar.min.js?1758355652" defer></script>
    <script src="/docs/js/theme.min.js?1758355652" defer></script>
  </body>
</html>
