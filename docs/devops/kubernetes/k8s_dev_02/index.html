<!DOCTYPE html>
<html lang="zh" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.150.0">
    <meta name="generator" content="Relearn 8.0.1+b23cf6629eada0c2802f34ae4012e04343497862">
    <meta name="description" content="ç»„ä»¶æ¦‚è§ˆ å…³äºk8sæ•´ä½“æ¶æ„ï¼Œå¯å‚è€ƒï¼šä¹‹å‰æ–‡ç«  Kubernetesä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼ˆå¿…é¡»å®‰è£…ï¼‰ï¼š
etcdä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼› apiserveræä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ï¼› controller managerè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ï¼› schedulerè´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Šï¼› kubeletè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†ï¼Œå®‰è£…æ¯å°å·¥ä½œèŠ‚ç‚¹ï¼› kube-proxyè´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œå®‰è£…åœ¨æ¯å°å·¥ä½œèŠ‚ç‚¹ï¼› é™¤äº†æ ¸å¿ƒç»„ä»¶ï¼Œè¿˜æœ‰ä¸€äº›æ¨èçš„Add-onsï¼ˆé€‰è£…ï¼‰ï¼š kube-dnsè´Ÿè´£ä¸ºæ•´ä¸ªé›†ç¾¤æä¾›DNSæœåŠ¡ï¼Œåº”è¯¥ä½¿ç”¨kubectlæ·»åŠ ä¸€ä¸ªæœåŠ¡åˆ°å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªå‘å¸ƒçš„åº”ç”¨æœåŠ¡äº å…¶ä¸­kubeletæ˜¯äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼Œå…¶ä»–ç»„ä»¶å‡ä¸ºdockeré•œåƒï¼Œkubeadmè´Ÿè´£æ‹‰å–é•œåƒå¹¶åˆå§‹åŒ–ç¯å¢ƒã€‚ kubectlæ˜¯å®¢æˆ·ç«¯ç®¡ç†å·¥å…·ï¼ŒåŒæ ·æ˜¯ä¸ªäºŒè¿›åˆ¶ã€‚ æ‰€ä»¥kubelet,kubeadm,kubectléœ€è¦é€šè¿‡yum|apt-getå®‰è£…ï¼Œå…¶ä»–ç»„ä»¶é€šè¿‡kubeadmå®‰è£…ã€‚
å®‰è£…k8s æœ€ç®€å•ï¼ŒæˆåŠŸç‡æœ€é«˜çš„å®‰è£…æ–¹å¼å…¶å®æ˜¯ä½¿ç”¨rkeå®‰è£…ï¼Œè¿™é‡Œä½¿ç”¨kubeadminæ˜¯æƒ³çŸ¥é“æ¯ä¸ªç»„ä»¶çš„å•ç‹¬åŸç†å’Œä½œç”¨ï¼Œå…·ä½“å®‰è£…æ•™ç¨‹å‚è€ƒï¼šhttps://docs.rancher.cn/docs/rke/installation/_index/ã€‚
å·²ç»å®‰è£…å¦‚æœéœ€è¦æ¸…é™¤ï¼Œå¯æŒ‰ç…§æ­¤æ­¥éª¤å¤„ç†(é‡ç½®k8sï¼Œåˆ é™¤æ‰€æœ‰è¿è¡Œå®¹æ˜“å’Œé•œåƒ)
kubeadm reset docker ps -a | awk &#39;{if(NR&gt;1){print $1;system(&#34;docker stop &#34;$1);system(&#34;docker rm &#34;$1)}}&#39;; docker images | awk &#39;{system(&#34;docker rmi &#34;$3)}&#39; rm -rf $HOME/.kube åŒæ—¶æ¸…é™¤ä¸‹é¢å®‰è£…ç½‘ç»œç« èŠ‚çš„ç½‘ç»œç›¸å…³æ–‡ä»¶ å‡†å¤‡æœºå™¨ è¿™é‡Œä½¿ç”¨debianç¯å¢ƒï¼Œä¸»å¤‡ä¸€ä¸»ä¸€ä»ä¸¤å°æœºå™¨ï¼Œæœ€å¥½å›ºå®šipï¼Œipæœ€å¥½åœ¨åŒä¸€ç½‘æ®µ
k8s-master 10.10.0.115 k8s-worker 10.10.0.116 å®‰è£…kubeletï¼Œkubeadmï¼Œkubectlï¼Œä¸¤å°æœºå™¨å‡ç›¸åŒ ç¡®ä¿ä¸¤å°æœºå™¨æå‰å®‰è£…åŒ…docker
apt-get install docker-ce è®¾ç½®é˜¿é‡Œäº‘æº sudo vim /etc/apt/sources.list.d/kubernetes.list # å°†ä¸‹é¢çš„é˜¿é‡ŒæºåŠ å…¥æ–‡ä»¶ä¸­ deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main # ä¹Ÿå¯ä»¥é€‰æ‹©ä¸­ç§‘å¤§çš„æº deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main é‡Œå…ˆè¿è¡Œä¸€ä¸‹ apt update, ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ç¼ºå°‘ç›¸åº”çš„keyï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ·»åŠ (E084DAB9 ä¸ºä¸Šé¢æŠ¥é”™çš„keyå8ä½)
gpg --keyserver keyserver.ubuntu.com --recv-keys E084DAB9 gpg --export --armor E084DAB9 | sudo apt-key add - ä¸‹è½½å®‰è£… apt-get update &amp;&amp; apt-get install -y kubelet kubeadm kubectl å…³é—­swap å¦‚æœä¸å…³é—­kubernetesè¿è¡Œä¼šå‡ºç°é”™è¯¯ï¼Œ å³ä½¿å®‰è£…æˆåŠŸäº†ï¼Œnodeé‡å¯åä¹Ÿä¼šå‡ºç°kubernetes serverè¿è¡Œé”™è¯¯ã€‚">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="K8SäºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤ :: liaomin416100569åšå®¢">
    <meta name="twitter:description" content="ç»„ä»¶æ¦‚è§ˆ å…³äºk8sæ•´ä½“æ¶æ„ï¼Œå¯å‚è€ƒï¼šä¹‹å‰æ–‡ç«  Kubernetesä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼ˆå¿…é¡»å®‰è£…ï¼‰ï¼š
etcdä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼› apiserveræä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ï¼› controller managerè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ï¼› schedulerè´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Šï¼› kubeletè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†ï¼Œå®‰è£…æ¯å°å·¥ä½œèŠ‚ç‚¹ï¼› kube-proxyè´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œå®‰è£…åœ¨æ¯å°å·¥ä½œèŠ‚ç‚¹ï¼› é™¤äº†æ ¸å¿ƒç»„ä»¶ï¼Œè¿˜æœ‰ä¸€äº›æ¨èçš„Add-onsï¼ˆé€‰è£…ï¼‰ï¼š kube-dnsè´Ÿè´£ä¸ºæ•´ä¸ªé›†ç¾¤æä¾›DNSæœåŠ¡ï¼Œåº”è¯¥ä½¿ç”¨kubectlæ·»åŠ ä¸€ä¸ªæœåŠ¡åˆ°å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªå‘å¸ƒçš„åº”ç”¨æœåŠ¡äº å…¶ä¸­kubeletæ˜¯äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼Œå…¶ä»–ç»„ä»¶å‡ä¸ºdockeré•œåƒï¼Œkubeadmè´Ÿè´£æ‹‰å–é•œåƒå¹¶åˆå§‹åŒ–ç¯å¢ƒã€‚ kubectlæ˜¯å®¢æˆ·ç«¯ç®¡ç†å·¥å…·ï¼ŒåŒæ ·æ˜¯ä¸ªäºŒè¿›åˆ¶ã€‚ æ‰€ä»¥kubelet,kubeadm,kubectléœ€è¦é€šè¿‡yum|apt-getå®‰è£…ï¼Œå…¶ä»–ç»„ä»¶é€šè¿‡kubeadmå®‰è£…ã€‚
å®‰è£…k8s æœ€ç®€å•ï¼ŒæˆåŠŸç‡æœ€é«˜çš„å®‰è£…æ–¹å¼å…¶å®æ˜¯ä½¿ç”¨rkeå®‰è£…ï¼Œè¿™é‡Œä½¿ç”¨kubeadminæ˜¯æƒ³çŸ¥é“æ¯ä¸ªç»„ä»¶çš„å•ç‹¬åŸç†å’Œä½œç”¨ï¼Œå…·ä½“å®‰è£…æ•™ç¨‹å‚è€ƒï¼šhttps://docs.rancher.cn/docs/rke/installation/_index/ã€‚
å·²ç»å®‰è£…å¦‚æœéœ€è¦æ¸…é™¤ï¼Œå¯æŒ‰ç…§æ­¤æ­¥éª¤å¤„ç†(é‡ç½®k8sï¼Œåˆ é™¤æ‰€æœ‰è¿è¡Œå®¹æ˜“å’Œé•œåƒ)
kubeadm reset docker ps -a | awk &#39;{if(NR&gt;1){print $1;system(&#34;docker stop &#34;$1);system(&#34;docker rm &#34;$1)}}&#39;; docker images | awk &#39;{system(&#34;docker rmi &#34;$3)}&#39; rm -rf $HOME/.kube åŒæ—¶æ¸…é™¤ä¸‹é¢å®‰è£…ç½‘ç»œç« èŠ‚çš„ç½‘ç»œç›¸å…³æ–‡ä»¶ å‡†å¤‡æœºå™¨ è¿™é‡Œä½¿ç”¨debianç¯å¢ƒï¼Œä¸»å¤‡ä¸€ä¸»ä¸€ä»ä¸¤å°æœºå™¨ï¼Œæœ€å¥½å›ºå®šipï¼Œipæœ€å¥½åœ¨åŒä¸€ç½‘æ®µ
k8s-master 10.10.0.115 k8s-worker 10.10.0.116 å®‰è£…kubeletï¼Œkubeadmï¼Œkubectlï¼Œä¸¤å°æœºå™¨å‡ç›¸åŒ ç¡®ä¿ä¸¤å°æœºå™¨æå‰å®‰è£…åŒ…docker
apt-get install docker-ce è®¾ç½®é˜¿é‡Œäº‘æº sudo vim /etc/apt/sources.list.d/kubernetes.list # å°†ä¸‹é¢çš„é˜¿é‡ŒæºåŠ å…¥æ–‡ä»¶ä¸­ deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main # ä¹Ÿå¯ä»¥é€‰æ‹©ä¸­ç§‘å¤§çš„æº deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main é‡Œå…ˆè¿è¡Œä¸€ä¸‹ apt update, ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ç¼ºå°‘ç›¸åº”çš„keyï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ·»åŠ (E084DAB9 ä¸ºä¸Šé¢æŠ¥é”™çš„keyå8ä½)
gpg --keyserver keyserver.ubuntu.com --recv-keys E084DAB9 gpg --export --armor E084DAB9 | sudo apt-key add - ä¸‹è½½å®‰è£… apt-get update &amp;&amp; apt-get install -y kubelet kubeadm kubectl å…³é—­swap å¦‚æœä¸å…³é—­kubernetesè¿è¡Œä¼šå‡ºç°é”™è¯¯ï¼Œ å³ä½¿å®‰è£…æˆåŠŸäº†ï¼Œnodeé‡å¯åä¹Ÿä¼šå‡ºç°kubernetes serverè¿è¡Œé”™è¯¯ã€‚">
    <meta property="og:url" content="https://jiaozi789.github.io/docs/devops/kubernetes/k8s_dev_02/index.html">
    <meta property="og:site_name" content="liaomin416100569åšå®¢">
    <meta property="og:title" content="K8SäºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤ :: liaomin416100569åšå®¢">
    <meta property="og:description" content="ç»„ä»¶æ¦‚è§ˆ å…³äºk8sæ•´ä½“æ¶æ„ï¼Œå¯å‚è€ƒï¼šä¹‹å‰æ–‡ç«  Kubernetesä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼ˆå¿…é¡»å®‰è£…ï¼‰ï¼š
etcdä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼› apiserveræä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ï¼› controller managerè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ï¼› schedulerè´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Šï¼› kubeletè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†ï¼Œå®‰è£…æ¯å°å·¥ä½œèŠ‚ç‚¹ï¼› kube-proxyè´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œå®‰è£…åœ¨æ¯å°å·¥ä½œèŠ‚ç‚¹ï¼› é™¤äº†æ ¸å¿ƒç»„ä»¶ï¼Œè¿˜æœ‰ä¸€äº›æ¨èçš„Add-onsï¼ˆé€‰è£…ï¼‰ï¼š kube-dnsè´Ÿè´£ä¸ºæ•´ä¸ªé›†ç¾¤æä¾›DNSæœåŠ¡ï¼Œåº”è¯¥ä½¿ç”¨kubectlæ·»åŠ ä¸€ä¸ªæœåŠ¡åˆ°å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªå‘å¸ƒçš„åº”ç”¨æœåŠ¡äº å…¶ä¸­kubeletæ˜¯äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼Œå…¶ä»–ç»„ä»¶å‡ä¸ºdockeré•œåƒï¼Œkubeadmè´Ÿè´£æ‹‰å–é•œåƒå¹¶åˆå§‹åŒ–ç¯å¢ƒã€‚ kubectlæ˜¯å®¢æˆ·ç«¯ç®¡ç†å·¥å…·ï¼ŒåŒæ ·æ˜¯ä¸ªäºŒè¿›åˆ¶ã€‚ æ‰€ä»¥kubelet,kubeadm,kubectléœ€è¦é€šè¿‡yum|apt-getå®‰è£…ï¼Œå…¶ä»–ç»„ä»¶é€šè¿‡kubeadmå®‰è£…ã€‚
å®‰è£…k8s æœ€ç®€å•ï¼ŒæˆåŠŸç‡æœ€é«˜çš„å®‰è£…æ–¹å¼å…¶å®æ˜¯ä½¿ç”¨rkeå®‰è£…ï¼Œè¿™é‡Œä½¿ç”¨kubeadminæ˜¯æƒ³çŸ¥é“æ¯ä¸ªç»„ä»¶çš„å•ç‹¬åŸç†å’Œä½œç”¨ï¼Œå…·ä½“å®‰è£…æ•™ç¨‹å‚è€ƒï¼šhttps://docs.rancher.cn/docs/rke/installation/_index/ã€‚
å·²ç»å®‰è£…å¦‚æœéœ€è¦æ¸…é™¤ï¼Œå¯æŒ‰ç…§æ­¤æ­¥éª¤å¤„ç†(é‡ç½®k8sï¼Œåˆ é™¤æ‰€æœ‰è¿è¡Œå®¹æ˜“å’Œé•œåƒ)
kubeadm reset docker ps -a | awk &#39;{if(NR&gt;1){print $1;system(&#34;docker stop &#34;$1);system(&#34;docker rm &#34;$1)}}&#39;; docker images | awk &#39;{system(&#34;docker rmi &#34;$3)}&#39; rm -rf $HOME/.kube åŒæ—¶æ¸…é™¤ä¸‹é¢å®‰è£…ç½‘ç»œç« èŠ‚çš„ç½‘ç»œç›¸å…³æ–‡ä»¶ å‡†å¤‡æœºå™¨ è¿™é‡Œä½¿ç”¨debianç¯å¢ƒï¼Œä¸»å¤‡ä¸€ä¸»ä¸€ä»ä¸¤å°æœºå™¨ï¼Œæœ€å¥½å›ºå®šipï¼Œipæœ€å¥½åœ¨åŒä¸€ç½‘æ®µ
k8s-master 10.10.0.115 k8s-worker 10.10.0.116 å®‰è£…kubeletï¼Œkubeadmï¼Œkubectlï¼Œä¸¤å°æœºå™¨å‡ç›¸åŒ ç¡®ä¿ä¸¤å°æœºå™¨æå‰å®‰è£…åŒ…docker
apt-get install docker-ce è®¾ç½®é˜¿é‡Œäº‘æº sudo vim /etc/apt/sources.list.d/kubernetes.list # å°†ä¸‹é¢çš„é˜¿é‡ŒæºåŠ å…¥æ–‡ä»¶ä¸­ deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main # ä¹Ÿå¯ä»¥é€‰æ‹©ä¸­ç§‘å¤§çš„æº deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main é‡Œå…ˆè¿è¡Œä¸€ä¸‹ apt update, ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ç¼ºå°‘ç›¸åº”çš„keyï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ·»åŠ (E084DAB9 ä¸ºä¸Šé¢æŠ¥é”™çš„keyå8ä½)
gpg --keyserver keyserver.ubuntu.com --recv-keys E084DAB9 gpg --export --armor E084DAB9 | sudo apt-key add - ä¸‹è½½å®‰è£… apt-get update &amp;&amp; apt-get install -y kubelet kubeadm kubectl å…³é—­swap å¦‚æœä¸å…³é—­kubernetesè¿è¡Œä¼šå‡ºç°é”™è¯¯ï¼Œ å³ä½¿å®‰è£…æˆåŠŸäº†ï¼Œnodeé‡å¯åä¹Ÿä¼šå‡ºç°kubernetes serverè¿è¡Œé”™è¯¯ã€‚">
    <meta property="og:locale" content="zh">
    <meta property="og:type" content="article">
    <meta property="article:section" content="è¿ç»´ä¸€ä½“åŒ–">
    <meta property="article:published_time" content="2025-09-18T16:55:17+08:00">
    <meta property="article:modified_time" content="2025-09-18T16:55:17+08:00">
    <meta itemprop="name" content="K8SäºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤ :: liaomin416100569åšå®¢">
    <meta itemprop="description" content="ç»„ä»¶æ¦‚è§ˆ å…³äºk8sæ•´ä½“æ¶æ„ï¼Œå¯å‚è€ƒï¼šä¹‹å‰æ–‡ç«  Kubernetesä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼ˆå¿…é¡»å®‰è£…ï¼‰ï¼š
etcdä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼› apiserveræä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ï¼› controller managerè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ï¼› schedulerè´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Šï¼› kubeletè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†ï¼Œå®‰è£…æ¯å°å·¥ä½œèŠ‚ç‚¹ï¼› kube-proxyè´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œå®‰è£…åœ¨æ¯å°å·¥ä½œèŠ‚ç‚¹ï¼› é™¤äº†æ ¸å¿ƒç»„ä»¶ï¼Œè¿˜æœ‰ä¸€äº›æ¨èçš„Add-onsï¼ˆé€‰è£…ï¼‰ï¼š kube-dnsè´Ÿè´£ä¸ºæ•´ä¸ªé›†ç¾¤æä¾›DNSæœåŠ¡ï¼Œåº”è¯¥ä½¿ç”¨kubectlæ·»åŠ ä¸€ä¸ªæœåŠ¡åˆ°å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªå‘å¸ƒçš„åº”ç”¨æœåŠ¡äº å…¶ä¸­kubeletæ˜¯äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼Œå…¶ä»–ç»„ä»¶å‡ä¸ºdockeré•œåƒï¼Œkubeadmè´Ÿè´£æ‹‰å–é•œåƒå¹¶åˆå§‹åŒ–ç¯å¢ƒã€‚ kubectlæ˜¯å®¢æˆ·ç«¯ç®¡ç†å·¥å…·ï¼ŒåŒæ ·æ˜¯ä¸ªäºŒè¿›åˆ¶ã€‚ æ‰€ä»¥kubelet,kubeadm,kubectléœ€è¦é€šè¿‡yum|apt-getå®‰è£…ï¼Œå…¶ä»–ç»„ä»¶é€šè¿‡kubeadmå®‰è£…ã€‚
å®‰è£…k8s æœ€ç®€å•ï¼ŒæˆåŠŸç‡æœ€é«˜çš„å®‰è£…æ–¹å¼å…¶å®æ˜¯ä½¿ç”¨rkeå®‰è£…ï¼Œè¿™é‡Œä½¿ç”¨kubeadminæ˜¯æƒ³çŸ¥é“æ¯ä¸ªç»„ä»¶çš„å•ç‹¬åŸç†å’Œä½œç”¨ï¼Œå…·ä½“å®‰è£…æ•™ç¨‹å‚è€ƒï¼šhttps://docs.rancher.cn/docs/rke/installation/_index/ã€‚
å·²ç»å®‰è£…å¦‚æœéœ€è¦æ¸…é™¤ï¼Œå¯æŒ‰ç…§æ­¤æ­¥éª¤å¤„ç†(é‡ç½®k8sï¼Œåˆ é™¤æ‰€æœ‰è¿è¡Œå®¹æ˜“å’Œé•œåƒ)
kubeadm reset docker ps -a | awk &#39;{if(NR&gt;1){print $1;system(&#34;docker stop &#34;$1);system(&#34;docker rm &#34;$1)}}&#39;; docker images | awk &#39;{system(&#34;docker rmi &#34;$3)}&#39; rm -rf $HOME/.kube åŒæ—¶æ¸…é™¤ä¸‹é¢å®‰è£…ç½‘ç»œç« èŠ‚çš„ç½‘ç»œç›¸å…³æ–‡ä»¶ å‡†å¤‡æœºå™¨ è¿™é‡Œä½¿ç”¨debianç¯å¢ƒï¼Œä¸»å¤‡ä¸€ä¸»ä¸€ä»ä¸¤å°æœºå™¨ï¼Œæœ€å¥½å›ºå®šipï¼Œipæœ€å¥½åœ¨åŒä¸€ç½‘æ®µ
k8s-master 10.10.0.115 k8s-worker 10.10.0.116 å®‰è£…kubeletï¼Œkubeadmï¼Œkubectlï¼Œä¸¤å°æœºå™¨å‡ç›¸åŒ ç¡®ä¿ä¸¤å°æœºå™¨æå‰å®‰è£…åŒ…docker
apt-get install docker-ce è®¾ç½®é˜¿é‡Œäº‘æº sudo vim /etc/apt/sources.list.d/kubernetes.list # å°†ä¸‹é¢çš„é˜¿é‡ŒæºåŠ å…¥æ–‡ä»¶ä¸­ deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main # ä¹Ÿå¯ä»¥é€‰æ‹©ä¸­ç§‘å¤§çš„æº deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main é‡Œå…ˆè¿è¡Œä¸€ä¸‹ apt update, ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ç¼ºå°‘ç›¸åº”çš„keyï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ·»åŠ (E084DAB9 ä¸ºä¸Šé¢æŠ¥é”™çš„keyå8ä½)
gpg --keyserver keyserver.ubuntu.com --recv-keys E084DAB9 gpg --export --armor E084DAB9 | sudo apt-key add - ä¸‹è½½å®‰è£… apt-get update &amp;&amp; apt-get install -y kubelet kubeadm kubectl å…³é—­swap å¦‚æœä¸å…³é—­kubernetesè¿è¡Œä¼šå‡ºç°é”™è¯¯ï¼Œ å³ä½¿å®‰è£…æˆåŠŸäº†ï¼Œnodeé‡å¯åä¹Ÿä¼šå‡ºç°kubernetes serverè¿è¡Œé”™è¯¯ã€‚">
    <meta itemprop="datePublished" content="2025-09-18T16:55:17+08:00">
    <meta itemprop="dateModified" content="2025-09-18T16:55:17+08:00">
    <meta itemprop="wordCount" content="2496">
    <title>K8SäºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤ :: liaomin416100569åšå®¢</title>
    <link href="/docs/css/auto-complete/auto-complete.min.css?1758355652" rel="stylesheet">
    <script src="/docs/js/auto-complete/auto-complete.min.js?1758355652" defer></script>
    <script src="/docs/js/search-lunr.min.js?1758355652" defer></script>
    <script src="/docs/js/search.min.js?1758355652" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/docs/searchindex.en.js?1758355652";
    </script>
    <script src="/docs/js/lunr/lunr.min.js?1758355652" defer></script>
    <script src="/docs/js/lunr/lunr.stemmer.support.min.js?1758355652" defer></script>
    <script src="/docs/js/lunr/lunr.multi.min.js?1758355652" defer></script>
    <script src="/docs/js/lunr/lunr.zh.min.js?1758355652" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['zh'];
    </script>
    <link href="/docs/fonts/fontawesome/css/fontawesome-all.min.css?1758355652" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs/fonts/fontawesome/css/fontawesome-all.min.css?1758355652" rel="stylesheet"></noscript>
    <link href="/docs/css/perfect-scrollbar/perfect-scrollbar.min.css?1758355652" rel="stylesheet">
    <link href="/docs/css/theme.min.css?1758355652" rel="stylesheet">
    <link href="/docs/css/format-html.min.css?1758355652" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/devops\/kubernetes\/k8s_dev_02\/index.html';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/jiaozi789.github.io\/docs';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'auto' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/docs/css/custom.css?1758355652" rel="stylesheet">
  </head>
  <body class="mobile-support html" data-url="/docs/devops/kubernetes/k8s_dev_02/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#ç»„ä»¶æ¦‚è§ˆ">ç»„ä»¶æ¦‚è§ˆ</a></li>
    <li><a href="#å®‰è£…k8s">å®‰è£…k8s</a>
      <ul>
        <li><a href="#å‡†å¤‡æœºå™¨">å‡†å¤‡æœºå™¨</a></li>
        <li><a href="#è®¾ç½®é˜¿é‡Œäº‘æº">è®¾ç½®é˜¿é‡Œäº‘æº</a></li>
        <li><a href="#ä¸‹è½½å®‰è£…">ä¸‹è½½å®‰è£…</a></li>
        <li><a href="#å…³é—­swap">å…³é—­swap</a></li>
        <li><a href="#è·å–é•œåƒ">è·å–é•œåƒ</a></li>
        <li><a href="#ä¸»èŠ‚ç‚¹">ä¸»èŠ‚ç‚¹</a>
          <ul>
            <li><a href="#åˆå§‹åŒ–">åˆå§‹åŒ–</a></li>
            <li><a href="#å®‰è£…ç½‘ç»œ">å®‰è£…ç½‘ç»œ</a></li>
          </ul>
        </li>
        <li><a href="#workerèŠ‚ç‚¹">workerèŠ‚ç‚¹</a></li>
        <li><a href="#å¼‚å¸¸é—®é¢˜">å¼‚å¸¸é—®é¢˜</a>
          <ul>
            <li><a href="#calicoå®¹å™¨å¼‚å¸¸">calicoå®¹å™¨å¼‚å¸¸</a></li>
            <li><a href="#æ— æ³•pingé€šclusteripå’ŒæœåŠ¡å">æ— æ³•pingé€šclusteripå’ŒæœåŠ¡å</a></li>
          </ul>
        </li>
        <li><a href="#å‘å¸ƒæµ‹è¯•">å‘å¸ƒæµ‹è¯•</a></li>
        <li><a href="#é‡æ–°å¯åŠ¨">é‡æ–°å¯åŠ¨</a></li>
        <li><a href="#å›¾å½¢ç®¡ç†å·¥å…·">å›¾å½¢ç®¡ç†å·¥å…·</a>
          <ul>
            <li><a href="#å®‰è£…">å®‰è£…</a></li>
            <li><a href="#è·å–token">è·å–Token</a></li>
            <li><a href="#kuboard-v3x">Kuboard v3.x</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/docs/index.html"><span itemprop="name">liaomin416100569åšå®¢</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/docs/devops/index.html"><span itemprop="name">è¿ç»´ä¸€ä½“åŒ–</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/docs/devops/kubernetes/index.html"><span itemprop="name">kubernetes</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">K8SäºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/docs/devops/kubernetes/k8s_dev_01/index.html" title="K8SäºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰ (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/docs/devops/kubernetes/k8s_dev_03/index.html" title="K8SäºŒæ¬¡å¼€å‘03-CRDèµ„æºè¯¦è§£ (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable devops" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="k8säºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤">K8SäºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤</h1>

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']]
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

<h1 id="ç»„ä»¶æ¦‚è§ˆ">ç»„ä»¶æ¦‚è§ˆ</h1>
<p>å…³äºk8sæ•´ä½“æ¶æ„ï¼Œå¯å‚è€ƒï¼š<a href="https://blog.csdn.net/liaomin416100569/article/details/86711655?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164447827216780265446300%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=164447827216780265446300&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-86711655.nonecase&utm_term=k8s&spm=1018.2226.3001.4450" rel="external" target="_blank">ä¹‹å‰æ–‡ç« </a>
<a href="#R-image-b686a1554a9c6546ecffd0779b023e61" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_02.md.images/cc3f01cec211b1e4ef3e34775820ef65.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-b686a1554a9c6546ecffd0779b023e61"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_02.md.images/cc3f01cec211b1e4ef3e34775820ef65.png"></a>
Kubernetesä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼ˆå¿…é¡»å®‰è£…ï¼‰ï¼š</p>
<ul>
<li>etcdä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼›</li>
<li>apiserveræä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ï¼›</li>
<li>controller managerè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ï¼›</li>
<li>schedulerè´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Šï¼›</li>
<li>kubeletè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†ï¼Œå®‰è£…æ¯å°å·¥ä½œèŠ‚ç‚¹ï¼›</li>
<li>kube-proxyè´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œå®‰è£…åœ¨æ¯å°å·¥ä½œèŠ‚ç‚¹ï¼›
é™¤äº†æ ¸å¿ƒç»„ä»¶ï¼Œè¿˜æœ‰ä¸€äº›æ¨èçš„Add-onsï¼ˆé€‰è£…ï¼‰ï¼š</li>
<li>kube-dnsè´Ÿè´£ä¸ºæ•´ä¸ªé›†ç¾¤æä¾›DNSæœåŠ¡ï¼Œåº”è¯¥ä½¿ç”¨kubectlæ·»åŠ ä¸€ä¸ªæœåŠ¡åˆ°å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªå‘å¸ƒçš„åº”ç”¨æœåŠ¡äº</li>
</ul>
<p>å…¶ä¸­kubeletæ˜¯äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼Œå…¶ä»–ç»„ä»¶å‡ä¸ºdockeré•œåƒï¼Œkubeadmè´Ÿè´£æ‹‰å–é•œåƒå¹¶åˆå§‹åŒ–ç¯å¢ƒã€‚
kubectlæ˜¯å®¢æˆ·ç«¯ç®¡ç†å·¥å…·ï¼ŒåŒæ ·æ˜¯ä¸ªäºŒè¿›åˆ¶ã€‚
æ‰€ä»¥kubelet,kubeadm,kubectléœ€è¦é€šè¿‡yum|apt-getå®‰è£…ï¼Œå…¶ä»–ç»„ä»¶é€šè¿‡kubeadmå®‰è£…ã€‚</p>
<h1 id="å®‰è£…k8s">å®‰è£…k8s</h1>
<blockquote>
<p>æœ€ç®€å•ï¼ŒæˆåŠŸç‡æœ€é«˜çš„å®‰è£…æ–¹å¼å…¶å®æ˜¯ä½¿ç”¨rkeå®‰è£…ï¼Œè¿™é‡Œä½¿ç”¨kubeadminæ˜¯æƒ³çŸ¥é“æ¯ä¸ªç»„ä»¶çš„å•ç‹¬åŸç†å’Œä½œç”¨ï¼Œå…·ä½“å®‰è£…æ•™ç¨‹å‚è€ƒï¼šhttps://docs.rancher.cn/docs/rke/installation/_index/ã€‚</p></blockquote>
<p>å·²ç»å®‰è£…å¦‚æœéœ€è¦æ¸…é™¤ï¼Œå¯æŒ‰ç…§æ­¤æ­¥éª¤å¤„ç†(é‡ç½®k8sï¼Œåˆ é™¤æ‰€æœ‰è¿è¡Œå®¹æ˜“å’Œé•œåƒ)</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubeadm</span> <span style="color:#a6e22e">reset</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">ps</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">a</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">awk</span> <span style="color:#e6db74">&#39;{if(NR&gt;1){print $1;system(&#34;docker stop &#34;$1);system(&#34;docker rm &#34;$1)}}&#39;</span>;                
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">images</span>  <span style="color:#f92672">|</span> <span style="color:#a6e22e">awk</span> <span style="color:#e6db74">&#39;{system(&#34;docker rmi &#34;$3)}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rm</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">rf</span> <span style="color:#a6e22e">$HOME</span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">kube</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">åŒæ—¶æ¸…é™¤ä¸‹é¢å®‰è£…ç½‘ç»œç« èŠ‚çš„ç½‘ç»œç›¸å…³æ–‡ä»¶</span></span></span></code></pre></div>
<h2 id="å‡†å¤‡æœºå™¨">å‡†å¤‡æœºå™¨</h2>
<p>è¿™é‡Œä½¿ç”¨debianç¯å¢ƒï¼Œä¸»å¤‡ä¸€ä¸»ä¸€ä»ä¸¤å°æœºå™¨ï¼Œæœ€å¥½å›ºå®šipï¼Œipæœ€å¥½åœ¨åŒä¸€ç½‘æ®µ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">k8s</span><span style="color:#f92672">-</span><span style="color:#a6e22e">master</span> <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">k8s</span><span style="color:#f92672">-</span><span style="color:#a6e22e">worker</span> <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.116</span></span></span></code></pre></div>
<p>å®‰è£…kubeletï¼Œkubeadmï¼Œkubectlï¼Œä¸¤å°æœºå™¨å‡ç›¸åŒ
ç¡®ä¿ä¸¤å°æœºå™¨æå‰å®‰è£…åŒ…docker</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apt</span><span style="color:#f92672">-</span><span style="color:#a6e22e">get</span> <span style="color:#a6e22e">install</span> <span style="color:#a6e22e">docker</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ce</span></span></span></code></pre></div>
<h2 id="è®¾ç½®é˜¿é‡Œäº‘æº">è®¾ç½®é˜¿é‡Œäº‘æº</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">vim</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">apt</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sources</span>.<span style="color:#a6e22e">list</span>.<span style="color:#a6e22e">d</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kubernetes</span>.<span style="color:#a6e22e">list</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">å°†ä¸‹é¢çš„é˜¿é‡ŒæºåŠ å…¥æ–‡ä»¶ä¸­</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">deb</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">ä¹Ÿå¯ä»¥é€‰æ‹©ä¸­ç§‘å¤§çš„æº</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">deb</span> <span style="color:#a6e22e">http</span><span style="color:#f92672">:</span><span style="color:#75715e">//mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main
</span></span></span></code></pre></div>
<p>é‡Œå…ˆè¿è¡Œä¸€ä¸‹ apt update, ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ç¼ºå°‘ç›¸åº”çš„keyï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ·»åŠ (E084DAB9 ä¸ºä¸Šé¢æŠ¥é”™çš„keyå8ä½)</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">gpg</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">keyserver</span> <span style="color:#a6e22e">keyserver</span>.<span style="color:#a6e22e">ubuntu</span>.<span style="color:#a6e22e">com</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">recv</span><span style="color:#f92672">-</span><span style="color:#a6e22e">keys</span> <span style="color:#a6e22e">E084DAB9</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gpg</span> <span style="color:#f92672">--</span><span style="color:#66d9ef">export</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">armor</span> <span style="color:#a6e22e">E084DAB9</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">apt</span><span style="color:#f92672">-</span><span style="color:#a6e22e">key</span> <span style="color:#a6e22e">add</span> <span style="color:#f92672">-</span></span></span></code></pre></div>
<h2 id="ä¸‹è½½å®‰è£…">ä¸‹è½½å®‰è£…</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apt</span><span style="color:#f92672">-</span><span style="color:#a6e22e">get</span> <span style="color:#a6e22e">update</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">apt</span><span style="color:#f92672">-</span><span style="color:#a6e22e">get</span> <span style="color:#a6e22e">install</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">y</span> <span style="color:#a6e22e">kubelet</span> <span style="color:#a6e22e">kubeadm</span> <span style="color:#a6e22e">kubectl</span></span></span></code></pre></div>
<h2 id="å…³é—­swap">å…³é—­swap</h2>
<p>å¦‚æœä¸å…³é—­kubernetesè¿è¡Œä¼šå‡ºç°é”™è¯¯ï¼Œ å³ä½¿å®‰è£…æˆåŠŸäº†ï¼Œnodeé‡å¯åä¹Ÿä¼šå‡ºç°kubernetes serverè¿è¡Œé”™è¯¯ã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">æš‚æ—¶å…³é—­</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">swapoff</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">a</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">æ°¸ä¹…å…³é—­</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">vim</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">fstab</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">æ³¨é‡Šæ‰swapé‚£ä¸€è¡Œå°±è¡Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">è™šæ‹Ÿæœºæœ€å¥½æŠŠå†…å­˜åˆ†é…è°ƒæ•´åˆ°2Gä»¥ä¸Š</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">å¦åˆ™å…³æ‰swapä¼šå¯¼è‡´å›¾å½¢ç•Œé¢éš¾ä»¥è¿›å…¥</span><span style="color:#960050;background-color:#1e0010">ã€‚</span></span></span></code></pre></div>
<p>æˆ‘è¿™é‡Œæ˜¯æ³¨é‡Šæœ€åä¸€è¡Œ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/home/mainte# more /etc/fstab</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">fstab</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">file</span> <span style="color:#a6e22e">system</span> <span style="color:#a6e22e">information</span>.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Use</span> <span style="color:#e6db74">&#39;blkid&#39;</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">print</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">universally</span> <span style="color:#a6e22e">unique</span> <span style="color:#a6e22e">identifier</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">a</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">device</span>; <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">may</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">used</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">UUID</span><span style="color:#f92672">=</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">more</span> <span style="color:#a6e22e">robust</span> <span style="color:#a6e22e">way</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">name</span> <span style="color:#a6e22e">devices</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">that</span> <span style="color:#a6e22e">works</span> <span style="color:#a6e22e">even</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">disks</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">added</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">removed</span>. <span style="color:#a6e22e">See</span> <span style="color:#a6e22e">fstab</span>(<span style="color:#ae81ff">5</span>).
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">file</span> <span style="color:#a6e22e">system</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">mount</span> <span style="color:#a6e22e">point</span><span style="color:#f92672">&gt;</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">type</span><span style="color:#f92672">&gt;</span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">options</span><span style="color:#f92672">&gt;</span>       <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">dump</span><span style="color:#f92672">&gt;</span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">pass</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">was</span> <span style="color:#a6e22e">on</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">dev</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sda1</span> <span style="color:#a6e22e">during</span> <span style="color:#a6e22e">installation</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">UUID</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span><span style="color:#a6e22e">c86df1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">9442</span><span style="color:#f92672">-</span><span style="color:#ae81ff">46</span><span style="color:#a6e22e">c0</span><span style="color:#f92672">-</span><span style="color:#a6e22e">a29c</span><span style="color:#f92672">-</span><span style="color:#a6e22e">b8f7d0a421ab</span> <span style="color:#f92672">/</span>               <span style="color:#a6e22e">ext4</span>    <span style="color:#a6e22e">errors</span><span style="color:#f92672">=</span><span style="color:#a6e22e">remount</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ro</span> <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">swap</span> <span style="color:#a6e22e">was</span> <span style="color:#a6e22e">on</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">dev</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sda5</span> <span style="color:#a6e22e">during</span> <span style="color:#a6e22e">installation</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">UUID</span><span style="color:#f92672">=</span><span style="color:#a6e22e">e4e792e9</span><span style="color:#f92672">-</span><span style="color:#a6e22e">d30b</span><span style="color:#f92672">-</span><span style="color:#ae81ff">4e4</span><span style="color:#a6e22e">a</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ab3c</span><span style="color:#f92672">-</span><span style="color:#ae81ff">26</span><span style="color:#a6e22e">bd488adaae</span> <span style="color:#a6e22e">none</span>            <span style="color:#a6e22e">swap</span>    <span style="color:#a6e22e">sw</span>              <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#f92672">/</span><span style="color:#a6e22e">dev</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sr0</span>        <span style="color:#f92672">/</span><span style="color:#a6e22e">media</span><span style="color:#f92672">/</span><span style="color:#a6e22e">cdrom0</span>   <span style="color:#a6e22e">udf</span>,<span style="color:#a6e22e">iso9660</span> <span style="color:#a6e22e">user</span>,<span style="color:#a6e22e">noauto</span>     <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">0</span></span></span></code></pre></div>
<h2 id="è·å–é•œåƒ">è·å–é•œåƒ</h2>
<p>ç”±äºå®˜æ–¹é•œåƒåœ°å€è¢«å¢™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é¦–å…ˆè·å–æ‰€éœ€é•œåƒä»¥åŠå®ƒä»¬çš„ç‰ˆæœ¬ã€‚ç„¶åä»å›½å†…é˜¿é‡Œçš„é•œåƒç«™è·å–ã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubeadm</span> <span style="color:#a6e22e">config</span> <span style="color:#a6e22e">images</span> <span style="color:#a6e22e">list</span></span></span></code></pre></div>
<p>è·å–é•œåƒåˆ—è¡¨åå¯ä»¥é€šè¿‡ä¸‹é¢çš„è„šæœ¬ä»é˜¿é‡Œäº‘è·å–ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#66d9ef">in</span> <span style="color:#e6db74">`kubeadm config images list`</span>; <span style="color:#66d9ef">do</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">corednsé•œåƒåœ¨gcr</span>.<span style="color:#a6e22e">ioä¸Šæ˜¯k8s</span>.<span style="color:#a6e22e">gcr</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">/</span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">:</span><span style="color:#a6e22e">v1</span>.<span style="color:#ae81ff">8.6</span> <span style="color:#a6e22e">åœ¨é˜¿é‡Œäº‘ä¸Šæ˜¯</span> <span style="color:#a6e22e">registry</span>.<span style="color:#a6e22e">aliyuncs</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">google_containers</span><span style="color:#f92672">/</span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">:</span><span style="color:#a6e22e">v1</span>.<span style="color:#ae81ff">8.6</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">éœ€è¦ç‰¹æ®Šå¤„ç†</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">echo</span> <span style="color:#a6e22e">$i</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">grep</span> <span style="color:#a6e22e">coredns</span><span style="color:#f92672">/</span><span style="color:#a6e22e">coredns</span>;<span style="color:#a6e22e">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">imageName</span><span style="color:#f92672">=</span><span style="color:#a6e22e">$</span>{<span style="color:#a6e22e">i</span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">k8s</span>.<span style="color:#a6e22e">gcr</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">/</span>}  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">pull</span> <span style="color:#a6e22e">registry</span>.<span style="color:#a6e22e">aliyuncs</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">google_containers</span><span style="color:#f92672">/</span><span style="color:#a6e22e">$imageName</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">tag</span> <span style="color:#a6e22e">registry</span>.<span style="color:#a6e22e">aliyuncs</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">google_containers</span><span style="color:#f92672">/</span><span style="color:#a6e22e">$imageName</span> <span style="color:#a6e22e">k8s</span>.<span style="color:#a6e22e">gcr</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">/</span><span style="color:#a6e22e">$imageName</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">rmi</span> <span style="color:#a6e22e">registry</span>.<span style="color:#a6e22e">aliyuncs</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">google_containers</span><span style="color:#f92672">/</span><span style="color:#a6e22e">$imageName</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">imageName</span><span style="color:#f92672">=</span><span style="color:#a6e22e">$</span>{<span style="color:#a6e22e">i</span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">k8s</span>.<span style="color:#a6e22e">gcr</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">pull</span> <span style="color:#a6e22e">registry</span>.<span style="color:#a6e22e">aliyuncs</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">google_containers</span><span style="color:#f92672">/</span><span style="color:#a6e22e">$imageName</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">tag</span> <span style="color:#a6e22e">registry</span>.<span style="color:#a6e22e">aliyuncs</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">google_containers</span><span style="color:#f92672">/</span><span style="color:#a6e22e">$imageName</span> <span style="color:#a6e22e">k8s</span>.<span style="color:#a6e22e">gcr</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span><span style="color:#a6e22e">$imageName</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">docker</span> <span style="color:#a6e22e">rmi</span> <span style="color:#a6e22e">registry</span>.<span style="color:#a6e22e">aliyuncs</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">google_containers</span><span style="color:#f92672">/</span><span style="color:#a6e22e">$imageName</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fi</span> 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">done</span>;</span></span></code></pre></div>
<h2 id="ä¸»èŠ‚ç‚¹">ä¸»èŠ‚ç‚¹</h2>
<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubeadm</span> <span style="color:#a6e22e">init</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">service</span><span style="color:#f92672">-</span><span style="color:#a6e22e">cidr</span><span style="color:#f92672">=</span><span style="color:#ae81ff">10.96</span>.<span style="color:#ae81ff">0.0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">image</span><span style="color:#f92672">-</span><span style="color:#a6e22e">repository</span><span style="color:#f92672">=</span><span style="color:#a6e22e">registry</span>.<span style="color:#a6e22e">aliyuncs</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">google_containers</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">pod</span><span style="color:#f92672">-</span><span style="color:#a6e22e">network</span><span style="color:#f92672">-</span><span style="color:#a6e22e">cidr</span><span style="color:#f92672">=</span><span style="color:#ae81ff">10.244</span>.<span style="color:#ae81ff">0.0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">16</span> 
</span></span></code></pre></div>
<p>åˆå§‹åŒ–å¯å¸¸ç”¨çš„å‚æ•°ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span> <span style="color:#a6e22e">å‚æ•°è¯´æ˜</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span><span style="color:#a6e22e">apiserver</span><span style="color:#f92672">-</span><span style="color:#a6e22e">advertise</span><span style="color:#f92672">-</span><span style="color:#a6e22e">address</span><span style="color:#f92672">=</span><span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span>    <span style="color:#a6e22e">è¿™ä¸ªå‚æ•°å°±æ˜¯masterä¸»æœºçš„IPåœ°å€</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">ä¾‹å¦‚æˆ‘çš„Masterä¸»æœºçš„IPæ˜¯</span><span style="color:#960050;background-color:#1e0010">ï¼š</span><span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span><span style="color:#a6e22e">image</span><span style="color:#f92672">-</span><span style="color:#a6e22e">repository</span><span style="color:#f92672">=</span><span style="color:#a6e22e">registry</span>.<span style="color:#a6e22e">aliyuncs</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">google_containers</span>  <span style="color:#a6e22e">è¿™ä¸ªæ˜¯é•œåƒåœ°å€</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">ç”±äºå›½å¤–åœ°å€æ— æ³•è®¿é—®</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">æ•…ä½¿ç”¨çš„é˜¿é‡Œäº‘ä»“åº“åœ°å€</span><span style="color:#960050;background-color:#1e0010">ï¼š</span><span style="color:#a6e22e">registry</span>.<span style="color:#a6e22e">aliyuncs</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">google_containers</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">å¦‚æœä¸æŒ‡å®šå°±éœ€è¦åšä¸‹é¢è·å–é•œåƒç« èŠ‚çš„åŠ¨ä½œ</span><span style="color:#960050;background-color:#1e0010">ã€‚</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span><span style="color:#a6e22e">kubernetes</span><span style="color:#f92672">-</span><span style="color:#a6e22e">version</span><span style="color:#f92672">=</span><span style="color:#a6e22e">v1</span>.<span style="color:#ae81ff">17.4</span>   <span style="color:#a6e22e">è¿™ä¸ªå‚æ•°æ˜¯ä¸‹è½½çš„k8sè½¯ä»¶ç‰ˆæœ¬å·</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span><span style="color:#a6e22e">service</span><span style="color:#f92672">-</span><span style="color:#a6e22e">cidr</span><span style="color:#f92672">=</span><span style="color:#ae81ff">10.96</span>.<span style="color:#ae81ff">0.0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span>       <span style="color:#a6e22e">è¿™ä¸ªå‚æ•°åçš„IPåœ°å€ç›´æ¥å°±å¥—ç”¨10</span>.<span style="color:#ae81ff">96.0</span>.<span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">12</span> ,<span style="color:#a6e22e">ä»¥åå®‰è£…æ—¶ä¹Ÿå¥—ç”¨å³å¯</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">ä¸è¦æ›´æ”¹</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span><span style="color:#a6e22e">pod</span><span style="color:#f92672">-</span><span style="color:#a6e22e">network</span><span style="color:#f92672">-</span><span style="color:#a6e22e">cidr</span><span style="color:#f92672">=</span><span style="color:#ae81ff">10.244</span>.<span style="color:#ae81ff">0.0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">16</span>       <span style="color:#a6e22e">k8så†…éƒ¨çš„podèŠ‚ç‚¹ä¹‹é—´ç½‘ç»œå¯ä»¥ä½¿ç”¨çš„IPæ®µ</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">ä¸èƒ½å’Œservice</span><span style="color:#f92672">-</span><span style="color:#a6e22e">cidrå†™ä¸€æ ·</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">å¦‚æœä¸çŸ¥é“æ€ä¹ˆé…</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">å°±å…ˆç”¨è¿™ä¸ª10</span>.<span style="color:#ae81ff">244.0</span>.<span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">16</span></span></span></code></pre></div>
<p>ä¸€èˆ¬éƒ½ä¼šæŠ¥é”™</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>[<span style="color:#a6e22e">wait</span><span style="color:#f92672">-</span><span style="color:#a6e22e">control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">plane</span>] <span style="color:#a6e22e">Waiting</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">kubelet</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">boot</span> <span style="color:#a6e22e">up</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">control</span> <span style="color:#a6e22e">plane</span> <span style="color:#a6e22e">as</span> <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">Pods</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">directory</span> <span style="color:#e6db74">&#34;/etc/kubernetes/manifests&#34;</span>. <span style="color:#a6e22e">This</span> <span style="color:#a6e22e">can</span> <span style="color:#a6e22e">take</span> <span style="color:#a6e22e">up</span> <span style="color:#a6e22e">to</span> <span style="color:#ae81ff">4</span><span style="color:#a6e22e">m0s</span>
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">kubelet</span><span style="color:#f92672">-</span><span style="color:#a6e22e">check</span>] <span style="color:#a6e22e">Initial</span> <span style="color:#a6e22e">timeout</span> <span style="color:#66d9ef">of</span> <span style="color:#ae81ff">40</span><span style="color:#a6e22e">s</span> <span style="color:#a6e22e">passed</span>.
</span></span><span style="display:flex;"><span>[<span style="color:#a6e22e">kubelet</span><span style="color:#f92672">-</span><span style="color:#a6e22e">check</span>] <span style="color:#a6e22e">It</span> <span style="color:#a6e22e">seems</span> <span style="color:#a6e22e">like</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">kubelet</span> <span style="color:#a6e22e">isn</span><span style="color:#e6db74">&#39;t running or healthy.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[kubelet-check] The HTTP call equal to &#39;</span><span style="color:#a6e22e">curl</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">sSL</span> <span style="color:#a6e22e">http</span><span style="color:#f92672">:</span><span style="color:#75715e">//localhost:10248/healthz&#39; failed with error: Get &#34;http://localhost:10248/healthz&#34;: dial tcp [::1]:10248: connect: connection refused.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[<span style="color:#a6e22e">kubelet</span><span style="color:#f92672">-</span><span style="color:#a6e22e">check</span>] <span style="color:#a6e22e">It</span> <span style="color:#a6e22e">seems</span> <span style="color:#a6e22e">like</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">kubelet</span> <span style="color:#a6e22e">isn</span><span style="color:#e6db74">&#39;t running or healthy.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[kubelet-check] The HTTP call equal to &#39;</span><span style="color:#a6e22e">curl</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">sSL</span> <span style="color:#a6e22e">http</span><span style="color:#f92672">:</span><span style="color:#75715e">//localhost:10248/healthz&#39; failed with error: Get &#34;http://localhost:10248/healthz&#34;: dial tcp [::1]:10248: connect: connection refused.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[<span style="color:#a6e22e">kubelet</span><span style="color:#f92672">-</span><span style="color:#a6e22e">check</span>] <span style="color:#a6e22e">It</span> <span style="color:#a6e22e">seems</span> <span style="color:#a6e22e">like</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">kubelet</span> <span style="color:#a6e22e">isn</span><span style="color:#e6db74">&#39;t running or healthy.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[kubelet-check] The HTTP call equal to &#39;</span><span style="color:#a6e22e">curl</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">sSL</span> <span style="color:#a6e22e">http</span><span style="color:#f92672">:</span><span style="color:#75715e">//localhost:10248/healthz&#39; failed with error: Get &#34;http://localhost:10248/healthz&#34;: dial tcp [::1]:10248: connect: connection refused.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[<span style="color:#a6e22e">kubelet</span><span style="color:#f92672">-</span><span style="color:#a6e22e">check</span>] <span style="color:#a6e22e">It</span> <span style="color:#a6e22e">seems</span> <span style="color:#a6e22e">like</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">kubelet</span> <span style="color:#a6e22e">isn</span><span style="color:#e6db74">&#39;t running or healthy.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[kubelet-check] The HTTP call equal to &#39;</span><span style="color:#a6e22e">curl</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">sSL</span> <span style="color:#a6e22e">http</span><span style="color:#f92672">:</span><span style="color:#75715e">//localhost:10248/healthz&#39; failed with error: Get &#34;http://localhost:10248/healthz&#34;: dial tcp [::1]:10248: connect: connection refused.
</span></span></span></code></pre></div>
<p>æŸ¥çœ‹å®˜ç½‘ä»‹ç»ä¸º docker å’Œ kubelet æœåŠ¡ä¸­çš„ cgroup é©±åŠ¨ä¸ä¸€è‡´ï¼Œæœ‰ä¸¤ç§æ–¹æ³•
æ–¹å¼ä¸€ï¼šé©±åŠ¨å‘ docker çœ‹é½
æ–¹å¼äºŒï¼šé©±åŠ¨ä¸ºå‘ kubelet çœ‹é½
å¦‚æœdocker ä¸æ–¹ä¾¿é‡å¯åˆ™ç»Ÿä¸€å‘ kubeletçœ‹é½ï¼Œå¹¶é‡å¯å¯¹åº”çš„æœåŠ¡å³å¯
è§£å†³æ–¹å¼
docker é…ç½®æ–‡ä»¶
è¿™é‡Œé‡‡å–çš„æ˜¯æ–¹å¼äºŒï¼Œdocker é»˜è®¤é©±åŠ¨ä¸º cgroupfs ,åªéœ€è¦æ·»åŠ </p>
<p>&ldquo;exec-opts&rdquo;: [
&ldquo;native.cgroupdriver=systemd&rdquo;
],
ä¿®æ”¹åé…ç½®æ–‡ä»¶</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">controlplane</span><span style="color:#f92672">:~</span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">cat</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">docker</span><span style="color:#f92672">/</span><span style="color:#a6e22e">daemon</span>.<span style="color:#a6e22e">json</span> 
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;exec-opts&#34;</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;native.cgroupdriver=systemd&#34;</span>
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;bip&#34;</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;172.12.0.1/24&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;registry-mirrors&#34;</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;http://docker-registry-mirror.kodekloud.com&#34;</span>
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>é‡å¯docker</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">systemctl</span> <span style="color:#a6e22e">restart</span> <span style="color:#a6e22e">docker</span></span></span></code></pre></div>
<p>kublete é…ç½®æ–‡ä»¶
grep æˆªå–ä¸€ä¸‹,å¯ä»¥çœ‹å¾—å‡ºæ¥kubeleté»˜è®¤ cgoup é©±åŠ¨ä¸ºsystemd</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">controlplane</span><span style="color:#f92672">:~</span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">cat</span> <span style="color:#f92672">/</span><span style="color:#66d9ef">var</span><span style="color:#960050;background-color:#1e0010">/lib/kubelet/config.yaml |grep group</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cgroupDriver</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">systemd</span></span></span></code></pre></div>
<p>ä¿®æ”¹åé‡ç½®å¹¶é‡æ–°åˆå§‹åŒ–å¯æ­£å¸¸åˆå§‹åŒ–</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubeadm</span> <span style="color:#a6e22e">reset</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">kubeadm</span> <span style="color:#a6e22e">init</span></span></span></code></pre></div>
<p>æˆåŠŸåæç¤º</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">Your</span> <span style="color:#a6e22e">Kubernetes</span> <span style="color:#a6e22e">control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">plane</span> <span style="color:#a6e22e">has</span> <span style="color:#a6e22e">initialized</span> <span style="color:#a6e22e">successfully</span><span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">To</span> <span style="color:#a6e22e">start</span> <span style="color:#a6e22e">using</span> <span style="color:#a6e22e">your</span> <span style="color:#a6e22e">cluster</span>, <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">need</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">run</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">following</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">regular</span> <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">mkdir</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">p</span> <span style="color:#a6e22e">$HOME</span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">kube</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">cp</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kubernetes</span><span style="color:#f92672">/</span><span style="color:#a6e22e">admin</span>.<span style="color:#a6e22e">conf</span> <span style="color:#a6e22e">$HOME</span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">kube</span><span style="color:#f92672">/</span><span style="color:#a6e22e">config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">chown</span> <span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">id</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">u</span>)<span style="color:#f92672">:</span><span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">id</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">g</span>) <span style="color:#a6e22e">$HOME</span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">kube</span><span style="color:#f92672">/</span><span style="color:#a6e22e">config</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Alternatively</span>, <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">are</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">root</span> <span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">can</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">export</span> <span style="color:#a6e22e">KUBECONFIG</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">/etc/kubernetes/admin.conf</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">You</span> <span style="color:#a6e22e">should</span> <span style="color:#a6e22e">now</span> <span style="color:#a6e22e">deploy</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">pod</span> <span style="color:#a6e22e">network</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">cluster</span>.
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Run</span> <span style="color:#e6db74">&#34;kubectl apply -f [podnetwork].yaml&#34;</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">one</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">options</span> <span style="color:#a6e22e">listed</span> <span style="color:#a6e22e">at</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Then</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">can</span> <span style="color:#a6e22e">join</span> <span style="color:#a6e22e">any</span> <span style="color:#a6e22e">number</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">worker</span> <span style="color:#a6e22e">nodes</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">running</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">following</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">each</span> <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">root</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kubeadm</span> <span style="color:#a6e22e">join</span> <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6443</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">token</span> <span style="color:#a6e22e">pedwrg</span>.<span style="color:#a6e22e">x3ocfkg6ui1t5yht</span> <span style="color:#f92672">\</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">--</span><span style="color:#a6e22e">discovery</span><span style="color:#f92672">-</span><span style="color:#a6e22e">token</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ca</span><span style="color:#f92672">-</span><span style="color:#a6e22e">cert</span><span style="color:#f92672">-</span><span style="color:#a6e22e">hash</span> <span style="color:#a6e22e">sha256</span><span style="color:#f92672">:</span><span style="color:#a6e22e">a696588d58710779c758a0cdc4f0da3154af5d62f9b54420b5bb78d63f11e7a2</span> 
</span></span></code></pre></div>
<p>æ³¨æ„æœ€åä¸€æ®µçš„kubeadm joinæ˜¯workerèŠ‚ç‚¹åŠ å…¥ä½¿ç”¨çš„ï¼Œæ³¨æ„ä¿å­˜,å¦‚æœå¿˜è®°äº†å¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰“å°ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubeadm</span> <span style="color:#a6e22e">token</span> <span style="color:#a6e22e">create</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">print</span><span style="color:#f92672">-</span><span style="color:#a6e22e">join</span><span style="color:#f92672">-</span><span style="color:#a6e22e">command</span></span></span></code></pre></div>
<p>æ™®é€šç”¨æˆ·å®‰è£…éœ€è¦æ‰§è¡Œå¦‚ä¸‹è„šæœ¬ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>  <span style="color:#a6e22e">mkdir</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">p</span> <span style="color:#a6e22e">$HOME</span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">kube</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">cp</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kubernetes</span><span style="color:#f92672">/</span><span style="color:#a6e22e">admin</span>.<span style="color:#a6e22e">conf</span> <span style="color:#a6e22e">$HOME</span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">kube</span><span style="color:#f92672">/</span><span style="color:#a6e22e">config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">chown</span> <span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">id</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">u</span>)<span style="color:#f92672">:</span><span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">id</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">g</span>) <span style="color:#a6e22e">$HOME</span><span style="color:#f92672">/</span>.<span style="color:#a6e22e">kube</span><span style="color:#f92672">/</span><span style="color:#a6e22e">config</span></span></span></code></pre></div>
<p>rootç”¨æˆ·ç›´æ¥è¿è¡Œ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>  <span style="color:#66d9ef">export</span> <span style="color:#a6e22e">KUBECONFIG</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">/etc/kubernetes/admin.conf</span></span></span></code></pre></div>
<p>æ­¤æ—¶æŸ¥çœ‹æ‰€æœ‰äºŒè¿›åˆ¶å®‰è£…çš„è¿›ç¨‹</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/home/mainte# ps -ef | grep kube</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">root</span>      <span style="color:#ae81ff">7691</span>  <span style="color:#ae81ff">7622</span>  <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">:</span><span style="color:#ae81ff">30</span> <span style="color:#f92672">?</span>        <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">03</span> <span style="color:#a6e22e">etcd</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">advertise</span><span style="color:#f92672">-</span><span style="color:#a6e22e">client</span><span style="color:#f92672">-</span><span style="color:#a6e22e">urls</span><span style="color:#f92672">=</span><span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//10.10.0.115:2379 --cert-file=/etc/kubernetes/pki/etcd/server.crt --client-cert-auth=true --data-dir=/var/lib/etcd --initial-advertise-peer-urls=https://10.10.0.115:2380 --initial-cluster=liaok8s=https://10.10.0.115:2380 --key-file=/etc/kubernetes/pki/etcd/server.key --listen-client-urls=https://127.0.0.1:2379,https://10.10.0.115:2379 --listen-metrics-urls=http://127.0.0.1:2381 --listen-peer-urls=https://10.10.0.115:2380 --name=liaok8s --peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt --peer-client-cert-auth=true --peer-key-file=/etc/kubernetes/pki/etcd/peer.key --peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt --snapshot-count=10000 --trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">root</span>      <span style="color:#ae81ff">7736</span>  <span style="color:#ae81ff">7648</span>  <span style="color:#ae81ff">8</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">:</span><span style="color:#ae81ff">30</span> <span style="color:#f92672">?</span>        <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">apiserver</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">advertise</span><span style="color:#f92672">-</span><span style="color:#a6e22e">address</span><span style="color:#f92672">=</span><span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">privileged</span><span style="color:#f92672">=</span><span style="color:#66d9ef">true</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">authorization</span><span style="color:#f92672">-</span><span style="color:#a6e22e">mode</span><span style="color:#f92672">=</span><span style="color:#a6e22e">Node</span>,<span style="color:#a6e22e">RBAC</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">client</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ca</span><span style="color:#f92672">-</span><span style="color:#a6e22e">file</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">/etc/kubernetes/pki/ca.crt --enable-admission-plugins=NodeRestriction --enable-bootstrap-token-auth=true --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key --etcd-servers=https://127.0.0.1:2379 --kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt --kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key --requestheader-allowed-names=front-proxy-client --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/etc/kubernetes/pki/sa.pub --service-account-signing-key-file=/etc/kubernetes/pki/sa.key --service-cluster-ip-range=10.96.0.0/12 --tls-cert-file=/etc/kubernetes/pki/apiserver.crt --tls-private-key-file=/etc/kubernetes/pki/apiserver.key</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">root</span>      <span style="color:#ae81ff">7744</span>  <span style="color:#ae81ff">7661</span>  <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">:</span><span style="color:#ae81ff">30</span> <span style="color:#f92672">?</span>        <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">03</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">controller</span><span style="color:#f92672">-</span><span style="color:#a6e22e">manager</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">authentication</span><span style="color:#f92672">-</span><span style="color:#a6e22e">kubeconfig</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">/etc/kubernetes/controller-manager.conf --authorization-kubeconfig=/etc/kubernetes/controller-manager.conf --bind-address=127.0.0.1 --client-ca-file=/etc/kubernetes/pki/ca.crt --cluster-name=kubernetes --cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt --cluster-signing-key-file=/etc/kubernetes/pki/ca.key --controllers=*,bootstrapsigner,tokencleaner --kubeconfig=/etc/kubernetes/controller-manager.conf --leader-elect=true --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --root-ca-file=/etc/kubernetes/pki/ca.crt --service-account-private-key-file=/etc/kubernetes/pki/sa.key --use-service-account-credentials=true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">root</span>      <span style="color:#ae81ff">7752</span>  <span style="color:#ae81ff">7695</span>  <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">:</span><span style="color:#ae81ff">30</span> <span style="color:#f92672">?</span>        <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">01</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">scheduler</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">authentication</span><span style="color:#f92672">-</span><span style="color:#a6e22e">kubeconfig</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">/etc/kubernetes/scheduler.conf --authorization-kubeconfig=/etc/kubernetes/scheduler.conf --bind-address=127.0.0.1 --kubeconfig=/etc/kubernetes/scheduler.conf --leader-elect=true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">root</span>      <span style="color:#ae81ff">7965</span>     <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">:</span><span style="color:#ae81ff">30</span> <span style="color:#f92672">?</span>        <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">03</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kubelet</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">bootstrap</span><span style="color:#f92672">-</span><span style="color:#a6e22e">kubeconfig</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --network-plugin=cni --pod-infra-container-image=k8s.gcr.io/pause:3.6</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">root</span>      <span style="color:#ae81ff">8294</span>  <span style="color:#ae81ff">8274</span>  <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">:</span><span style="color:#ae81ff">31</span> <span style="color:#f92672">?</span>        <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">local</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">proxy</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">config</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">/var/lib/kube-proxy/config.conf --hostname-override=liaok8s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">root</span>      <span style="color:#ae81ff">9929</span>  <span style="color:#ae81ff">1346</span>  <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">16</span><span style="color:#f92672">:</span><span style="color:#ae81ff">33</span> <span style="color:#a6e22e">pts</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0</span>    <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#a6e22e">grep</span> <span style="color:#a6e22e">kube</span></span></span></code></pre></div>
<p>æŸ¥çœ‹ç³»ç»Ÿpod</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/home/mainte# kubectl get pods --namespace kube-system</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">NAME</span>                              <span style="color:#a6e22e">READY</span>   <span style="color:#a6e22e">STATUS</span>              <span style="color:#a6e22e">RESTARTS</span>   <span style="color:#a6e22e">AGE</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">-</span><span style="color:#ae81ff">64897985</span><span style="color:#a6e22e">d</span><span style="color:#f92672">-</span><span style="color:#a6e22e">f9l5d</span>           <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">ContainerCreating</span>   <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">3</span><span style="color:#a6e22e">m18s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">-</span><span style="color:#ae81ff">64897985</span><span style="color:#a6e22e">d</span><span style="color:#f92672">-</span><span style="color:#a6e22e">gtbp6</span>           <span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">ContainerCreating</span>   <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">3</span><span style="color:#a6e22e">m18s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">etcd</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>                      <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>             <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">3</span><span style="color:#a6e22e">m23s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">apiserver</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>            <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>             <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">3</span><span style="color:#a6e22e">m25s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">controller</span><span style="color:#f92672">-</span><span style="color:#a6e22e">manager</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>   <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>             <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">3</span><span style="color:#a6e22e">m23s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">proxy</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#a6e22e">phdl</span>                  <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>             <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">3</span><span style="color:#a6e22e">m18s</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">scheduler</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>            <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>             <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">3</span><span style="color:#a6e22e">m22s</span></span></span></code></pre></div>
<p>å‘ç°dnså…³äºç½‘ç»œçš„æœåŠ¡éƒ½æ˜¯0ä¸ªå®ä¾‹
åŒæ—¶æ£€æŸ¥nodeèŠ‚ç‚¹ï¼ˆç›®å‰å°±ä¸€ä¸ªmasterèŠ‚ç‚¹ï¼Œç‰ˆæœ¬1.12.3ï¼‰</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/home/mainte# kubectl get node</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">NAME</span>      <span style="color:#a6e22e">STATUS</span>   <span style="color:#a6e22e">ROLES</span>                  <span style="color:#a6e22e">AGE</span>    <span style="color:#a6e22e">VERSION</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">liaok8s</span>   <span style="color:#a6e22e">Ready</span>    <span style="color:#a6e22e">control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">plane</span>,<span style="color:#a6e22e">master</span>   <span style="color:#ae81ff">4</span><span style="color:#a6e22e">m9s</span>   <span style="color:#a6e22e">v1</span>.<span style="color:#ae81ff">23.3</span></span></span></code></pre></div>
<p>æŸ¥çœ‹ç‰ˆæœ¬</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/home/mainte# kubectl version --short=true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Client</span> <span style="color:#a6e22e">Version</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>.<span style="color:#ae81ff">23.3</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Server</span> <span style="color:#a6e22e">Version</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>.<span style="color:#ae81ff">23.3</span></span></span></code></pre></div>
<p>ä¸Šé¢å®‰è£…æˆåŠŸåå¦‚æœé€šè¿‡æŸ¥è¯¢kube-systemä¸‹Podçš„è¿è¡Œæƒ…å†µï¼Œä¼šå‘ç°å’Œç½‘ç»œç›¸å…³çš„Podéƒ½å¤„äºPendingçš„çŠ¶æ€ï¼Œè¿™æ˜¯å› ä¸ºç¼ºå°‘ç›¸å…³çš„ç½‘ç»œæ’ä»¶ã€‚</p>
<h3 id="å®‰è£…ç½‘ç»œ">å®‰è£…ç½‘ç»œ</h3>
<p>ä¸Šé¢å®‰è£…æˆåŠŸåå¦‚æœé€šè¿‡æŸ¥è¯¢kube-systemä¸‹Podçš„è¿è¡Œæƒ…å†µï¼Œä¼šæ”¾ä¸‹å’Œç½‘ç»œç›¸å…³çš„Podéƒ½å¤„äºPendingçš„çŠ¶æ€ï¼Œè¿™æ˜¯å› ä¸ºç¼ºå°‘ç›¸å…³çš„ç½‘ç»œæ’ä»¶ï¼Œè€Œç½‘ç»œæ’ä»¶æœ‰å¾ˆå¤šä¸ªï¼ˆä»¥ä¸‹ä»»é€‰ä¸€ä¸ªï¼‰ï¼Œå¯ä»¥é€‰æ‹©è‡ªå·±éœ€è¦çš„ã€‚
æ¯”è¾ƒæµè¡Œçš„å‡ ä¸ªä¸ºï¼š</p>
<ul>
<li>flannel</li>
<li>weave</li>
<li>calico
è¿™é‡Œä»¥calicoä¸ºä¾‹
Calicoæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„åè®®ï¼Œä¸ºOpenStackè™šæœºå’ŒDockerå®¹å™¨æä¾›å¤šä¸»æœºé—´é€šä¿¡ã€‚Calicoä¸ä½¿ç”¨é‡å ç½‘ç»œæ¯”å¦‚flannelå’Œlibnetworké‡å ç½‘ç»œé©±åŠ¨ï¼Œ
å®ƒæ˜¯ä¸€ä¸ªçº¯ä¸‰å±‚çš„æ–¹æ³•ï¼Œä½¿ç”¨è™šæ‹Ÿè·¯ç”±ä»£æ›¿è™šæ‹Ÿäº¤æ¢ï¼Œæ¯ä¸€å°è™šæ‹Ÿè·¯ç”±é€šè¿‡BGPåè®®ä¼ æ’­å¯è¾¾ä¿¡æ¯ï¼ˆè·¯ç”±ï¼‰åˆ°å‰©ä½™æ•°æ®ä¸­å¿ƒã€‚<a href="https://blog.csdn.net/ccy19910925/article/details/82423452" rel="external" target="_blank">calicoåŸç†å‚è€ƒ</a>
ä¸è¦ç›´æ¥ä½¿ç”¨ä¸‹é¢æ–¹å¼ä¸‹è½½å®‰è£…ï¼Œå› ä¸ºnodeé—´é€šä¿¡ï¼Œé»˜è®¤ä¼šé€‰æ‹©ç¬¬ä¸€ä¸ªç‰©ç†ç½‘å¡çš„ipï¼Œä¼šå¯¼è‡´é€‰é”™ipï¼Œæ— æ³•é€šä¿¡</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">apply</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//docs.projectcalico.org/manifests/calico.yaml
</span></span></span></code></pre></div>
<p>åº”è¯¥é¦–å…ˆä¸‹è½½calico.yaml
wget <a href="https://docs.projectcalico.org/manifests/calico.yaml" rel="external" target="_blank">https://docs.projectcalico.org/manifests/calico.yaml</a>
ä¿®æ”¹yamlæ–‡ä»¶å®¹å™¨åç§°ä¸ºï¼šcalico-nodeï¼Œæœç´¢å¤§æ¦‚è¿™ä¸ªå†…å®¹</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>      <span style="color:#a6e22e">containers</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">image</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">docker</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span><span style="color:#a6e22e">calico</span><span style="color:#f92672">/</span><span style="color:#a6e22e">node</span><span style="color:#f92672">:</span><span style="color:#a6e22e">v3</span>.<span style="color:#ae81ff">22.0</span></span></span></code></pre></div>
<p>æ–°å¢ä¸€ä¸ªå˜é‡ envéƒ¨åˆ†</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>            <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">IP_AUTODETECTION_METHOD</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;interface=ens.*&#34;</span></span></span></code></pre></div>
<p>æ„æ€æ˜¯æ‰¾ç‰©ç†ä¸»æœºçš„ipæ˜¯ä½¿ç”¨enså¼€å¤´çš„ç½‘å¡ï¼Œå…·ä½“çš„æœ¬åœ°ç‰©ç†ç½‘å¡åç§°å¯ä»¥é€šè¿‡ ip addræŸ¥çœ‹</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">apply</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> .<span style="color:#f92672">/</span><span style="color:#a6e22e">calico</span>.<span style="color:#a6e22e">yaml</span></span></span></code></pre></div>
<p>æ£€æµ‹podæ˜¯å¦å®‰è£…æˆåŠŸ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/home/mainte# kubectl get pods --namespace kube-system -o wide</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">NAME</span>                                       <span style="color:#a6e22e">READY</span>   <span style="color:#a6e22e">STATUS</span>    <span style="color:#a6e22e">RESTARTS</span>   <span style="color:#a6e22e">AGE</span>    <span style="color:#a6e22e">IP</span>                <span style="color:#a6e22e">NODE</span>      <span style="color:#a6e22e">NOMINATED</span> <span style="color:#a6e22e">NODE</span>   <span style="color:#a6e22e">READINESS</span> <span style="color:#a6e22e">GATES</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">controllers</span><span style="color:#f92672">-</span><span style="color:#ae81ff">566</span><span style="color:#a6e22e">dc76669</span><span style="color:#f92672">-</span><span style="color:#a6e22e">dwlrk</span>   <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">4</span><span style="color:#a6e22e">m4s</span>   <span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">134.129</span>   <span style="color:#a6e22e">liaok8s</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>           <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span><span style="color:#f92672">-</span><span style="color:#a6e22e">gtpcw</span>                          <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">4</span><span style="color:#a6e22e">m4s</span>   <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span>       <span style="color:#a6e22e">liaok8s</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>           <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">-</span><span style="color:#ae81ff">64897985</span><span style="color:#a6e22e">d</span><span style="color:#f92672">-</span><span style="color:#a6e22e">f9l5d</span>                    <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">64</span><span style="color:#a6e22e">m</span>    <span style="color:#ae81ff">172.16</span>.<span style="color:#ae81ff">134.131</span>    <span style="color:#a6e22e">liaok8s</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>           <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">-</span><span style="color:#ae81ff">64897985</span><span style="color:#a6e22e">d</span><span style="color:#f92672">-</span><span style="color:#a6e22e">gtbp6</span>                    <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">64</span><span style="color:#a6e22e">m</span>    <span style="color:#ae81ff">172.16</span>.<span style="color:#ae81ff">134.129</span>    <span style="color:#a6e22e">liaok8s</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>           <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">etcd</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>                               <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">64</span><span style="color:#a6e22e">m</span>    <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span>       <span style="color:#a6e22e">liaok8s</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>           <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">apiserver</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>                     <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">64</span><span style="color:#a6e22e">m</span>    <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span>       <span style="color:#a6e22e">liaok8s</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>           <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">controller</span><span style="color:#f92672">-</span><span style="color:#a6e22e">manager</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>            <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">2</span>          <span style="color:#ae81ff">64</span><span style="color:#a6e22e">m</span>    <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span>       <span style="color:#a6e22e">liaok8s</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>           <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">proxy</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#a6e22e">phdl</span>                           <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">64</span><span style="color:#a6e22e">m</span>    <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span>       <span style="color:#a6e22e">liaok8s</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>           <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">scheduler</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>                     <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">4</span>          <span style="color:#ae81ff">64</span><span style="color:#a6e22e">m</span>    <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span>       <span style="color:#a6e22e">liaok8s</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>           <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span></span></span></code></pre></div>
<p>å¦‚æœå®‰è£…å¤±è´¥å¾ˆæœ‰å¯èƒ½æ˜¯ä¹‹å‰å®‰è£…resetè¿‡æ²¡æœ‰æ¸…é™¤å®Œï¼Œæ¸…é™¤åé‡è£…</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">ã€</span><span style="color:#a6e22e">åˆ é™¤å®‰è£…æ’ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#66d9ef">delete</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> .<span style="color:#f92672">/</span><span style="color:#a6e22e">calico</span>.<span style="color:#a6e22e">yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">ã€</span><span style="color:#a6e22e">æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œ</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">çœ‹çœ‹æ˜¯å¦å­˜åœ¨Tunl0</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">è‹¥å­˜åœ¨Tunl0</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">å°†å…¶åˆ é™¤</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">modprobe</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">r</span> <span style="color:#a6e22e">ipip</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">ã€</span><span style="color:#a6e22e">ç§»é™¤ä¸Calicoç½‘ç»œæ’ä»¶æœ‰å…³çš„ç½‘ç»œé…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ls</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">cni</span><span style="color:#f92672">/</span><span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">d</span><span style="color:#f92672">/</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rm</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">rf</span> <span style="color:#a6e22e">calicoç›¸å…³æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rm</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">rf</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">cni</span><span style="color:#f92672">/</span><span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">d</span><span style="color:#f92672">/*</span><span style="color:#a6e22e">calico</span><span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">åˆ é™¤æ‰€æœ‰calicoçš„pod</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#66d9ef">in</span> <span style="color:#e6db74">`kubectl get pods --namespace kube-system`</span>; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">echo</span> <span style="color:#a6e22e">$i</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">grep</span> <span style="color:#a6e22e">calico</span>;<span style="color:#a6e22e">then</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">echo</span> <span style="color:#a6e22e">$i</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">awk</span> <span style="color:#e6db74">&#39;system(&#34;kubectl delete --force pod &#34;$1&#34; --namespace kube-system&#34;)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">done</span>;
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">ã€</span><span style="color:#a6e22e">é‡æ–°å®‰è£…</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">apply</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> .<span style="color:#f92672">/</span><span style="color:#a6e22e">calico</span>.<span style="color:#a6e22e">yaml</span></span></span></code></pre></div>
<h2 id="workerèŠ‚ç‚¹">workerèŠ‚ç‚¹</h2>
<p>åŒä¸»èŠ‚ç‚¹kubeletå’Œdockerçš„é©±åŠ¨ç±»å‹å¿…é¡»ä¸€è‡´
ä¿®æ”¹/etc/docker/daemon.json é‡å¯docker</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span> <span style="color:#e6db74">&#34;exec-opts&#34;</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;native.cgroupdriver=systemd&#34;</span>
</span></span><span style="display:flex;"><span>  ],</span></span></code></pre></div>
<p>æ³¨æ„workerèŠ‚ç‚¹ä¹Ÿè¦è·å–è¿™äº›é•œåƒï¼Œè™½ç„¶åªæœ‰éƒ¨åˆ†ä½¿ç”¨ï¼Œæ¯”å¦‚pauseï¼Œå¦åˆ™kubeletä¼šå‡ºç°æ‹‰å–é”™è¯¯
ä¹‹å‰æ˜¯æ²¡æœ‰åœ¨workerèŠ‚ç‚¹æ‹‰å–é•œåƒï¼Œåœ¨ä¸»èŠ‚ç‚¹æŸ¥çœ‹calicoç½‘ç»œçš„eventæ—¥å¿—</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">describe</span> <span style="color:#a6e22e">pods</span> <span style="color:#a6e22e">calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ncwdc</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">n</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Events</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Type</span>     <span style="color:#a6e22e">Reason</span>                    <span style="color:#a6e22e">Age</span>                   <span style="color:#a6e22e">From</span>               <span style="color:#a6e22e">Message</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">----</span>     <span style="color:#f92672">------</span>                    <span style="color:#f92672">----</span>                  <span style="color:#f92672">----</span>               <span style="color:#f92672">-------</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Normal</span>   <span style="color:#a6e22e">Scheduled</span>                 <span style="color:#ae81ff">15</span><span style="color:#a6e22e">m</span>                   <span style="color:#66d9ef">default</span><span style="color:#f92672">-</span><span style="color:#a6e22e">scheduler</span>  <span style="color:#a6e22e">Successfully</span> <span style="color:#a6e22e">assigned</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system</span><span style="color:#f92672">/</span><span style="color:#a6e22e">calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ncwdc</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">pve</span><span style="color:#f92672">-</span><span style="color:#a6e22e">tmpl</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Warning</span>  <span style="color:#a6e22e">FailedCreatePodContainer</span>  <span style="color:#ae81ff">15</span><span style="color:#a6e22e">m</span>                   <span style="color:#a6e22e">kubelet</span>            <span style="color:#a6e22e">unable</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">ensure</span> <span style="color:#a6e22e">pod</span> <span style="color:#a6e22e">container</span> <span style="color:#a6e22e">exists</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">failed</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">create</span> <span style="color:#a6e22e">container</span> <span style="color:#66d9ef">for</span> [<span style="color:#a6e22e">kubepods</span> <span style="color:#a6e22e">burstable</span> <span style="color:#a6e22e">podb1e24b58</span><span style="color:#f92672">-</span><span style="color:#a6e22e">fe92</span><span style="color:#f92672">-</span><span style="color:#ae81ff">42</span><span style="color:#a6e22e">d6</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8857</span><span style="color:#f92672">-</span><span style="color:#ae81ff">61</span><span style="color:#a6e22e">d4d36638a2</span>] <span style="color:#f92672">:</span> <span style="color:#a6e22e">mkdir</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">sys</span><span style="color:#f92672">/</span><span style="color:#a6e22e">fs</span><span style="color:#f92672">/</span><span style="color:#a6e22e">cgroup</span><span style="color:#f92672">/</span><span style="color:#a6e22e">devices</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kubepods</span>.<span style="color:#a6e22e">slice</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kubepods</span><span style="color:#f92672">-</span><span style="color:#a6e22e">burstable</span>.<span style="color:#a6e22e">slice</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kubepods</span><span style="color:#f92672">-</span><span style="color:#a6e22e">burstable</span><span style="color:#f92672">-</span><span style="color:#a6e22e">podb1e24b58_fe92_42d6_8857_61d4d36638a2</span>.<span style="color:#a6e22e">slice</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">no</span> <span style="color:#a6e22e">such</span> <span style="color:#a6e22e">file</span> <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">directory</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Warning</span>  <span style="color:#a6e22e">FailedCreatePodSandBox</span>    <span style="color:#ae81ff">15</span><span style="color:#a6e22e">m</span>                   <span style="color:#a6e22e">kubelet</span>            <span style="color:#a6e22e">Failed</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">create</span> <span style="color:#a6e22e">pod</span> <span style="color:#a6e22e">sandbox</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">rpc</span> <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Unknown</span> <span style="color:#a6e22e">desc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">failed</span> <span style="color:#a6e22e">pulling</span> <span style="color:#a6e22e">image</span> <span style="color:#e6db74">&#34;k8s.gcr.io/pause:3.6&#34;</span><span style="color:#f92672">:</span> Error <span style="color:#a6e22e">response</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">daemon</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;https://k8s.gcr.io/v2/&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">net</span><span style="color:#f92672">/</span><span style="color:#a6e22e">http</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">request</span> <span style="color:#a6e22e">canceled</span> <span style="color:#66d9ef">while</span> <span style="color:#a6e22e">waiting</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">connection</span> (<span style="color:#a6e22e">Client</span>.<span style="color:#a6e22e">Timeout</span> <span style="color:#a6e22e">exceeded</span> <span style="color:#66d9ef">while</span> <span style="color:#a6e22e">awaiting</span> <span style="color:#a6e22e">headers</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Warning</span>  <span style="color:#a6e22e">FailedCreatePodSandBox</span>    <span style="color:#ae81ff">14</span><span style="color:#a6e22e">m</span>                   <span style="color:#a6e22e">kubelet</span>            <span style="color:#a6e22e">Failed</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">create</span> <span style="color:#a6e22e">pod</span> <span style="color:#a6e22e">sandbox</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">rpc</span> <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Unknown</span> <span style="color:#a6e22e">desc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">failed</span> <span style="color:#a6e22e">pulling</span> <span style="color:#a6e22e">image</span> <span style="color:#e6db74">&#34;k8s.gcr.io/pause:3.6&#34;</span><span style="color:#f92672">:</span> Error <span style="color:#a6e22e">response</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">daemon</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;https://k8s.gcr.io/v2/&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dial</span> <span style="color:#a6e22e">tcp</span> <span style="color:#ae81ff">74.125</span>.<span style="color:#ae81ff">204.82</span><span style="color:#f92672">:</span><span style="color:#ae81ff">443</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">/</span><span style="color:#a6e22e">o</span> <span style="color:#a6e22e">timeout</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Warning</span>  <span style="color:#a6e22e">FailedCreatePodSandBox</span>    <span style="color:#ae81ff">10</span><span style="color:#a6e22e">m</span>                   <span style="color:#a6e22e">kubelet</span>            <span style="color:#a6e22e">Failed</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">create</span> <span style="color:#a6e22e">pod</span> <span style="color:#a6e22e">sandbox</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">rpc</span> <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Unknown</span> <span style="color:#a6e22e">desc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">failed</span> <span style="color:#a6e22e">pulling</span> <span style="color:#a6e22e">image</span> <span style="color:#e6db74">&#34;k8s.gcr.io/pause:3.6&#34;</span><span style="color:#f92672">:</span> Error <span style="color:#a6e22e">response</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">daemon</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;https://k8s.gcr.io/v2/&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dial</span> <span style="color:#a6e22e">tcp</span> <span style="color:#ae81ff">142.251</span>.<span style="color:#ae81ff">8.82</span><span style="color:#f92672">:</span><span style="color:#ae81ff">443</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">/</span><span style="color:#a6e22e">o</span> <span style="color:#a6e22e">timeout</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Warning</span>  <span style="color:#a6e22e">FailedCreatePodSandBox</span>    <span style="color:#ae81ff">8</span><span style="color:#a6e22e">m35s</span> (<span style="color:#a6e22e">x13</span> <span style="color:#a6e22e">over</span> <span style="color:#ae81ff">15</span><span style="color:#a6e22e">m</span>)  <span style="color:#a6e22e">kubelet</span>            <span style="color:#a6e22e">Failed</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">create</span> <span style="color:#a6e22e">pod</span> <span style="color:#a6e22e">sandbox</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">rpc</span> <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Unknown</span> <span style="color:#a6e22e">desc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">failed</span> <span style="color:#a6e22e">pulling</span> <span style="color:#a6e22e">image</span> <span style="color:#e6db74">&#34;k8s.gcr.io/pause:3.6&#34;</span><span style="color:#f92672">:</span> Error <span style="color:#a6e22e">response</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">daemon</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;https://k8s.gcr.io/v2/&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">net</span><span style="color:#f92672">/</span><span style="color:#a6e22e">http</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">request</span> <span style="color:#a6e22e">canceled</span> <span style="color:#66d9ef">while</span> <span style="color:#a6e22e">waiting</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">connection</span> (<span style="color:#a6e22e">Client</span>.<span style="color:#a6e22e">Timeout</span> <span style="color:#a6e22e">exceeded</span> <span style="color:#66d9ef">while</span> <span style="color:#a6e22e">awaiting</span> <span style="color:#a6e22e">headers</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Warning</span>  <span style="color:#a6e22e">FailedCreatePodSandBox</span>    <span style="color:#ae81ff">8</span><span style="color:#a6e22e">m6s</span>                  <span style="color:#a6e22e">kubelet</span>            <span style="color:#a6e22e">Failed</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">create</span> <span style="color:#a6e22e">pod</span> <span style="color:#a6e22e">sandbox</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">rpc</span> <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Unknown</span> <span style="color:#a6e22e">desc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">failed</span> <span style="color:#a6e22e">pulling</span> <span style="color:#a6e22e">image</span> <span style="color:#e6db74">&#34;k8s.gcr.io/pause:3.6&#34;</span><span style="color:#f92672">:</span> Error <span style="color:#a6e22e">response</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">daemon</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Get</span> <span style="color:#e6db74">&#34;https://k8s.gcr.io/v2/&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dial</span> <span style="color:#a6e22e">tcp</span> <span style="color:#ae81ff">108.177</span>.<span style="color:#ae81ff">125.82</span><span style="color:#f92672">:</span><span style="color:#ae81ff">443</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">/</span><span style="color:#a6e22e">o</span> <span style="color:#a6e22e">timeout</span></span></span></code></pre></div>
<p>ä½¿ç”¨ä¹‹å‰çš„kubeadm joinå‘½ä»¤åŠ å…¥ï¼Œå¦‚æœå¿˜è®°äº†å¯ä»¥åœ¨ä¸»èŠ‚ç‚¹è·å–</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubeadm</span> <span style="color:#a6e22e">token</span> <span style="color:#a6e22e">create</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">print</span><span style="color:#f92672">-</span><span style="color:#a6e22e">join</span><span style="color:#f92672">-</span><span style="color:#a6e22e">command</span></span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubeadm</span> <span style="color:#a6e22e">join</span> <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6443</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">token</span> <span style="color:#a6e22e">dprbpd</span>.<span style="color:#a6e22e">gdjxay6moqf10d05</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">discovery</span><span style="color:#f92672">-</span><span style="color:#a6e22e">token</span><span style="color:#f92672">-</span><span style="color:#a6e22e">ca</span><span style="color:#f92672">-</span><span style="color:#a6e22e">cert</span><span style="color:#f92672">-</span><span style="color:#a6e22e">hash</span> <span style="color:#a6e22e">sha256</span><span style="color:#f92672">:</span><span style="color:#a6e22e">a696588d58710779c758a0cdc4f0da3154af5d62f9b54420b5bb78d63f11e7a2</span> 
</span></span></code></pre></div>
<p>åŠ å…¥æˆåŠŸåï¼Œå¯é€šè¿‡docker ps æŸ¥çœ‹</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">pve</span><span style="color:#f92672">-</span><span style="color:#a6e22e">tmpl</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/home/mainte# docker ps</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">CONTAINER</span> <span style="color:#a6e22e">ID</span>   <span style="color:#a6e22e">IMAGE</span>                  <span style="color:#a6e22e">COMMAND</span>                  <span style="color:#a6e22e">CREATED</span>        <span style="color:#a6e22e">STATUS</span>        <span style="color:#a6e22e">PORTS</span>     <span style="color:#a6e22e">NAMES</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">96170</span><span style="color:#a6e22e">aa46f83</span>   <span style="color:#a6e22e">k8s</span>.<span style="color:#a6e22e">gcr</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span><span style="color:#a6e22e">pause</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3.6</span>   <span style="color:#e6db74">&#34;/pause&#34;</span>                 <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">hours</span> <span style="color:#a6e22e">ago</span>   <span style="color:#a6e22e">Up</span> <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">hours</span>             <span style="color:#a6e22e">k8s_POD_nginx_default_7c3d47ef</span><span style="color:#f92672">-</span><span style="color:#a6e22e">f478</span><span style="color:#f92672">-</span><span style="color:#ae81ff">40</span><span style="color:#a6e22e">b4</span><span style="color:#f92672">-</span><span style="color:#a6e22e">b154</span><span style="color:#f92672">-</span><span style="color:#a6e22e">e9334cff14e3_1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span><span style="color:#a6e22e">c627df7a7ca</span>   <span style="color:#a6e22e">f109b1742d34</span>           <span style="color:#e6db74">&#34;start_runit&#34;</span>            <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">hours</span> <span style="color:#a6e22e">ago</span>   <span style="color:#a6e22e">Up</span> <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">hours</span>             <span style="color:#a6e22e">k8s_calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node_calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span><span style="color:#f92672">-</span><span style="color:#a6e22e">j8x2d_kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system_3875d252</span><span style="color:#f92672">-</span><span style="color:#ae81ff">86</span><span style="color:#a6e22e">cf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">47e4</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8</span><span style="color:#a6e22e">c86</span><span style="color:#f92672">-</span><span style="color:#a6e22e">e74f32356d51_1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">c30f1e963eae</span>   <span style="color:#a6e22e">k8s</span>.<span style="color:#a6e22e">gcr</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span><span style="color:#a6e22e">pause</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3.6</span>   <span style="color:#e6db74">&#34;/pause&#34;</span>                 <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">hours</span> <span style="color:#a6e22e">ago</span>   <span style="color:#a6e22e">Up</span> <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">hours</span>             <span style="color:#a6e22e">k8s_POD_calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span><span style="color:#f92672">-</span><span style="color:#a6e22e">j8x2d_kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system_3875d252</span><span style="color:#f92672">-</span><span style="color:#ae81ff">86</span><span style="color:#a6e22e">cf</span><span style="color:#f92672">-</span><span style="color:#ae81ff">47e4</span><span style="color:#f92672">-</span><span style="color:#ae81ff">8</span><span style="color:#a6e22e">c86</span><span style="color:#f92672">-</span><span style="color:#a6e22e">e74f32356d51_1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0426</span><span style="color:#a6e22e">d0f18715</span>   <span style="color:#ae81ff">9</span><span style="color:#a6e22e">b7cc9982109</span>           <span style="color:#e6db74">&#34;/usr/local/bin/kubeâ€¦&#34;</span>   <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">hours</span> <span style="color:#a6e22e">ago</span>   <span style="color:#a6e22e">Up</span> <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">hours</span>             <span style="color:#a6e22e">k8s_kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">proxy_kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">proxy</span><span style="color:#f92672">-</span><span style="color:#a6e22e">kql69_kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system_838b79c1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">14</span><span style="color:#a6e22e">c1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">46e1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">a806</span><span style="color:#f92672">-</span><span style="color:#ae81ff">868</span><span style="color:#a6e22e">ca3fa87d3_2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">773974</span><span style="color:#a6e22e">f94bba</span>   <span style="color:#a6e22e">k8s</span>.<span style="color:#a6e22e">gcr</span>.<span style="color:#a6e22e">io</span><span style="color:#f92672">/</span><span style="color:#a6e22e">pause</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3.6</span>   <span style="color:#e6db74">&#34;/pause&#34;</span>                 <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">hours</span> <span style="color:#a6e22e">ago</span>   <span style="color:#a6e22e">Up</span> <span style="color:#ae81ff">13</span> <span style="color:#a6e22e">hours</span>             <span style="color:#a6e22e">k8s_POD_kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">proxy</span><span style="color:#f92672">-</span><span style="color:#a6e22e">kql69_kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system_838b79c1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">14</span><span style="color:#a6e22e">c1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">46e1</span><span style="color:#f92672">-</span><span style="color:#a6e22e">a806</span><span style="color:#f92672">-</span><span style="color:#ae81ff">868</span><span style="color:#a6e22e">ca3fa87d3_1</span></span></span></code></pre></div>
<p>ä»èŠ‚ç‚¹å›å®‰è£…pauseï¼Œcalicoï¼Œkubeproxyç­‰ç»„ä»¶ï¼ŒäºŒè¿›åˆ¶ç»„ä»¶</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">pve</span><span style="color:#f92672">-</span><span style="color:#a6e22e">tmpl</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/home/mainte# ps -ef | grep kube</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">root</span>       <span style="color:#ae81ff">392</span>     <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">1</span> <span style="color:#a6e22e">Feb10</span> <span style="color:#f92672">?</span>        <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">13</span><span style="color:#f92672">:</span><span style="color:#ae81ff">19</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kubelet</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">bootstrap</span><span style="color:#f92672">-</span><span style="color:#a6e22e">kubeconfig</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --network-plugin=cni --pod-infra-container-image=k8s.gcr.io/pause:3.6</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">root</span>       <span style="color:#ae81ff">967</span>   <span style="color:#ae81ff">947</span>  <span style="color:#ae81ff">0</span> <span style="color:#a6e22e">Feb10</span> <span style="color:#f92672">?</span>        <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">08</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">usr</span><span style="color:#f92672">/</span><span style="color:#a6e22e">local</span><span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">proxy</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">config</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">/var/lib/kube-proxy/config.conf --hostname-override=pve-tmpl</span></span></span></code></pre></div>
<h2 id="å¼‚å¸¸é—®é¢˜">å¼‚å¸¸é—®é¢˜</h2>
<h3 id="calicoå®¹å™¨å¼‚å¸¸">calicoå®¹å™¨å¼‚å¸¸</h3>
<p>å¦‚æœcalicoå®‰è£…å‡ºç°é—®é¢˜ï¼Œä¸€èˆ¬éƒ½ä¼šå¯¼è‡´kube-systemä¸‹çš„calicoç›¸å…³çš„å®¹å™¨æ— æ³•æ­£å¸¸è¿è¡Œ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/usr/local/bin# kubectl get pods --namespace kube-system</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">NAME</span>                                       <span style="color:#a6e22e">READY</span>   <span style="color:#a6e22e">STATUS</span>    <span style="color:#a6e22e">RESTARTS</span>      <span style="color:#a6e22e">AGE</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">controllers</span><span style="color:#f92672">-</span><span style="color:#ae81ff">566</span><span style="color:#a6e22e">dc76669</span><span style="color:#f92672">-</span><span style="color:#a6e22e">dllq7</span>   <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">0</span>             <span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span><span style="color:#f92672">-</span><span style="color:#a6e22e">j2ffk</span>                          <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">0</span>             <span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span><span style="color:#f92672">-</span><span style="color:#a6e22e">j8x2d</span>                          <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">1</span> (<span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span> <span style="color:#a6e22e">ago</span>)   <span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">-</span><span style="color:#ae81ff">64897985</span><span style="color:#a6e22e">d</span><span style="color:#f92672">-</span><span style="color:#a6e22e">f9l5d</span>                    <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">1</span> (<span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span> <span style="color:#a6e22e">ago</span>)   <span style="color:#ae81ff">17</span><span style="color:#a6e22e">h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">coredns</span><span style="color:#f92672">-</span><span style="color:#ae81ff">64897985</span><span style="color:#a6e22e">d</span><span style="color:#f92672">-</span><span style="color:#a6e22e">gtbp6</span>                    <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">1</span> (<span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span> <span style="color:#a6e22e">ago</span>)   <span style="color:#ae81ff">17</span><span style="color:#a6e22e">h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">etcd</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>                               <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">3</span> (<span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span> <span style="color:#a6e22e">ago</span>)   <span style="color:#ae81ff">17</span><span style="color:#a6e22e">h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">apiserver</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>                     <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">4</span> (<span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span> <span style="color:#a6e22e">ago</span>)   <span style="color:#ae81ff">17</span><span style="color:#a6e22e">h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">controller</span><span style="color:#f92672">-</span><span style="color:#a6e22e">manager</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>            <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">3</span> (<span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span> <span style="color:#a6e22e">ago</span>)   <span style="color:#ae81ff">17</span><span style="color:#a6e22e">h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">proxy</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#a6e22e">phdl</span>                           <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">1</span> (<span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span> <span style="color:#a6e22e">ago</span>)   <span style="color:#ae81ff">17</span><span style="color:#a6e22e">h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">proxy</span><span style="color:#f92672">-</span><span style="color:#a6e22e">kql69</span>                           <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">2</span> (<span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span> <span style="color:#a6e22e">ago</span>)   <span style="color:#ae81ff">15</span><span style="color:#a6e22e">h</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">scheduler</span><span style="color:#f92672">-</span><span style="color:#a6e22e">liaok8s</span>                     <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">5</span> (<span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span> <span style="color:#a6e22e">ago</span>)   <span style="color:#ae81ff">17</span><span style="color:#a6e22e">h</span></span></span></code></pre></div>
<p>å¦‚æœä»»æ„ä¸€ä¸ªå®¹å™¨å‡ºç°å¼‚å¸¸å¯ä»¥é€šè¿‡æŸ¥çœ‹eventå‘ç°é—®é¢˜</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">describe</span> <span style="color:#a6e22e">pod</span> <span style="color:#a6e22e">calico</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span><span style="color:#f92672">-</span><span style="color:#a6e22e">j2ffk</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">n</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system</span></span></span></code></pre></div>
<p>æˆ‘è¿™é‡Œä¹‹å‰æ²¡æœ‰ä¿®æ”¹calico.yamlç›´æ¥applyå¯¼è‡´å‡ºç°äº†ä¸€ä¸ªé—®é¢˜</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>  <span style="color:#a6e22e">Warning</span>  <span style="color:#a6e22e">Unhealthy</span>  <span style="color:#ae81ff">23</span><span style="color:#a6e22e">s</span> (<span style="color:#a6e22e">x3</span> <span style="color:#a6e22e">over</span> <span style="color:#ae81ff">25</span><span style="color:#a6e22e">s</span>)  <span style="color:#a6e22e">kubelet</span>            <span style="color:#a6e22e">Readiness</span> <span style="color:#a6e22e">probe</span> <span style="color:#a6e22e">failed</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">calico</span><span style="color:#f92672">/</span><span style="color:#a6e22e">node</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">ready</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">BIRD</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">ready</span><span style="color:#f92672">:</span> Error <span style="color:#a6e22e">querying</span> <span style="color:#a6e22e">BIRD</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">unable</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">connect</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">BIRDv4</span> <span style="color:#a6e22e">socket</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dial</span> <span style="color:#a6e22e">unix</span> <span style="color:#f92672">/</span><span style="color:#66d9ef">var</span><span style="color:#960050;background-color:#1e0010">/run/calico/bird.ctl: connect: connection refused</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Warning</span>  <span style="color:#a6e22e">Unhealthy</span>  <span style="color:#ae81ff">20</span><span style="color:#a6e22e">s</span>                <span style="color:#a6e22e">kubelet</span>            <span style="color:#a6e22e">Readiness</span> <span style="color:#a6e22e">probe</span> <span style="color:#a6e22e">failed</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2022</span><span style="color:#f92672">-</span><span style="color:#ae81ff">02</span><span style="color:#f92672">-</span><span style="color:#ae81ff">10</span> <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">15</span><span style="color:#f92672">:</span><span style="color:#ae81ff">15.807</span> [<span style="color:#a6e22e">INFO</span>][<span style="color:#ae81ff">250</span>] <span style="color:#a6e22e">confd</span><span style="color:#f92672">/</span><span style="color:#a6e22e">health</span>.<span style="color:#a6e22e">go</span> <span style="color:#ae81ff">180</span><span style="color:#f92672">:</span> Number <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">node</span>(<span style="color:#a6e22e">s</span>) <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">BGP</span> <span style="color:#a6e22e">peering</span> <span style="color:#a6e22e">established</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span></span></span></code></pre></div>
<p>è¿™ä¸ªé—®é¢˜å°±æ˜¯calicoé€šä¿¡æ— æ³•è¯†åˆ«ä¸»æœºé—´çœŸå®çš„ç‰©ç†ipå¼•èµ·çš„ï¼Œå¯é€šè¿‡å®‰è£…calicoctlè¯Šæ–­
å®‰è£…è¯·å‚è€ƒå®˜ç½‘ï¼šhttps://projectcalico.docs.tigera.io/maintenance/clis/calicoctl/install
æ­£ç¡®çš„ç»“æœä¸º
åœ¨masterèŠ‚ç‚¹ï¼Œpeer_addressä¸ºå¤šä¸ªä»èŠ‚ç‚¹çš„ipï¼Œä¸€ä¸ªä»èŠ‚ç‚¹ä¸€ä¸ªï¼ŒINFOä¸ºEstablished</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/usr/local/bin# calicoctl node status</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Calico</span> <span style="color:#a6e22e">process</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">running</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">IPv4</span> <span style="color:#a6e22e">BGP</span> <span style="color:#a6e22e">status</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+--------------+-------------------+-------+----------+-------------+</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#a6e22e">PEER</span> <span style="color:#a6e22e">ADDRESS</span> <span style="color:#f92672">|</span>     <span style="color:#a6e22e">PEER</span> <span style="color:#a6e22e">TYPE</span>     <span style="color:#f92672">|</span> <span style="color:#a6e22e">STATE</span> <span style="color:#f92672">|</span>  <span style="color:#a6e22e">SINCE</span>   <span style="color:#f92672">|</span>    <span style="color:#a6e22e">INFO</span>     <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+--------------+-------------------+-------+----------+-------------+</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.116</span>  <span style="color:#f92672">|</span> <span style="color:#a6e22e">node</span><span style="color:#f92672">-</span><span style="color:#a6e22e">to</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span> <span style="color:#a6e22e">mesh</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">up</span>    <span style="color:#f92672">|</span> <span style="color:#ae81ff">12</span><span style="color:#f92672">:</span><span style="color:#ae81ff">29</span><span style="color:#f92672">:</span><span style="color:#ae81ff">59</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">Established</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+--------------+-------------------+-------+----------+-------------+</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">IPv6</span> <span style="color:#a6e22e">BGP</span> <span style="color:#a6e22e">status</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">No</span> <span style="color:#a6e22e">IPv6</span> <span style="color:#a6e22e">peers</span> <span style="color:#a6e22e">found</span>.</span></span></code></pre></div>
<p>åœ¨workerèŠ‚ç‚¹,peer_addressä¸ºå¤šä¸ªä»èŠ‚ç‚¹çš„ipå’Œä¸»èŠ‚ç‚¹çš„ipï¼Œä¸€ä¸ªä»èŠ‚ç‚¹ä¸€ä¸ªï¼ŒINFOä¸ºEstablished</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">pve</span><span style="color:#f92672">-</span><span style="color:#a6e22e">tmpl</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/home/mainte# calicoctl node status</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Calico</span> <span style="color:#a6e22e">process</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">running</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">IPv4</span> <span style="color:#a6e22e">BGP</span> <span style="color:#a6e22e">status</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+--------------+-------------------+-------+----------+-------------+</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#a6e22e">PEER</span> <span style="color:#a6e22e">ADDRESS</span> <span style="color:#f92672">|</span>     <span style="color:#a6e22e">PEER</span> <span style="color:#a6e22e">TYPE</span>     <span style="color:#f92672">|</span> <span style="color:#a6e22e">STATE</span> <span style="color:#f92672">|</span>  <span style="color:#a6e22e">SINCE</span>   <span style="color:#f92672">|</span>    <span style="color:#a6e22e">INFO</span>     <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+--------------+-------------------+-------+----------+-------------+</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#ae81ff">10.10</span>.<span style="color:#ae81ff">0.115</span>  <span style="color:#f92672">|</span> <span style="color:#a6e22e">node</span><span style="color:#f92672">-</span><span style="color:#a6e22e">to</span><span style="color:#f92672">-</span><span style="color:#a6e22e">node</span> <span style="color:#a6e22e">mesh</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">up</span>    <span style="color:#f92672">|</span> <span style="color:#ae81ff">12</span><span style="color:#f92672">:</span><span style="color:#ae81ff">29</span><span style="color:#f92672">:</span><span style="color:#ae81ff">59</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">Established</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+--------------+-------------------+-------+----------+-------------+</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">IPv6</span> <span style="color:#a6e22e">BGP</span> <span style="color:#a6e22e">status</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">No</span> <span style="color:#a6e22e">IPv6</span> <span style="color:#a6e22e">peers</span> <span style="color:#a6e22e">found</span>.</span></span></code></pre></div>
<p>æ³¨æ„è¿™äº›ipå¦‚æœä¸æ˜¯ç‰©ç†ä¸»æœºçš„ipï¼Œ å˜æˆäº†æŸä¸ªç½‘å¡çš„å†…éƒ¨åœ°å€å°±ä¼šå‡ºç°é€šä¿¡é—®é¢˜ã€‚</p>
<blockquote>
<p>åœ¨ä¸»å’Œå·¥ä½œèŠ‚ç‚¹ä¸Šéƒ½ä¼šæœ‰ä¸ªtunl0çš„ç½‘å¡ï¼Œå·¥ä½œèŠ‚ç‚¹çš„tunl0çš„ipåœ°å€å°±æ˜¯podçš„èŠ‚ç‚¹ipæ®µ</p></blockquote>
<h3 id="æ— æ³•pingé€šclusteripå’ŒæœåŠ¡å">æ— æ³•pingé€šclusteripå’ŒæœåŠ¡å</h3>
<p>å› ä¸ºæˆ‘ä¹‹å‰é‡ç½®è¿‡å¤šæ¬¡é›†ç¾¤ï¼Œæ²¡æœ‰æŒ‡å®šå›ºå®šçš„pod ipæ®µï¼Œå¯¼è‡´masterå’ŒworkerèŠ‚ç‚¹tunl0çš„ipä¸åœ¨åŒä¸€ä¸ªç½‘æ®µï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸é€šè®¯ã€‚
<a href="#R-image-5975e1696fcf98f3b61aae7b83dfe13d" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_02.md.images/ea50b5931d1bc9996d7485dcb5b62604.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5975e1696fcf98f3b61aae7b83dfe13d"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_02.md.images/ea50b5931d1bc9996d7485dcb5b62604.png"></a>
æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªdnsutilsé•œåƒåœ¨kube-systemä¸‹ç”¨æ¥è¯Šæ–­ç½‘ç»œ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">apiVersion</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kind</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">metadata</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dnsutils</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spec</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">containers</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">dnsutils</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">image</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">mydlqclub</span><span style="color:#f92672">/</span><span style="color:#a6e22e">dnsutils</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1.3</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">imagePullPolicy</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">IfNotPresent</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">command</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;sleep&#34;</span>,<span style="color:#e6db74">&#34;3600&#34;</span>]</span></span></code></pre></div>
<p>é€šè¿‡ Kubectl å·¥å…·éƒ¨ç½² NDS å·¥å…·é•œåƒ
é€šè¿‡ Kubectl å·¥å…·ï¼Œå°†å¯¹ä¸Šé¢ DNS å·¥å…·é•œåƒéƒ¨ç½²åˆ° Kubernetes ä¸­ï¼š</p>
<p>-nï¼šæŒ‡å®šåº”ç”¨éƒ¨ç½²çš„ Namespace ç©ºé—´ã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$</span> <span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">create</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> <span style="color:#a6e22e">ndsutils</span>.<span style="color:#a6e22e">yaml</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">n</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system</span></span></span></code></pre></div>
<p>è¿›å…¥ DNS å·¥å…· Pod çš„å‘½ä»¤è¡Œ
ä¸Šé¢ DNS å·¥å…·å·²ç»éƒ¨ç½²å®Œæˆï¼Œæˆ‘ä»¬å¯ä¹Ÿé€šè¿‡ Kubectl å·¥å…·è¿›å…¥ Pod å‘½ä»¤è¡Œï¼Œç„¶åï¼Œä½¿ç”¨é‡Œé¢çš„ä¸€äº›å·¥å…·è¿›è¡Œé—®é¢˜åˆ†æï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š
execï¼šè®©æŒ‡å®š Pod å®¹å™¨æ‰§è¡ŒæŸäº›å‘½ä»¤ã€‚
-iï¼šå°†æ§åˆ¶å°å†…å®¹ä¼ å…¥åˆ°å®¹å™¨ã€‚
-tï¼šè¿›å…¥å®¹å™¨çš„ tty ä½¿ç”¨ bash å‘½ä»¤è¡Œã€‚
-nï¼šæŒ‡å®šä¸Šé¢éƒ¨ç½² DNS Pod æ‰€åœ¨çš„ Namespaceã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">$</span> <span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">exec</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">it</span> <span style="color:#a6e22e">dnsutils</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">bin</span><span style="color:#f92672">/</span><span style="color:#a6e22e">sh</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">n</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system</span></span></span></code></pre></div>
<p>é€šè¿‡ Ping å’Œ Nsloopup å‘½ä»¤æµ‹è¯•
è¿›å…¥å®¹å™¨ sh å‘½ä»¤è¡Œç•Œé¢åï¼Œå…ˆä½¿ç”¨ ping å‘½ä»¤æ¥åˆ†åˆ«æ¢æµ‹è§‚å¯Ÿæ˜¯å¦èƒ½å¤Ÿ ping é€šé›†ç¾¤å†…éƒ¨å’Œé›†ç¾¤å¤–éƒ¨çš„åœ°å€
é¦–å…ˆç¡®è®¤ä¸‹ndsutilsçš„ipåœ°å€ï¼š192.168.57.136å’Œç¬¬ä¸€ä¸ªcorednsç›¸åŒã€‚
è¿›å…¥å®¹å™¨å :</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/ # ping 192.168.57.136   coredns1èƒ½pingé€šï¼Œåœ¨åŒä¸€ä¸ªworkerèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">PING</span> <span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">57.136</span> (<span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">57.136</span>)<span style="color:#f92672">:</span> <span style="color:#ae81ff">56</span> <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">bytes</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">57.136</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0.058</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">57.136</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0.045</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">^</span><span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">---</span> <span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">57.136</span> <span style="color:#a6e22e">ping</span> <span style="color:#a6e22e">statistics</span> <span style="color:#f92672">---</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> <span style="color:#a6e22e">packets</span> <span style="color:#a6e22e">transmitted</span>, <span style="color:#ae81ff">2</span> <span style="color:#a6e22e">packets</span> <span style="color:#a6e22e">received</span>, <span style="color:#ae81ff">0</span><span style="color:#f92672">%</span> <span style="color:#a6e22e">packet</span> <span style="color:#a6e22e">loss</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">round</span><span style="color:#f92672">-</span><span style="color:#a6e22e">trip</span> <span style="color:#a6e22e">min</span><span style="color:#f92672">/</span><span style="color:#a6e22e">avg</span><span style="color:#f92672">/</span><span style="color:#a6e22e">max</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.045</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0.051</span><span style="color:#f92672">/</span><span style="color:#ae81ff">0.058</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/ # ping 192.168.134.132 masterå¯¹åº”çš„corednsæ— æ³•pingé€š</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">PING</span> <span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">134.132</span> (<span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">134.132</span>)<span style="color:#f92672">:</span> <span style="color:#ae81ff">56</span> <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">bytes</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">^</span><span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">---</span> <span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">134.132</span> <span style="color:#a6e22e">ping</span> <span style="color:#a6e22e">statistics</span> <span style="color:#f92672">---</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">11</span> <span style="color:#a6e22e">packets</span> <span style="color:#a6e22e">transmitted</span>, <span style="color:#ae81ff">0</span> <span style="color:#a6e22e">packets</span> <span style="color:#a6e22e">received</span>, <span style="color:#ae81ff">100</span><span style="color:#f92672">%</span> <span style="color:#a6e22e">packet</span> <span style="color:#a6e22e">loss</span></span></span></code></pre></div>
<p>æŸ¥çœ‹å®¹å™¨çš„/etc/resolv.confæ–‡ä»¶</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/ # more /etc/resolv.conf </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">nameserver</span> <span style="color:#ae81ff">10.96</span>.<span style="color:#ae81ff">0.10</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">search</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">svc</span>.<span style="color:#a6e22e">cluster</span>.<span style="color:#a6e22e">local</span> <span style="color:#a6e22e">svc</span>.<span style="color:#a6e22e">cluster</span>.<span style="color:#a6e22e">local</span> <span style="color:#a6e22e">cluster</span>.<span style="color:#a6e22e">local</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">options</span> <span style="color:#a6e22e">ndots</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span></span></span></code></pre></div>
<p>å‘ç°nameserveræŒ‡å‘çš„æ˜¯service=kube-dnsçš„é›†ç¾¤ip
<a href="#R-image-2dec1aff9f0063c630a1811ae612f250" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_02.md.images/4ebbedc30185c322871f9e63eaf6db9b.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-2dec1aff9f0063c630a1811ae612f250"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_02.md.images/4ebbedc30185c322871f9e63eaf6db9b.png"></a>
æ³¨æ„clusteripæ˜¯ä¸èƒ½pingçš„ å¯ä»¥é€šè¿‡ip:ç«¯å£ç»„åˆæ¥è®¿é—®ã€‚
æ­¤æ—¶pingä¸‹å¤–ç½‘ï¼Œä¸é€šçš„</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/ # ping www.baidu.com</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">^</span><span style="color:#a6e22e">C</span></span></span></code></pre></div>
<p>kube-dnsçš„serviceå®é™…æ˜¯è´Ÿè½½å‡è¡¡åˆ°ä¸¤ä¸ªcorednsä¸Šï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯é€šçš„æˆ‘ä»¬è®¾ç½®dnsæœåŠ¡æ˜¯è¿™ä¸ªé€šçš„è¯•è¯•</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">nameserver</span> <span style="color:#ae81ff">10.96</span>.<span style="color:#ae81ff">0.10</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">nameserver</span> <span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">57.138</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">search</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system</span>.<span style="color:#a6e22e">svc</span>.<span style="color:#a6e22e">cluster</span>.<span style="color:#a6e22e">local</span> <span style="color:#a6e22e">svc</span>.<span style="color:#a6e22e">cluster</span>.<span style="color:#a6e22e">local</span> <span style="color:#a6e22e">cluster</span>.<span style="color:#a6e22e">local</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">options</span> <span style="color:#a6e22e">ndots</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span></span></span></code></pre></div>
<p>å†æ¬¡æµ‹è¯•å‘ç°æ­£å¸¸</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/ # ping www.baidu.com</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">PING</span> <span style="color:#a6e22e">www</span>.<span style="color:#a6e22e">baidu</span>.<span style="color:#a6e22e">com</span> (<span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span>)<span style="color:#f92672">:</span> <span style="color:#ae81ff">56</span> <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">bytes</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">44.204</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">44.330</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">43.863</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">44.107</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">4</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">44.148</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">44.329</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">6</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">44.210</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">7</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">44.204</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">8</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">44.113</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">64</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">from</span> <span style="color:#ae81ff">110.242</span>.<span style="color:#ae81ff">68.4</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">seq</span><span style="color:#f92672">=</span><span style="color:#ae81ff">9</span> <span style="color:#a6e22e">ttl</span><span style="color:#f92672">=</span><span style="color:#ae81ff">52</span> <span style="color:#a6e22e">time</span><span style="color:#f92672">=</span><span style="color:#ae81ff">44.161</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">^</span><span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">---</span> <span style="color:#a6e22e">www</span>.<span style="color:#a6e22e">baidu</span>.<span style="color:#a6e22e">com</span> <span style="color:#a6e22e">ping</span> <span style="color:#a6e22e">statistics</span> <span style="color:#f92672">---</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span> <span style="color:#a6e22e">packets</span> <span style="color:#a6e22e">transmitted</span>, <span style="color:#ae81ff">10</span> <span style="color:#a6e22e">packets</span> <span style="color:#a6e22e">received</span>, <span style="color:#ae81ff">0</span><span style="color:#f92672">%</span> <span style="color:#a6e22e">packet</span> <span style="color:#a6e22e">loss</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">round</span><span style="color:#f92672">-</span><span style="color:#a6e22e">trip</span> <span style="color:#a6e22e">min</span><span style="color:#f92672">/</span><span style="color:#a6e22e">avg</span><span style="color:#f92672">/</span><span style="color:#a6e22e">max</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">43.863</span><span style="color:#f92672">/</span><span style="color:#ae81ff">44.166</span><span style="color:#f92672">/</span><span style="color:#ae81ff">44.330</span> <span style="color:#a6e22e">ms</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/ # ping nginx.default</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">PING</span> <span style="color:#a6e22e">nginx</span>.<span style="color:#66d9ef">default</span> (<span style="color:#ae81ff">10.99</span>.<span style="color:#ae81ff">35.228</span>)<span style="color:#f92672">:</span> <span style="color:#ae81ff">56</span> <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">bytes</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">^</span><span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">---</span> <span style="color:#a6e22e">nginx</span>.<span style="color:#66d9ef">default</span> <span style="color:#a6e22e">ping</span> <span style="color:#a6e22e">statistics</span> <span style="color:#f92672">---</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> <span style="color:#a6e22e">packets</span> <span style="color:#a6e22e">transmitted</span>, <span style="color:#ae81ff">0</span> <span style="color:#a6e22e">packets</span> <span style="color:#a6e22e">received</span>, <span style="color:#ae81ff">100</span><span style="color:#f92672">%</span> <span style="color:#a6e22e">packet</span> <span style="color:#a6e22e">loss</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/ # ping httpd.default</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">PING</span> <span style="color:#a6e22e">httpd</span>.<span style="color:#66d9ef">default</span> (<span style="color:#ae81ff">10.98</span>.<span style="color:#ae81ff">37.38</span>)<span style="color:#f92672">:</span> <span style="color:#ae81ff">56</span> <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">bytes</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">^</span><span style="color:#a6e22e">C</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/ # wget nginx.default   æ³¨æ„å±äºä¸¤ä¸ªä¸åŒçš„namespaceæ‰€ä»¥éœ€è¦åœ¨æœåŠ¡åç§°ååŠ ä¸Š.namesapce:ç«¯å£è®¿é—®ï¼Œipæ˜¯ä¸èƒ½ç›´æ¥pingé€šçš„ ä½†æ˜¯å¯ä»¥è·å–åˆ°dnsçš„åœ°å€</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Connecting</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">nginx</span>.<span style="color:#66d9ef">default</span> (<span style="color:#ae81ff">10.99</span>.<span style="color:#ae81ff">35.228</span><span style="color:#f92672">:</span><span style="color:#ae81ff">80</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">index</span>.<span style="color:#a6e22e">html</span>           <span style="color:#ae81ff">100</span><span style="color:#f92672">%</span> <span style="color:#f92672">|**********************************************************************************************************************************************************************************************|</span>   <span style="color:#ae81ff">615</span>   <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#a6e22e">ETA</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/ # more index.html</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;!</span><span style="color:#a6e22e">DOCTYPE</span> <span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">head</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">title</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Welcome</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">nginx</span><span style="color:#f92672">!&lt;</span><span style="color:#960050;background-color:#1e0010">/title&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">style</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">html</span> { <span style="color:#a6e22e">color</span><span style="color:#f92672">-</span><span style="color:#a6e22e">scheme</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">light</span> <span style="color:#a6e22e">dark</span>; }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">body</span> { <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">35</span><span style="color:#a6e22e">em</span>; <span style="color:#a6e22e">margin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span> <span style="color:#a6e22e">auto</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">font</span><span style="color:#f92672">-</span><span style="color:#a6e22e">family</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Tahoma</span>, <span style="color:#a6e22e">Verdana</span>, <span style="color:#a6e22e">Arial</span>, <span style="color:#a6e22e">sans</span><span style="color:#f92672">-</span><span style="color:#a6e22e">serif</span>; }
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/style&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/head&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">body</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">h1</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Welcome</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">nginx</span><span style="color:#f92672">!&lt;</span><span style="color:#960050;background-color:#1e0010">/h1&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">If</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">see</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">page</span>, <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">nginx</span> <span style="color:#a6e22e">web</span> <span style="color:#a6e22e">server</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">successfully</span> <span style="color:#a6e22e">installed</span> <span style="color:#a6e22e">and</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">working</span>. <span style="color:#a6e22e">Further</span> <span style="color:#a6e22e">configuration</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">required</span>.<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/p&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">For</span> <span style="color:#a6e22e">online</span> <span style="color:#a6e22e">documentation</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">support</span> <span style="color:#a6e22e">please</span> <span style="color:#a6e22e">refer</span> <span style="color:#a6e22e">to</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://nginx.org/&#34;</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">nginx</span>.<span style="color:#a6e22e">org</span><span style="color:#f92672">&lt;</span><span style="color:#e6db74">/a&gt;.&lt;br/</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Commercial</span> <span style="color:#a6e22e">support</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">available</span> <span style="color:#a6e22e">at</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://nginx.com/&#34;</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">nginx</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/a&gt;.&lt;/p&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span><span style="color:#f92672">&gt;&lt;</span><span style="color:#a6e22e">em</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Thank</span> <span style="color:#a6e22e">you</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">using</span> <span style="color:#a6e22e">nginx</span>.<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/em&gt;&lt;/p&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/body&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/html&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">/ # </span></span></span></code></pre></div>
<p>è¿™é‡Œå¯ä»¥æƒ³åˆ° ,æƒ³ç€æ˜¯å¦æˆ‘ä»¬éœ€è¦å°†podçš„ipå…¨éƒ¨éƒ½è®¾ç½®ä¸ºç›¸åŒçš„æ®µèƒ½è®¿é—®æ˜¯å¦å°±å¯è¡Œäº†ï¼Œé‡ç½®k8s,init
å¸¦ä¸Š&ndash;pod-network-cidr=10.244.0.0/16  å‘ç°ä¾ç„¶ä¸è¡Œï¼Œä¼šä¸æ˜¯æ˜¯corednsä¸åº”è¯¥åœ¨masterèŠ‚ç‚¹ä¸Šæœ‰ä¸ªpodçš„äº†ã€‚
é‡æ–°æŒ‰ç…§corednsï¼Œå‚è€ƒï¼š <a href="https://github.com/coredns/deployment/tree/master/kubernetes" rel="external" target="_blank">https://github.com/coredns/deployment/tree/master/kubernetes</a>
ä¸‹è½½è¿™ä¸¤ä¸ªæ–‡ä»¶</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">wget</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//raw.githubusercontent.com/coredns/deployment/master/kubernetes/coredns.yaml.sed
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">wget</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//raw.githubusercontent.com/coredns/deployment/master/kubernetes/deploy.sh
</span></span></span></code></pre></div>
<p>æ‰§è¡Œå‘½ä»¤(-iæŒ‡å®šçš„å‚æ•°æ˜¯kube-dns clusteridçš„åœ°å€ï¼Œé»˜è®¤æ˜¯10.96.0.10)ï¼Œ</p>
<blockquote>
<p>æ³¨æ„å…ˆæå‰åˆ é™¤kube-systemä¸‹çš„deploy=coredns,service=kube-dns</p></blockquote>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#66d9ef">delete</span> <span style="color:#a6e22e">deploy</span> <span style="color:#a6e22e">coredns</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">kubectl</span> <span style="color:#66d9ef">delete</span> <span style="color:#a6e22e">svc</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">dns</span>  
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">chmod</span> <span style="color:#f92672">+</span><span style="color:#a6e22e">x</span> .<span style="color:#f92672">/</span><span style="color:#a6e22e">deploy</span>.<span style="color:#a6e22e">sh</span> <span style="color:#f92672">&amp;&amp;</span> .<span style="color:#f92672">/</span><span style="color:#a6e22e">deploy</span>.<span style="color:#a6e22e">sh</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">i</span> <span style="color:#ae81ff">10.96</span>.<span style="color:#ae81ff">0.10</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">apply</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> <span style="color:#f92672">-</span></span></span></code></pre></div>
<p>å¦‚æœå‘½ä»¤æ‰§è¡Œç¼ºå°‘jqï¼Œæå‰ç”¨yumæˆ–è€…apt-getæˆ–è€…apkå®‰è£…ï¼Œé‡æ–°å®‰è£…å®Œæˆï¼Œåœ¨æµ‹è¯•ä¸€åˆ‡æ­£å¸¸äº†ï¼Œä½†æ˜¯è¿™ä¸ªå‘½ä»¤å®‰è£…åªæ˜¯äº§ç”Ÿäº†ä¸€ä¸ªcorednsçš„podï¼Œä¾ç„¶æœ‰ç‚¹ä¸çŸ¥æ‰€ä»¥ç„¶è™½ç„¶æ­£å¸¸è¿è¡Œï¼Œåç»­åœ¨æ–°å¢ä¸€ä¸ªworkerèŠ‚ç‚¹åœ¨æµ‹è¯•ä¸‹ä»–çš„serviceåˆ†å‘çš„é€»è¾‘ã€‚</p>
<h2 id="å‘å¸ƒæµ‹è¯•">å‘å¸ƒæµ‹è¯•</h2>
<p>ä¸»èŠ‚ç‚¹è¿è¡Œ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">run</span> <span style="color:#a6e22e">nginx</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">image</span><span style="color:#f92672">=</span><span style="color:#a6e22e">nginx</span></span></span></code></pre></div>
<p>æŸ¥çœ‹nginxçŠ¶æ€</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/usr/local/bin# kubectl get pods -o wide                     </span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">NAME</span>    <span style="color:#a6e22e">READY</span>   <span style="color:#a6e22e">STATUS</span>    <span style="color:#a6e22e">RESTARTS</span>      <span style="color:#a6e22e">AGE</span>   <span style="color:#a6e22e">IP</span>               <span style="color:#a6e22e">NODE</span>       <span style="color:#a6e22e">NOMINATED</span> <span style="color:#a6e22e">NODE</span>   <span style="color:#a6e22e">READINESS</span> <span style="color:#a6e22e">GATES</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">nginx</span>   <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">1</span> (<span style="color:#ae81ff">13</span><span style="color:#a6e22e">h</span> <span style="color:#a6e22e">ago</span>)   <span style="color:#ae81ff">14</span><span style="color:#a6e22e">h</span>   <span style="color:#ae81ff">192.168</span>.<span style="color:#ae81ff">57.130</span>   <span style="color:#a6e22e">pve</span><span style="color:#f92672">-</span><span style="color:#a6e22e">tmpl</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>           <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span></span></span></code></pre></div>
<p>æŸ¥çœ‹æ‰§è¡Œè¿‡ç¨‹ï¼ˆå¦‚æœreadyçŠ¶æ€ä¸€ç›´æ˜¯0ï¼‰</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">describe</span> <span style="color:#a6e22e">pod</span> <span style="color:#a6e22e">nginx</span></span></span></code></pre></div>
<p>é€šè¿‡pod ipè®¿é—®httpåœ°å€</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/usr/local/bin# curl 192.168.57.130</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;!</span><span style="color:#a6e22e">DOCTYPE</span> <span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">head</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">title</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Welcome</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">nginx</span><span style="color:#f92672">!&lt;</span><span style="color:#960050;background-color:#1e0010">/title&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">style</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">html</span> { <span style="color:#a6e22e">color</span><span style="color:#f92672">-</span><span style="color:#a6e22e">scheme</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">light</span> <span style="color:#a6e22e">dark</span>; }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">body</span> { <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">35</span><span style="color:#a6e22e">em</span>; <span style="color:#a6e22e">margin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span> <span style="color:#a6e22e">auto</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">font</span><span style="color:#f92672">-</span><span style="color:#a6e22e">family</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Tahoma</span>, <span style="color:#a6e22e">Verdana</span>, <span style="color:#a6e22e">Arial</span>, <span style="color:#a6e22e">sans</span><span style="color:#f92672">-</span><span style="color:#a6e22e">serif</span>; }
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/style&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/head&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">body</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">h1</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Welcome</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">nginx</span><span style="color:#f92672">!&lt;</span><span style="color:#960050;background-color:#1e0010">/h1&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">If</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">see</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">page</span>, <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">nginx</span> <span style="color:#a6e22e">web</span> <span style="color:#a6e22e">server</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">successfully</span> <span style="color:#a6e22e">installed</span> <span style="color:#a6e22e">and</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">working</span>. <span style="color:#a6e22e">Further</span> <span style="color:#a6e22e">configuration</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">required</span>.<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/p&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">For</span> <span style="color:#a6e22e">online</span> <span style="color:#a6e22e">documentation</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">support</span> <span style="color:#a6e22e">please</span> <span style="color:#a6e22e">refer</span> <span style="color:#a6e22e">to</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://nginx.org/&#34;</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">nginx</span>.<span style="color:#a6e22e">org</span><span style="color:#f92672">&lt;</span><span style="color:#e6db74">/a&gt;.&lt;br/</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Commercial</span> <span style="color:#a6e22e">support</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">available</span> <span style="color:#a6e22e">at</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://nginx.com/&#34;</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">nginx</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/a&gt;.&lt;/p&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span><span style="color:#f92672">&gt;&lt;</span><span style="color:#a6e22e">em</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Thank</span> <span style="color:#a6e22e">you</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">using</span> <span style="color:#a6e22e">nginx</span>.<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/em&gt;&lt;/p&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/body&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/html&gt;</span></span></span></code></pre></div>
<p>åˆ›å»ºservice</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/usr/local/bin# kubectl expose pod nginx --port=80</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">service</span><span style="color:#f92672">/</span><span style="color:#a6e22e">nginx</span> <span style="color:#a6e22e">exposed</span></span></span></code></pre></div>
<p>æŸ¥çœ‹service</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/usr/local/bin# kubectl get service nginx -o wide</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">NAME</span>    <span style="color:#a6e22e">TYPE</span>        <span style="color:#a6e22e">CLUSTER</span><span style="color:#f92672">-</span><span style="color:#a6e22e">IP</span>     <span style="color:#a6e22e">EXTERNAL</span><span style="color:#f92672">-</span><span style="color:#a6e22e">IP</span>   <span style="color:#a6e22e">PORT</span>(<span style="color:#a6e22e">S</span>)   <span style="color:#a6e22e">AGE</span>   <span style="color:#a6e22e">SELECTOR</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">nginx</span>   <span style="color:#a6e22e">ClusterIP</span>   <span style="color:#ae81ff">10.99</span>.<span style="color:#ae81ff">35.228</span>   <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">none</span><span style="color:#f92672">&gt;</span>        <span style="color:#ae81ff">80</span><span style="color:#f92672">/</span><span style="color:#a6e22e">TCP</span>    <span style="color:#ae81ff">46</span><span style="color:#a6e22e">s</span>   <span style="color:#a6e22e">run</span><span style="color:#f92672">=</span><span style="color:#a6e22e">nginx</span></span></span></code></pre></div>
<p>é€šè¿‡é›†ç¾¤ipè´Ÿè½½è®¿é—®å®¹å™¨</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">root</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">liaok8s</span><span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">/usr/local/bin# curl 10.99.35.228</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;!</span><span style="color:#a6e22e">DOCTYPE</span> <span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">head</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">title</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Welcome</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">nginx</span><span style="color:#f92672">!&lt;</span><span style="color:#960050;background-color:#1e0010">/title&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">style</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">html</span> { <span style="color:#a6e22e">color</span><span style="color:#f92672">-</span><span style="color:#a6e22e">scheme</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">light</span> <span style="color:#a6e22e">dark</span>; }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">body</span> { <span style="color:#a6e22e">width</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">35</span><span style="color:#a6e22e">em</span>; <span style="color:#a6e22e">margin</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span> <span style="color:#a6e22e">auto</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">font</span><span style="color:#f92672">-</span><span style="color:#a6e22e">family</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Tahoma</span>, <span style="color:#a6e22e">Verdana</span>, <span style="color:#a6e22e">Arial</span>, <span style="color:#a6e22e">sans</span><span style="color:#f92672">-</span><span style="color:#a6e22e">serif</span>; }
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/style&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/head&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">body</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">h1</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Welcome</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">nginx</span><span style="color:#f92672">!&lt;</span><span style="color:#960050;background-color:#1e0010">/h1&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">If</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">see</span> <span style="color:#66d9ef">this</span> <span style="color:#a6e22e">page</span>, <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">nginx</span> <span style="color:#a6e22e">web</span> <span style="color:#a6e22e">server</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">successfully</span> <span style="color:#a6e22e">installed</span> <span style="color:#a6e22e">and</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">working</span>. <span style="color:#a6e22e">Further</span> <span style="color:#a6e22e">configuration</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">required</span>.<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/p&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">For</span> <span style="color:#a6e22e">online</span> <span style="color:#a6e22e">documentation</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">support</span> <span style="color:#a6e22e">please</span> <span style="color:#a6e22e">refer</span> <span style="color:#a6e22e">to</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://nginx.org/&#34;</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">nginx</span>.<span style="color:#a6e22e">org</span><span style="color:#f92672">&lt;</span><span style="color:#e6db74">/a&gt;.&lt;br/</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Commercial</span> <span style="color:#a6e22e">support</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">available</span> <span style="color:#a6e22e">at</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://nginx.com/&#34;</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">nginx</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/a&gt;.&lt;/p&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">p</span><span style="color:#f92672">&gt;&lt;</span><span style="color:#a6e22e">em</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Thank</span> <span style="color:#a6e22e">you</span> <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">using</span> <span style="color:#a6e22e">nginx</span>.<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/em&gt;&lt;/p&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/body&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/html&gt;</span></span></span></code></pre></div>
<p>éªŒè¯dnsæ­£ç¡®æ€§
å®‰è£…ä¸€ä¸ªapahce httpdæœåŠ¡</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">run</span> <span style="color:#a6e22e">httpd</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">image</span> <span style="color:#a6e22e">httpd</span></span></span></code></pre></div>
<p>å®‰è£…æˆåŠŸåè¿›å…¥workerèŠ‚ç‚¹å®¿ä¸»æœºï¼Œè¿›å…¥nginxå®¹å™¨</p>
<h2 id="é‡æ–°å¯åŠ¨">é‡æ–°å¯åŠ¨</h2>
<p>å¦‚æœå› ä¸ºå¼‚å¸¸æ–­ç”µï¼Œå¯¼è‡´k8såœæ­¢ï¼Œå¯è®¾ç½®é›†ç¾¤è‡ªåŠ¨å¯åŠ¨
é…ç½®ç¯å¢ƒå˜é‡</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#centosä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>echo <span style="color:#e6db74">&#34;export KUBECONFIG=/etc/kubernetes/admin.conf&#34;</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">~/</span>.bash_profile <span style="color:#f92672">&amp;&amp;</span> source <span style="color:#f92672">~/</span>.bash_profile
</span></span><span style="display:flex;"><span><span style="color:#75715e">#debianä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>echo <span style="color:#e6db74">&#34;export KUBECONFIG=/etc/kubernetes/admin.conf&#34;</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">~/</span>.bashrc <span style="color:#f92672">&amp;&amp;</span> source <span style="color:#f92672">~/</span>.bashrc 
</span></span></code></pre></div>
<p>åœ¨ä¸»å·¥ä½œèŠ‚ç‚¹è®¾ç½®æœåŠ¡è‡ªå¯</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>systemctl enable kubelet <span style="color:#f92672">&amp;&amp;</span> systemctl restart kubelet</span></span></code></pre></div>
<blockquote>
<p>å¦‚æœkubeletæ— æ³•å¯åŠ¨ï¼Œå¾ˆå¤§å¯èƒ½æ˜¯swapæœªæ­£å¸¸å…³é—­ ï¼Œsudo swapoff -a å†è¯•è¯•</p></blockquote>
<h2 id="å›¾å½¢ç®¡ç†å·¥å…·">å›¾å½¢ç®¡ç†å·¥å…·</h2>
<p>Kubernetes å®¹å™¨ç¼–æ’å·²è¶Šæ¥è¶Šè¢«å¤§å®¶å…³æ³¨ï¼Œç„¶è€Œä½¿ç”¨ Kubernetes çš„é—¨æ§›å´ä¾ç„¶å¾ˆé«˜ï¼Œä¸»è¦ä½“ç°åœ¨è¿™å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>é›†ç¾¤çš„å®‰è£…å¤æ‚ï¼Œå‡ºé”™æ¦‚ç‡å¤§</li>
<li>Kubernetesç›¸è¾ƒäºå®¹å™¨åŒ–ï¼Œå¼•å…¥äº†è®¸å¤šæ–°çš„æ¦‚å¿µï¼Œå­¦ä¹ éš¾åº¦é«˜</li>
<li>éœ€è¦æ‰‹å·¥ç¼–å†™ YAML æ–‡ä»¶ï¼Œéš¾ä»¥åœ¨å¤šç¯å¢ƒä¸‹ç®¡ç†</li>
<li>ç¼ºå°‘å¥½çš„å®æˆ˜æ¡ˆä¾‹å¯ä»¥å‚è€ƒ</li>
</ul>
<p>Kuboardï¼Œæ˜¯ä¸€æ¬¾å…è´¹çš„ Kubernetes å›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼ŒKuboard åŠ›å›¾å¸®åŠ©ç”¨æˆ·å¿«é€Ÿåœ¨ Kubernetes ä¸Šè½åœ°å¾®æœåŠ¡ã€‚</p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<p>å¦‚æœæ‚¨å‚è€ƒ <a href="https://kuboard.cn" rel="external" target="_blank">https://kuboard.cn</a> ç½‘ç«™ä¸Šæä¾›çš„ Kubernetes å®‰è£…æ–‡æ¡£ï¼Œå¯åœ¨ master èŠ‚ç‚¹ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">apply</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//kuboard.cn/install-script/kuboard.yaml
</span></span></span></code></pre></div>
<p>æŸ¥çœ‹ Kuboard è¿è¡ŒçŠ¶æ€ï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">pods</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">l</span> <span style="color:#a6e22e">k8s</span>.<span style="color:#a6e22e">eip</span>.<span style="color:#a6e22e">work</span><span style="color:#f92672">/</span><span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#a6e22e">kuboard</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">n</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">NAME</span>                       <span style="color:#a6e22e">READY</span>   <span style="color:#a6e22e">STATUS</span>    <span style="color:#a6e22e">RESTARTS</span>   <span style="color:#a6e22e">AGE</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">kuboard</span><span style="color:#f92672">-</span><span style="color:#ae81ff">756</span><span style="color:#a6e22e">d46c4d4</span><span style="color:#f92672">-</span><span style="color:#a6e22e">qh6cm</span>   <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     <span style="color:#a6e22e">Running</span>   <span style="color:#ae81ff">0</span>          <span style="color:#ae81ff">101</span><span style="color:#a6e22e">m</span></span></span></code></pre></div>
<p>ç¡®ä¿kuboard å¤„äº Running çŠ¶æ€</p>
<h3 id="è·å–token">è·å–Token</h3>
<p>æ‚¨å¯ä»¥è·å¾—ç®¡ç†å‘˜ç”¨æˆ·ã€åªè¯»ç”¨æˆ·çš„Tokenã€‚
Kuboard æœ‰è®¡åˆ’å¼€å‘æƒé™è®¾ç½®çš„åŠŸèƒ½ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œå¦‚æœæ‚¨éœ€è¦æ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ï¼Œè¯·å‚è€ƒ <a href="https://www.kuboard.cn/learning/k8s-advanced/sec/rbac/example.html" rel="external" target="_blank">RBAC Example</a>
æ­¤Tokenæ‹¥æœ‰ ClusterAdmin çš„æƒé™ï¼Œå¯ä»¥æ‰§è¡Œæ‰€æœ‰æ“ä½œ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">kubectl</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">n</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system</span> <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">secret</span> <span style="color:#a6e22e">$</span>(<span style="color:#a6e22e">kubectl</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">n</span> <span style="color:#a6e22e">kube</span><span style="color:#f92672">-</span><span style="color:#a6e22e">system</span> <span style="color:#a6e22e">get</span> <span style="color:#a6e22e">secret</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">grep</span> <span style="color:#a6e22e">kuboard</span><span style="color:#f92672">-</span><span style="color:#a6e22e">user</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">awk</span> <span style="color:#e6db74">&#39;{print $1}&#39;</span>) <span style="color:#f92672">-</span><span style="color:#a6e22e">o</span> <span style="color:#a6e22e">go</span><span style="color:#f92672">-</span><span style="color:#a6e22e">template</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{{.data.token}}&#39;</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">base64</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">d</span></span></span></code></pre></div>
<p>Kuboard Service ä½¿ç”¨äº† NodePort çš„æ–¹å¼æš´éœ²æœåŠ¡ï¼ŒNodePort ä¸º 32567ï¼›æ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è®¿é—® Kuboardã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">http</span><span style="color:#f92672">:</span><span style="color:#75715e">//ä»»æ„ä¸€ä¸ªWorkerèŠ‚ç‚¹çš„IPåœ°å€:32567/
</span></span></span></code></pre></div>
<p>è¾“å…¥å‰ä¸€æ­¥éª¤ä¸­è·å¾—çš„ tokenï¼Œå¯è¿›å…¥ Kuboard é›†ç¾¤æ¦‚è§ˆé¡µ
<a href="#R-image-1884b8754721806c9a7ea6fc9cc00384" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_02.md.images/8723bcdb310516438947fcbbd1b88149.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-1884b8754721806c9a7ea6fc9cc00384"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_02.md.images/8723bcdb310516438947fcbbd1b88149.png"></a></p>
<h3 id="kuboard-v3x">Kuboard v3.x</h3>
<p>Kuboard v3.x æ”¯æŒ Kubernetes å¤šé›†ç¾¤ç®¡ç†ã€‚å¦‚æœæ‚¨ä» Kuboard v1.0.x æˆ–è€… Kuboard v2.0.x å‡çº§åˆ° Kuboardï¼Œè¯·æ³¨æ„ï¼š</p>
<ul>
<li>æ‚¨å¯ä»¥åŒæ—¶ä½¿ç”¨ Kuboard v3.x å’Œ Kuboard v2.0.xï¼›</li>
<li>Kuboard v3.x æ”¯æŒ amd64 (x86) æ¶æ„å’Œ arm68 (armv8) æ¶æ„çš„ CPUï¼›
å¯å‚è€ƒkuboardå®˜ç½‘ï¼šhttps://kuboard.cn/install/v3/install-in-k8s.html
åœ¨çº¿å®‰è£…ï¼š</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">kubectl</span> <span style="color:#a6e22e">apply</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">f</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//addons.kuboard.cn/kuboard/kuboard-v3.yaml
</span></span></span></code></pre></div>
<p><a href="#R-image-a02ab83fd77d9b1e34f7243665de2526" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_02.md.images/3b29a3bd36e39927fdb7dcc2688efd36.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-a02ab83fd77d9b1e34f7243665de2526"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_02.md.images/3b29a3bd36e39927fdb7dcc2688efd36.png"></a>
è®¿é—® Kuboard
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é“¾æ¥ http://your-node-ip-address:30080</p>
<p>è¾“å…¥åˆå§‹ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ç™»å½•</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">ç”¨æˆ·å</span><span style="color:#960050;background-color:#1e0010">ï¼š</span> <span style="color:#a6e22e">admin</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">å¯†ç </span><span style="color:#960050;background-color:#1e0010">ï¼š</span> <span style="color:#a6e22e">Kuboard123</span></span></span></code></pre></div>

  <footer class="footline">
              <i class='fa-fw fas fa-calendar'></i> Sep 18, 2025
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/docs/index.html">
            <div class="logo-title">liaomin416100569åšå®¢</div>
          </a>
        </div>
        <search><form action="/docs/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/docs/index.html"><a class="padding" href="/docs/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/docs/programming/index.html"><a class="padding" href="/docs/programming/index.html">ç¼–ç¨‹å¼€å‘</a><ul id="R-subsections-e3fc01b477dbaf64a8f5013a3dab5c5b" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/docs/devops/index.html"><a class="padding" href="/docs/devops/index.html">è¿ç»´ä¸€ä½“åŒ–</a><ul id="R-subsections-389d4feb4920b919bcbc0b1e9947dace" class="collapsible-menu">
            <li class="parent alwaysopen " data-nav-id="/docs/devops/kubernetes/index.html"><a class="padding" href="/docs/devops/kubernetes/index.html">kubernetes</a><ul id="R-subsections-a6d9d4850f81ae033d42cdaa03dad084" class="collapsible-menu">
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_01/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_01/index.html">K8SäºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰</a></li>
            <li class="active " data-nav-id="/docs/devops/kubernetes/k8s_dev_02/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_02/index.html">K8SäºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤</a></li>
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_03/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_03/index.html">K8SäºŒæ¬¡å¼€å‘03-CRDèµ„æºè¯¦è§£</a></li>
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_04/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_04/index.html">K8SäºŒæ¬¡å¼€å‘04-è‡ªå®šä¹‰operatorï¼ˆoperator-sdkè°ƒè¯•ï¼‰</a></li>
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_05/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_05/index.html">K8SäºŒæ¬¡å¼€å‘05-ä½¿ç”¨clientgoè‡ªå®šä¹‰ingresscontroller</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/docs/devops/networking/index.html"><a class="padding" href="/docs/devops/networking/index.html">ç½‘ç»œæŠ€æœ¯</a><ul id="R-subsections-bd6b3f75e8269a91d29691b78d3bac17" class="collapsible-menu"></ul></li></ul></li>
            <li class="" data-nav-id="/docs/security/index.html"><a class="padding" href="/docs/security/index.html">å®‰å…¨æ”»é˜²</a><ul id="R-subsections-66815ecaaecfc1c209e5637d03b258b2" class="collapsible-menu"></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/docs/js/clipboard/clipboard.min.js?1758355652" defer></script>
    <script src="/docs/js/perfect-scrollbar/perfect-scrollbar.min.js?1758355652" defer></script>
    <script src="/docs/js/theme.min.js?1758355652" defer></script>
  </body>
</html>
