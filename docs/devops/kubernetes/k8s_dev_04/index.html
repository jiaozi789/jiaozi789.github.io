<!DOCTYPE html>
<html lang="zh" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.150.0">
    <meta name="generator" content="Relearn 8.0.1+b23cf6629eada0c2802f34ae4012e04343497862">
    <meta name="description" content="Operator æ˜¯ Kubernetes çš„æ‰©å±•è½¯ä»¶ï¼Œå®ƒåˆ©ç”¨ å®šåˆ¶èµ„æº ç®¡ç†åº”ç”¨åŠå…¶ç»„ä»¶ã€‚ Operator éµå¾ª Kubernetes çš„ç†å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨æ§åˆ¶å™¨ æ–¹é¢ã€‚ Operatoræ“ä½œé‚£äº›æœ‰çŠ¶æ€çš„åŸºç¡€è®¾æ–½æœåŠ¡ï¼ŒåŒ…æ‹¬ï¼šç»„ä»¶å‡çº§ã€èŠ‚ç‚¹æ¢å¤ã€è°ƒæ•´é›†ç¾¤è§„æ¨¡ã€‚ä¸€ä¸ªç†æƒ³åŒ–çš„è¿ç»´å¹³å°å¿…é¡»æ˜¯Operatorè‡ªå·±ç»´æŠ¤æœ‰çŠ¶æ€åº”ç”¨ï¼Œå¹¶å°†äººå·¥å¹²é¢„é™ä½åˆ°æœ€ä½é™åº¦
ä»€ä¹ˆæ˜¯Operatorï¼Ÿ ä¸ºäº†ç†è§£ä»€ä¹ˆæ˜¯Operatorï¼Œè®©æˆ‘ä»¬å…ˆå¤ä¹ ä¸€ä¸‹Kubernetesã€‚Kuberneteså®é™…æ˜¯æœŸæœ›çŠ¶æ€ç®¡ç†å™¨ã€‚å…ˆåœ¨Kubernetesä¸­æŒ‡å®šåº”ç”¨ç¨‹åºæœŸæœ›çŠ¶æ€ï¼ˆå®ä¾‹æ•°ï¼Œç£ç›˜ç©ºé—´ï¼Œé•œåƒç­‰ï¼‰ï¼Œç„¶åå®ƒä¼šå°è¯•æŠŠåº”ç”¨ç»´æŒåœ¨è¿™ç§çŠ¶æ€ã€‚Kubernetesçš„æ§åˆ¶å¹³é¢è¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šï¼Œå®ƒåŒ…å«æ•°ä¸ªcontrollerä»¥è°ƒå’Œåº”ç”¨è¾¾åˆ°æœŸæœ›çŠ¶æ€ï¼š
æ£€æŸ¥å½“å‰çš„å®é™…çŠ¶æ€ï¼ˆPodã€Deploymentç­‰ï¼‰ å°†å®é™…çŠ¶æ€ä¸specæœŸæœ›çŠ¶æ€è¿›è¡Œæ¯”è¾ƒ å¦‚æœå®é™…çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¸ä¸€è‡´ï¼Œcontrollerå°†ä¼šå°è¯•åè°ƒå®é™…çŠ¶æ€ä»¥è¾¾åˆ°ä¸€è‡´ æ¯”å¦‚ï¼Œé€šè¿‡RSå®šä¹‰Podæ‹¥æœ‰3ä¸ªå‰¯æœ¬ã€‚å½“å…¶ä¸­ä¸€ä¸ªPod downæ‰æ—¶ï¼ŒKubernetes controlleré€šè¿‡wacth APIå‘ç°æœŸæœ›è¿è¡Œ3ä¸ªå‰¯æœ¬ï¼Œè€Œå®é™…åªæœ‰2ä¸ªå‰¯æœ¬åœ¨è¿è¡Œã€‚äºæ˜¯å®ƒæ–°åˆ›å»ºå‡ºä¸€ä¸ªPodå®ä¾‹ã€‚
controllerä½œç”¨ å¦‚å›¾æ‰€ç¤ºï¼Œcontrolleråœ¨Kubernetesä¸­å‘æŒ¥çš„ä½œç”¨ã€‚ é€šè¿‡Kubectlå‘½ä»¤å‘é€å¯¹è±¡specå®šä¹‰ï¼ˆPodï¼ŒDeploymentç­‰ï¼‰åˆ°Kubernetes MasterèŠ‚ç‚¹çš„APIæœåŠ¡ MasterèŠ‚ç‚¹è°ƒåº¦å¯¹è±¡è¿è¡Œ ä¸€æ—¦å¯¹è±¡è¿è¡Œï¼Œcontrollerä¼šæŒç»­æ£€æŸ¥å¯¹è±¡å¹¶æ ¹æ®specåè°ƒå®é™…æƒ…å†µ é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒKuberneteséå¸¸é€‚åˆç»´æŠ¤æ— çŠ¶æ€åº”ç”¨ã€‚ä½†å®ƒæœ¬èº«çš„èµ„æºç±»å‹ï¼ˆPodï¼ŒDeploymentsï¼ŒNamespacesï¼ŒServicesï¼ŒDaemonSetsç­‰ï¼‰æ¯”è¾ƒæœ‰é™ã€‚è™½ç„¶æ¯ç§èµ„æºç±»å‹éƒ½é¢„å®šäº†è¡Œä¸ºåŠåè°ƒæ–¹å¼ï¼Œä½†å®ƒä»¬çš„å¤„ç†æ–¹å¼æ²¡æœ‰å¤šå¤§å·®åˆ«ã€‚ ç°åœ¨ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨æ›´å¤æ‚å¹¶éœ€è¦æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œä»¥è¾¾åˆ°æœŸæœ›çš„è¿è¡ŒçŠ¶æ€ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ
ä¸¾ä¸€ä¸ªæœ‰çŠ¶æ€åº”ç”¨çš„ä¾‹å­ã€‚å‡å¦‚ä¸€ä¸ªæ•°æ®åº“åº”ç”¨è¿è¡Œåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚å¦‚æœè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œåˆ™éœ€è¦æŒ‰ç…§ç‰¹å®šæ­¥éª¤ä»ç‰¹å®šå¿«ç…§ä¸­åŠ è½½æ•°æ®ã€‚ä½¿ç”¨åŸç”ŸKuberneteså¯¹è±¡ç±»å‹å’Œcontrolleråˆ™éš¾ä»¥å®ç°ã€‚æˆ–è€…ä¸ºæœ‰çŠ¶æ€åº”ç”¨ç¨‹åºæ‰©å±•èŠ‚ç‚¹ï¼Œå‡çº§åˆ°æ–°ç‰ˆæœ¬æˆ–ç¾éš¾æ¢å¤ã€‚è¿™äº›ç±»å‹çš„æ“ä½œé€šå¸¸éœ€è¦éå¸¸å…·ä½“çš„æ­¥éª¤ï¼Œå¹¶ä¸”é€šå¸¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚
controllerç³»ç»Ÿç»“æ„ ä½¿ç”¨ CRD å®šåˆ¶èµ„æºåï¼Œä»…ä»…æ˜¯è®© Kubernetes èƒ½å¤Ÿè¯†åˆ«å®šåˆ¶èµ„æºçš„èº«ä»½ã€‚åˆ›å»ºå®šåˆ¶èµ„æºå®ä¾‹åï¼ŒKubernetes åªä¼šå°†åˆ›å»ºçš„å®ä¾‹å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸ä¼šè§¦å‘ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚åœ¨ æ•°æ®åº“ä¿å­˜å®šåˆ¶èµ„æºå®ä¾‹æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå¦‚æœéœ€è¦è¿›è¡Œä¸šåŠ¡é€»è¾‘æ§åˆ¶ï¼Œå°±éœ€è¦åˆ›å»ºæ§åˆ¶å™¨ã€‚
Controller çš„ä½œç”¨å°±æ˜¯ç›‘å¬æŒ‡å®šå¯¹è±¡çš„æ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹ç­‰å˜åŒ–ï¼Œå¹¶é’ˆå¯¹è¿™äº›å˜åŒ–åšå‡ºç›¸åº”çš„å“åº”ï¼Œå…³äº Controller çš„è¯¦ç»†è®¾è®¡ï¼Œå¯ä»¥å‚è€ƒ Harry (Lei) Zhang è€å¸ˆåœ¨ twitter ä¸Šçš„åˆ†äº«ï¼ŒåŸºæœ¬æ¶æ„å›¾å¦‚ä¸‹ï¼š å›¾ä¸­å¯çœ‹å‡ºï¼Œå®šåˆ¶èµ„æºå®ä¾‹çš„å˜åŒ–ä¼šé€šè¿‡ Informer å­˜å…¥ WorkQueueï¼Œä¹‹å Controller ä¼šæ¶ˆè´¹ WorkQueueï¼Œå¹¶å¯¹å…¶ä¸­çš„æ•°æ®åšå‡ºä¸šåŠ¡å“åº”ã€‚">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="K8SäºŒæ¬¡å¼€å‘04-è‡ªå®šä¹‰operatorï¼ˆoperator-sdkè°ƒè¯•ï¼‰ :: liaomin416100569åšå®¢">
    <meta name="twitter:description" content="Operator æ˜¯ Kubernetes çš„æ‰©å±•è½¯ä»¶ï¼Œå®ƒåˆ©ç”¨ å®šåˆ¶èµ„æº ç®¡ç†åº”ç”¨åŠå…¶ç»„ä»¶ã€‚ Operator éµå¾ª Kubernetes çš„ç†å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨æ§åˆ¶å™¨ æ–¹é¢ã€‚ Operatoræ“ä½œé‚£äº›æœ‰çŠ¶æ€çš„åŸºç¡€è®¾æ–½æœåŠ¡ï¼ŒåŒ…æ‹¬ï¼šç»„ä»¶å‡çº§ã€èŠ‚ç‚¹æ¢å¤ã€è°ƒæ•´é›†ç¾¤è§„æ¨¡ã€‚ä¸€ä¸ªç†æƒ³åŒ–çš„è¿ç»´å¹³å°å¿…é¡»æ˜¯Operatorè‡ªå·±ç»´æŠ¤æœ‰çŠ¶æ€åº”ç”¨ï¼Œå¹¶å°†äººå·¥å¹²é¢„é™ä½åˆ°æœ€ä½é™åº¦
ä»€ä¹ˆæ˜¯Operatorï¼Ÿ ä¸ºäº†ç†è§£ä»€ä¹ˆæ˜¯Operatorï¼Œè®©æˆ‘ä»¬å…ˆå¤ä¹ ä¸€ä¸‹Kubernetesã€‚Kuberneteså®é™…æ˜¯æœŸæœ›çŠ¶æ€ç®¡ç†å™¨ã€‚å…ˆåœ¨Kubernetesä¸­æŒ‡å®šåº”ç”¨ç¨‹åºæœŸæœ›çŠ¶æ€ï¼ˆå®ä¾‹æ•°ï¼Œç£ç›˜ç©ºé—´ï¼Œé•œåƒç­‰ï¼‰ï¼Œç„¶åå®ƒä¼šå°è¯•æŠŠåº”ç”¨ç»´æŒåœ¨è¿™ç§çŠ¶æ€ã€‚Kubernetesçš„æ§åˆ¶å¹³é¢è¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šï¼Œå®ƒåŒ…å«æ•°ä¸ªcontrollerä»¥è°ƒå’Œåº”ç”¨è¾¾åˆ°æœŸæœ›çŠ¶æ€ï¼š
æ£€æŸ¥å½“å‰çš„å®é™…çŠ¶æ€ï¼ˆPodã€Deploymentç­‰ï¼‰ å°†å®é™…çŠ¶æ€ä¸specæœŸæœ›çŠ¶æ€è¿›è¡Œæ¯”è¾ƒ å¦‚æœå®é™…çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¸ä¸€è‡´ï¼Œcontrollerå°†ä¼šå°è¯•åè°ƒå®é™…çŠ¶æ€ä»¥è¾¾åˆ°ä¸€è‡´ æ¯”å¦‚ï¼Œé€šè¿‡RSå®šä¹‰Podæ‹¥æœ‰3ä¸ªå‰¯æœ¬ã€‚å½“å…¶ä¸­ä¸€ä¸ªPod downæ‰æ—¶ï¼ŒKubernetes controlleré€šè¿‡wacth APIå‘ç°æœŸæœ›è¿è¡Œ3ä¸ªå‰¯æœ¬ï¼Œè€Œå®é™…åªæœ‰2ä¸ªå‰¯æœ¬åœ¨è¿è¡Œã€‚äºæ˜¯å®ƒæ–°åˆ›å»ºå‡ºä¸€ä¸ªPodå®ä¾‹ã€‚
controllerä½œç”¨ å¦‚å›¾æ‰€ç¤ºï¼Œcontrolleråœ¨Kubernetesä¸­å‘æŒ¥çš„ä½œç”¨ã€‚ é€šè¿‡Kubectlå‘½ä»¤å‘é€å¯¹è±¡specå®šä¹‰ï¼ˆPodï¼ŒDeploymentç­‰ï¼‰åˆ°Kubernetes MasterèŠ‚ç‚¹çš„APIæœåŠ¡ MasterèŠ‚ç‚¹è°ƒåº¦å¯¹è±¡è¿è¡Œ ä¸€æ—¦å¯¹è±¡è¿è¡Œï¼Œcontrollerä¼šæŒç»­æ£€æŸ¥å¯¹è±¡å¹¶æ ¹æ®specåè°ƒå®é™…æƒ…å†µ é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒKuberneteséå¸¸é€‚åˆç»´æŠ¤æ— çŠ¶æ€åº”ç”¨ã€‚ä½†å®ƒæœ¬èº«çš„èµ„æºç±»å‹ï¼ˆPodï¼ŒDeploymentsï¼ŒNamespacesï¼ŒServicesï¼ŒDaemonSetsç­‰ï¼‰æ¯”è¾ƒæœ‰é™ã€‚è™½ç„¶æ¯ç§èµ„æºç±»å‹éƒ½é¢„å®šäº†è¡Œä¸ºåŠåè°ƒæ–¹å¼ï¼Œä½†å®ƒä»¬çš„å¤„ç†æ–¹å¼æ²¡æœ‰å¤šå¤§å·®åˆ«ã€‚ ç°åœ¨ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨æ›´å¤æ‚å¹¶éœ€è¦æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œä»¥è¾¾åˆ°æœŸæœ›çš„è¿è¡ŒçŠ¶æ€ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ
ä¸¾ä¸€ä¸ªæœ‰çŠ¶æ€åº”ç”¨çš„ä¾‹å­ã€‚å‡å¦‚ä¸€ä¸ªæ•°æ®åº“åº”ç”¨è¿è¡Œåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚å¦‚æœè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œåˆ™éœ€è¦æŒ‰ç…§ç‰¹å®šæ­¥éª¤ä»ç‰¹å®šå¿«ç…§ä¸­åŠ è½½æ•°æ®ã€‚ä½¿ç”¨åŸç”ŸKuberneteså¯¹è±¡ç±»å‹å’Œcontrolleråˆ™éš¾ä»¥å®ç°ã€‚æˆ–è€…ä¸ºæœ‰çŠ¶æ€åº”ç”¨ç¨‹åºæ‰©å±•èŠ‚ç‚¹ï¼Œå‡çº§åˆ°æ–°ç‰ˆæœ¬æˆ–ç¾éš¾æ¢å¤ã€‚è¿™äº›ç±»å‹çš„æ“ä½œé€šå¸¸éœ€è¦éå¸¸å…·ä½“çš„æ­¥éª¤ï¼Œå¹¶ä¸”é€šå¸¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚
controllerç³»ç»Ÿç»“æ„ ä½¿ç”¨ CRD å®šåˆ¶èµ„æºåï¼Œä»…ä»…æ˜¯è®© Kubernetes èƒ½å¤Ÿè¯†åˆ«å®šåˆ¶èµ„æºçš„èº«ä»½ã€‚åˆ›å»ºå®šåˆ¶èµ„æºå®ä¾‹åï¼ŒKubernetes åªä¼šå°†åˆ›å»ºçš„å®ä¾‹å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸ä¼šè§¦å‘ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚åœ¨ æ•°æ®åº“ä¿å­˜å®šåˆ¶èµ„æºå®ä¾‹æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå¦‚æœéœ€è¦è¿›è¡Œä¸šåŠ¡é€»è¾‘æ§åˆ¶ï¼Œå°±éœ€è¦åˆ›å»ºæ§åˆ¶å™¨ã€‚
Controller çš„ä½œç”¨å°±æ˜¯ç›‘å¬æŒ‡å®šå¯¹è±¡çš„æ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹ç­‰å˜åŒ–ï¼Œå¹¶é’ˆå¯¹è¿™äº›å˜åŒ–åšå‡ºç›¸åº”çš„å“åº”ï¼Œå…³äº Controller çš„è¯¦ç»†è®¾è®¡ï¼Œå¯ä»¥å‚è€ƒ Harry (Lei) Zhang è€å¸ˆåœ¨ twitter ä¸Šçš„åˆ†äº«ï¼ŒåŸºæœ¬æ¶æ„å›¾å¦‚ä¸‹ï¼š å›¾ä¸­å¯çœ‹å‡ºï¼Œå®šåˆ¶èµ„æºå®ä¾‹çš„å˜åŒ–ä¼šé€šè¿‡ Informer å­˜å…¥ WorkQueueï¼Œä¹‹å Controller ä¼šæ¶ˆè´¹ WorkQueueï¼Œå¹¶å¯¹å…¶ä¸­çš„æ•°æ®åšå‡ºä¸šåŠ¡å“åº”ã€‚">
    <meta property="og:url" content="https://jiaozi789.github.io/docs/devops/kubernetes/k8s_dev_04/index.html">
    <meta property="og:site_name" content="liaomin416100569åšå®¢">
    <meta property="og:title" content="K8SäºŒæ¬¡å¼€å‘04-è‡ªå®šä¹‰operatorï¼ˆoperator-sdkè°ƒè¯•ï¼‰ :: liaomin416100569åšå®¢">
    <meta property="og:description" content="Operator æ˜¯ Kubernetes çš„æ‰©å±•è½¯ä»¶ï¼Œå®ƒåˆ©ç”¨ å®šåˆ¶èµ„æº ç®¡ç†åº”ç”¨åŠå…¶ç»„ä»¶ã€‚ Operator éµå¾ª Kubernetes çš„ç†å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨æ§åˆ¶å™¨ æ–¹é¢ã€‚ Operatoræ“ä½œé‚£äº›æœ‰çŠ¶æ€çš„åŸºç¡€è®¾æ–½æœåŠ¡ï¼ŒåŒ…æ‹¬ï¼šç»„ä»¶å‡çº§ã€èŠ‚ç‚¹æ¢å¤ã€è°ƒæ•´é›†ç¾¤è§„æ¨¡ã€‚ä¸€ä¸ªç†æƒ³åŒ–çš„è¿ç»´å¹³å°å¿…é¡»æ˜¯Operatorè‡ªå·±ç»´æŠ¤æœ‰çŠ¶æ€åº”ç”¨ï¼Œå¹¶å°†äººå·¥å¹²é¢„é™ä½åˆ°æœ€ä½é™åº¦
ä»€ä¹ˆæ˜¯Operatorï¼Ÿ ä¸ºäº†ç†è§£ä»€ä¹ˆæ˜¯Operatorï¼Œè®©æˆ‘ä»¬å…ˆå¤ä¹ ä¸€ä¸‹Kubernetesã€‚Kuberneteså®é™…æ˜¯æœŸæœ›çŠ¶æ€ç®¡ç†å™¨ã€‚å…ˆåœ¨Kubernetesä¸­æŒ‡å®šåº”ç”¨ç¨‹åºæœŸæœ›çŠ¶æ€ï¼ˆå®ä¾‹æ•°ï¼Œç£ç›˜ç©ºé—´ï¼Œé•œåƒç­‰ï¼‰ï¼Œç„¶åå®ƒä¼šå°è¯•æŠŠåº”ç”¨ç»´æŒåœ¨è¿™ç§çŠ¶æ€ã€‚Kubernetesçš„æ§åˆ¶å¹³é¢è¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šï¼Œå®ƒåŒ…å«æ•°ä¸ªcontrollerä»¥è°ƒå’Œåº”ç”¨è¾¾åˆ°æœŸæœ›çŠ¶æ€ï¼š
æ£€æŸ¥å½“å‰çš„å®é™…çŠ¶æ€ï¼ˆPodã€Deploymentç­‰ï¼‰ å°†å®é™…çŠ¶æ€ä¸specæœŸæœ›çŠ¶æ€è¿›è¡Œæ¯”è¾ƒ å¦‚æœå®é™…çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¸ä¸€è‡´ï¼Œcontrollerå°†ä¼šå°è¯•åè°ƒå®é™…çŠ¶æ€ä»¥è¾¾åˆ°ä¸€è‡´ æ¯”å¦‚ï¼Œé€šè¿‡RSå®šä¹‰Podæ‹¥æœ‰3ä¸ªå‰¯æœ¬ã€‚å½“å…¶ä¸­ä¸€ä¸ªPod downæ‰æ—¶ï¼ŒKubernetes controlleré€šè¿‡wacth APIå‘ç°æœŸæœ›è¿è¡Œ3ä¸ªå‰¯æœ¬ï¼Œè€Œå®é™…åªæœ‰2ä¸ªå‰¯æœ¬åœ¨è¿è¡Œã€‚äºæ˜¯å®ƒæ–°åˆ›å»ºå‡ºä¸€ä¸ªPodå®ä¾‹ã€‚
controllerä½œç”¨ å¦‚å›¾æ‰€ç¤ºï¼Œcontrolleråœ¨Kubernetesä¸­å‘æŒ¥çš„ä½œç”¨ã€‚ é€šè¿‡Kubectlå‘½ä»¤å‘é€å¯¹è±¡specå®šä¹‰ï¼ˆPodï¼ŒDeploymentç­‰ï¼‰åˆ°Kubernetes MasterèŠ‚ç‚¹çš„APIæœåŠ¡ MasterèŠ‚ç‚¹è°ƒåº¦å¯¹è±¡è¿è¡Œ ä¸€æ—¦å¯¹è±¡è¿è¡Œï¼Œcontrollerä¼šæŒç»­æ£€æŸ¥å¯¹è±¡å¹¶æ ¹æ®specåè°ƒå®é™…æƒ…å†µ é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒKuberneteséå¸¸é€‚åˆç»´æŠ¤æ— çŠ¶æ€åº”ç”¨ã€‚ä½†å®ƒæœ¬èº«çš„èµ„æºç±»å‹ï¼ˆPodï¼ŒDeploymentsï¼ŒNamespacesï¼ŒServicesï¼ŒDaemonSetsç­‰ï¼‰æ¯”è¾ƒæœ‰é™ã€‚è™½ç„¶æ¯ç§èµ„æºç±»å‹éƒ½é¢„å®šäº†è¡Œä¸ºåŠåè°ƒæ–¹å¼ï¼Œä½†å®ƒä»¬çš„å¤„ç†æ–¹å¼æ²¡æœ‰å¤šå¤§å·®åˆ«ã€‚ ç°åœ¨ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨æ›´å¤æ‚å¹¶éœ€è¦æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œä»¥è¾¾åˆ°æœŸæœ›çš„è¿è¡ŒçŠ¶æ€ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ
ä¸¾ä¸€ä¸ªæœ‰çŠ¶æ€åº”ç”¨çš„ä¾‹å­ã€‚å‡å¦‚ä¸€ä¸ªæ•°æ®åº“åº”ç”¨è¿è¡Œåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚å¦‚æœè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œåˆ™éœ€è¦æŒ‰ç…§ç‰¹å®šæ­¥éª¤ä»ç‰¹å®šå¿«ç…§ä¸­åŠ è½½æ•°æ®ã€‚ä½¿ç”¨åŸç”ŸKuberneteså¯¹è±¡ç±»å‹å’Œcontrolleråˆ™éš¾ä»¥å®ç°ã€‚æˆ–è€…ä¸ºæœ‰çŠ¶æ€åº”ç”¨ç¨‹åºæ‰©å±•èŠ‚ç‚¹ï¼Œå‡çº§åˆ°æ–°ç‰ˆæœ¬æˆ–ç¾éš¾æ¢å¤ã€‚è¿™äº›ç±»å‹çš„æ“ä½œé€šå¸¸éœ€è¦éå¸¸å…·ä½“çš„æ­¥éª¤ï¼Œå¹¶ä¸”é€šå¸¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚
controllerç³»ç»Ÿç»“æ„ ä½¿ç”¨ CRD å®šåˆ¶èµ„æºåï¼Œä»…ä»…æ˜¯è®© Kubernetes èƒ½å¤Ÿè¯†åˆ«å®šåˆ¶èµ„æºçš„èº«ä»½ã€‚åˆ›å»ºå®šåˆ¶èµ„æºå®ä¾‹åï¼ŒKubernetes åªä¼šå°†åˆ›å»ºçš„å®ä¾‹å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸ä¼šè§¦å‘ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚åœ¨ æ•°æ®åº“ä¿å­˜å®šåˆ¶èµ„æºå®ä¾‹æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå¦‚æœéœ€è¦è¿›è¡Œä¸šåŠ¡é€»è¾‘æ§åˆ¶ï¼Œå°±éœ€è¦åˆ›å»ºæ§åˆ¶å™¨ã€‚
Controller çš„ä½œç”¨å°±æ˜¯ç›‘å¬æŒ‡å®šå¯¹è±¡çš„æ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹ç­‰å˜åŒ–ï¼Œå¹¶é’ˆå¯¹è¿™äº›å˜åŒ–åšå‡ºç›¸åº”çš„å“åº”ï¼Œå…³äº Controller çš„è¯¦ç»†è®¾è®¡ï¼Œå¯ä»¥å‚è€ƒ Harry (Lei) Zhang è€å¸ˆåœ¨ twitter ä¸Šçš„åˆ†äº«ï¼ŒåŸºæœ¬æ¶æ„å›¾å¦‚ä¸‹ï¼š å›¾ä¸­å¯çœ‹å‡ºï¼Œå®šåˆ¶èµ„æºå®ä¾‹çš„å˜åŒ–ä¼šé€šè¿‡ Informer å­˜å…¥ WorkQueueï¼Œä¹‹å Controller ä¼šæ¶ˆè´¹ WorkQueueï¼Œå¹¶å¯¹å…¶ä¸­çš„æ•°æ®åšå‡ºä¸šåŠ¡å“åº”ã€‚">
    <meta property="og:locale" content="zh">
    <meta property="og:type" content="article">
    <meta property="article:section" content="è¿ç»´ä¸€ä½“åŒ–">
    <meta property="article:published_time" content="2025-09-18T16:55:17+08:00">
    <meta property="article:modified_time" content="2025-09-18T16:55:17+08:00">
    <meta itemprop="name" content="K8SäºŒæ¬¡å¼€å‘04-è‡ªå®šä¹‰operatorï¼ˆoperator-sdkè°ƒè¯•ï¼‰ :: liaomin416100569åšå®¢">
    <meta itemprop="description" content="Operator æ˜¯ Kubernetes çš„æ‰©å±•è½¯ä»¶ï¼Œå®ƒåˆ©ç”¨ å®šåˆ¶èµ„æº ç®¡ç†åº”ç”¨åŠå…¶ç»„ä»¶ã€‚ Operator éµå¾ª Kubernetes çš„ç†å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨æ§åˆ¶å™¨ æ–¹é¢ã€‚ Operatoræ“ä½œé‚£äº›æœ‰çŠ¶æ€çš„åŸºç¡€è®¾æ–½æœåŠ¡ï¼ŒåŒ…æ‹¬ï¼šç»„ä»¶å‡çº§ã€èŠ‚ç‚¹æ¢å¤ã€è°ƒæ•´é›†ç¾¤è§„æ¨¡ã€‚ä¸€ä¸ªç†æƒ³åŒ–çš„è¿ç»´å¹³å°å¿…é¡»æ˜¯Operatorè‡ªå·±ç»´æŠ¤æœ‰çŠ¶æ€åº”ç”¨ï¼Œå¹¶å°†äººå·¥å¹²é¢„é™ä½åˆ°æœ€ä½é™åº¦
ä»€ä¹ˆæ˜¯Operatorï¼Ÿ ä¸ºäº†ç†è§£ä»€ä¹ˆæ˜¯Operatorï¼Œè®©æˆ‘ä»¬å…ˆå¤ä¹ ä¸€ä¸‹Kubernetesã€‚Kuberneteså®é™…æ˜¯æœŸæœ›çŠ¶æ€ç®¡ç†å™¨ã€‚å…ˆåœ¨Kubernetesä¸­æŒ‡å®šåº”ç”¨ç¨‹åºæœŸæœ›çŠ¶æ€ï¼ˆå®ä¾‹æ•°ï¼Œç£ç›˜ç©ºé—´ï¼Œé•œåƒç­‰ï¼‰ï¼Œç„¶åå®ƒä¼šå°è¯•æŠŠåº”ç”¨ç»´æŒåœ¨è¿™ç§çŠ¶æ€ã€‚Kubernetesçš„æ§åˆ¶å¹³é¢è¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šï¼Œå®ƒåŒ…å«æ•°ä¸ªcontrollerä»¥è°ƒå’Œåº”ç”¨è¾¾åˆ°æœŸæœ›çŠ¶æ€ï¼š
æ£€æŸ¥å½“å‰çš„å®é™…çŠ¶æ€ï¼ˆPodã€Deploymentç­‰ï¼‰ å°†å®é™…çŠ¶æ€ä¸specæœŸæœ›çŠ¶æ€è¿›è¡Œæ¯”è¾ƒ å¦‚æœå®é™…çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¸ä¸€è‡´ï¼Œcontrollerå°†ä¼šå°è¯•åè°ƒå®é™…çŠ¶æ€ä»¥è¾¾åˆ°ä¸€è‡´ æ¯”å¦‚ï¼Œé€šè¿‡RSå®šä¹‰Podæ‹¥æœ‰3ä¸ªå‰¯æœ¬ã€‚å½“å…¶ä¸­ä¸€ä¸ªPod downæ‰æ—¶ï¼ŒKubernetes controlleré€šè¿‡wacth APIå‘ç°æœŸæœ›è¿è¡Œ3ä¸ªå‰¯æœ¬ï¼Œè€Œå®é™…åªæœ‰2ä¸ªå‰¯æœ¬åœ¨è¿è¡Œã€‚äºæ˜¯å®ƒæ–°åˆ›å»ºå‡ºä¸€ä¸ªPodå®ä¾‹ã€‚
controllerä½œç”¨ å¦‚å›¾æ‰€ç¤ºï¼Œcontrolleråœ¨Kubernetesä¸­å‘æŒ¥çš„ä½œç”¨ã€‚ é€šè¿‡Kubectlå‘½ä»¤å‘é€å¯¹è±¡specå®šä¹‰ï¼ˆPodï¼ŒDeploymentç­‰ï¼‰åˆ°Kubernetes MasterèŠ‚ç‚¹çš„APIæœåŠ¡ MasterèŠ‚ç‚¹è°ƒåº¦å¯¹è±¡è¿è¡Œ ä¸€æ—¦å¯¹è±¡è¿è¡Œï¼Œcontrollerä¼šæŒç»­æ£€æŸ¥å¯¹è±¡å¹¶æ ¹æ®specåè°ƒå®é™…æƒ…å†µ é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒKuberneteséå¸¸é€‚åˆç»´æŠ¤æ— çŠ¶æ€åº”ç”¨ã€‚ä½†å®ƒæœ¬èº«çš„èµ„æºç±»å‹ï¼ˆPodï¼ŒDeploymentsï¼ŒNamespacesï¼ŒServicesï¼ŒDaemonSetsç­‰ï¼‰æ¯”è¾ƒæœ‰é™ã€‚è™½ç„¶æ¯ç§èµ„æºç±»å‹éƒ½é¢„å®šäº†è¡Œä¸ºåŠåè°ƒæ–¹å¼ï¼Œä½†å®ƒä»¬çš„å¤„ç†æ–¹å¼æ²¡æœ‰å¤šå¤§å·®åˆ«ã€‚ ç°åœ¨ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨æ›´å¤æ‚å¹¶éœ€è¦æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œä»¥è¾¾åˆ°æœŸæœ›çš„è¿è¡ŒçŠ¶æ€ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ
ä¸¾ä¸€ä¸ªæœ‰çŠ¶æ€åº”ç”¨çš„ä¾‹å­ã€‚å‡å¦‚ä¸€ä¸ªæ•°æ®åº“åº”ç”¨è¿è¡Œåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚å¦‚æœè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œåˆ™éœ€è¦æŒ‰ç…§ç‰¹å®šæ­¥éª¤ä»ç‰¹å®šå¿«ç…§ä¸­åŠ è½½æ•°æ®ã€‚ä½¿ç”¨åŸç”ŸKuberneteså¯¹è±¡ç±»å‹å’Œcontrolleråˆ™éš¾ä»¥å®ç°ã€‚æˆ–è€…ä¸ºæœ‰çŠ¶æ€åº”ç”¨ç¨‹åºæ‰©å±•èŠ‚ç‚¹ï¼Œå‡çº§åˆ°æ–°ç‰ˆæœ¬æˆ–ç¾éš¾æ¢å¤ã€‚è¿™äº›ç±»å‹çš„æ“ä½œé€šå¸¸éœ€è¦éå¸¸å…·ä½“çš„æ­¥éª¤ï¼Œå¹¶ä¸”é€šå¸¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚
controllerç³»ç»Ÿç»“æ„ ä½¿ç”¨ CRD å®šåˆ¶èµ„æºåï¼Œä»…ä»…æ˜¯è®© Kubernetes èƒ½å¤Ÿè¯†åˆ«å®šåˆ¶èµ„æºçš„èº«ä»½ã€‚åˆ›å»ºå®šåˆ¶èµ„æºå®ä¾‹åï¼ŒKubernetes åªä¼šå°†åˆ›å»ºçš„å®ä¾‹å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸ä¼šè§¦å‘ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚åœ¨ æ•°æ®åº“ä¿å­˜å®šåˆ¶èµ„æºå®ä¾‹æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå¦‚æœéœ€è¦è¿›è¡Œä¸šåŠ¡é€»è¾‘æ§åˆ¶ï¼Œå°±éœ€è¦åˆ›å»ºæ§åˆ¶å™¨ã€‚
Controller çš„ä½œç”¨å°±æ˜¯ç›‘å¬æŒ‡å®šå¯¹è±¡çš„æ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹ç­‰å˜åŒ–ï¼Œå¹¶é’ˆå¯¹è¿™äº›å˜åŒ–åšå‡ºç›¸åº”çš„å“åº”ï¼Œå…³äº Controller çš„è¯¦ç»†è®¾è®¡ï¼Œå¯ä»¥å‚è€ƒ Harry (Lei) Zhang è€å¸ˆåœ¨ twitter ä¸Šçš„åˆ†äº«ï¼ŒåŸºæœ¬æ¶æ„å›¾å¦‚ä¸‹ï¼š å›¾ä¸­å¯çœ‹å‡ºï¼Œå®šåˆ¶èµ„æºå®ä¾‹çš„å˜åŒ–ä¼šé€šè¿‡ Informer å­˜å…¥ WorkQueueï¼Œä¹‹å Controller ä¼šæ¶ˆè´¹ WorkQueueï¼Œå¹¶å¯¹å…¶ä¸­çš„æ•°æ®åšå‡ºä¸šåŠ¡å“åº”ã€‚">
    <meta itemprop="datePublished" content="2025-09-18T16:55:17+08:00">
    <meta itemprop="dateModified" content="2025-09-18T16:55:17+08:00">
    <meta itemprop="wordCount" content="2012">
    <title>K8SäºŒæ¬¡å¼€å‘04-è‡ªå®šä¹‰operatorï¼ˆoperator-sdkè°ƒè¯•ï¼‰ :: liaomin416100569åšå®¢</title>
    <link href="/docs/css/auto-complete/auto-complete.min.css?1758355652" rel="stylesheet">
    <script src="/docs/js/auto-complete/auto-complete.min.js?1758355652" defer></script>
    <script src="/docs/js/search-lunr.min.js?1758355652" defer></script>
    <script src="/docs/js/search.min.js?1758355652" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/docs/searchindex.en.js?1758355652";
    </script>
    <script src="/docs/js/lunr/lunr.min.js?1758355652" defer></script>
    <script src="/docs/js/lunr/lunr.stemmer.support.min.js?1758355652" defer></script>
    <script src="/docs/js/lunr/lunr.multi.min.js?1758355652" defer></script>
    <script src="/docs/js/lunr/lunr.zh.min.js?1758355652" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['zh'];
    </script>
    <link href="/docs/fonts/fontawesome/css/fontawesome-all.min.css?1758355652" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/docs/fonts/fontawesome/css/fontawesome-all.min.css?1758355652" rel="stylesheet"></noscript>
    <link href="/docs/css/perfect-scrollbar/perfect-scrollbar.min.css?1758355652" rel="stylesheet">
    <link href="/docs/css/theme.min.css?1758355652" rel="stylesheet">
    <link href="/docs/css/format-html.min.css?1758355652" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/devops\/kubernetes\/k8s_dev_04\/index.html';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/jiaozi789.github.io\/docs';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'auto' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
    <link href="/docs/css/custom.css?1758355652" rel="stylesheet">
  </head>
  <body class="mobile-support html" data-url="/docs/devops/kubernetes/k8s_dev_04/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#ä»€ä¹ˆæ˜¯operator">ä»€ä¹ˆæ˜¯Operatorï¼Ÿ</a>
      <ul>
        <li><a href="#controllerä½œç”¨">controllerä½œç”¨</a></li>
        <li><a href="#controllerç³»ç»Ÿç»“æ„">controllerç³»ç»Ÿç»“æ„</a></li>
        <li><a href="#operatorè‡ªå®šä¹‰controller">Operatorè‡ªå®šä¹‰controller</a></li>
        <li><a href="#æ„å»ºoperator">æ„å»ºOperator</a></li>
        <li><a href="#ç¼–å†™ä½ è‡ªå·±çš„-operator">ç¼–å†™ä½ è‡ªå·±çš„ Operator</a></li>
      </ul>
    </li>
    <li><a href="#ä½¿ç”¨operator-sdkç¼–å†™">ä½¿ç”¨operator sdkç¼–å†™</a>
      <ul>
        <li><a href="#å·¥ä½œæµç¨‹">å·¥ä½œæµç¨‹</a></li>
        <li><a href="#å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a>
          <ul>
            <li><a href="#å‰ç½®å®‰è£…">å‰ç½®å®‰è£…</a>
              <ul>
                <li><a href="#å®‰è£…gccå’Œmake">å®‰è£…gccå’Œmake</a></li>
                <li><a href="#golang">golang</a></li>
                <li><a href="#å®‰è£…docker">å®‰è£…docker</a></li>
                <li><a href="#å®‰è£…docker-registry">å®‰è£…docker registry</a></li>
                <li><a href="#å®‰è£…kubectl">å®‰è£…kubectl</a></li>
              </ul>
            </li>
            <li><a href="#å®‰è£…operator-sdk">å®‰è£…operator-sdk</a></li>
            <li><a href="#operator-sdkå®ä¾‹">operator-sdkå®ä¾‹</a>
              <ul>
                <li><a href="#åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®</a></li>
                <li><a href="#åˆ›å»ºapi">åˆ›å»ºapi</a></li>
                <li><a href="#å®ç°controller">å®ç°controller</a></li>
                <li><a href="#è¿è¡Œoperator">è¿è¡Œoperator</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/docs/index.html"><span itemprop="name">liaomin416100569åšå®¢</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/docs/devops/index.html"><span itemprop="name">è¿ç»´ä¸€ä½“åŒ–</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/docs/devops/kubernetes/index.html"><span itemprop="name">kubernetes</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">K8SäºŒæ¬¡å¼€å‘04-è‡ªå®šä¹‰operatorï¼ˆoperator-sdkè°ƒè¯•ï¼‰</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/docs/devops/kubernetes/k8s_dev_03/index.html" title="K8SäºŒæ¬¡å¼€å‘03-CRDèµ„æºè¯¦è§£ (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/docs/devops/kubernetes/k8s_dev_05/index.html" title="K8SäºŒæ¬¡å¼€å‘05-ä½¿ç”¨clientgoè‡ªå®šä¹‰ingresscontroller (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable devops" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="k8säºŒæ¬¡å¼€å‘04-è‡ªå®šä¹‰operatoroperator-sdkè°ƒè¯•">K8SäºŒæ¬¡å¼€å‘04-è‡ªå®šä¹‰operatorï¼ˆoperator-sdkè°ƒè¯•ï¼‰</h1>

<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']]
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

<p>Operator æ˜¯ Kubernetes çš„æ‰©å±•è½¯ä»¶ï¼Œå®ƒåˆ©ç”¨ å®šåˆ¶èµ„æº ç®¡ç†åº”ç”¨åŠå…¶ç»„ä»¶ã€‚ Operator éµå¾ª Kubernetes çš„ç†å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨æ§åˆ¶å™¨ æ–¹é¢ã€‚
Operatoræ“ä½œé‚£äº›æœ‰çŠ¶æ€çš„åŸºç¡€è®¾æ–½æœåŠ¡ï¼ŒåŒ…æ‹¬ï¼šç»„ä»¶å‡çº§ã€èŠ‚ç‚¹æ¢å¤ã€è°ƒæ•´é›†ç¾¤è§„æ¨¡ã€‚ä¸€ä¸ªç†æƒ³åŒ–çš„è¿ç»´å¹³å°å¿…é¡»æ˜¯Operatorè‡ªå·±ç»´æŠ¤æœ‰çŠ¶æ€åº”ç”¨ï¼Œå¹¶å°†äººå·¥å¹²é¢„é™ä½åˆ°æœ€ä½é™åº¦</p>
<h1 id="ä»€ä¹ˆæ˜¯operator">ä»€ä¹ˆæ˜¯Operatorï¼Ÿ</h1>
<p>ä¸ºäº†ç†è§£ä»€ä¹ˆæ˜¯Operatorï¼Œè®©æˆ‘ä»¬å…ˆå¤ä¹ ä¸€ä¸‹Kubernetesã€‚Kuberneteså®é™…æ˜¯æœŸæœ›çŠ¶æ€ç®¡ç†å™¨ã€‚å…ˆåœ¨Kubernetesä¸­æŒ‡å®šåº”ç”¨ç¨‹åºæœŸæœ›çŠ¶æ€ï¼ˆå®ä¾‹æ•°ï¼Œç£ç›˜ç©ºé—´ï¼Œé•œåƒç­‰ï¼‰ï¼Œç„¶åå®ƒä¼šå°è¯•æŠŠåº”ç”¨ç»´æŒåœ¨è¿™ç§çŠ¶æ€ã€‚Kubernetesçš„æ§åˆ¶å¹³é¢è¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šï¼Œå®ƒåŒ…å«æ•°ä¸ªcontrollerä»¥è°ƒå’Œåº”ç”¨è¾¾åˆ°æœŸæœ›çŠ¶æ€ï¼š</p>
<ul>
<li>æ£€æŸ¥å½“å‰çš„å®é™…çŠ¶æ€ï¼ˆPodã€Deploymentç­‰ï¼‰</li>
<li>å°†å®é™…çŠ¶æ€ä¸specæœŸæœ›çŠ¶æ€è¿›è¡Œæ¯”è¾ƒ</li>
<li>å¦‚æœå®é™…çŠ¶æ€ä¸æœŸæœ›çŠ¶æ€ä¸ä¸€è‡´ï¼Œcontrollerå°†ä¼šå°è¯•åè°ƒå®é™…çŠ¶æ€ä»¥è¾¾åˆ°ä¸€è‡´</li>
</ul>
<p>æ¯”å¦‚ï¼Œé€šè¿‡RSå®šä¹‰Podæ‹¥æœ‰3ä¸ªå‰¯æœ¬ã€‚å½“å…¶ä¸­ä¸€ä¸ªPod downæ‰æ—¶ï¼ŒKubernetes controlleré€šè¿‡wacth APIå‘ç°æœŸæœ›è¿è¡Œ3ä¸ªå‰¯æœ¬ï¼Œè€Œå®é™…åªæœ‰2ä¸ªå‰¯æœ¬åœ¨è¿è¡Œã€‚äºæ˜¯å®ƒæ–°åˆ›å»ºå‡ºä¸€ä¸ªPodå®ä¾‹ã€‚</p>
<h2 id="controllerä½œç”¨">controllerä½œç”¨</h2>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œcontrolleråœ¨Kubernetesä¸­å‘æŒ¥çš„ä½œç”¨ã€‚
<a href="#R-image-5aa29e2e4de0591ec8e0b040efca4ba3" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/fecdc107d98dda9ad50ecd4d79b7d9fb.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5aa29e2e4de0591ec8e0b040efca4ba3"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/fecdc107d98dda9ad50ecd4d79b7d9fb.png"></a></p>
<ul>
<li>é€šè¿‡Kubectlå‘½ä»¤å‘é€å¯¹è±¡specå®šä¹‰ï¼ˆPodï¼ŒDeploymentç­‰ï¼‰åˆ°Kubernetes MasterèŠ‚ç‚¹çš„APIæœåŠ¡</li>
<li>MasterèŠ‚ç‚¹è°ƒåº¦å¯¹è±¡è¿è¡Œ</li>
<li>ä¸€æ—¦å¯¹è±¡è¿è¡Œï¼Œcontrollerä¼šæŒç»­æ£€æŸ¥å¯¹è±¡å¹¶æ ¹æ®specåè°ƒå®é™…æƒ…å†µ</li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒKuberneteséå¸¸é€‚åˆç»´æŠ¤æ— çŠ¶æ€åº”ç”¨ã€‚ä½†å®ƒæœ¬èº«çš„èµ„æºç±»å‹ï¼ˆPodï¼ŒDeploymentsï¼ŒNamespacesï¼ŒServicesï¼ŒDaemonSetsç­‰ï¼‰æ¯”è¾ƒæœ‰é™ã€‚è™½ç„¶æ¯ç§èµ„æºç±»å‹éƒ½é¢„å®šäº†è¡Œä¸ºåŠåè°ƒæ–¹å¼ï¼Œä½†å®ƒä»¬çš„å¤„ç†æ–¹å¼æ²¡æœ‰å¤šå¤§å·®åˆ«ã€‚
ç°åœ¨ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨æ›´å¤æ‚å¹¶éœ€è¦æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œä»¥è¾¾åˆ°æœŸæœ›çš„è¿è¡ŒçŠ¶æ€ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>ä¸¾ä¸€ä¸ªæœ‰çŠ¶æ€åº”ç”¨çš„ä¾‹å­ã€‚å‡å¦‚ä¸€ä¸ªæ•°æ®åº“åº”ç”¨è¿è¡Œåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šã€‚å¦‚æœè¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œåˆ™éœ€è¦æŒ‰ç…§ç‰¹å®šæ­¥éª¤ä»ç‰¹å®šå¿«ç…§ä¸­åŠ è½½æ•°æ®ã€‚ä½¿ç”¨åŸç”ŸKuberneteså¯¹è±¡ç±»å‹å’Œcontrolleråˆ™éš¾ä»¥å®ç°ã€‚æˆ–è€…ä¸ºæœ‰çŠ¶æ€åº”ç”¨ç¨‹åºæ‰©å±•èŠ‚ç‚¹ï¼Œå‡çº§åˆ°æ–°ç‰ˆæœ¬æˆ–ç¾éš¾æ¢å¤ã€‚è¿™äº›ç±»å‹çš„æ“ä½œé€šå¸¸éœ€è¦éå¸¸å…·ä½“çš„æ­¥éª¤ï¼Œå¹¶ä¸”é€šå¸¸éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚</p>
<h2 id="controllerç³»ç»Ÿç»“æ„">controllerç³»ç»Ÿç»“æ„</h2>
<p>ä½¿ç”¨ CRD å®šåˆ¶èµ„æºåï¼Œä»…ä»…æ˜¯è®© Kubernetes èƒ½å¤Ÿè¯†åˆ«å®šåˆ¶èµ„æºçš„èº«ä»½ã€‚åˆ›å»ºå®šåˆ¶èµ„æºå®ä¾‹åï¼ŒKubernetes åªä¼šå°†åˆ›å»ºçš„å®ä¾‹å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸ä¼šè§¦å‘ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚åœ¨  æ•°æ®åº“ä¿å­˜å®šåˆ¶èµ„æºå®ä¾‹æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå¦‚æœéœ€è¦è¿›è¡Œä¸šåŠ¡é€»è¾‘æ§åˆ¶ï¼Œå°±éœ€è¦åˆ›å»ºæ§åˆ¶å™¨ã€‚</p>
<p>Controller çš„ä½œç”¨å°±æ˜¯ç›‘å¬æŒ‡å®šå¯¹è±¡çš„æ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹ç­‰å˜åŒ–ï¼Œå¹¶é’ˆå¯¹è¿™äº›å˜åŒ–åšå‡ºç›¸åº”çš„å“åº”ï¼Œå…³äº Controller çš„è¯¦ç»†è®¾è®¡ï¼Œå¯ä»¥å‚è€ƒ Harry (Lei) Zhang è€å¸ˆåœ¨ twitter ä¸Šçš„åˆ†äº«ï¼ŒåŸºæœ¬æ¶æ„å›¾å¦‚ä¸‹ï¼š
<a href="#R-image-7cd42df05e6bb51f7b2bfed405495ace" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/39fafb0ece4b6fe6e8933edf666179ed.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7cd42df05e6bb51f7b2bfed405495ace"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/39fafb0ece4b6fe6e8933edf666179ed.png"></a>
å›¾ä¸­å¯çœ‹å‡ºï¼Œå®šåˆ¶èµ„æºå®ä¾‹çš„å˜åŒ–ä¼šé€šè¿‡ Informer å­˜å…¥ WorkQueueï¼Œä¹‹å Controller ä¼šæ¶ˆè´¹ WorkQueueï¼Œå¹¶å¯¹å…¶ä¸­çš„æ•°æ®åšå‡ºä¸šåŠ¡å“åº”ã€‚</p>
<p>Operator å…¶å®å°±æ˜¯å›¾ä¸­é™¤äº† API Server å’Œ etcd çš„å‰©ä½™éƒ¨åˆ†ã€‚ç”±äº Clientã€Informer å’Œ WorkQueue æ˜¯é«˜åº¦ç›¸ä¼¼çš„ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šé¡¹ç›®å¯ä»¥è‡ªåŠ¨åŒ–ç”Ÿæˆ Controller ä¹‹å¤–çš„ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚ Clientã€Informerã€Listerï¼‰ï¼Œå› æ­¤ç”¨æˆ·åªéœ€è¦ä¸“æ³¨äº Controller ä¸­çš„ä¸šåŠ¡é€»è¾‘å³å¯ã€‚</p>
<h2 id="operatorè‡ªå®šä¹‰controller">Operatorè‡ªå®šä¹‰controller</h2>
<p>Operatoré€šè¿‡æ‰©å±•Kuberneteså®šä¹‰Custom Controllerï¼Œè§‚å¯Ÿåº”ç”¨å¹¶æ ¹æ®å®é™…çŠ¶æ€æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡ã€‚åº”ç”¨è¢«å®šä¹‰ä¸ºKuberneteså¯¹è±¡ï¼šCustom Resource ï¼ˆCRï¼‰ï¼Œå®ƒåŒ…å«yaml specå’Œè¢«APIæœåŠ¡æ¥å—å¯¹è±¡ç±»å‹ï¼ˆK8s kindï¼‰ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥åœ¨è‡ªå®šä¹‰è§„èŒƒä¸­å®šä¹‰è¦è§‚å¯Ÿçš„ä»»ä½•ç‰¹å®šæ¡ä»¶ï¼Œå¹¶åœ¨å®ä¾‹ä¸è§„èŒƒä¸åŒ¹é…æ—¶åè°ƒå®ä¾‹ã€‚è™½ç„¶Operator controllerä¸»è¦ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶ï¼Œä½†å®ƒä¸åŸç”ŸKubernetes controlleråè°ƒæ–¹å¼éå¸¸ç±»ä¼¼ã€‚
<a href="#R-image-8375025b28d3d1ed403e8c0fb640ee6a" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/b9044ab1fdbf06a90a97ce06b8d82c4c.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-8375025b28d3d1ed403e8c0fb640ee6a"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/b9044ab1fdbf06a90a97ce06b8d82c4c.png"></a></p>
<p>Operatoré€šè¿‡Custom Controlleråè°ƒåº”ç”¨specã€‚è™½ç„¶APIæœåŠ¡çŸ¥é“Custom Controllerï¼Œä½†Operatorå¯ä»¥ç‹¬ç«‹è¿è¡Œåœ¨é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨ã€‚</p>
<h2 id="æ„å»ºoperator">æ„å»ºOperator</h2>
<p>ä¸ºäº†åˆ›å»ºè‡ªå®šä¹‰Operatorï¼Œæˆ‘ä»¬éœ€è¦å¦‚ä¸‹èµ„æºï¼š</p>
<ol>
<li>Custom Resourceï¼ˆCRï¼‰specï¼Œå®šä¹‰æˆ‘ä»¬è¦è§‚æµ‹çš„åº”ç”¨å¯¹è±¡ï¼Œä»¥åŠä¸ºCRå®šä¹‰çš„API</li>
<li>Custom Controllerï¼Œç”¨æ¥è§‚æµ‹CR</li>
<li>Custom codeï¼Œå†³å®šCustom Controllerå¦‚ä½•åè°ƒCR</li>
<li>Operatorï¼Œç®¡ç†Custom Controller</li>
<li>Deploymentï¼Œå®šä¹‰Operatorå’Œè‡ªå®šä¹‰èµ„æº</li>
</ol>
<p>æ‰€æœ‰ä¸Šè¿°å†…å®¹éƒ½å¯ä»¥é€šè¿‡æ‰‹å·¥ç¼–å†™Goä»£ç å’Œspecï¼Œæˆ–é€šè¿‡kubebuilderç­‰å·¥å…·ç”ŸæˆKubernetes APIã€‚ä½†æœ€ç®€å•çš„æ–¹å¼ï¼ˆä¹Ÿæ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨çš„æ–¹æ³•ï¼‰æ˜¯ä½¿ç”¨CoreOS operator-sdkä¸ºè¿™äº›ç»„ä»¶ç”Ÿæˆæ¨¡ç‰ˆã€‚å®ƒå…è®¸æ‚¨é€šè¿‡CLIå‘½ä»¤ç”Ÿæˆspecã€controllerä»¥åŠOperatoræ¡†æ¶ã€‚ä¸€æ—¦ç”Ÿæˆåï¼Œæ‚¨å¯ä»¥åœ¨specä¸­å®šä¹‰è‡ªå®šä¹‰å­—æ®µå¹¶ç¼–å†™åè°ƒçš„è‡ªå®šä¹‰ä»£ç ã€‚æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹çš„ä¸‹ä¸€éƒ¨åˆ†ä¸­å±•å¼€ä»‹ç»ã€‚</p>
<h2 id="ç¼–å†™ä½ è‡ªå·±çš„-operator">ç¼–å†™ä½ è‡ªå·±çš„ Operator</h2>
<p>å¦‚æœç”Ÿæ€ç³»ç»Ÿä¸­æ²¡å¯ä»¥å®ç°ä½ ç›®æ ‡çš„ Operatorï¼Œä½ å¯ä»¥è‡ªå·±ç¼–å†™ä»£ç ã€‚</p>
<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒ Kubernetes API å®¢æˆ·ç«¯ çš„è¯­è¨€æˆ–è¿è¡Œæ—¶æ¥å®ç° Operatorï¼ˆå³æ§åˆ¶å™¨ï¼‰ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›åº“å’Œå·¥å…·ï¼Œä½ å¯ç”¨äºç¼–å†™è‡ªå·±çš„äº‘åŸç”Ÿ Operatorã€‚</p>
<p>è¯´æ˜ï¼š æœ¬éƒ¨åˆ†é“¾æ¥åˆ°æä¾› Kubernetes æ‰€éœ€åŠŸèƒ½çš„ç¬¬ä¸‰æ–¹é¡¹ç›®ã€‚Kubernetes é¡¹ç›®ä½œè€…ä¸è´Ÿè´£è¿™äº›é¡¹ç›®ã€‚æ­¤é¡µé¢éµå¾ªCNCF ç½‘ç«™æŒ‡å—ï¼ŒæŒ‰å­—æ¯é¡ºåºåˆ—å‡ºé¡¹ç›®ã€‚è¦å°†é¡¹ç›®æ·»åŠ åˆ°æ­¤åˆ—è¡¨ä¸­ï¼Œè¯·åœ¨æäº¤æ›´æ”¹ä¹‹å‰é˜…è¯»å†…å®¹æŒ‡å—ã€‚
<a href="https://juju.is/" rel="external" target="_blank">Charmed Operator Framework</a>
<a href="https://book.kubebuilder.io/" rel="external" target="_blank">kubebuilder</a>
<a href="https://buehler.github.io/dotnet-operator-sdk/" rel="external" target="_blank">KubeOps (dotnet operator SDK)</a>
<a href="https://kudo.dev/" rel="external" target="_blank">KUDO (Kubernetes é€šç”¨å£°æ˜å¼ Operator)</a>
<a href="https://metacontroller.github.io/metacontroller/intro.html" rel="external" target="_blank">Metacontrollerï¼Œå¯ä¸ Webhooks ç»“åˆä½¿ç”¨ï¼Œä»¥å®ç°è‡ªå·±çš„åŠŸèƒ½ã€‚</a>
<a href="https://operatorframework.io/" rel="external" target="_blank">Operator Framework</a>
<a href="https://github.com/flant/shell-operator" rel="external" target="_blank">shell-operator</a></p>
<h1 id="ä½¿ç”¨operator-sdkç¼–å†™">ä½¿ç”¨operator sdkç¼–å†™</h1>
<p>operator sdké¡¹ç›®æ˜¯Operator Frameworkçš„ä¸€ä¸ªç»„ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æºå·¥å…·åŒ…ï¼Œä»¥æœ‰æ•ˆï¼Œè‡ªåŠ¨åŒ–å’Œå¯æ‰©å±•çš„æ–¹å¼ç®¡ç†KubernetesåŸç”Ÿåº”ç”¨ç¨‹åºï¼Œç§°ä¸ºOperatorsã€‚æ›´å¤šä»‹ç»å†…å®¹ï¼Œè¯·é˜…è¯»åšå®¢ã€‚
Operators å¯ä»¥åœ¨Kubernetesä¹‹ä¸Šè½»æ¾åœ°ç®¡ç†å¤æ‚æœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼Œç”±äºè¯¸å¦‚ä½¿ç”¨ä½çº§APIï¼Œç¼–å†™æ ·æ¿ä»¥åŠç¼ºä¹æ¨¡å—å¯¼è‡´é‡å¤æ€§å·¥ä½œç­‰æŒ‘æˆ˜ï¼Œå¯¼è‡´ç›®å‰ç¼–å†™Operatorå¯èƒ½å¾ˆå›°éš¾ã€‚
Operator SDKæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ–Operatorçš„ç¼–å†™ï¼Œå®ƒæä¾›å¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>é«˜çº§APIå’ŒæŠ½è±¡ï¼Œæ›´ç›´è§‚åœ°ç¼–å†™æ“ä½œé€»è¾‘</li>
<li>ç”¨äºè„šæ‰‹æ¶å’Œä»£ç ç”Ÿæˆçš„å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿå¼•å¯¼æ–°é¡¹ç›®</li>
<li>æ‰©å±•ä»¥æ¶µç›–å¸¸è§çš„æ“ä½œå‘˜ç”¨ä¾‹</li>
</ul>
<h2 id="å·¥ä½œæµç¨‹">å·¥ä½œæµç¨‹</h2>
<p>SDKæä¾›ä»¥ä¸‹å·¥ä½œæµç¨‹æ¥å¼€å‘æ–°çš„Operatorï¼š</p>
<ul>
<li>ä½¿ç”¨SDKå‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰åˆ›å»ºæ–°çš„Operatoré¡¹ç›®</li>
<li>é€šè¿‡æ·»åŠ è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰å®šä¹‰æ–°èµ„æºAPI</li>
<li>ä½¿ç”¨SDK APIç›‘æ§æŒ‡å®šçš„èµ„æº</li>
<li>åœ¨æŒ‡å®šçš„å¤„ç†ç¨‹åºä¸­å®šä¹‰Operatoråè°ƒé€»è¾‘(å¯¹æ¯”æœŸæœ›çŠ¶æ€ä¸å®é™…çŠ¶æ€)ï¼Œå¹¶ä½¿ç”¨SDK APIä¸èµ„æºè¿›è¡Œäº¤äº’</li>
<li>ä½¿ç”¨SDK CLIæ„å»ºå¹¶ç”ŸæˆOperatoréƒ¨ç½²manifests
Operatorä½¿ç”¨SDKåœ¨ç”¨æˆ·è‡ªå®šä¹‰çš„å¤„ç†ç¨‹åºä¸­ä»¥é«˜çº§APIå¤„ç†ç›‘è§†èµ„æºçš„äº‹ä»¶ï¼Œå¹¶é‡‡å–æªæ–½æ¥reconcileï¼ˆå¯¹æ¯”æœŸæœ›çŠ¶æ€ä¸å®é™…çŠ¶æ€ï¼‰åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚</li>
</ul>
<h2 id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</h2>
<p>å…ˆç»™å‡ºæˆ‘çš„ç¯å¢ƒï¼Œæ³¨æ„operator-sdkæ”¯æŒé€šè¿‡ä»£ç å®‰è£…ï¼Œåœ¨windowä¸Šé€šè¿‡ideaç­‰å·¥å…·æ­é…golangå¼€å‘ï¼Œæœ‰ç¯å¢ƒçš„å¯ç›´æ¥ä½¿ç”¨macosã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">å¼€å‘æ“ä½œç³»ç»Ÿï¼š</span>window
</span></span><span style="display:flex;"><span>k8s: <span style="color:#ae81ff">1.23.3</span>
</span></span><span style="display:flex;"><span>k8séƒ¨ç½²<span style="color:#960050;background-color:#1e0010">ï¼š</span>debian<span style="color:#f92672">|</span>dockerdesktopè‡ªå¸¦çš„k8s</span></span></code></pre></div>
<h3 id="å‰ç½®å®‰è£…">å‰ç½®å®‰è£…</h3>
<ul>
<li>å®‰è£…gccå’Œmakeã€‚</li>
<li>å®‰è£…golang1.17ä»¥ä¸Šç‰ˆæœ¬ã€‚</li>
<li>ä¸€ä¸ªå¯è¿›å…¥çš„å…¬å…±çš„docker registryæœåŠ¡ï¼Œå¹¶ä¸”å‡†å¤‡ä¸€ä¸ªåŸŸåä½œä¸ºregistryæœåŠ¡çš„åŸŸåã€‚</li>
</ul>
<h4 id="å®‰è£…gccå’Œmake">å®‰è£…gccå’Œmake</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>apt<span style="color:#f92672">-</span>get install gcc automake autoconf libtool make</span></span></code></pre></div>
<p>windowä¸‹ç›´æ¥å®‰è£…cygwinï¼Œé€‰æ‹©gccå’Œmakeç­‰ç»„ä»¶å³å¯ï¼Œæˆ‘å·²ç»æå‰å®‰è£…ï¼Œå¦‚æœä¸çŸ¥é“æ€ä¹ˆå®‰è£…å¯å‚è€ƒï¼šhttps://blog.csdn.net/liaomin416100569/article/details/105127557?spm=1001.2014.3001.5501ã€‚</p>
<h4 id="golang">golang</h4>
<p>å®‰è£… golang 17ä»¥ä¸Šç‰ˆæœ¬</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>wget https:<span style="color:#75715e">//studygolang.com/dl/golang/go1.17.linux-amd64.tar.gz
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>tar zxvf go1<span style="color:#ae81ff">.17</span>.linux<span style="color:#f92672">-</span>amd64.tar.gz 
</span></span></code></pre></div>
<p>æˆ‘è¿™ç›´æ¥è§£å‹åœ¨/rootä¸‹ï¼Œ/etc/profileæ·»åŠ ç¯å¢ƒå˜é‡</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> GOPATH<span style="color:#f92672">=/</span>root<span style="color:#f92672">/</span>go
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> GOROOT<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$</span>{GOPATH}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> GOARCH<span style="color:#f92672">=</span><span style="color:#ae81ff">386</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> GOOS<span style="color:#f92672">=</span>linux
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> GOTOOLS<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$</span>GOROOT<span style="color:#f92672">/</span>pkg<span style="color:#f92672">/</span>tool
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> PATH<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$</span>PATH:<span style="color:#960050;background-color:#1e0010">$</span>GOROOT<span style="color:#f92672">/</span>bin:<span style="color:#960050;background-color:#1e0010">$</span>GOPATH<span style="color:#f92672">/</span>bin</span></span></code></pre></div>
<p>è®©é…ç½®ç”Ÿæ•ˆ å¹¶ä¿®æ”¹golangçš„ç§æœ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>source <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>profile <span style="color:#f92672">&amp;&amp;</span> go env <span style="color:#f92672">-</span>w GOPROXY<span style="color:#f92672">=</span>https:<span style="color:#75715e">//mirrors.aliyun.com/goproxy/
</span></span></span></code></pre></div>
<p>æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>root<span style="color:#960050;background-color:#1e0010">@</span>liaok8s:<span style="color:#f92672">~/</span>go<span style="color:#960050;background-color:#1e0010">#</span> go version                   
</span></span><span style="display:flex;"><span>go version go1<span style="color:#ae81ff">.17</span> linux<span style="color:#f92672">/</span>amd64
</span></span><span style="display:flex;"><span>root<span style="color:#960050;background-color:#1e0010">@</span>liaok8s:<span style="color:#f92672">~/</span>go<span style="color:#960050;background-color:#1e0010">#</span> go env <span style="color:#f92672">|</span> grep GOPROXY
</span></span><span style="display:flex;"><span>GOPROXY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://mirrors.aliyun.com/goproxy/&#34;</span></span></span></code></pre></div>
<h4 id="å®‰è£…docker">å®‰è£…docker</h4>
<p>å¼€å‘æœ¬æœºéœ€å®‰è£…dockerï¼Œoperatorçš„controlleréœ€è¦ç”Ÿæˆdockeré•œåƒ
linuxæœºå™¨ä½¿ç”¨ yumæˆ–è€…apt-getå®‰è£… docker-ceå³å¯
windowå®‰è£…docker desktopå³å¯ã€‚</p>
<h4 id="å®‰è£…docker-registry">å®‰è£…docker registry</h4>
<p>å®‰è£…å¯ç”¨çš„docker registry | nexus | harbor
harborå®‰è£…å‚è€ƒï¼šhttps://blog.csdn.net/liaomin416100569/article/details/86599571
è¿™é‡Œç›´æ¥é€‰æ‹©docker registry (æˆ‘çš„ipï¼š10.10.0.115ï¼Œåç»­è®¾ç½®ä¸€ä¸ªæœ¬åœ°åŸŸå:jiaozi.com)</p>
<blockquote>
<p>è¿™é‡Œä¸ºäº†ç®€å•ï¼Œå°±ä¸è®¾ç½®è´¦å·å¯†ç æƒé™äº†ã€‚</p></blockquote>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>docker run <span style="color:#f92672">-</span>d <span style="color:#f92672">-</span>p <span style="color:#ae81ff">5000</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5000</span> <span style="color:#f92672">--</span>name registry <span style="color:#f92672">--</span>restart<span style="color:#f92672">=</span>always <span style="color:#f92672">-</span>v <span style="color:#f92672">/</span>opt<span style="color:#f92672">/</span>registry<span style="color:#f92672">/</span>data:<span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>lib<span style="color:#f92672">/</span>registry docker.io<span style="color:#f92672">/</span>registry</span></span></code></pre></div>
<p>æ£€æµ‹å­˜åœ¨çš„é•œåƒ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span> curl http:<span style="color:#75715e">//127.0.0.1:5000/v2/_catalog
</span></span></span></code></pre></div>
<p>åœ¨å¼€å‘çš„windowå’Œk8sçš„workerèŠ‚ç‚¹ linux(/etc/docker/daemon.json)è®¾ç½®ï¼Œæ”¹åé‡å¯;</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;insecure-registries&#34;</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;jiaozi.com:5000&#34;</span>
</span></span><span style="display:flex;"><span>  ],</span></span></code></pre></div>
<p>åœ¨å¼€å‘çš„æœ¬åœ°æœºå™¨å’Œk8sçš„workerèŠ‚ç‚¹ç»‘å®šhosts</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">æ­£åœ¨</span> Ping jiaozi.com [<span style="color:#ae81ff">10.10.0.115</span>] <span style="color:#960050;background-color:#1e0010">å…·æœ‰</span> <span style="color:#ae81ff">32</span> <span style="color:#960050;background-color:#1e0010">å­—èŠ‚çš„æ•°æ®</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">æ¥è‡ª</span> <span style="color:#ae81ff">10.10.0.115</span> <span style="color:#960050;background-color:#1e0010">çš„å›å¤</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">å­—èŠ‚</span><span style="color:#f92672">=</span><span style="color:#ae81ff">32</span> <span style="color:#960050;background-color:#1e0010">æ—¶é—´</span><span style="color:#f92672">&lt;</span><span style="color:#ae81ff">1</span>ms TTL<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">æ¥è‡ª</span> <span style="color:#ae81ff">10.10.0.115</span> <span style="color:#960050;background-color:#1e0010">çš„å›å¤</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">å­—èŠ‚</span><span style="color:#f92672">=</span><span style="color:#ae81ff">32</span> <span style="color:#960050;background-color:#1e0010">æ—¶é—´</span><span style="color:#f92672">&lt;</span><span style="color:#ae81ff">1</span>ms TTL<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">æ¥è‡ª</span> <span style="color:#ae81ff">10.10.0.115</span> <span style="color:#960050;background-color:#1e0010">çš„å›å¤</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">å­—èŠ‚</span><span style="color:#f92672">=</span><span style="color:#ae81ff">32</span> <span style="color:#960050;background-color:#1e0010">æ—¶é—´</span><span style="color:#f92672">&lt;</span><span style="color:#ae81ff">1</span>ms TTL<span style="color:#f92672">=</span><span style="color:#ae81ff">63</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10.10.0.115</span> <span style="color:#960050;background-color:#1e0010">çš„</span> Ping <span style="color:#960050;background-color:#1e0010">ç»Ÿè®¡ä¿¡æ¯</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">æ•°æ®åŒ…</span><span style="color:#f92672">:</span> <span style="color:#960050;background-color:#1e0010">å·²å‘é€</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">ï¼Œå·²æ¥æ”¶</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">ï¼Œä¸¢å¤±</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> (<span style="color:#ae81ff">0</span><span style="color:#f92672">%</span> <span style="color:#960050;background-color:#1e0010">ä¸¢å¤±</span>)<span style="color:#960050;background-color:#1e0010">ï¼Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">å¾€è¿”è¡Œç¨‹çš„ä¼°è®¡æ—¶é—´</span>(<span style="color:#960050;background-color:#1e0010">ä»¥æ¯«ç§’ä¸ºå•ä½</span>)<span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">æœ€çŸ­</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>ms<span style="color:#960050;background-color:#1e0010">ï¼Œæœ€é•¿</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>ms<span style="color:#960050;background-color:#1e0010">ï¼Œå¹³å‡</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>ms</span></span></code></pre></div>
<p>æµ‹è¯•ä¸Šä¼ ä¸€ä¸ªé•œåƒ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>docker pull nginx <span style="color:#f92672">&amp;&amp;</span> docker tag nginx jiaozi.com:<span style="color:#ae81ff">5000</span><span style="color:#f92672">/</span>nginx <span style="color:#f92672">&amp;&amp;</span> docker push jiaozi.com:<span style="color:#ae81ff">5000</span><span style="color:#f92672">/</span>nginx  <span style="color:#f92672">&amp;&amp;</span> curl jiaozi.com<span style="color:#f92672">/</span><span style="color:#ae81ff">5000</span><span style="color:#f92672">/</span>v2<span style="color:#f92672">/</span>_catalog
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#34;repositories&#34;</span><span style="color:#f92672">:</span>[<span style="color:#e6db74">&#34;nginx&#34;</span>]}</span></span></code></pre></div>
<h4 id="å®‰è£…kubectl">å®‰è£…kubectl</h4>
<p>è®©å¼€å‘çš„æœºå™¨å¯ä»¥é€šè¿‡kubectlè®¿é—®é›†ç¾¤ï¼Œä¸€èˆ¬ç”¨windowå¼€å‘çš„ è¯ï¼Œæ–°ç‰ˆçš„docker desktopéƒ½å¸¦ä¸Šå†…ç½®çš„k8sï¼Œè‡ªç„¶è‡ªå¸¦kubectlå‘½ä»¤ï¼Œå¯å°†è¿œç¨‹k8sé›†ç¾¤çš„åˆå§‹åŒ–æ—¶ç”Ÿæˆçš„configæ–‡ä»¶æ‹·è´åˆ°å‡ºæ¥</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Your Kubernetes control<span style="color:#f92672">-</span>plane has initialized successfully<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>To start <span style="color:#66d9ef">using</span> your cluster, you need to run the following as a regular user:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  mkdir <span style="color:#f92672">-</span>p <span style="color:#960050;background-color:#1e0010">$</span>HOME<span style="color:#f92672">/</span>.kube
</span></span><span style="display:flex;"><span>  sudo cp <span style="color:#f92672">-</span>i <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>kubernetes<span style="color:#f92672">/</span>admin.conf <span style="color:#960050;background-color:#1e0010">$</span>HOME<span style="color:#f92672">/</span>.kube<span style="color:#f92672">/</span>config
</span></span><span style="display:flex;"><span>  sudo chown <span style="color:#960050;background-color:#1e0010">$</span>(id <span style="color:#f92672">-</span>u)<span style="color:#f92672">:</span><span style="color:#960050;background-color:#1e0010">$</span>(id <span style="color:#f92672">-</span>g) <span style="color:#960050;background-color:#1e0010">$</span>HOME<span style="color:#f92672">/</span>.kube<span style="color:#f92672">/</span>config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Alternatively, <span style="color:#66d9ef">if</span> you are the root user, you can run:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">export</span> KUBECONFIG<span style="color:#f92672">=/</span>etc<span style="color:#f92672">/</span>kubernetes<span style="color:#f92672">/</span>admin.conf</span></span></code></pre></div>
<p>ä¸€èˆ¬å°±æ˜¯/etc/kubernetes/admin.confï¼Œæ”¾åˆ°windowçš„  %USERPROFILE%/.kube/configæ–‡ä»¶å³å¯</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>C:<span style="color:#960050;background-color:#1e0010">\</span>Users<span style="color:#960050;background-color:#1e0010">\</span>liaomin<span style="color:#f92672">&gt;</span>echo <span style="color:#f92672">%</span>USERPROFILE<span style="color:#f92672">%</span>
</span></span><span style="display:flex;"><span>C:<span style="color:#960050;background-color:#1e0010">\</span>Users<span style="color:#960050;background-color:#1e0010">\</span>liaomin mkdir <span style="color:#f92672">%</span>USERPROFILE<span style="color:#f92672">%</span><span style="color:#960050;background-color:#1e0010">\</span>.kube
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">å°†</span>admin.confé‡å‘½åä¸ºconfigæ–‡ä»¶å³å¯</span></span></code></pre></div>
<p><a href="#R-image-81fd994a2c612fe1f9c76581522213a2" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/632aea0b9b437bfa7bb96459825c8f80.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-81fd994a2c612fe1f9c76581522213a2"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/632aea0b9b437bfa7bb96459825c8f80.png"></a>
æµ‹è¯•</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>C:<span style="color:#960050;background-color:#1e0010">\</span>Users<span style="color:#960050;background-color:#1e0010">\</span>liaomin<span style="color:#960050;background-color:#1e0010">\</span>.kube<span style="color:#f92672">&gt;</span>kubectl get pods
</span></span><span style="display:flex;"><span>NAME       READY   STATUS    RESTARTS        AGE
</span></span><span style="display:flex;"><span>dnsutils   <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     Running   <span style="color:#ae81ff">123</span> (<span style="color:#ae81ff">22</span>m ago)   <span style="color:#ae81ff">5</span>d2h
</span></span><span style="display:flex;"><span>nginx      <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     Running   <span style="color:#ae81ff">1</span> (<span style="color:#ae81ff">22</span>m ago)     <span style="color:#ae81ff">5</span>d3h</span></span></code></pre></div>
<h3 id="å®‰è£…operator-sdk">å®‰è£…operator-sdk</h3>
<p>å®‰è£…è¿‡ç¨‹è¯·å‚è€ƒï¼šhttps://sdk.operatorframework.io/docs/installation/
émacoså»ºè®®æºä»£ç å®‰è£…ï¼Œwindowçš„è¯å…ˆå®‰è£…cygwinï¼Œæ‰“å¼€cygwin Terminal æ‰§è¡Œå‘½ä»¤ã€‚</p>
<blockquote>
<p>windowä¸‹å‡çº§go  go get golang.org/dl/go<!-- raw HTML omitted --> &amp;&amp; go<!-- raw HTML omitted --> download  ä¸‹è½½å®Œæˆåï¼Œwindowä¸‹ç›´æ¥å®‰è£…åœ¨ï¼Œ%USERPROFILE%\sdk ç›®å½•ä¸‹ï¼Œå¯ç›´æ¥ä¿®æ”¹pathåˆ° %USERPROFILE%\sdk\go<!-- raw HTML omitted -->\binç›®å½•ä¸‹ã€‚</p></blockquote>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>git clone https:<span style="color:#75715e">//github.com/operator-framework/operator-sdk
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>cd <span style="color:#66d9ef">operator</span><span style="color:#f92672">-</span>sdk
</span></span><span style="display:flex;"><span>git checkout master
</span></span><span style="display:flex;"><span>make install</span></span></code></pre></div>
<p>å®‰è£…å®Œæˆå</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>root<span style="color:#960050;background-color:#1e0010">@</span>liaok8s:<span style="color:#f92672">~/</span>go<span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">-</span>sdk version
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">operator</span><span style="color:#f92672">-</span>sdk version: <span style="color:#e6db74">&#34;v1.17.0-3-g158da144-dirty&#34;</span>, commit: <span style="color:#e6db74">&#34;158da1444dc400bcc7402e4e47787d56a9b4f4ad&#34;</span>, kubernetes version: <span style="color:#e6db74">&#34;v1.21&#34;</span>, go version: <span style="color:#e6db74">&#34;go1.17&#34;</span>, GOOS: <span style="color:#e6db74">&#34;linux&#34;</span>, GOARCH: <span style="color:#e6db74">&#34;amd64&#34;</span></span></span></code></pre></div>
<blockquote>
<p>windowå®‰è£…å®Œæˆåç›®å½•ä¸ºï¼š
$ which operator-sdk
/cygdrive/c/Users/liaomin/go/bin/operator-sdk</p></blockquote>
<h3 id="operator-sdkå®ä¾‹">operator-sdkå®ä¾‹</h3>
<p>ä»¥ä¸‹å®ä¾‹å‚è€ƒè‡ªå®˜æ–¹æ–‡æ¡£ï¼šhttps://sdk.operatorframework.io/docs/building-operators/golang/tutorial/
åŠŸèƒ½å®ç°å¦‚ä¸‹ï¼š
å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹é¡¹ç›®</p>
<ol>
<li>å¦‚æœä¸å­˜åœ¨å³åˆ›å»ºä¸€ä¸ªnginx Deployment</li>
<li>ç¡®ä¿deployçš„å¤§å°å’ŒCRæ–‡ä»¶åˆ¶å®šçš„å¤§å°ä¸€è‡´</li>
<li>æ›´æ–°nginx CRçš„çŠ¶æ€ï¼ˆåŒæ­¥åå­—ç›¸åŒçš„PODSçŠ¶æ€ï¼‰</li>
</ol>
<h4 id="åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®</h4>
<p>åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„é¡¹ç›®åŒ…å«ä»¥ä¸‹å†…å®¹ :</p>
<ul>
<li>go.mod  é¡¹ç›®ä¾èµ–ã€‚</li>
<li>PROJECT å­˜å‚¨é¡¹ç›®çš„é…ç½®ã€‚</li>
<li>Makefile  ä¸€äº›å¸¸ç”¨çš„make targetsã€‚</li>
<li>configç›®å½•ä¸‹è®¸å¤šYAML files ç”¨äºé¡¹ç›®å‘å¸ƒã€‚</li>
<li>main.go ç”¨äºåˆ›å»º managerï¼Œè¿è¡Œé¡¹ç›®controllersã€‚</li>
</ul>
<blockquote>
<p>æ›´åŠ è¯¦ç»†çš„ç›®å½•ç»“æœä¿¡æ¯å¯æŸ¥çœ‹kubebuilderæ–‡æ¡£ï¼šhttps://book.kubebuilder.io/cronjob-tutorial/basic-project.html</p></blockquote>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>liaomin<span style="color:#960050;background-color:#1e0010">@</span>DESKTOP<span style="color:#f92672">-</span>FSEDE3P <span style="color:#f92672">/</span>cygdrive<span style="color:#f92672">/</span>d<span style="color:#f92672">/</span>code1<span style="color:#f92672">/</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">-</span>sdk init <span style="color:#f92672">--</span>domain jiaozi.com <span style="color:#f92672">--</span>repo github.com<span style="color:#f92672">/</span>lzeqian<span style="color:#f92672">/</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span>
</span></span><span style="display:flex;"><span>Writing kustomize manifests <span style="color:#66d9ef">for</span> you to edit...
</span></span><span style="display:flex;"><span>Writing scaffold <span style="color:#66d9ef">for</span> you to edit...
</span></span><span style="display:flex;"><span>Get controller runtime:
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> go get sigs.k8s.io<span style="color:#f92672">/</span>controller<span style="color:#f92672">-</span>runtime<span style="color:#960050;background-color:#1e0010">@</span>v0<span style="color:#ae81ff">.11.0</span>
</span></span><span style="display:flex;"><span>Update dependencies:
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> go mod tidy
</span></span><span style="display:flex;"><span>Next: define a resource with:
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">-</span>sdk create api</span></span></code></pre></div>
<h4 id="åˆ›å»ºapi">åˆ›å»ºapi</h4>
<p>é€šè¿‡è„šæ‰‹æ¶ç”Ÿæˆä¸€ä¸ªcrdå’Œcontrollerçš„apiï¼Œæ²¡æœ‰æ²¡æœ‰æŒ‡å®š&ndash;resource &ndash;controllerï¼Œå°†ä¼šé€šè¿‡äº¤äº’é€šè¿‡ç”¨æˆ·ç¡®è®¤æ˜¯å¦ç”Ÿæˆï¼Œå‘½ä»¤æ‰§è¡Œæ—¶ç›¸å…³çš„golangä¾èµ–å°†è‡ªåŠ¨ä¸‹è½½å®‰è£…ã€‚</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">operator</span><span style="color:#f92672">-</span>sdk create api <span style="color:#f92672">--</span>group test <span style="color:#f92672">--</span>version v1alpha1 <span style="color:#f92672">--</span>kind HelloWorld <span style="color:#f92672">--</span>resource <span style="color:#f92672">--</span>controller</span></span></code></pre></div>
<p>ç”Ÿæˆäº†ä¸€ä¸ªapiå’Œcontrollerç›®å½•åŒ…å«apiçš„ç»“æ„ä½“å®šä¹‰å’Œcontrollerä»£ç ã€‚
å¦‚æœä½¿ç”¨cygwin terminalå»æ‰§è¡Œä¸€èˆ¬éƒ½ä¼šæŠ¥é”™</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">-</span>sdk create api <span style="color:#f92672">--</span>group test <span style="color:#f92672">--</span>version v1alpha1 <span style="color:#f92672">--</span>kind HelloWorld <span style="color:#f92672">--</span>resource <span style="color:#f92672">--</span>controller
</span></span><span style="display:flex;"><span>Writing kustomize manifests <span style="color:#66d9ef">for</span> you to edit...
</span></span><span style="display:flex;"><span>Writing scaffold <span style="color:#66d9ef">for</span> you to edit...
</span></span><span style="display:flex;"><span>api<span style="color:#960050;background-color:#1e0010">\</span>v1alpha1<span style="color:#960050;background-color:#1e0010">\</span>helloworld_types.go
</span></span><span style="display:flex;"><span>controllers<span style="color:#960050;background-color:#1e0010">\</span>helloworld_controller.go
</span></span><span style="display:flex;"><span>Update dependencies:
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> go mod tidy
</span></span><span style="display:flex;"><span>Running make:
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> make generate
</span></span><span style="display:flex;"><span>go: creating <span style="color:#66d9ef">new</span> go.mod: module tmp
</span></span><span style="display:flex;"><span>Downloading sigs.k8s.io<span style="color:#f92672">/</span>controller<span style="color:#f92672">-</span>tools<span style="color:#f92672">/</span>cmd<span style="color:#f92672">/</span>controller<span style="color:#f92672">-</span>gen<span style="color:#960050;background-color:#1e0010">@</span>v0<span style="color:#ae81ff">.8.0</span>
</span></span><span style="display:flex;"><span>go get: installing executables with <span style="color:#960050;background-color:#1e0010">&#39;</span>go get<span style="color:#960050;background-color:#1e0010">&#39;</span> in module mode is deprecated.
</span></span><span style="display:flex;"><span>        To adjust and download dependencies of the current module, use <span style="color:#960050;background-color:#1e0010">&#39;</span>go get <span style="color:#f92672">-</span>d<span style="color:#960050;background-color:#1e0010">&#39;</span>.
</span></span><span style="display:flex;"><span>        To install <span style="color:#66d9ef">using</span> requirements of the current module, use <span style="color:#960050;background-color:#1e0010">&#39;</span>go install<span style="color:#960050;background-color:#1e0010">&#39;</span>.
</span></span><span style="display:flex;"><span>        To install ignoring the current module, use <span style="color:#960050;background-color:#1e0010">&#39;</span>go install<span style="color:#960050;background-color:#1e0010">&#39;</span> with a version,
</span></span><span style="display:flex;"><span>        like <span style="color:#960050;background-color:#1e0010">&#39;</span>go install example.com<span style="color:#f92672">/</span>cmd<span style="color:#960050;background-color:#1e0010">@</span>latest<span style="color:#960050;background-color:#1e0010">&#39;</span>.
</span></span><span style="display:flex;"><span>        For more information, see https:<span style="color:#75715e">//golang.org/doc/go-get-install-deprecation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        or run <span style="color:#960050;background-color:#1e0010">&#39;</span>go help get<span style="color:#960050;background-color:#1e0010">&#39;</span> or <span style="color:#960050;background-color:#1e0010">&#39;</span>go help install<span style="color:#960050;background-color:#1e0010">&#39;</span>.
</span></span><span style="display:flex;"><span>cannot install, GOBIN must be an absolute path
</span></span><span style="display:flex;"><span>make: <span style="color:#f92672">***</span> [Makefile:<span style="color:#ae81ff">142</span><span style="color:#960050;background-color:#1e0010">ï¼š</span>controller<span style="color:#f92672">-</span>gen] <span style="color:#960050;background-color:#1e0010">é”™è¯¯</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Error: failed to create API: unable to run post<span style="color:#f92672">-</span>scaffold tasks of <span style="color:#e6db74">&#34;base.go.kubebuilder.io/v3&#34;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span> exit status <span style="color:#ae81ff">2</span></span></span></code></pre></div>
<p>é€šè¿‡é”™è¯¯å¯ä»¥çŸ¥é“æ˜¯åœ¨æ‰§è¡Œmake generateæ—¶ä¸‹è½½sigs.k8s.io/controller-tools/cmd/controller-gen@v0.8.0æŠ¥é”™ï¼Œé”™è¯¯æ˜¯GOBIN must be an absolute pathï¼Œè¯´æ˜GOBINå¯¹åº”çš„è·¯å¾„æ˜¯é”™çš„å¯¼è‡´ä¸‹è½½çš„åŒ…æ— æ³•å†™å…¥ï¼Œé€šè¿‡æŸ¥çœ‹Makefileçš„generateä»»åŠ¡ä¼šè°ƒç”¨ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°go-get-tool</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e"># go-get-tool will &#39;go get&#39; any package $2 and install it to $1.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>PROJECT_DIR :<span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">$</span>(shell dirname <span style="color:#960050;background-color:#1e0010">$</span>(abspath <span style="color:#960050;background-color:#1e0010">$</span>(lastword <span style="color:#960050;background-color:#1e0010">$</span>(MAKEFILE_LIST))))
</span></span><span style="display:flex;"><span>define go<span style="color:#f92672">-</span>get<span style="color:#f92672">-</span>tool
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>[ <span style="color:#f92672">-</span>f <span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#ae81ff">1</span>) ] <span style="color:#f92672">||</span> { \
</span></span><span style="display:flex;"><span>set <span style="color:#f92672">-</span>e ;\
</span></span><span style="display:flex;"><span>TMP_DIR<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$$</span>(mktemp <span style="color:#f92672">-</span>d) ;\
</span></span><span style="display:flex;"><span>cd <span style="color:#960050;background-color:#1e0010">$$</span>TMP_DIR ;\
</span></span><span style="display:flex;"><span>go mod init tmp ;\
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Downloading $(2) $(PROJECT_DIR)&#34;</span> ;\
</span></span><span style="display:flex;"><span>GOBIN<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$</span>(PROJECT_DIR)<span style="color:#f92672">/</span>bin go get <span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#ae81ff">2</span>) ;\
</span></span><span style="display:flex;"><span>rm <span style="color:#f92672">-</span>rf <span style="color:#960050;background-color:#1e0010">$$</span>TMP_DIR ;\
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>endef</span></span></code></pre></div>
<p>å‘ç°å…¶ä¸­ä¸€å¥ï¼šGOBIN=$(PROJECT_DIR)/bin go get $(2) ;<br>
è®¾ç½®GOBIN=å½“å‰é¡¹ç›®ç›®å½•/binç›®å½•ç„¶åæ‰§è¡Œ go getå‘½ä»¤ï¼Œæ‰“å°GOBINå‘ç°è·¯å¾„æ˜¯ï¼š/cygdrive/d/code1/helloworld-operatorï¼Œå¯¹äºgogetæ¥è¯´ç¨‹åºå†…éƒ¨è‚¯å®šæ˜¯ä¸èƒ½è¯†åˆ«è¿™ä¸ªè·¯å¾„ï¼Œä½†æ˜¯å‘½ä»¤è¡Œæ˜¯å¯ä»¥è¯†åˆ«çš„ï¼Œæ¯”å¦‚mkdir  /cygdrive/d/code1/helloworld-operator/aaæ˜¯å¯è¡Œçš„ï¼Œæˆ‘åªéœ€è¦å°†
PROJECT_DIR := $(shell dirname $(abspath $(lastword $(MAKEFILE_LIST)))) æ›¿æ¢ä¸ºå®é™…çš„ç›®å½•å³å¯
ä¿®æ”¹PROJECT_DIR=ä½ é¡¹ç›®çš„æ ¹ç›®å½•å³å¯</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e"># go-get-tool will &#39;go get&#39; any package $2 and install it to $1.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>PROJECT_DIR :<span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">$</span>(shell dirname <span style="color:#960050;background-color:#1e0010">$</span>(abspath <span style="color:#960050;background-color:#1e0010">$</span>(lastword <span style="color:#960050;background-color:#1e0010">$</span>(MAKEFILE_LIST))))
</span></span><span style="display:flex;"><span>PROJECT_DIR :<span style="color:#f92672">=</span> D:<span style="color:#f92672">/</span>code1<span style="color:#f92672">/</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>define go<span style="color:#f92672">-</span>get<span style="color:#f92672">-</span>tool
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>[ <span style="color:#f92672">-</span>f <span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#ae81ff">1</span>) ] <span style="color:#f92672">||</span> { \
</span></span><span style="display:flex;"><span>set <span style="color:#f92672">-</span>e ;\
</span></span><span style="display:flex;"><span>TMP_DIR<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$$</span>(mktemp <span style="color:#f92672">-</span>d) ;\
</span></span><span style="display:flex;"><span>cd <span style="color:#960050;background-color:#1e0010">$$</span>TMP_DIR ;\
</span></span><span style="display:flex;"><span>go mod init tmp ;\
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;Downloading $(2) $(PROJECT_DIR)&#34;</span> ;\
</span></span><span style="display:flex;"><span>GOBIN<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">$</span>(PROJECT_DIR)<span style="color:#f92672">/</span>bin go get <span style="color:#960050;background-color:#1e0010">$</span>(<span style="color:#ae81ff">2</span>) ;\
</span></span><span style="display:flex;"><span>rm <span style="color:#f92672">-</span>rf <span style="color:#960050;background-color:#1e0010">$$</span>TMP_DIR ;\
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>endef</span></span></code></pre></div>
<p>ä¿®æ”¹å®Œæˆåæ­£å¸¸æ‰§è¡Œï¼Œå¹¶ä¸”æ ¹ç›®å½•ç”Ÿæˆäº†binç›®å½•ï¼Œå¹¶ä¸”ä¸‹è½½äº†controller-gen
<a href="#R-image-f32fbeca75f89e51421fb11aac40858d" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/8217f75b3deb3628b97d0326c5aac294.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f32fbeca75f89e51421fb11aac40858d"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/8217f75b3deb3628b97d0326c5aac294.png"></a>
ä¿®æ”¹api/v1alpha1/helloworld_types.go æ–‡ä»¶</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>package v1alpha1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">import</span> (
</span></span><span style="display:flex;"><span>	metav1 <span style="color:#e6db74">&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">æœ€åå‘å¸ƒåçš„crå°±æ˜¯è¿™æ ·
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">kubectl get memcached/memcached-sample -o yaml
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">apiVersion: cache.example.com/v1alpha1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">kind: Memcached
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  clusterName: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  creationTimestamp: 2018-03-31T22:51:08Z
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  generation: 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  name: memcached-sample
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  namespace: default
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  resourceVersion: &#34;245453&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  selfLink: /apis/cache.example.com/v1alpha1/namespaces/default/memcacheds/memcached-sample
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  uid: 0026cc97-3536-11e8-bd83-0800274106a1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  size: 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">status:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  nodes:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  - memcached-sample-6fd7c98d8-7dqdr
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  - memcached-sample-6fd7c98d8-g5k7v
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  - memcached-sample-6fd7c98d8-m7vn7
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// HelloWorldSpec å®šä¹‰ä¸Šé¢specçš„éƒ¨åˆ†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>type HelloWorldSpec <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//å¯¹åº”crdè‡ªå®šä¹‰å­—æ®µ spec.size
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	Size int32 <span style="color:#960050;background-color:#1e0010">`</span>json:<span style="color:#e6db74">&#34;size&#34;</span><span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// HelloWorldStatuså®šä¹‰HelloWorldçš„çŠ¶æ€è§‚å¯Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>type HelloWorldStatus <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	Nodes []string <span style="color:#960050;background-color:#1e0010">`</span>json:<span style="color:#e6db74">&#34;nodes&#34;</span><span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//è¡¨ç¤ºä¸‹é¢è¿™ä¸ªç»“æ„æ˜¯yamlçš„æ ¹ åŒæ—¶æ·»åŠ å­èµ„æºçŠ¶æ€å’Œscale
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//+kubebuilder:object:root=true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//+kubebuilder:subresource:status
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// HelloWorldæ˜¯ helloworlds APIçš„å®šä¹‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>type HelloWorld <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	metav1.TypeMeta   <span style="color:#960050;background-color:#1e0010">`</span>json:<span style="color:#e6db74">&#34;,inline&#34;</span><span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>	metav1.ObjectMeta <span style="color:#960050;background-color:#1e0010">`</span>json:<span style="color:#e6db74">&#34;metadata,omitempty&#34;</span><span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	Spec   HelloWorldSpec   <span style="color:#960050;background-color:#1e0010">`</span>json:<span style="color:#e6db74">&#34;spec,omitempty&#34;</span><span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>	Status HelloWorldStatus <span style="color:#960050;background-color:#1e0010">`</span>json:<span style="color:#e6db74">&#34;status,omitempty&#34;</span><span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//+kubebuilder:object:root=true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// HelloWorldList åŒ…å«å¤šä¸ª HelloWorld
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>type HelloWorldList <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	metav1.TypeMeta <span style="color:#960050;background-color:#1e0010">`</span>json:<span style="color:#e6db74">&#34;,inline&#34;</span><span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>	metav1.ListMeta <span style="color:#960050;background-color:#1e0010">`</span>json:<span style="color:#e6db74">&#34;metadata,omitempty&#34;</span><span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>	Items           []HelloWorld <span style="color:#960050;background-color:#1e0010">`</span>json:<span style="color:#e6db74">&#34;items&#34;</span><span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>func <span style="color:#a6e22e">init</span>() {
</span></span><span style="display:flex;"><span>	SchemeBuilder.Register(<span style="color:#f92672">&amp;</span>HelloWorld{}, <span style="color:#f92672">&amp;</span>HelloWorldList{})
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>æ‰§è¡Œå‘½ä»¤</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>make generate</span></span></code></pre></div>
<blockquote>
<p>è¯¥å‘½ä»¤ä¼šæ‰§è¡Œcontroller-gen å·¥å…·æ›´æ–° api/v1alpha1/zz_generated.deepcopy.go</p></blockquote>
<p>æ‰§è¡Œå‘½ä»¤</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>make manifests</span></span></code></pre></div>
<blockquote>
<p>å°†æ‰§è¡Œ controller-genç”Ÿæˆ CRDæ–‡ä»¶ï¼š config/crd/bases/test.jiaozi.com_helloworlds.yaml</p></blockquote>
<p>ç”Ÿæˆçš„crdæ–‡ä»¶å’Œå®šä¹‰çš„goä»£ç æ˜¯ä¸€è‡´çš„</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#f92672">---</span>
</span></span><span style="display:flex;"><span>apiVersion: apiextensions.k8s.io<span style="color:#f92672">/</span>v1
</span></span><span style="display:flex;"><span>kind: CustomResourceDefinition
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  annotations:
</span></span><span style="display:flex;"><span>    controller<span style="color:#f92672">-</span>gen.kubebuilder.io<span style="color:#f92672">/</span>version: v0<span style="color:#ae81ff">.8.0</span>
</span></span><span style="display:flex;"><span>  creationTimestamp: null
</span></span><span style="display:flex;"><span>  name: helloworlds.test.jiaozi.com
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  group: test.jiaozi.com
</span></span><span style="display:flex;"><span>  names:
</span></span><span style="display:flex;"><span>    kind: HelloWorld
</span></span><span style="display:flex;"><span>    listKind: HelloWorldList
</span></span><span style="display:flex;"><span>    plural: helloworlds
</span></span><span style="display:flex;"><span>    singular: helloworld
</span></span><span style="display:flex;"><span>  scope: Namespaced
</span></span><span style="display:flex;"><span>  versions:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> name: v1alpha1
</span></span><span style="display:flex;"><span>    schema:
</span></span><span style="display:flex;"><span>      openAPIV3Schema:
</span></span><span style="display:flex;"><span>        description: <span style="color:#960050;background-color:#1e0010">è¡¨ç¤ºä¸‹é¢è¿™ä¸ªç»“æ„æ˜¯</span>yamlçš„æ ¹ <span style="color:#960050;background-color:#1e0010">åŒæ—¶æ·»åŠ å­èµ„æºçŠ¶æ€å’Œ</span>scale HelloWorldæ˜¯ helloworlds APIçš„å®šä¹‰
</span></span><span style="display:flex;"><span>        properties:
</span></span><span style="display:flex;"><span>          apiVersion:
</span></span><span style="display:flex;"><span>            description: <span style="color:#960050;background-color:#1e0010">&#39;</span>APIVersion defines the versioned schema of <span style="color:#66d9ef">this</span> representation
</span></span><span style="display:flex;"><span>              of an object. Servers should convert recognized schemas to the latest
</span></span><span style="display:flex;"><span>              internal value, and may reject unrecognized values. More info: https:<span style="color:#75715e">//git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            type: string
</span></span><span style="display:flex;"><span>          kind:
</span></span><span style="display:flex;"><span>            description: <span style="color:#960050;background-color:#1e0010">&#39;</span>Kind is a string value representing the REST resource <span style="color:#66d9ef">this</span>
</span></span><span style="display:flex;"><span>              object represents. Servers may infer <span style="color:#66d9ef">this</span> from the endpoint the client
</span></span><span style="display:flex;"><span>              submits requests to. Cannot be updated. In CamelCase. More info: https:<span style="color:#75715e">//git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            type: string
</span></span><span style="display:flex;"><span>          metadata:
</span></span><span style="display:flex;"><span>            type: object
</span></span><span style="display:flex;"><span>          spec:
</span></span><span style="display:flex;"><span>            description: HelloWorldSpec <span style="color:#960050;background-color:#1e0010">å®šä¹‰ä¸Šé¢</span>specçš„éƒ¨åˆ†
</span></span><span style="display:flex;"><span>            properties:
</span></span><span style="display:flex;"><span>              size:
</span></span><span style="display:flex;"><span>                description: <span style="color:#960050;background-color:#1e0010">å¯¹åº”</span>crdè‡ªå®šä¹‰å­—æ®µ spec.size
</span></span><span style="display:flex;"><span>                format: int32
</span></span><span style="display:flex;"><span>                type: integer
</span></span><span style="display:flex;"><span>            required:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">-</span> size
</span></span><span style="display:flex;"><span>            type: object
</span></span><span style="display:flex;"><span>          status:
</span></span><span style="display:flex;"><span>            description: HelloWorldStatuså®šä¹‰HelloWorldçš„çŠ¶æ€è§‚å¯Ÿ
</span></span><span style="display:flex;"><span>            properties:
</span></span><span style="display:flex;"><span>              nodes:
</span></span><span style="display:flex;"><span>                items:
</span></span><span style="display:flex;"><span>                  type: string
</span></span><span style="display:flex;"><span>                type: array
</span></span><span style="display:flex;"><span>            required:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">-</span> nodes
</span></span><span style="display:flex;"><span>            type: object
</span></span><span style="display:flex;"><span>        type: object
</span></span><span style="display:flex;"><span>    served: true
</span></span><span style="display:flex;"><span>    storage: true
</span></span><span style="display:flex;"><span>    subresources:
</span></span><span style="display:flex;"><span>      status: {}
</span></span><span style="display:flex;"><span>status:
</span></span><span style="display:flex;"><span>  acceptedNames:
</span></span><span style="display:flex;"><span>    kind: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    plural: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>  conditions: []
</span></span><span style="display:flex;"><span>  storedVersions: []</span></span></code></pre></div>
<h4 id="å®ç°controller">å®ç°controller</h4>
<p>å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„apiæ¥å£åŒ…å‚è€ƒï¼š</p>
<ol>
<li>corev1 &ldquo;k8s.io/api/core/v1&rdquo; æ ¸å¿ƒapiï¼Œæä¾›æ ¸å¿ƒç»“æ„å’Œæ¥å£ï¼Œyamlä¸­å¸¸ç”¨çš„Specå®šä¹‰åœ¨æ­¤ã€‚</li>
<li>metav1 &ldquo;k8s.io/apimachinery/pkg/apis/meta/v1&rdquo; yamlä¸­å¸¸ç”¨çš„metadataå®šä¹‰ï¼ŒObjectMeta,LabelSelectorç­‰åŸºæœ¬åœ¨æ­¤ã€‚</li>
<li>appsv1 &ldquo;k8s.io/api/apps/v1&rdquo; å¸¸ç”¨çš„åˆ›å»ºçš„crdæˆ–è€…å·²ç»å­˜åœ¨çš„rdç­‰éƒ½åœ¨æ­¤ï¼Œæ¯”å¦‚Deployments,Pod,Serviceç­‰ç­‰ã€‚</li>
</ol>
<p>å®ç°controllerä»£ç </p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>package controllers
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/go-logr/logr&#34;</span>
</span></span><span style="display:flex;"><span>	appsv1 <span style="color:#e6db74">&#34;k8s.io/api/apps/v1&#34;</span>
</span></span><span style="display:flex;"><span>	corev1 <span style="color:#e6db74">&#34;k8s.io/api/core/v1&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;k8s.io/apimachinery/pkg/api/errors&#34;</span>
</span></span><span style="display:flex;"><span>	metav1 <span style="color:#e6db74">&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;k8s.io/apimachinery/pkg/types&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;reflect&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;sigs.k8s.io/controller-runtime/pkg/controller/controllerutil&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;k8s.io/apimachinery/pkg/runtime&#34;</span>
</span></span><span style="display:flex;"><span>	ctrl <span style="color:#e6db74">&#34;sigs.k8s.io/controller-runtime&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;sigs.k8s.io/controller-runtime/pkg/client&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;sigs.k8s.io/controller-runtime/pkg/log&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	testv1alpha1 <span style="color:#e6db74">&#34;github.com/lzeqian/helloworld-operator/api/v1alpha1&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// HelloWorldReconciler reconciles a HelloWorld object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>type HelloWorldReconciler <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	client.Client
</span></span><span style="display:flex;"><span>	Log    logr.Logger <span style="color:#75715e">//æ—¥å¿—æ‰“å°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	Scheme <span style="color:#f92672">*</span>runtime.Scheme
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//+kubebuilder:rbac:groups=test.jiaozi.com,resources=helloworlds,verbs=get;list;watch;create;update;patch;delete
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//+kubebuilder:rbac:groups=test.jiaozi.com,resources=helloworlds/status,verbs=get;update;patch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//+kubebuilder:rbac:groups=test.jiaozi.com,resources=helloworlds/finalizers,verbs=update
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Reconcile is part of the main kubernetes reconciliation loop which aims to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// move the current state of the cluster closer to the desired state.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// TODO(user): Modify the Reconcile function to compare the state specified by
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// the HelloWorld object against the actual cluster state, and then
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// perform operations to make the cluster state reflect the state specified by
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// the user.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// For more details, check Reconcile and its Result here:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.11.0/pkg/reconcile
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>func (r <span style="color:#f92672">*</span>HelloWorldReconciler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) {
</span></span><span style="display:flex;"><span>	_ <span style="color:#f92672">=</span> log.FromContext(ctx)
</span></span><span style="display:flex;"><span>	r.Log.Info(<span style="color:#e6db74">&#34;recondileè¢«è°ƒç”¨&#34;</span> <span style="color:#f92672">+</span> req.Namespace <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">+</span> req.Name)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// TODO(user): your logic here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	helloworld :<span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>testv1alpha1.HelloWorld{}
</span></span><span style="display:flex;"><span>	err :<span style="color:#f92672">=</span> r.Client.Get(ctx, req.NamespacedName, helloworld)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> err <span style="color:#f92672">!=</span> nil {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//å¦‚æœæ˜¯æ‰¾ä¸åˆ°å¼‚å¸¸ è¯´æ˜è¿™ä¸ªcrå·²ç»è¢«åˆ é™¤äº†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> errors.IsNotFound(err) {
</span></span><span style="display:flex;"><span>			r.Log.Info(<span style="color:#e6db74">&#34;crdèµ„æºå·²ç»è¢«åˆ é™¤&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">//åœæ­¢loopå¾ªç¯ä¸åœ¨è®¢é˜…äº‹ä»¶ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#66d9ef">return</span> ctrl.Result{}, nil
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//è¿”å›é”™è¯¯ï¼Œä½†æ˜¯ç»§ç»­ç›‘å¬äº‹ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">return</span> ctrl.Result{}, err
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//æ‰¾åˆ°äº†crå°±å¯ä»¥ç¡®è®¤crä¸‹çš„deployæ˜¯å¦å­˜åœ¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	nginxDeployFound :<span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>appsv1.Deployment{}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//è·å–å½“å‰namespaceä¸‹çš„deploy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	errDeploy :<span style="color:#f92672">=</span> r.Client.Get(ctx, types.NamespacedName{Name: helloworld.Name, Namespace: helloworld.Namespace}, nginxDeployFound)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> errDeploy <span style="color:#f92672">!=</span> nil {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//ä¸å­˜åœ¨ï¼Œéœ€è¦åˆ›å»º
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> errors.IsNotFound(errDeploy) {
</span></span><span style="display:flex;"><span>			r.Log.Info(<span style="color:#e6db74">&#34;ä¸å­˜åœ¨deployï¼Œæ–°å»ºdeploy&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">//ç±»ä¼¼äºyamlçš„è¯­æ³•åˆ›å»ºngxindeploy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			nginxDeploy :<span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>appsv1.Deployment{
</span></span><span style="display:flex;"><span>				ObjectMeta: metav1.ObjectMeta{
</span></span><span style="display:flex;"><span>					Name:      helloworld.Name,
</span></span><span style="display:flex;"><span>					Namespace: helloworld.Namespace,
</span></span><span style="display:flex;"><span>				},
</span></span><span style="display:flex;"><span>				Spec: appsv1.DeploymentSpec{
</span></span><span style="display:flex;"><span>					Replicas: <span style="color:#f92672">&amp;</span>helloworld.Spec.Size,
</span></span><span style="display:flex;"><span>					Selector: <span style="color:#f92672">&amp;</span>metav1.LabelSelector{
</span></span><span style="display:flex;"><span>						MatchLabels: map[string]string{
</span></span><span style="display:flex;"><span>							<span style="color:#e6db74">&#34;hello_name&#34;</span><span style="color:#f92672">:</span> helloworld.Name,
</span></span><span style="display:flex;"><span>						},
</span></span><span style="display:flex;"><span>					},
</span></span><span style="display:flex;"><span>					Template: corev1.PodTemplateSpec{
</span></span><span style="display:flex;"><span>						ObjectMeta: metav1.ObjectMeta{
</span></span><span style="display:flex;"><span>							Labels: map[string]string{
</span></span><span style="display:flex;"><span>								<span style="color:#e6db74">&#34;hello_name&#34;</span><span style="color:#f92672">:</span> helloworld.Name,
</span></span><span style="display:flex;"><span>							},
</span></span><span style="display:flex;"><span>						},
</span></span><span style="display:flex;"><span>						Spec: corev1.PodSpec{
</span></span><span style="display:flex;"><span>							Containers: []corev1.Container{
</span></span><span style="display:flex;"><span>								{
</span></span><span style="display:flex;"><span>									Image: <span style="color:#e6db74">&#34;nginx&#34;</span>,
</span></span><span style="display:flex;"><span>									Name:  <span style="color:#e6db74">&#34;nginx&#34;</span>,
</span></span><span style="display:flex;"><span>									Ports: []corev1.ContainerPort{{
</span></span><span style="display:flex;"><span>										ContainerPort: <span style="color:#ae81ff">80</span>,
</span></span><span style="display:flex;"><span>										Name:          <span style="color:#e6db74">&#34;nginx&#34;</span>,
</span></span><span style="display:flex;"><span>									}},
</span></span><span style="display:flex;"><span>								},
</span></span><span style="display:flex;"><span>							},
</span></span><span style="display:flex;"><span>						},
</span></span><span style="display:flex;"><span>					},
</span></span><span style="display:flex;"><span>				},
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			controllerutil.SetControllerReference(helloworld, nginxDeploy, r.Scheme)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> err1 :<span style="color:#f92672">=</span> r.Client.Create(ctx, nginxDeploy); err1 <span style="color:#f92672">!=</span> nil {
</span></span><span style="display:flex;"><span>				r.Log.Info(<span style="color:#e6db74">&#34;ä¸å­˜åœ¨deployï¼Œæ–°å»ºdeployå¤±è´¥&#34;</span>)
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">return</span> ctrl.Result{}, errDeploy
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			r.Log.Info(<span style="color:#e6db74">&#34;ä¸å­˜åœ¨deployï¼Œæ–°å»ºdeployæˆåŠŸ&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> ctrl.Result{Requeue: true}, nil
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> ctrl.Result{}, errDeploy
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//å¦‚æœerræ˜¯ç©ºçš„è¯´æ˜æ‰¾åˆ°äº†ä¸€ä¸ªå·²ç»å­˜åœ¨çš„deploy,éœ€è¦åˆ¤æ–­deployå®é™…çš„ä¸ªæ•°å’Œé¢„æœŸcrdä¸Šçš„ä¸ªæ•°æ˜¯å¦ä¸€è‡´çš„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">*</span>nginxDeployFound.Spec.Replicas <span style="color:#f92672">!=</span> helloworld.Spec.Size {
</span></span><span style="display:flex;"><span>		r.Log.Info(<span style="color:#e6db74">&#34;deployå¯¹åº”podæ•°é‡é”™è¯¯ï¼Œæ›´æ–°deployä¸ºhellowordçš„size&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//ä¿®æ”¹åŸå§‹çš„å¯¹è±¡çš„spec.replicas
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		nginxDeployFound.Spec.Replicas <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>helloworld.Spec.Size
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//æ›´æ–°deploy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">if</span> err <span style="color:#f92672">=</span> r.Update(ctx, nginxDeployFound); err <span style="color:#f92672">!=</span> nil {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> ctrl.Result{}, err
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> ctrl.Result{Requeue: true}, nil
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//æ›´æ–°æ‰¾åˆ°çš„deployçš„podçš„æ•°é‡æ›´æ–°åˆ°helloworldçš„status.nodesä¸Š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	podList :<span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>corev1.PodList{}
</span></span><span style="display:flex;"><span>	listOpts :<span style="color:#f92672">=</span> []client.ListOption{
</span></span><span style="display:flex;"><span>		client.InNamespace(helloworld.Namespace),
</span></span><span style="display:flex;"><span>		client.MatchingLabels(map[string]string{
</span></span><span style="display:flex;"><span>			<span style="color:#e6db74">&#34;hello_name&#34;</span><span style="color:#f92672">:</span> helloworld.Name,
</span></span><span style="display:flex;"><span>		}),
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> err <span style="color:#f92672">=</span> r.List(ctx, podList, listOpts...); err <span style="color:#f92672">!=</span> nil {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> ctrl.Result{}, err
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// æ›´æ–°podçš„å®é™…ä¸ªæ•°çš„åå­—å†™å…¥åˆ°helloworldçš„statusä¸Š
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	podNames :<span style="color:#f92672">=</span> []string{}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> pn :<span style="color:#f92672">=</span> range podList.Items {
</span></span><span style="display:flex;"><span>		podNames <span style="color:#f92672">=</span> append(podNames, podList.Items[pn].Name)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>reflect.DeepEqual(podNames, helloworld.Status.Nodes) {
</span></span><span style="display:flex;"><span>		helloworld.Status.Nodes <span style="color:#f92672">=</span> podNames
</span></span><span style="display:flex;"><span>		r.Log.Info(<span style="color:#e6db74">&#34;æ›´æ–°çŠ¶æ€å¤šhellowordçš„å­status&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> err :<span style="color:#f92672">=</span> r.Status().Update(ctx, helloworld); err <span style="color:#f92672">!=</span> nil {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> ctrl.Result{}, err
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> ctrl.Result{}, nil
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// forè¡¨ç¤ºç›‘æ§çš„crçš„ç±»å‹ï¼ŒOwnsè¡¨ç¤ºç›‘æ§çš„ç¬¬äºŒèµ„æºä¹Ÿå°±æ˜¯créœ€è¦æ§åˆ¶çš„èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>func (r <span style="color:#f92672">*</span>HelloWorldReconciler) SetupWithManager(mgr ctrl.Manager) error {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> ctrl.NewControllerManagedBy(mgr).
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//watch HelloWorldè¿™ä¸ªcrdä½œä¸ºä¸€ç›‘æ§èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		For(<span style="color:#f92672">&amp;</span>testv1alpha1.HelloWorld{}).
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">//watch Deploymentä½œä¸ºç¬¬äºŒä¸ªç›‘æ§èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		Owns(<span style="color:#f92672">&amp;</span>appsv1.Deployment{}).
</span></span><span style="display:flex;"><span>		Complete(r)
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<h4 id="è¿è¡Œoperator">è¿è¡Œoperator</h4>
<p>è¿è¡Œoperatoræ”¯æŒä»¥ä¸‹ä¸‰ç§æ–¹å¼ã€‚</p>
<ol>
<li>controllerä½œä¸ºä¸€ä¸ªgoåº”ç”¨è¿è¡Œåœ¨é›†ç¾¤ä¹‹å¤–æ–¹å¼è¿è¡Œã€‚</li>
<li>ä½œä¸ºä¸€ä¸ªdeploymentç›´æ¥å°†ç¨‹åºæ‰“åŒ…æˆé•œåƒè¿è¡Œåœ¨é›†ç¾¤å†…éƒ¨ã€‚</li>
<li>ä½¿ç”¨oolmæ–¹å¼éƒ¨ç½²ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„è¿™é‡Œè¿è¡Œoperatorå®é™…ä¸Šæ˜¯æœ‰3æ­¥</p>
<ol>
<li>å°†crdçš„å®šä¹‰å®‰è£…åˆ°é›†ç¾¤ã€‚</li>
<li>è¿è¡Œcontrollerç›‘æ§crçš„èµ„æºåˆ›å»º/åˆ é™¤/ä¿®æ”¹ç­‰ï¼Œå®é™…è¿è¡Œçš„ç¨‹åºå°±æ˜¯è¿è¡Œcontrollerï¼Œcontrollerå¯ä»¥è¿è¡Œåœ¨é›†ç¾¤å¤–å’Œé›†ç¾¤å†…å‡å¯ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªcrï¼Œè§¦å‘controllerã€‚</li>
</ol></blockquote>
<p>å…¶ä¸­2å’Œ3æ–¹å¼é€‚åˆç”Ÿäº§éƒ¨ç½²ï¼šå¯å‚è€ƒï¼šhttps://master.sdk.operatorframework.io/docs/building-operators/golang/tutorial/#run-the-operator
è¿™é‡Œæ¼”ç¤ºç¬¬ä¸€ç§æ–¹å¼ï¼Œå› ä¸ºæ–¹ä¾¿è°ƒè¯•ï¼Œæˆ‘è¿™ä½¿ç”¨ideaåœ¨windowä¸‹ç¯å¢ƒã€‚
å‰ç½®æ¡ä»¶ï¼šwindowå®‰è£…kubectlå‚è€ƒå‰é¢çš„ç« èŠ‚ã€‚
ç¡®ä¿èƒ½æ­£å¸¸æ‰§è¡Œkubectlå‘½ä»¤</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>D:<span style="color:#960050;background-color:#1e0010">\</span>code1<span style="color:#960050;background-color:#1e0010">\</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">&gt;</span>kubectl get pods
</span></span><span style="display:flex;"><span>NAME       READY   STATUS    RESTARTS        AGE
</span></span><span style="display:flex;"><span>dnsutils   <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     Running   <span style="color:#ae81ff">290</span> (<span style="color:#ae81ff">59</span>m ago)   <span style="color:#ae81ff">12</span>d
</span></span><span style="display:flex;"><span>nginx      <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     Running   <span style="color:#ae81ff">1</span> (<span style="color:#ae81ff">7</span>d ago)      <span style="color:#ae81ff">12</span>d</span></span></code></pre></div>
<h5 id="ä¿®æ”¹é…ç½®">ä¿®æ”¹é…ç½®</h5>
<p>æ³¨æ„è¯¥é…ç½®ä¿®æ”¹ï¼Œå¦‚æœæ˜¯æœ¬åœ°è°ƒè¯•å¯ä»¥ä¸æ‰§è¡Œï¼Œå¦‚æœä½¿ç”¨2-3æ–¹å¼è¿è¡Œæ˜¯å¿…é€‰é¡¹
é…ç½®é•œåƒï¼Œä¿®æ”¹Makefile
æ³¨é‡Šæ‰</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#f92672">-</span>IMG <span style="color:#f92672">?=</span> controller:latest</span></span></code></pre></div>
<p>ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„registryç§æœ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>IMAGE_TAG_BASE <span style="color:#f92672">?=</span> jiaozi.com:<span style="color:#ae81ff">5000</span><span style="color:#f92672">/</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># BUNDLE_IMG defines the image:tag used for the bundle.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># You can use it as an arg. (E.g make bundle-build BUNDLE_IMG=&lt;some-registry&gt;/&lt;project-name-bundle&gt;:&lt;tag&gt;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>BUNDLE_IMG <span style="color:#f92672">?=</span> <span style="color:#960050;background-color:#1e0010">$</span>(IMAGE_TAG_BASE)<span style="color:#f92672">-</span>bundle:v<span style="color:#960050;background-color:#1e0010">$</span>(VERSION)</span></span></code></pre></div>
<p>ä¿®æ”¹Dockerfile
æ³¨é‡Šæ‰ä»£ç </p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#USER 65532:65532</span></span></span></code></pre></div>
<p>å°†åŸºç¡€é•œåƒ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>FROM gcr.io<span style="color:#f92672">/</span>distroless<span style="color:#f92672">/</span><span style="color:#66d9ef">static</span><span style="color:#f92672">:</span>nonroot</span></span></code></pre></div>
<p>æ›¿æ¢ä¸ºï¼š</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>FROM alpine:latest</span></span></code></pre></div>
<p>å»é™¤å•å…ƒæµ‹è¯•
ä¿®æ”¹makefile</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>docker<span style="color:#f92672">-</span>build: test <span style="color:#960050;background-color:#1e0010">##</span> Build docker image with the manager.</span></span></code></pre></div>
<p>ä¸º</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>docker<span style="color:#f92672">-</span>build:  <span style="color:#960050;background-color:#1e0010">##</span> Build docker image with the manager.</span></span></code></pre></div>
<p>æ‰§è¡Œå‘½ä»¤ï¼Œæ„å»ºé•œåƒï¼Œæ¨é€åˆ°ç§æœ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>make docker<span style="color:#f92672">-</span>build docker<span style="color:#f92672">-</span>push</span></span></code></pre></div>
<h5 id="æ‰“å°æ—¥å¿—">æ‰“å°æ—¥å¿—</h5>
<p>æ‰“å°æ—¥å¿—ä¸»è¦æ˜¯æ–¹ä¾¿è°ƒè¯•ã€‚
main.goä¸­åˆ›å»ºReconcileréƒ¨åˆ†æ·»åŠ å‚æ•°</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> err <span style="color:#f92672">=</span> (<span style="color:#f92672">&amp;</span>controllers.HelloWorldReconciler{
</span></span><span style="display:flex;"><span>		Client: mgr.GetClient(),
</span></span><span style="display:flex;"><span>		Log:    ctrl.Log.WithName(<span style="color:#e6db74">&#34;helloworld&#34;</span>),
</span></span><span style="display:flex;"><span>		Scheme: mgr.GetScheme(),
</span></span><span style="display:flex;"><span>	}).SetupWithManager(mgr); err <span style="color:#f92672">!=</span> nil {
</span></span><span style="display:flex;"><span>		setupLog.Error(err, <span style="color:#e6db74">&#34;unable to create controller&#34;</span>, <span style="color:#e6db74">&#34;controller&#34;</span>, <span style="color:#e6db74">&#34;HelloWorld&#34;</span>)
</span></span><span style="display:flex;"><span>		os.Exit(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	}</span></span></code></pre></div>
<p>HelloWorldReconcilerç»“æ„ä½“å®šä¹‰æ·»åŠ Log</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>type HelloWorldReconciler <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	client.Client
</span></span><span style="display:flex;"><span>	Log    logr.Logger <span style="color:#75715e">//æ—¥å¿—æ‰“å°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	Scheme <span style="color:#f92672">*</span>runtime.Scheme
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>å¯åœ¨æ–¹æ³•ä¸­ä½¿ç”¨</p>
<ul>
<li>r.Log.Info(&ldquo;crdèµ„æºå·²ç»è¢«åˆ é™¤&rdquo;)  æ‰“å°infoæ—¥å¿—</li>
<li>r.Log.Error(&ldquo;å¼‚å¸¸ä¿¡æ¯&rdquo;) æ‰“å°erroræ—¥å¿—</li>
</ul>
<h5 id="å®‰è£…crd">å®‰è£…crd</h5>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>make install</span></span></code></pre></div>
<p>æŸ¥çœ‹å®‰è£…</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>D:<span style="color:#960050;background-color:#1e0010">\</span>code1<span style="color:#960050;background-color:#1e0010">\</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">&gt;</span>kubectl get crd <span style="color:#f92672">|</span> grep hello
</span></span><span style="display:flex;"><span>helloworlds.test.jiaozi.com                           <span style="color:#ae81ff">2022</span><span style="color:#f92672">-</span><span style="color:#ae81ff">02</span><span style="color:#f92672">-</span><span style="color:#ae81ff">28</span>T10:<span style="color:#ae81ff">30</span><span style="color:#f92672">:</span><span style="color:#ae81ff">42</span>Z</span></span></code></pre></div>
<p>æŸ¥çœ‹å®šä¹‰</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>D:<span style="color:#960050;background-color:#1e0010">\</span>code1<span style="color:#960050;background-color:#1e0010">\</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">&gt;</span>kubectl explain helloworlds.test.jiaozi.com
</span></span><span style="display:flex;"><span>KIND:     HelloWorld
</span></span><span style="display:flex;"><span>VERSION:  test.jiaozi.com<span style="color:#f92672">/</span>v1alpha1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DESCRIPTION:
</span></span><span style="display:flex;"><span>     <span style="color:#960050;background-color:#1e0010">è¡¨ç¤ºä¸‹é¢è¿™ä¸ªç»“æ„æ˜¯</span>yamlçš„æ ¹ <span style="color:#960050;background-color:#1e0010">åŒæ—¶æ·»åŠ å­èµ„æºçŠ¶æ€å’Œ</span>scale
</span></span><span style="display:flex;"><span>     HelloWorldæ˜¯ helloworlds APIçš„å®šä¹‰
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FIELDS:
</span></span><span style="display:flex;"><span>   apiVersion   <span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>     APIVersion defines the versioned schema of <span style="color:#66d9ef">this</span> representation of an
</span></span><span style="display:flex;"><span>     object. Servers should convert recognized schemas to the latest internal
</span></span><span style="display:flex;"><span>     value, and may reject unrecognized values. More info:
</span></span><span style="display:flex;"><span>     https:<span style="color:#75715e">//git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   kind <span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>     Kind is a string value representing the REST resource <span style="color:#66d9ef">this</span> object
</span></span><span style="display:flex;"><span>     represents. Servers may infer <span style="color:#66d9ef">this</span> from the endpoint the client submits
</span></span><span style="display:flex;"><span>     requests to. Cannot be updated. In CamelCase. More info:
</span></span><span style="display:flex;"><span>     https:<span style="color:#75715e">//git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   metadata     <span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>     Standard object<span style="color:#960050;background-color:#1e0010">&#39;</span>s metadata. More info:
</span></span><span style="display:flex;"><span>     https:<span style="color:#75715e">//git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>   spec <span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>     HelloWorldSpec <span style="color:#960050;background-color:#1e0010">å®šä¹‰ä¸Šé¢</span>specçš„éƒ¨åˆ†
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   status       <span style="color:#f92672">&lt;</span>Object<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>     HelloWorldStatuså®šä¹‰HelloWorldçš„çŠ¶æ€è§‚å¯Ÿ</span></span></code></pre></div>
<h5 id="è¿è¡Œcontroller">è¿è¡Œcontroller</h5>
<p>è¿è¡Œcontroller watch crçš„åˆ›å»º/åˆ é™¤/ä¿®æ”¹</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>D:<span style="color:#960050;background-color:#1e0010">\</span>code1<span style="color:#960050;background-color:#1e0010">\</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">&gt;</span>make run .
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>cygdrive<span style="color:#f92672">/</span>d<span style="color:#f92672">/</span>code1<span style="color:#f92672">/</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>controller<span style="color:#f92672">-</span>gen rbac:roleName<span style="color:#f92672">=</span>manager<span style="color:#f92672">-</span>role crd webhook paths<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./...&#34;</span> output:crd:artifacts:config<span style="color:#f92672">=</span>config<span style="color:#f92672">/</span>crd<span style="color:#f92672">/</span>bases
</span></span><span style="display:flex;"><span><span style="color:#f92672">/</span>cygdrive<span style="color:#f92672">/</span>d<span style="color:#f92672">/</span>code1<span style="color:#f92672">/</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>controller<span style="color:#f92672">-</span>gen object:headerFile<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hack</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">boilerplate.go.txt&#34;</span> paths<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./...&#34;</span>
</span></span><span style="display:flex;"><span>go fmt .<span style="color:#f92672">/</span>...
</span></span><span style="display:flex;"><span>go vet .<span style="color:#f92672">/</span>...
</span></span><span style="display:flex;"><span>go run .<span style="color:#f92672">/</span>main.go
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460445940803254e+09</span>  INFO    controller<span style="color:#f92672">-</span>runtime.metrics      Metrics server is starting to listen    {<span style="color:#e6db74">&#34;addr&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;:8080&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460445940819194e+09</span>  INFO    setup   starting manager
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460445940819194e+09</span>  INFO    Starting server {<span style="color:#e6db74">&#34;kind&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;health probe&#34;</span>, <span style="color:#e6db74">&#34;addr&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;[::]:8081&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460445940819194e+09</span>  INFO    Starting server {<span style="color:#e6db74">&#34;path&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/metrics&#34;</span>, <span style="color:#e6db74">&#34;kind&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;metrics&#34;</span>, <span style="color:#e6db74">&#34;addr&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;[::]:8080&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.646044594082426e+09</span>   INFO    controller.helloworld   Starting EventSource    {<span style="color:#e6db74">&#34;reconciler group&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;test.jiaozi.com&#34;</span>, <span style="color:#e6db74">&#34;reconciler kind&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>, <span style="color:#e6db74">&#34;source&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;kind source: *v1alpha1.HelloWorld&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460445940830188e+09</span>  INFO    controller.helloworld   Starting EventSource    {<span style="color:#e6db74">&#34;reconciler group&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;test.jiaozi.com&#34;</span>, <span style="color:#e6db74">&#34;reconciler kind&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>, <span style="color:#e6db74">&#34;source&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;kind source: *v1.Deployment&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460445940830188e+09</span>  INFO    controller.helloworld   Starting Controller     {<span style="color:#e6db74">&#34;reconciler group&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;test.jiaozi.com&#34;</span>, <span style="color:#e6db74">&#34;reconciler kind&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460445941841855e+09</span>  INFO    controller.helloworld   Starting workers        {<span style="color:#e6db74">&#34;reconciler group&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;test.jiaozi.com&#34;</span>, <span style="color:#e6db74">&#34;reconciler kind&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;HelloWorld&#34;</span>, <span style="color:#e6db74">&#34;worker count&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>}</span></span></code></pre></div>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªcr ä½¿ç”¨å‘½ä»¤æ‰§è¡Œ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>apiVersion: test.jiaozi.com<span style="color:#f92672">/</span>v1alpha1
</span></span><span style="display:flex;"><span>kind: HelloWorld
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: helloworld<span style="color:#f92672">-</span>sample
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  size: <span style="color:#ae81ff">2</span></span></span></code></pre></div>
<p>kubectl apply -f helloworld.yaml
å¯çœ‹åˆ°controllerçš„æ§åˆ¶å°å‡ºç°äº†ç›´æ¥logæ‰“å°çš„æ—¥å¿—</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#ae81ff">1.6460447152888484e+09</span>  INFO    helloworld      recondileè¢«è°ƒç”¨default<span style="color:#f92672">-</span>helloworld<span style="color:#f92672">-</span>sample
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460447152893913e+09</span>  INFO    helloworld      <span style="color:#960050;background-color:#1e0010">ä¸å­˜åœ¨</span>deploy<span style="color:#960050;background-color:#1e0010">ï¼Œæ–°å»º</span>deploy
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460447152947052e+09</span>  INFO    helloworld      <span style="color:#960050;background-color:#1e0010">ä¸å­˜åœ¨</span>deploy<span style="color:#960050;background-color:#1e0010">ï¼Œæ–°å»º</span>deployæˆåŠŸ
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.646044715295705e+09</span>   INFO    helloworld      recondileè¢«è°ƒç”¨default<span style="color:#f92672">-</span>helloworld<span style="color:#f92672">-</span>sample
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460447153962688e+09</span>  INFO    helloworld      <span style="color:#960050;background-color:#1e0010">æ›´æ–°çŠ¶æ€å¤š</span>hellowordçš„å­status
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.6460447154029741e+09</span>  INFO    helloworld      recondileè¢«è°ƒç”¨default<span style="color:#f92672">-</span>helloworld<span style="color:#f92672">-</span>sample</span></span></code></pre></div>
<p>æŸ¥çœ‹deployå’Œpodçš„ä¸ªæ•°</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>D:<span style="color:#960050;background-color:#1e0010">\</span>code1<span style="color:#960050;background-color:#1e0010">\</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">&gt;</span>kubectl get deploy
</span></span><span style="display:flex;"><span>NAME                READY   UP<span style="color:#f92672">-</span>TO<span style="color:#f92672">-</span>DATE   AVAILABLE   AGE
</span></span><span style="display:flex;"><span>helloworld<span style="color:#f92672">-</span>sample   <span style="color:#ae81ff">2</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>     <span style="color:#ae81ff">2</span>            <span style="color:#ae81ff">2</span>           <span style="color:#ae81ff">60</span>s
</span></span><span style="display:flex;"><span>D:<span style="color:#960050;background-color:#1e0010">\</span>code1<span style="color:#960050;background-color:#1e0010">\</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">&gt;</span>kubectl get pod <span style="color:#f92672">|</span> grep hello
</span></span><span style="display:flex;"><span>helloworld<span style="color:#f92672">-</span>sample<span style="color:#f92672">-</span><span style="color:#ae81ff">569448757</span><span style="color:#f92672">-</span>pdq7q   <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     Running   <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">75</span>s
</span></span><span style="display:flex;"><span>helloworld<span style="color:#f92672">-</span>sample<span style="color:#f92672">-</span><span style="color:#ae81ff">569448757</span><span style="color:#f92672">-</span>x4b9p   <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span>     Running   <span style="color:#ae81ff">0</span>               <span style="color:#ae81ff">75</span>s</span></span></code></pre></div>
<h5 id="è°ƒè¯•controller">è°ƒè¯•controller</h5>
<p>é¦–å…ˆç”Ÿæˆexeæ–‡ä»¶</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>go build</span></span></code></pre></div>
<p><a href="#R-image-5b942c854a3cbb37886bd93a5aa4386c" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/96cbf3398504182eefbb2edb8c24096a.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-5b942c854a3cbb37886bd93a5aa4386c"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/96cbf3398504182eefbb2edb8c24096a.png"></a>
å®‰è£…dlvï¼Œå¦‚æœä¸‹è½½æœ‰é”™ï¼Œå¤šä¸‹è½½å‡ æ¬¡ï¼Œæœ€å¥½è®¾ç½®ä»£ç†</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>go get <span style="color:#f92672">-</span>u github.com<span style="color:#f92672">/</span>go<span style="color:#f92672">-</span>delve<span style="color:#f92672">/</span>delve<span style="color:#f92672">/</span>cmd<span style="color:#f92672">/</span>dlv</span></span></code></pre></div>
<p><del>æ‰“å¼€idea help-edit custom propertiesï¼Œæ–°å¢dlvå‚æ•°ä½ç½®ï¼ˆè¯¥æ­¥éª¤çœç•¥ï¼‰ï¼š</del></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>dlv.path<span style="color:#f92672">=</span>C:<span style="color:#f92672">/</span>Users<span style="color:#f92672">/</span>liaomin<span style="color:#f92672">/</span>go<span style="color:#f92672">/</span>bin<span style="color:#f92672">/</span>dlv.exe</span></span></code></pre></div>
<p>æ‰§è¡Œdlvå‘½ä»¤å¼€æ”¾2345ç«¯å£</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>dlv exec <span style="color:#f92672">--</span>headless <span style="color:#f92672">--</span>listen <span style="color:#e6db74">&#34;:2345&#34;</span> <span style="color:#f92672">--</span>log <span style="color:#f92672">--</span>api<span style="color:#f92672">-</span>version <span style="color:#ae81ff">2</span> .<span style="color:#f92672">/</span>helloworld<span style="color:#f92672">-</span><span style="color:#66d9ef">operator</span>.exe</span></span></code></pre></div>
<p>ideaåˆ›å»ºä¸€ä¸ªgo remote
<a href="#R-image-7f75e940d7996517b36599eddecc73ce" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/d65859fe9c2b136964c60950be8c98bf.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7f75e940d7996517b36599eddecc73ce"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/d65859fe9c2b136964c60950be8c98bf.png"></a>
hostå’Œporté»˜è®¤å³å¯ï¼Œç¡®è®¤åï¼Œç¨‹åºå¼€å§‹æ­£å¸¸è¿è¡Œï¼Œå¯ä»¥åœ¨controllerä¸‹æ–­ç‚¹ï¼Œæ‰§è¡Œkubectlæ–°å¢/åˆ é™¤crèµ„æºå¯æ­£å¸¸è°ƒè¯•
<a href="#R-image-60704f9056f83ad5b85760d142480a44" class="lightbox-link"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox figure-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/7b252a370210fdd7b0fe25a875974695.png" style=" height: auto; width: auto;"></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-60704f9056f83ad5b85760d142480a44"><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" class="lazy lightbox lightbox-image" loading="lazy" src="/docs/images/content/devops/kubernetes/k8s_dev_04.md.images/7b252a370210fdd7b0fe25a875974695.png"></a></p>

  <footer class="footline">
              <i class='fa-fw fas fa-calendar'></i> Sep 18, 2025
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/docs/index.html">
            <div class="logo-title">liaomin416100569åšå®¢</div>
          </a>
        </div>
        <search><form action="/docs/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/docs/index.html"><a class="padding" href="/docs/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/docs/programming/index.html"><a class="padding" href="/docs/programming/index.html">ç¼–ç¨‹å¼€å‘</a><ul id="R-subsections-e3fc01b477dbaf64a8f5013a3dab5c5b" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/docs/devops/index.html"><a class="padding" href="/docs/devops/index.html">è¿ç»´ä¸€ä½“åŒ–</a><ul id="R-subsections-389d4feb4920b919bcbc0b1e9947dace" class="collapsible-menu">
            <li class="parent alwaysopen " data-nav-id="/docs/devops/kubernetes/index.html"><a class="padding" href="/docs/devops/kubernetes/index.html">kubernetes</a><ul id="R-subsections-a6d9d4850f81ae033d42cdaa03dad084" class="collapsible-menu">
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_01/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_01/index.html">K8SäºŒæ¬¡å¼€å‘01-å„ç§èµ„æºå¯¹è±¡çš„ç†è§£å’Œå®šä¹‰</a></li>
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_02/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_02/index.html">K8SäºŒæ¬¡å¼€å‘02-kubeadmå®‰è£…k8sé›†ç¾¤</a></li>
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_03/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_03/index.html">K8SäºŒæ¬¡å¼€å‘03-CRDèµ„æºè¯¦è§£</a></li>
            <li class="active " data-nav-id="/docs/devops/kubernetes/k8s_dev_04/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_04/index.html">K8SäºŒæ¬¡å¼€å‘04-è‡ªå®šä¹‰operatorï¼ˆoperator-sdkè°ƒè¯•ï¼‰</a></li>
            <li class="" data-nav-id="/docs/devops/kubernetes/k8s_dev_05/index.html"><a class="padding" href="/docs/devops/kubernetes/k8s_dev_05/index.html">K8SäºŒæ¬¡å¼€å‘05-ä½¿ç”¨clientgoè‡ªå®šä¹‰ingresscontroller</a></li></ul></li>
            <li class="alwaysopen " data-nav-id="/docs/devops/networking/index.html"><a class="padding" href="/docs/devops/networking/index.html">ç½‘ç»œæŠ€æœ¯</a><ul id="R-subsections-bd6b3f75e8269a91d29691b78d3bac17" class="collapsible-menu"></ul></li></ul></li>
            <li class="" data-nav-id="/docs/security/index.html"><a class="padding" href="/docs/security/index.html">å®‰å…¨æ”»é˜²</a><ul id="R-subsections-66815ecaaecfc1c209e5637d03b258b2" class="collapsible-menu"></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/docs/js/clipboard/clipboard.min.js?1758355652" defer></script>
    <script src="/docs/js/perfect-scrollbar/perfect-scrollbar.min.js?1758355652" defer></script>
    <script src="/docs/js/theme.min.js?1758355652" defer></script>
  </body>
</html>
